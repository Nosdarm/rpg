# –°–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
## Phase 0: Architecture and Initialization
- Task 0.1: Discord Bot Project Initialization and Basic Guild Integration (MVP)
- Task 0.2: DBMS Setup and Database Model Definition with Guild ID (MVP)
- Task 0.3: Common Guild-Scoped Database Utilities (MVP)
## Phase 1: Game World (Static & Generated)
- Task 1.1: Location Model (i18n, Guild-Scoped)
- Task 1.2: Player and Party System (ORM, Commands, Guild-Scoped)
- Task 1.3: Movement Logic (API, Command, Guild-Scoped, Basic Party Movement)
## Phase 2: AI Integration - Generation Core
- Task 2.1: Finalize Definition of ALL DB Schemas (i18n, Guild ID)
- Task 2.2: AI Prompt Preparation Module (MVP)
- Task 2.3: AI Response Parsing and Validation Module (MVP)
- Task 2.6: AI Generation, Moderation, and Saving Logic (MVP, Guild-Scoped)
## Phase 5: Combat System
- Task 26: ‚öîÔ∏è 5.1 Combat and Participant Model (Guild-Scoped).
Description: Defined the CombatEncounter model in `src/models/combat_encounter.py` with fields for id, guild_id, location_id, status (using `CombatStatus` enum from `src/models/enums.py`), current_turn_entity_id, current_turn_entity_type, turn_order_json, rules_config_snapshot_json, participants_json, and combat_log_json. Added relationships to GuildConfig and Location. Created Alembic migration `0002_create_combat_encounter_table.py` (down_revision `fcb2e6d12a18`). Wrote basic unit tests in `tests/models/test_combat_encounter.py` which passed after installing dependencies.
Result: Model for tracking active combat state defined, migrated, and basic tests pass.
## Phase 6: Action Resolution Systems (Core Mechanics)
- Task ‚öôÔ∏è 6.1.1: Intra-Location Interaction Handler Module
- Task ‚öôÔ∏è 6.3.1: Dice Roller Module (MVP)
- Task ‚öôÔ∏è 6.3.2: Check Resolver Module (MVP)
- Task ‚öôÔ∏è 6.10: Action Parsing and Recognition Module (NLU & Intent/Entity) (MVP)
- Task ‚öôÔ∏è 6.11: Central Collected Actions Processing Module (Turn Processor) - Guild-Scoped Execution (MVP)
- Task ‚öôÔ∏è 6.12: Turn Queue System (Turn Controller) - Per-Guild Processing (MVP)
## Phase 7: Narrative Generation and Event Log
- Task 17: üìö 7.1 Event Log Model (Story Log, i18n, Guild-Scoped)
- Task 18: üìö 7.2 AI Narrative Generation (Multilang)
Description: Verified existing `generate_narrative` function in `src/core/ai_orchestrator.py`. Confirmed it meets requirements for language handling (player/guild/default), prompt construction from context, and error handling. Ensured it's correctly exported. Verified existing unit tests in `tests/core/test_ai_orchestrator.py` cover necessary scenarios. No code changes were required for the function itself.
Result: API for generating narrative text on demand is confirmed to be in place and tested.
- Task 19: üìö 7.3 Turn and Report Formatting (Guild-Scoped)
Description: –î–æ—Ä–∞–±–æ—Ç–∞–Ω –º–æ–¥—É–ª—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ (`src/core/report_formatter.py`). –†–∞—Å—à–∏—Ä–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `EventType` –≤ `_format_log_entry_with_names_cache` (–¥–æ–±–∞–≤–ª–µ–Ω—ã `NPC_ACTION`, `ITEM_USED`, `ITEM_DROPPED`, `DIALOGUE_START`, `DIALOGUE_END`, `FACTION_CHANGE` –∏ –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ—á–∏—Ö —Å–æ–±—ã—Ç–∏–π). –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_collect_entity_refs_from_log_entry` –¥–ª—è —Å–±–æ—Ä–∞ ID –∏–∑ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_report_formatter.py`. –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã `format_turn_report` –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å `localization_utils` –∏ `rules`.
Result: –ú–æ–¥—É–ª—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ RuleConfig. –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
## Phase 3: Abilities and Checks Mechanics
- Task 20: üß† 3.1 Ability Model (i18n, Guild-Scoped)
- Task 21: üß† 3.2 Entity Status Model (Status Effects, i18n, Guild-Scoped)
Description: Defined `StatusEffect` and `ActiveStatusEffect` models in `src/models/status_effect.py`. `StatusEffect` stores definitions (guild-scoped, i18n names/descriptions, properties). `ActiveStatusEffect` tracks instances applied to entities (players, NPCs) with duration, source, and custom properties. Updated `GuildConfig` with relationships. Created Alembic migration `0004_create_status_effects_tables.py`. Added basic unit tests for model creation.
Result: StatusEffect and ActiveStatusEffect models defined and integrated with basic tests.
- Task 22: üß† 3.3 API for Activating Abilities and Applying Statuses (Guild-Scoped)
Description: –î–æ—Ä–∞–±–æ—Ç–∞–Ω –º–æ–¥—É–ª—å `src/core/ability_system.py`. –§—É–Ω–∫—Ü–∏–∏ `activate_ability` –∏ `apply_status` –±—ã–ª–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω—ã.
  - `activate_ability` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤, —É—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä 'caster_must_be_in_combat'), –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (damage, healing, apply_status) —Å —É—á–µ—Ç–æ–º `target_scope`, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `AbilityOutcomeDetails`.
  - `apply_status` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ (–ø—Ä–∏ `duration_refresh: true`), –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `source_entity_id/type` –∏ `remaining_turns`.
  - `remove_status` –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –ø—Ä–∏–∑–Ω–∞–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º.
  - –í `ActiveStatusEffect` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `source_entity_id`, `source_entity_type` (—Å –º–∏–≥—Ä–∞—Ü–∏–µ–π).
  - –°–æ–∑–¥–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –≤ `src/core/entity_stats_utils.py` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è HP –∏ —Å—Ç–∞—Ç–∞–º–∏.
  - –ù–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_ability_system.py`.
Result: API –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è/—Å–Ω—è—Ç–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –≤–∫–ª—é—á–∞—è –±–∞–∑–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ. –ì–æ—Ç–æ–≤–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ RuleConfig.
<<<<<<< HEAD
=======
## Phase 5: Combat System (Continued)
- Task 27: ‚öîÔ∏è 5.2 Combat Engine Module.
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å `src/core/combat_engine.py` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `process_combat_action` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ –±–æ—é. –í–∫–ª—é—á–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –±–æ—è –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª (–∏–∑ —Å–Ω—ç–ø—à–æ—Ç–∞ –∏–ª–∏ RuleConfig), –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ–π—Å—Ç–≤–∏—è "attack" —Å –≤—ã–∑–æ–≤–æ–º `core.check_resolver.resolve_check` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞–Ω–∏—è. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞, –≤–∫–ª—é—á–∞—è –±–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –æ—Ç –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–¥–∞—Ä—ã (—Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤: `multiply_total_damage`, `double_damage_dice`, `maximize_and_add_dice`). –°–æ—Å—Ç–æ—è–Ω–∏–µ HP —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `CombatEncounter.participants_json`. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–æ—è –∏ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `CombatEncounter.combat_log_json` –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π `StoryLog` —á–µ—Ä–µ–∑ `core.game_events.log_event`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–Ω–µ –Ω–∞–π–¥–µ–Ω –±–æ–π, –∞–∫—Ç–æ—Ä, —Ü–µ–ª—å; —Ü–µ–ª—å —É–∂–µ –ø–æ–±–µ–∂–¥–µ–Ω–∞; –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ). –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `_get_combat_rule`, `_calculate_attribute_modifier`, `_get_participant_stat` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è. –ú–æ–¥–µ–ª–∏ `CheckResult`, `ModifierDetail`, `CheckOutcome` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ `src/models/check_results.py`. –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_combat_engine.py` (15 —Ç–µ—Å—Ç–æ–≤), –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ `process_combat_action`, –≤–∫–ª—é—á–∞—è –∞—Ç–∞–∫–∏, –ø—Ä–æ–º–∞—Ö–∏, –∫—Ä–∏—Ç—ã –∏ –æ—à–∏–±–∫–∏. –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
Result: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏—Å—Ö–æ–¥–æ–≤ –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–∞–≤–∏–ª, –ø—Ä–æ–≤–µ—Ä–æ–∫, —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Ä–æ–Ω–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
>>>>>>> bfb432bba449467aa352f0a8ca96d45b5f915ac2
## Phase 6: Action Resolution Systems (Core Mechanics)
- Task ‚öôÔ∏è 6.1.1: Intra-Location Interaction Handler Module.
Description: –î–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_intra_location_action` –≤ `src/core/interaction_handlers.py` –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ `interact`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig` (–∫–ª—é—á `interactions:<interaction_rules_key>`). –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (`requires_check`), –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `core.check_resolver.resolve_check`, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –ö–ª—é—á–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π (`success_consequences_key`, `failure_consequences_key`, `direct_consequences_key`) –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –±—É–¥—É—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –≤ `_format_feedback` –∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ `log_event` –¥–ª—è `player_interact`. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_interaction_handlers.py` –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ `interact`, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª.
Result: –ú–æ–¥—É–ª—å `interaction_handlers` —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä–æ–∫ —á–µ—Ä–µ–∑ `resolve_check`.
## Phase 4: World and Location Model
- Task 23: üó∫Ô∏è 4.1 Location Model (i18n, Guild-Scoped)
Description: –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ –º–æ–¥–µ–ª—å `Location` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã. –ü–æ–ª—è –º–æ–¥–µ–ª–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `JSONB`). –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `on_guild_join` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `GuildConfig` (—Å –ø–æ–ª–µ–º `name`) –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π (`DEFAULT_STATIC_LOCATIONS`) –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –±–æ—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î (`0005_use_jsonb_for_location_fields.py`). –ù–∞–ø–∏—Å–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–∏ `Location` –∏ —É—Ç–∏–ª–∏—Ç `locations_utils`. –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
Result: –ú–æ–¥–µ–ª—å Location –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–∏–ª—å–¥–∏–∏ –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π. –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Ç–µ—Å—Ç–∞–º–∏.
- Task 25: üó∫Ô∏è 4.3 Location Transitions (Guild-Scoped)
Description: –î–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `execute_move_for_player_action` –≤ `src/core/movement_logic.py` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è Task 25. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏ (`PARTY_MOVEMENT_RULES`) –∏–∑ `RuleConfig` (–ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ `leader_only`). –í –º–æ–¥–µ–ª—å `Party` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `leader_player_id` —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π Alembic (`7c27451a6727_add_leader_player_id_to_party.py`). –§—É–Ω–∫—Ü–∏—è –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞/–ø–∞—Ä—Ç–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ª–æ–∫–∞—Ü–∏–∏ (static_id –∏–ª–∏ –∏–º—è —Å i18n), –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≤—è–∑–Ω–æ—Å—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `on_enter_location` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã–∑—ã–≤–∞—é—â–∏–º –∫–æ–¥–æ–º (action_processor) –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_movement_logic.py`.
Result: API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤ –∏ –ø–∞—Ä—Ç–∏–π –º–µ–∂–¥—É –ª–æ–∫–∞—Ü–∏—è–º–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤–∏–ª –¥–ª—è –ø–∞—Ä—Ç–∏–π.
- Task 24: üó∫Ô∏è 4.2 Guild Map Generation and Editing (Guild-Scoped)
Description: –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_location` –≤ `src/core/world_generation.py` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è `parent_location_id` –∏ `connection_details_i18n` –ø—Ä–∏ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞—Ü–∏–π. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–≤—è–∑–µ–π —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–∫–∞—Ü–∏–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ Discord `/master_map generate_ai_location` –≤ `src/bot/commands/master_map_commands.py` –¥–ª—è –ø—Ä–∏–µ–º–∞ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (`parent_location_id`, `connection_details_i18n_json`) –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –∏—Ö –≤ `generate_location`. –ú–æ–∫ AI (`_mock_openai_api_call`) –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
Result: API –∏ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞—Ü–∏–π AI —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —è–≤–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–∫–∞—Ü–∏–µ–π, —É–ª—É—á—à–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –ú–∞—Å—Ç–µ—Ä–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –∫–∞–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (–†–∞–∑–Ω–æ–µ)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç –¥–ª—è main.py, –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –∏ TypeError
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Alembic –º–∏–≥—Ä–∞—Ü–∏–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-—Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏—Ö –∑–∞–ø—É—Å–∫–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç–∞ (—á–∏—Ç–∞–µ–º–æ—Å—Ç—å, N+1)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö action_processor, general_commands, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ ping
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (—Å–µ—Å—Å–∏—è 2)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (—Å–µ—Å—Å–∏—è 3 - test_action_processor, localization_utils, test_interaction_handlers, ai_orchestrator, test_general_commands, events, game_events, movement_logic, report_formatter, test_localization_utils, test_movement_logic)
