# –°–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
## Phase 0: Architecture and Initialization
- Task 0.1: Discord Bot Project Initialization and Basic Guild Integration (MVP)
- Task 0.2: DBMS Setup and Database Model Definition with Guild ID (MVP)
- Task 0.3: Common Guild-Scoped Database Utilities (MVP)
## Phase 1: Game World (Static & Generated)
- Task 1.1: Location Model (i18n, Guild-Scoped)
- Task 1.2: Player and Party System (ORM, Commands, Guild-Scoped)
Description: –ü—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π Player, Party, CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π –∏ –∫–æ–º–∞–Ω–¥ Discord (/start, /party). –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ä–∞–Ω–µ–µ. –î–æ–±–∞–≤–ª–µ–Ω—ã Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π (`tests/models/test_player.py`, `tests/models/test_party.py`), CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π (`tests/core/crud/test_crud_player.py`, `tests/core/crud/test_crud_party.py`) –∏ –∫–æ–º–∞–Ω–¥ Discord (`tests/bot/commands/test_general_commands.py`, `tests/bot/commands/test_party_commands.py`). –í –ø—Ä–æ—Ü–µ—Å—Å–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –∏ –ª–æ–≥–∏–∫–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–¥–µ –∏ —Ç–µ—Å—Ç–∞—Ö. –û–¥–∏–Ω —Å–ª–æ–∂–Ω—ã–π —Ç–µ—Å—Ç (`test_process_combat_turn_npc_action`) –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ RecursionError.
Result: –°–∏—Å—Ç–µ–º–∞ –∏–≥—Ä–æ–∫–æ–≤ –∏ –ø–∞—Ä—Ç–∏–π –ø–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏, –æ—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã.
- Task 1.3: Movement Logic (API, Command, Guild-Scoped, Basic Party Movement)
## Phase 2: AI Integration - Generation Core
- Task 2.1: Finalize Definition of ALL DB Schemas (i18n, Guild ID)
- Task 2.2: AI Prompt Preparation Module (MVP)
- Task 2.3: AI Response Parsing and Validation Module (MVP)
- Task 2.6: AI Generation, Moderation, and Saving Logic (MVP, Guild-Scoped)
## Phase 5: Combat System
- Task 26: ‚öîÔ∏è 5.1 Combat and Participant Model (Guild-Scoped).
Description: Defined the CombatEncounter model in `src/models/combat_encounter.py` with fields for id, guild_id, location_id, status (using `CombatStatus` enum from `src/models/enums.py`), current_turn_entity_id, current_turn_entity_type, turn_order_json, rules_config_snapshot_json, participants_json, and combat_log_json. Added relationships to GuildConfig and Location. Created Alembic migration `0002_create_combat_encounter_table.py` (down_revision `fcb2e6d12a18`). Wrote basic unit tests in `tests/models/test_combat_encounter.py` which passed after installing dependencies.
Result: Model for tracking active combat state defined, migrated, and basic tests pass.
## Phase 6: Action Resolution Systems (Core Mechanics)
- Task ‚öôÔ∏è 6.1.1: Intra-Location Interaction Handler Module
- Task ‚öôÔ∏è 6.3.1: Dice Roller Module (MVP)
- Task ‚öôÔ∏è 6.3.2: Check Resolver Module (MVP)
- Task ‚öôÔ∏è 6.10: Action Parsing and Recognition Module (NLU & Intent/Entity) (MVP)
- Task ‚öôÔ∏è 6.11: Central Collected Actions Processing Module (Turn Processor) - Guild-Scoped Execution (MVP)
- Task ‚öôÔ∏è 6.12: Turn Queue System (Turn Controller) - Per-Guild Processing (MVP)
## Phase 7: Narrative Generation and Event Log
- Task 17: üìö 7.1 Event Log Model (Story Log, i18n, Guild-Scoped)
- Task 18: üìö 7.2 AI Narrative Generation (Multilang)
Description: Verified existing `generate_narrative` function in `src/core/ai_orchestrator.py`. Confirmed it meets requirements for language handling (player/guild/default), prompt construction from context, and error handling. Ensured it's correctly exported. Verified existing unit tests in `tests/core/test_ai_orchestrator.py` cover necessary scenarios. No code changes were required for the function itself.
Result: API for generating narrative text on demand is confirmed to be in place and tested.
- Task 19: üìö 7.3 Turn and Report Formatting (Guild-Scoped)
Description: –î–æ—Ä–∞–±–æ—Ç–∞–Ω –º–æ–¥—É–ª—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ (`src/core/report_formatter.py`). –†–∞—Å—à–∏—Ä–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `EventType` –≤ `_format_log_entry_with_names_cache` (–¥–æ–±–∞–≤–ª–µ–Ω—ã `NPC_ACTION`, `ITEM_USED`, `ITEM_DROPPED`, `DIALOGUE_START`, `DIALOGUE_END`, `FACTION_CHANGE` –∏ –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ—á–∏—Ö —Å–æ–±—ã—Ç–∏–π). –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_collect_entity_refs_from_log_entry` –¥–ª—è —Å–±–æ—Ä–∞ ID –∏–∑ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_report_formatter.py`. –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã `format_turn_report` –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å `localization_utils` –∏ `rules`.
Result: –ú–æ–¥—É–ª—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ RuleConfig. –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
## Phase 3: Abilities and Checks Mechanics
- Task 20: üß† 3.1 Ability Model (i18n, Guild-Scoped)
- Task 21: üß† 3.2 Entity Status Model (Status Effects, i18n, Guild-Scoped)
Description: Defined `StatusEffect` and `ActiveStatusEffect` models in `src/models/status_effect.py`. `StatusEffect` stores definitions (guild-scoped, i18n names/descriptions, properties). `ActiveStatusEffect` tracks instances applied to entities (players, NPCs) with duration, source, and custom properties. Updated `GuildConfig` with relationships. Created Alembic migration `0004_create_status_effects_tables.py`. Added basic unit tests for model creation.
Result: StatusEffect and ActiveStatusEffect models defined and integrated with basic tests.
- Task 22: üß† 3.3 API for Activating Abilities and Applying Statuses (Guild-Scoped)
Description: –î–æ—Ä–∞–±–æ—Ç–∞–Ω –º–æ–¥—É–ª—å `src/core/ability_system.py`. –§—É–Ω–∫—Ü–∏–∏ `activate_ability` –∏ `apply_status` –±—ã–ª–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω—ã.
  - `activate_ability` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤, —É—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä 'caster_must_be_in_combat'), –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (damage, healing, apply_status) —Å —É—á–µ—Ç–æ–º `target_scope`, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `AbilityOutcomeDetails`.
  - `apply_status` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ (–ø—Ä–∏ `duration_refresh: true`), –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `source_entity_id/type` –∏ `remaining_turns`.
  - `remove_status` –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –ø—Ä–∏–∑–Ω–∞–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º.
  - –í `ActiveStatusEffect` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `source_entity_id`, `source_entity_type` (—Å –º–∏–≥—Ä–∞—Ü–∏–µ–π).
  - –°–æ–∑–¥–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –≤ `src/core/entity_stats_utils.py` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è HP –∏ —Å—Ç–∞—Ç–∞–º–∏.
  - –ù–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_ability_system.py`.
Result: API –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è/—Å–Ω—è—Ç–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –≤–∫–ª—é—á–∞—è –±–∞–∑–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ. –ì–æ—Ç–æ–≤–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ RuleConfig.
## Phase 5: Combat System (Continued)
- Task 27: ‚öîÔ∏è 5.2 Combat Engine Module.
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å `src/core/combat_engine.py` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `process_combat_action` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ –±–æ—é. –í–∫–ª—é—á–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –±–æ—è –∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª (–∏–∑ —Å–Ω—ç–ø—à–æ—Ç–∞ –∏–ª–∏ RuleConfig), –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ–π—Å—Ç–≤–∏—è "attack" —Å –≤—ã–∑–æ–≤–æ–º `core.check_resolver.resolve_check` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞–Ω–∏—è. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞, –≤–∫–ª—é—á–∞—è –±–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –æ—Ç –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–¥–∞—Ä—ã (—Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤: `multiply_total_damage`, `double_damage_dice`, `maximize_and_add_dice`). –°–æ—Å—Ç–æ—è–Ω–∏–µ HP —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `CombatEncounter.participants_json`. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–æ—è –∏ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `CombatEncounter.combat_log_json` –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π `StoryLog` —á–µ—Ä–µ–∑ `core.game_events.log_event`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–Ω–µ –Ω–∞–π–¥–µ–Ω –±–æ–π, –∞–∫—Ç–æ—Ä, —Ü–µ–ª—å; —Ü–µ–ª—å —É–∂–µ –ø–æ–±–µ–∂–¥–µ–Ω–∞; –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ). –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `_get_combat_rule`, `_calculate_attribute_modifier`, `_get_participant_stat` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è. –ú–æ–¥–µ–ª–∏ `CheckResult`, `ModifierDetail`, `CheckOutcome` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ `src/models/check_results.py`. –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_combat_engine.py` (15 —Ç–µ—Å—Ç–æ–≤), –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ `process_combat_action`, –≤–∫–ª—é—á–∞—è –∞—Ç–∞–∫–∏, –ø—Ä–æ–º–∞—Ö–∏, –∫—Ä–∏—Ç—ã –∏ –æ—à–∏–±–∫–∏. –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
Result: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∏—Å—Ö–æ–¥–æ–≤ –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–∞–≤–∏–ª, –ø—Ä–æ–≤–µ—Ä–æ–∫, —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Ä–æ–Ω–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
## Phase 6: Action Resolution Systems (Core Mechanics)
- Task ‚öôÔ∏è 6.1.1: Intra-Location Interaction Handler Module.
Description: –î–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_intra_location_action` –≤ `src/core/interaction_handlers.py` –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ `interact`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig` (–∫–ª—é—á `interactions:<interaction_rules_key>`). –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (`requires_check`), –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `core.check_resolver.resolve_check`, –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –ö–ª—é—á–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π (`success_consequences_key`, `failure_consequences_key`, `direct_consequences_key`) –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –±—É–¥—É—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –≤ `_format_feedback` –∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ `log_event` –¥–ª—è `player_interact`. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_interaction_handlers.py` –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ `interact`, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª.
Result: –ú–æ–¥—É–ª—å `interaction_handlers` —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä–æ–∫ —á–µ—Ä–µ–∑ `resolve_check`.
## Phase 4: World and Location Model
- Task 23: üó∫Ô∏è 4.1 Location Model (i18n, Guild-Scoped)
Description: –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ –º–æ–¥–µ–ª—å `Location` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã. –ü–æ–ª—è –º–æ–¥–µ–ª–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `JSONB`). –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `on_guild_join` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `GuildConfig` (—Å –ø–æ–ª–µ–º `name`) –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π (`DEFAULT_STATIC_LOCATIONS`) –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –±–æ—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î (`0005_use_jsonb_for_location_fields.py`). –ù–∞–ø–∏—Å–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–∏ `Location` –∏ —É—Ç–∏–ª–∏—Ç `locations_utils`. –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
Result: –ú–æ–¥–µ–ª—å Location –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–∏–ª—å–¥–∏–∏ –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π. –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Ç–µ—Å—Ç–∞–º–∏.
- Task 25: üó∫Ô∏è 4.3 Location Transitions (Guild-Scoped)
Description: –î–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `execute_move_for_player_action` –≤ `src/core/movement_logic.py` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è Task 25. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏ (`PARTY_MOVEMENT_RULES`) –∏–∑ `RuleConfig` (–ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ `leader_only`). –í –º–æ–¥–µ–ª—å `Party` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `leader_player_id` —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π Alembic (`7c27451a6727_add_leader_player_id_to_party.py`). –§—É–Ω–∫—Ü–∏—è –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞/–ø–∞—Ä—Ç–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ª–æ–∫–∞—Ü–∏–∏ (static_id –∏–ª–∏ –∏–º—è —Å i18n), –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≤—è–∑–Ω–æ—Å—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `on_enter_location` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—ã–∑—ã–≤–∞—é—â–∏–º –∫–æ–¥–æ–º (action_processor) –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_movement_logic.py`.
Result: API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –∏–≥—Ä–æ–∫–æ–≤ –∏ –ø–∞—Ä—Ç–∏–π –º–µ–∂–¥—É –ª–æ–∫–∞—Ü–∏—è–º–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤–∏–ª –¥–ª—è –ø–∞—Ä—Ç–∏–π.
- Task 24: üó∫Ô∏è 4.2 Guild Map Generation and Editing (Guild-Scoped)
Description: –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_location` –≤ `src/core/world_generation.py` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è `parent_location_id` –∏ `connection_details_i18n` –ø—Ä–∏ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞—Ü–∏–π. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Å–≤—è–∑–µ–π —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–∫–∞—Ü–∏–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ Discord `/master_map generate_ai_location` –≤ `src/bot/commands/master_map_commands.py` –¥–ª—è –ø—Ä–∏–µ–º–∞ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (`parent_location_id`, `connection_details_i18n_json`) –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –∏—Ö –≤ `generate_location`. –ú–æ–∫ AI (`_mock_openai_api_call`) –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
Result: API –∏ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞—Ü–∏–π AI —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —è–≤–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–∫–∞—Ü–∏–µ–π, —É–ª—É—á—à–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –ú–∞—Å—Ç–µ—Ä–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –∫–∞–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (–†–∞–∑–Ω–æ–µ)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç –¥–ª—è main.py, –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –∏ TypeError
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Alembic –º–∏–≥—Ä–∞—Ü–∏–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-—Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏—Ö –∑–∞–ø—É—Å–∫–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç–∞ (—á–∏—Ç–∞–µ–º–æ—Å—Ç—å, N+1)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö action_processor, general_commands, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ ping
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (—Å–µ—Å—Å–∏—è 2)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (—Å–µ—Å—Å–∏—è 3 - test_action_processor, localization_utils, test_interaction_handlers, ai_orchestrator, test_general_commands, events, game_events, movement_logic, report_formatter, test_localization_utils, test_movement_logic)

## Phase 5: Combat System (Continued)
- Task 28: ‚öîÔ∏è 5.3 NPC Combat Strategy Module (AI).
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å `src/core/npc_combat_strategy.py` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `get_npc_combat_action` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π NPC –≤ –±–æ—é. –ú–æ–¥—É–ª—å –≤–∫–ª—é—á–∞–µ—Ç:
  - –ó–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö NPC, —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è, AI-–ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig` –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
  - –õ–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏ (`_is_hostile`, `_get_potential_targets`, `_calculate_target_score`, `_select_target`) –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª (–≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç—å, —Ñ—Ä–∞–∫—Ü–∏–∏, –æ—Ç–Ω–æ—à–µ–Ω–∏—è) –∏ –º–µ—Ç—Ä–∏–∫ (HP, —É–≥—Ä–æ–∑–∞).
  - –õ–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è (`_get_available_abilities`, `_simulate_action_outcome` (—É–ø—Ä–æ—â–µ–Ω–Ω–æ), `_evaluate_action_effectiveness`, `_choose_action`) —Å —É—á–µ—Ç–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π, –∏—Ö —Å—Ç–æ–∏–º–æ—Å—Ç–∏, –∫—É–ª–¥–∞—É–Ω–æ–≤, –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–º–æ–ª–µ—á–µ–Ω–∏–µ).
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (`_format_action_result`) –¥–ª—è `CombatEngine`.
  - –ú–æ–¥—É–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/__init__.py`.
  - –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_npc_combat_strategy.py` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏.
Result: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ NPC –≤ –±–æ—é, —Å–ø–æ—Å–æ–±–Ω—ã–π –≤—ã–±–∏—Ä–∞—Ç—å —Ü–µ–ª–∏ –∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è. –ì–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CombatEngine.

- Task 29: ‚öîÔ∏è 5.4 Combat Cycle Refactoring (Multiplayer Combat State Machine).
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å `src/core/combat_cycle_manager.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ `start_combat` –∏ `process_combat_turn`.
  - `start_combat`: –°–æ–∑–¥–∞–µ—Ç `CombatEncounter`, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–Ω–∏–º–æ–∫ –ø—Ä–∞–≤–∏–ª, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã —Å—É—â–Ω–æ—Å—Ç–µ–π, –ª–æ–≥–∏—Ä—É–µ—Ç `COMBAT_START`. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å `action_processor.py` –¥–ª—è –≤—ã–∑–æ–≤–∞ –ø—Ä–∏ –∞—Ç–∞–∫–µ, –∏–Ω–∏—Ü–∏–∏—Ä—É—é—â–µ–π –±–æ–π.
  - `process_combat_turn`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ö–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞. –î–ª—è NPC –≤—ã–∑—ã–≤–∞–µ—Ç `npc_combat_strategy` –∏ `combat_engine`. –î–ª—è –∏–≥—Ä–æ–∫–æ–≤ –∏—Ö –¥–µ–π—Å—Ç–≤–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é `action_processor` -> `combat_engine`, –ø–æ—Å–ª–µ —á–µ–≥–æ `action_processor` –≤—ã–∑—ã–≤–∞–µ—Ç `process_combat_turn` –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –±–æ—è. –í–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–æ–≤ NPC.
  - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `_check_combat_end`, `_advance_turn`, `_handle_combat_end_consequences` (—Å –∑–∞–≥–ª—É—à–∫–∞–º–∏ –¥–ª—è XP, –ª—É—Ç–∞ –∏ —Ç.–¥.) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
  - –û–±–Ω–æ–≤–ª–µ–Ω `action_processor.py` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `start_combat` –∏ `process_combat_turn`.
  - –°–æ–∑–¥–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_combat_cycle_manager.py`.
Result: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ–¥–∞–º–∏ –≤ –±–æ—é, –≤–∫–ª—é—á–∞—è –Ω–∞—á–∞–ª–æ –±–æ—è, –æ–±—Ä–∞–±–æ—Ç–∫—É —Ö–æ–¥–æ–≤ NPC –∏ –∏–≥—Ä–æ–∫–æ–≤, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–∞ –±–æ—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –µ–≥–æ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∑–∞–≥–ª—É—à–µ–∫ –¥–ª—è –∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–∏—Å—Ç–µ–º).

## Phase 13: Experience and Character Development System
- Task 30: ‚ö°Ô∏è 13.1 Experience System Structure (Rules).
Description: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª —Å–∏—Å—Ç–µ–º—ã –æ–ø—ã—Ç–∞ –≤ `RuleConfig`. –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª—é—á–∞:
    1.  `experience_system:xp_gain_rules`: –ü—Ä–∞–≤–∏–ª–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP –∑–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–ø–æ–±–µ–¥–∞ –≤ –±–æ—é, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞–≤—ã–∫–æ–≤) —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–∫–∞–∑–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ XP –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤.
    2.  `experience_system:level_curve`: –¢–∞–±–ª–∏—Ü–∞ —É—Ä–æ–≤–Ω–µ–π, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å.
    3.  `experience_system:level_up_rewards`: –ü—Ä–∞–≤–∏–ª–∞ –≤—ã–¥–∞—á–∏ –Ω–∞–≥—Ä–∞–¥ –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è (–æ—á–∫–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –æ—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏) —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞–≥—Ä–∞–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π.
–≠—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ `AGENTS.md` –≤ —Ä–∞–∑–¥–µ–ª–µ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º Task 30. –ú–æ–¥–µ–ª—å `RuleConfig` –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —ç—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
Result: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ–ø—ã—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞. –ì–æ—Ç–æ–≤–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á–∞—Ö –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π.

- Task 31: ‚ö°Ô∏è 13.2 XP Awarding and Progress.
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å `src/core/experience_system.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ `award_xp` –∏ `_check_for_level_up`.
  - `award_xp` –Ω–∞—á–∏—Å–ª—è–µ—Ç –æ–ø—ã—Ç –∏–≥—Ä–æ–∫—É –∏–ª–∏ —á–ª–µ–Ω–∞–º –ø–∞—Ä—Ç–∏–∏ (—Å —Ä–∞–≤–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –¥–ª—è –ø–∞—Ä—Ç–∏–π –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ), –æ–±–Ω–æ–≤–ª—è–µ—Ç `player.xp` –∏ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `XP_GAINED`.
  - `_check_for_level_up` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `award_xp` –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è: –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ `level_curve` –∏ `level_up_rewards` –∏–∑ `RuleConfig`, –ø–æ–≤—ã—à–∞–µ—Ç `player.level`, –≤—ã—á–∏—Ç–∞–µ—Ç XP, –Ω–∞—á–∏—Å–ª—è–µ—Ç `player.unspent_xp` (–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–∞–∫ –æ—á–∫–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤), –ª–æ–≥–∏—Ä—É–µ—Ç `LEVEL_UP`.
  - API `award_xp` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ `src/core/__init__.py`.
  - –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_experience_system.py`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.
Result: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è, –≤–∫–ª—é—á–∞—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å RuleConfig –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ. –ì–æ—Ç–æ–≤–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–æ–¥—É–ª—è–º–∏ –±–æ—è –∏ –∫–≤–µ—Å—Ç–æ–≤.

- Task 32: ‚ö°Ô∏è 13.3 Applying Level Up (Multy-i18n).
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ Discord `/levelup` –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–º `unspent_xp` (–æ—á–∫–æ–≤ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è) –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π Cog `CharacterCog` (`src/bot/commands/character_commands.py`) –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ API-—Ñ—É–Ω–∫—Ü–∏—è `spend_attribute_points` –≤ `src/core/experience_system.py`, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É —Ç—Ä–∞—Ç—ã –æ—á–∫–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `player.unspent_xp` –∏ `player.attributes_json` (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —ç—Ç–æ –ø–æ–ª–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `Player`), –∞ —Ç–∞–∫–∂–µ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `ATTRIBUTE_POINTS_SPENT`. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª –≤ `RuleConfig` –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–º–∞–Ω–¥—ã. –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã –¥–ª—è API –∏ –∫–æ–º–∞–Ω–¥—ã, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏. –í `AGENTS.md` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø–æ–ª—è `Player.attributes_json` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏.
Result: –ò–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/levelup` –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –æ—á–∫–∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `RuleConfig`.

## Phase 8: Factions, Relationships, and Social Mechanics
- Task 33: üé≠ 8.1 Factions Model (Guild-Scoped, i18n).
Description: –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –º–æ–¥–µ–ª—å `GeneratedFaction` –≤ `src/models/generated_faction.py`. –ú–æ–¥–µ–ª—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Task 33, –≤–∫–ª—é—á–∞—è –ø–æ–ª—è `id`, `guild_id`, `name_i18n`, `ideology_i18n`, `description_i18n`, `resources_json`, `leader_npc_id`, `ai_metadata_json` –∏ –¥—Ä—É–≥–∏–µ. –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ `src/models/__init__.py`. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `generated_factions` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ `fcb2e6d12a18_initial_schema_setup.py` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥–µ–ª–∏.
Result: –ú–æ–¥–µ–ª—å `GeneratedFaction` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã. –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø—É—Ç–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.

- Task 34: üé≠ 8.2 Relationships Model (Guild-Scoped).
Description: –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Relationship` –≤ `src/models/relationship.py` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è Task 34. –ü–æ–ª–µ `relationship_type_i18n` –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `relationship_type` (Text, default="neutral"). –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `source_log_id` (Integer, FK –Ω–∞ `story_logs.id`). –ü–æ–ª–µ `ai_metadata_json` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ. Enum `RelationshipEntityType` –≤ `src/models/enums.py` –∏ –∏–º–ø–æ—Ä—Ç—ã –≤ `src/models/__init__.py` —É–∂–µ –±—ã–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã. –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è Alembic `alembic/versions/6344a0089ba3_update_relationships_table_fields.py` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü—ã `relationships` –≤ –ë–î.
Result: –ú–æ–¥–µ–ª—å `Relationship` –æ–±–Ω–æ–≤–ª–µ–Ω–∞, —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ.

- Task 35: üé≠ 8.3 AI Generation of Factions and Relationships (Multilang, Per Guild).
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ—Ä–∞–∫—Ü–∏–π –∏ –∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
    1.  –°–æ–∑–¥–∞–Ω CRUD –¥–ª—è `GeneratedFaction` (`src/core/crud/crud_faction.py`) –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/crud/__init__.py`.
    2.  –†–∞—Å—à–∏—Ä–µ–Ω—ã Pydantic-–º–æ–¥–µ–ª–∏ –≤ `src/core/ai_response_parser.py`: –¥–æ–±–∞–≤–ª–µ–Ω—ã `ParsedFactionData` –∏ `ParsedRelationshipData`, –æ–±–Ω–æ–≤–ª–µ–Ω `GeneratedEntity = Union[...]` –∏ –±–∞–∑–æ–≤–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è.
    3.  –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `prepare_faction_relationship_generation_prompt` –≤ `src/core/ai_prompt_builder.py` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ AI, –≤–∫–ª—é—á–∞—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `_get_entity_schema_terms` —Å—Ö–µ–º–∞–º–∏ –¥–ª—è —Ñ—Ä–∞–∫—Ü–∏–π –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
    4.  –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `generate_factions_and_relationships` –≤ `src/core/world_generation.py`, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –º–æ–∫-–≤—ã–∑–æ–≤ AI, –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î (`GeneratedFaction`, `Relationship`) –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è `WORLD_EVENT_FACTIONS_GENERATED`. –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
    5.  –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã:
        *   –î–ª—è `crud_faction` (`tests/core/crud/test_crud_faction.py`): –ø–æ–∫—Ä—ã—Ç—ã –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã.
        *   –î–ª—è Pydantic –º–æ–¥–µ–ª–µ–π `ParsedFactionData`, `ParsedRelationshipData` –∏ —Ñ—É–Ω–∫—Ü–∏–∏ `parse_and_validate_ai_response` (`tests/core/test_ai_response_parser.py`): –ø–æ–∫—Ä—ã—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π, —É—Å–ø–µ—à–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è.
        *   –î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ `prepare_faction_relationship_generation_prompt` (`tests/core/test_ai_prompt_builder.py`): –ø–æ–∫—Ä—ã—Ç—ã —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏ —è–∑—ã–∫–∞ –≥–∏–ª—å–¥–∏–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª.
        *   –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `generate_factions_and_relationships` (`tests/core/test_world_generation.py`): –ø–æ–∫—Ä—ã—Ç—ã —É—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö `static_id`.
Result: –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ—Ä–∞–∫—Ü–∏–π –∏ –∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –ø–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏ (—Å –º–æ–∫-–æ—Ç–≤–µ—Ç–æ–º –æ—Ç AI). –ì–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

- Task 36: üé≠ 8.4 Relationship Changes Through Actions (According to Rules, Guild-Scoped).
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–æ–¥—É–ª—å `src/core/relationship_system.py` —Å API `update_relationship` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç–Ω–æ—à–µ–Ω–∏–π –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–≥—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`.
  - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_get_canonical_entity_pair` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫ ID –∏ —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π.
  - `update_relationship` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –ø–æ –∫–ª—é—á—É `relationship_rules:{EVENT_TYPE}`, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö, –Ω–∞—Ö–æ–¥–∏—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å `Relationship` (–∏—Å–ø–æ–ª—å–∑—É—è `crud_relationship` –∏ –ø—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏), –æ–±–Ω–æ–≤–ª—è–µ—Ç `value` (—Å —É—á–µ—Ç–æ–º `min_val`/`max_val` –∏–∑ –ø—Ä–∞–≤–∏–ª) –∏ `source_log_id`.
  - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å–æ–±—ã—Ç–∏–µ `RELATIONSHIP_CHANGE` —á–µ—Ä–µ–∑ `game_events.log_event`.
  - API —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ `src/core/__init__.py`.
  - –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_relationship_system.py`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –∫–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏—é, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π, –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–∞–≤–∏–ª (–≤–∫–ª—é—á–∞—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ), –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ CRUD.
Result: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å —Å–∏—Å—Ç–µ–º–æ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è. –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏ (–±–æ–π, –∫–≤–µ—Å—Ç—ã –∏ —Ç.–¥.).

- Task 37: üé≠ 8.5 Relationship Influence (Full, According to Rules, Multy-i18n).
Description: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏–∑ –ë–î –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–ª–∏ —É—Å–ª–æ–≤–∏–π –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö –º–µ—Ö–∞–Ω–∏–∫–∞—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª RuleConfig.
  - **check_resolver.py**: –î–æ—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª `relationship_influence:checks:<check_type>`, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É–ª—ã –∏–ª–∏ –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
  - **npc_combat_strategy.py**: –î–æ—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —É—á–µ—Ç–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏ (`_is_hostile`), –æ—Ü–µ–Ω–∫–µ —É–≥—Ä–æ–∑—ã —Ü–µ–ª–∏ (`_calculate_target_score`) –∏ –≤—ã–±–æ—Ä–µ –¥–µ–π—Å—Ç–≤–∏–π (`_choose_action`) —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:npc_combat:behavior`. –§—É–Ω–∫—Ü–∏—è `_get_npc_ai_rules` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª.
  - **report_formatter.py**: –î–æ—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π `CheckResult` (–≤–∫–ª—é—á–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –æ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–π) –≤ –ª–æ–≥–∞—Ö `COMBAT_ACTION`.
  - **RuleConfig**: –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∞–≤–∏–ª –¥–ª—è –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏, –ø–æ–≤–µ–¥–µ–Ω–∏–µ NPC, —Ç–æ—Ä–≥–æ–≤–ª—é –∏ –¥–∏–∞–ª–æ–≥–∏.
  - –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã –¥–ª—è `check_resolver`, `npc_combat_strategy` –∏ `report_formatter` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
Result: –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∏, –ø–æ–≤–µ–¥–µ–Ω–∏–µ NPC –≤ –±–æ—é) —Ç–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞—é—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –≤ –ª–æ–≥–∞—Ö. –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –æ—Å–Ω–æ–≤–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ –¥–∏–∞–ª–æ–≥–æ–≤.

- Task 38: üé≠ 8.6 Complex Internal Faction Relationships.
Description: Generation and use of specific NPC relationships to other factions or NPCs within their own factions for more complex behavior. AI generates (16) and parses (17) these relationships. Stored in Relationship (34). Their influence is defined in RuleConfig (13/0.3) as a separate relationship type or rule modifier. NPC behavior rules dictated by hidden relationships (betrayal, helping the player from a hostile faction) are used by the AI Strategy (28) and Action Processing Module (21) / Dialogue (46).
Result: –†–∞—Å—à–∏—Ä–µ–Ω—ã –º–µ—Ö–∞–Ω–∏–∑–º—ã AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `static_id` —É NPC –∏ –∏—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö "—Å–∫—Ä—ã—Ç—ã—Ö" –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã —Ç–∏–ø—ã —Å–∫—Ä—ã—Ç—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –ø—Ä–∞–≤–∏–ª–∞ –∏—Ö –≤–ª–∏—è–Ω–∏—è –≤ `RuleConfig`. –ú–æ–¥—É–ª–∏ `npc_combat_strategy.py` –∏ `check_resolver.py` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —É—á–µ—Ç–∞ —ç—Ç–∏—Ö —Å–∫—Ä—ã—Ç—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è NPC –≤ –±–æ—é –∏ –ø—Ä–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–∞–≤—ã–∫–æ–≤. –í `ai_orchestrator.py` –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω `ai_prompt_builder.py` –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∫—Ä—ã—Ç—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º—É –¥–∏–∞–ª–æ–≥–æ–≤. –ù–∞–ø–∏—Å–∞–Ω—ã –∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Unit-—Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –∏ –ª–æ–≥–∏–∫–∏.
[end of Done.txt]
