## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã:**

1.  **–ê–Ω–∞–ª–∏–∑ `AGENTS.md`:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ª—é–±–æ–π —Ä–∞–±–æ—Ç—ã –≤—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª (`AGENTS.md`).
2.  **–†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–∞–º–∏ –∏–∑ `Tasks.txt`:**
    *   –í–∑—è—Ç—å –æ–¥–Ω—É –∑–∞–¥–∞—á—É –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt` –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.
    *   –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É.
    *   –ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).
    *   –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
        *   –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã.
        *   –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç, —Å–Ω–∞—á–∞–ª–∞ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É, –∑–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç.
        *   –ü–æ–≤—Ç–æ—Ä—è—Ç—å –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –≤—Å–µ —Ç–µ—Å—Ç—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –∑–∞–¥–∞—á–µ, –Ω–µ –ø—Ä–æ–π–¥—É—Ç.
    *   –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
        *   –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`.
        *   –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ (–¥–æ–±–∞–≤–∏—Ç—å) –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ –≤ —Ñ–∞–π–ª `done.txt`.
3.  **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
    *   –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—É–¥—É—â–µ–º, —Å–æ–∑–¥–∞—Ç—å –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ (`AGENTS.md`) —Å–µ–∫—Ü–∏—é "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏".
    *   –£–∫–∞–∑–∞—Ç—å –≤ —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏ –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å, –∏ —É–∫–∞–∑–∞—Ç—å, –∫–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å.
4.  **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md` –∏ –ö–æ–º–º–∏—Ç:**
    *   –ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–æ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏, –æ–±–Ω–æ–≤–∏—Ç—å `AGENTS.md` –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ (–≤ —Å–µ–∫—Ü–∏–∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π").
    *   –°–¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π.
5.  **–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –≤ `AGENTS.md`:**
    *   `AGENTS.md` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤–∞—à–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
    *   –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–æ–µ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ `AGENTS.md` –≤ —Å–µ–∫—Ü–∏–∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏.
6.  **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏:**
    *   –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    *   –≠—Ç–æ—Ç –ø–ª–∞–Ω –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Å–µ–∫—Ü–∏—é "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –≤ `AGENTS.md`. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —ç—Ç–∞ —Å–µ–∫—Ü–∏—è –æ—á–∏—â–∞–µ—Ç—Å—è –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏.
7.  **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:**
    *   –Ø–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞, –∏–º–µ—é—Ç –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
    *   –ó–∞—Ç–µ–º —Å–ª–µ–¥—É—é—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ ("–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞").

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `AGENTS.md` (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è):**

*   **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞:** (–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª)
*   **–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω:**
*(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–ª–∞–Ω–æ–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏)*
*   **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
    *(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—É–¥—É—â–µ–º)*
*   **–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π:** –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞—á–∏, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–¥–∞—á–∞–º. –ó–∞–¥–∞—á–∏ –Ω—É–º–µ—Ä—É—é—Ç—Å—è.

---
## –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω
*(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–ª–∞–Ω–æ–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏)*
---
## –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π

## Task 63: üñ•Ô∏è UI.9 UI for Global Entity Management
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –°–æ–∑–¥–∞—Ç—å UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ (GlobalNpc, MobileGroup). –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –±—ç–∫–µ–Ω–¥ (API, —Ç–∏–ø—ã, —Å—Ç–∞–±—ã —Å–µ—Ä–≤–∏—Å–æ–≤). UI –¥–ª—è GlobalEvent –æ—Ç–ª–æ–∂–µ–Ω –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - –®–∞–≥ 1: –ü—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª–∏ `GlobalNpc`, `MobileGroup` –∏ –∏—Ö CRUD API —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã –≥–æ—Ç–æ–≤—ã. –ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã –¥–ª—è `GlobalEvent` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –ü–ª–∞–Ω —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω.
    - –®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `GlobalNpcData`, `GlobalNpcPayload`, `GlobalNpcUpdatePayload`, `MobileGroupData`, `MobileGroupPayload`, `MobileGroupUpdatePayload` –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ `src/ui/src/types/globalEntity.ts`. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `PaginatedResponse`.
    - –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω—ã —Å—Ç–∞–±—ã API —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ `src/ui/src/services/globalEntityService.ts` –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ `GlobalNpc` –∏ `MobileGroup` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤–æ–≥–æ `apiClient`.
    - –®–∞–≥ 4: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤-–∑–∞–≥–ª—É—à–µ–∫ –≤ –Ω–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/ui/src/pages/GlobalEntitiesPage/`:
        - `GlobalNpcListPage.tsx` –∏ `GlobalNpcDetailPage.tsx`
        - `MobileGroupListPage.tsx` –∏ `MobileGroupDetailPage.tsx`
    - –®–∞–≥ 5: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è UI Task 63: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ (GlobalNpc, MobileGroup)" –≤ `AGENTS.md`.
    - –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω `AGENTS.md` (—ç—Ç–æ—Ç –ª–æ–≥ –∏ —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω).
    - –®–∞–≥ 7 (UI): –°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã-–∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è Unit-—Ç–µ—Å—Ç–æ–≤ UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å Task 63:
        - `src/ui/src/services/globalEntityService.test.ts`
        - `src/ui/src/pages/GlobalEntitiesPage/GlobalNpcListPage.test.tsx`
        - `src/ui/src/pages/GlobalEntitiesPage/GlobalNpcDetailPage.test.tsx`
        - `src/ui/src/pages/GlobalEntitiesPage/MobileGroupListPage.test.tsx`
        - `src/ui/src/pages/GlobalEntitiesPage/MobileGroupDetailPage.test.tsx`
    - **–°—Ç–∞—Ç—É—Å Task 63**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ UI-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, —Å—Ç–∞–±–æ–≤ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–æ–∑–¥–∞–Ω—ã –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è UI-—Ç–µ—Å—Ç–æ–≤. –ó–∞–¥–∞—á–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø–µ—Ä–µ–¥–∞—á–µ UI-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ UI –∏ —Ç–µ—Å—Ç–æ–≤.

## Task 62: üñ•Ô∏è UI.8 UI for Quest Management
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –°–æ–∑–¥–∞—Ç—å UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞–º–∏. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –±—ç–∫–µ–Ω–¥ (API, —Ç–∏–ø—ã, —Å—Ç–∞–±—ã —Å–µ—Ä–≤–∏—Å–æ–≤).
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ Task 62. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (API 39, CRUD API 41 - –≤—ã–ø–æ–ª–Ω–µ–Ω—ã).
    - –®–∞–≥ 2: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã –≤ `src/bot/commands/master_commands/quest_master_commands.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏/CRUD. –í—ã—è–≤–ª–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –≤ –∫–æ–º–∞–Ω–¥–µ `/master_quest progress_create`.
    - –®–∞–≥ 3: –°–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –±—ç–∫–µ–Ω–¥–∞ –¥–ª—è UI.
    - –®–∞–≥ 4: –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–º –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥–∞–º –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞–º–∏ (Questline, GeneratedQuest, QuestStep, PlayerQuestProgress) –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è UI. (–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ AGENTS.md –Ω–∏–∂–µ).
    - –®–∞–≥ 5: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞ `/master_quest progress_create` –≤ `src/bot/commands/master_commands/quest_master_commands.py` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –∫–≤–µ—Å—Ç–æ–≤. –ù–∞–ø–∏—Å–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ –æ—à–∏–±–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–∞—Ö. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤ —Ç–µ—Å—Ç–∞—Ö –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏".
    - –®–∞–≥ 6: –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (`QuestlineData`, `GeneratedQuestData`, `QuestStepData`, `PlayerQuestProgressData` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ `Payload`-—ã, `UIQuestStatus` enum) –≤ `src/ui/src/types/quest.ts`.
    - –®–∞–≥ 7: –°–æ–∑–¥–∞–Ω—ã —Å—Ç–∞–±—ã (–∑–∞–≥–ª—É—à–∫–∏) API —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ `src/ui/src/services/questService.ts`, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã –∫ –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥–∞–º –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –∫–≤–µ—Å—Ç–æ–≤.
    - –®–∞–≥ 8: –û–±–Ω–æ–≤–ª–µ–Ω `AGENTS.md` (—ç—Ç–æ—Ç –ª–æ–≥).

## Task 61: üñ•Ô∏è UI.7 UI for Faction and Relationship Management
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –°–æ–∑–¥–∞—Ç—å UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ—Ä–∞–∫—Ü–∏—è–º–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–µ—Ä–≤–∞—è –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –∏–∑ `Tasks.txt`: Task 61.
    - –®–∞–≥ 2: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 61 (–æ–ø–∏—Å–∞–Ω–∏–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ API - Task 41, –º–æ–¥–µ–ª–∏ - Task 20, 21).
    - –®–∞–≥ 3: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ (`GeneratedFaction`, `Relationship`), CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ (`CRUDFaction`, `CRUDRelationship`) –∏ –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã (`faction_master_commands.py`, `relationship_master_commands.py`). API –ø—Ä–∏–∑–Ω–∞–Ω—ã –≥–æ—Ç–æ–≤—ã–º–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
    - –®–∞–≥ 4: –°–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ UI-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏ —Å—Ç–∞–±–æ–≤.
    - –®–∞–≥ 5: –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è UI:
        - –í `src/ui/src/types/faction.ts` —Å–æ–∑–¥–∞–Ω—ã `FactionLeaderInfo`, `Faction`, `FactionPayload`, `FactionUpdatePayload`.
        - –í `src/ui/src/types/relationship.ts` —Å–æ–∑–¥–∞–Ω—ã `RelationshipEntityInfo`, `RelationshipData`, `RelationshipPayload`, `RelationshipUpdatePayload`.
        - –í –æ–±–æ–∏—Ö —Ñ–∞–π–ª–∞—Ö —É–ø–æ–º—è–Ω—É—Ç –æ–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `PaginatedResponse<T>`.
    - –®–∞–≥ 6: –°–æ–∑–¥–∞–Ω—ã —Å—Ç–∞–±—ã (–∑–∞–≥–ª—É—à–∫–∏) –¥–ª—è UI —Å–µ—Ä–≤–∏—Å–æ–≤:
        - –í `src/ui/src/services/factionService.ts` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–æ–∫–æ–≤—ã–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ—Ä–∞–∫—Ü–∏–π.
        - –í `src/ui/src/services/relationshipService.ts` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–æ–∫–æ–≤—ã–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
    - –®–∞–≥ 7: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–∑–∞–≥–ª—É—à–∫–∏):
        - –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `src/ui/src/pages/FactionsPage` —Å —Ñ–∞–π–ª–∞–º–∏ `FactionsListPage.tsx` –∏ `FactionDetailPage.tsx`.
        - –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `src/ui/src/pages/RelationshipsPage` —Å —Ñ–∞–π–ª–∞–º–∏ `RelationshipsListPage.tsx` –∏ `RelationshipDetailPage.tsx`.
    - –®–∞–≥ 8: –û–±–Ω–æ–≤–ª–µ–Ω `AGENTS.md` (—ç—Ç–æ—Ç –ª–æ–≥, —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è UI).

## Task 60: üñ•Ô∏è UI.6 UI for Inventory and Item Management
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –°–æ–∑–¥–∞—Ç—å UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π/NPC –∏ –æ–±—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –≥–∏–ª—å–¥–∏–∏.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–µ—Ä–≤–∞—è –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –∏–∑ `Tasks.txt`: Task 60.
    - –®–∞–≥ 2: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 60 (–æ–ø–∏—Å–∞–Ω–∏–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI).
    - –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π API (–ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã –¥–ª—è Item, InventoryItem). –í—ã—è–≤–ª–µ–Ω –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è API –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ UI.
    - –®–∞–≥ 4: –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –±—ç–∫–µ–Ω–¥-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ (API –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö).
    - –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω `AGENTS.md` (—ç—Ç–æ—Ç –ª–æ–≥ –∏ —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω).

## Task 56: üñ•Ô∏è UI.2 Basic UI Structure and Authentication Development (Backend part)
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±—ç–∫–µ–Ω–¥-—á–∞—Å—Ç—å –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ UI —á–µ—Ä–µ–∑ Discord OAuth2, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ JWT –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ API –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –≥–∏–ª—å–¥–∏–∏.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - **–®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth2 Discord –Ω–∞ –±—ç–∫–µ–Ω–¥–µ**:
        - –í `src/config/settings.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `DISCORD_CLIENT_ID`, `DISCORD_CLIENT_SECRET`, `DISCORD_REDIRECT_URI`.
        - –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏–º–µ—Ä `.env` —Ñ–∞–π–ª–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —ç—Ç–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
    - **–®–∞–≥ 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ OAuth2 (–∏ –∏—Ö –¥–æ—Ä–∞–±–æ—Ç–∫–∞)**:
        - –°–æ–∑–¥–∞–Ω —Ä–æ—É—Ç–µ—Ä `src/api/routers/auth.py`.
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/auth/discord` –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Discord.
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –¥–æ—Ä–∞–±–æ—Ç–∞–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/auth/discord/callback`:
            - –û–±–º–µ–Ω–∏–≤–∞–µ—Ç –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ `access_token` Discord.
            - –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ Discord (`/users/@me`).
            - –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≥–∏–ª—å–¥–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç Discord (`/users/@me/guilds`).
            - –§–∏–ª—å—Ç—Ä—É–µ—Ç –≥–∏–ª—å–¥–∏–∏ –ø–æ –ø—Ä–∞–≤–∞–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –Ω–∞–ª–∏—á–∏—é –≤ `GuildConfig` –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
            - –ù–∞—Ö–æ–¥–∏—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å `MasterUser` –≤ –ë–î.
            - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT (—Å–º. –®–∞–≥ 4), –≤–∫–ª—é—á–∞—è –≤ –Ω–µ–≥–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–∏–ª—å–¥–∏–π (`accessible_guilds`).
        - –†–æ—É—Ç–µ—Ä `auth_router` –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `src/main.py`.
    - **–®–∞–≥ 3: –ú–æ–¥–µ–ª—å –∏ CRUD –¥–ª—è –ú–∞—Å—Ç–µ—Ä-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π UI**:
        - –°–æ–∑–¥–∞–Ω–∞ SQLAlchemy –º–æ–¥–µ–ª—å `MasterUser` –≤ `src/models/master_user.py`.
        - –ú–æ–¥–µ–ª—å `MasterUser` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –°–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic (`cdc86ea77142_create_master_users_table.py`).
        - –°–æ–∑–¥–∞–Ω—ã Pydantic —Å—Ö–µ–º—ã –≤ `src/schemas/master_user.py` –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ `src/schemas/__init__.py`.
        - –°–æ–∑–¥–∞–Ω `CRUDMasterUser` –≤ `src/core/crud/crud_master_user.py` –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ `src/core/crud/__init__.py`.
    - **–®–∞–≥ 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ —á–µ—Ä–µ–∑ JWT**:
        - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `python-jose[cryptography]` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `requirements.txt` –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.
        - –í `src/core/security.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
            - –ú–æ–¥–µ–ª—å `TokenPayload` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `accessible_guilds`).
            - –§—É–Ω–∫—Ü–∏—è `create_access_token` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø—Ä–∏–µ–º–∞ —Å–ª–æ–≤–∞—Ä—è `subject_data`).
            - –§—É–Ω–∫—Ü–∏—è `verify_token_payload` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT.
            - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ FastAPI `oauth2_scheme`, `get_current_token_payload`, `get_current_master_user`.
        - –£—Ç–∏–ª–∏—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ `src/core/__init__.py`.
        - –≠–Ω–¥–ø–æ–∏–Ω—Ç `/api/auth/discord/callback` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `create_access_token` –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ JWT.
    - **–®–∞–≥ 5: API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–∏–ª—å–¥–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏ –∏—Ö –¥–æ—Ä–∞–±–æ—Ç–∫–∞)**:
        - –í `src/api/routers/auth.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:
            - –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/auth/me/guilds` (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π JWT): –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–∏–ª—å–¥–∏–π –∏–∑ –ø–æ–ª—è `accessible_guilds` –≤ JWT.
            - –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /api/auth/session/active-guild` (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π JWT): —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `active_guild_id` –≤ —Å–µ—Å—Å–∏–∏ –ø—É—Ç–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ JWT.
            - –≠–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/auth/session/active-guild` (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π JWT): –ø–æ–ª—É—á–∞–µ—Ç `active_guild_id` –∏–∑ JWT.
    - **–®–∞–≥ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `active_guild_id` –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API**:
        - –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –æ—Å–Ω–æ–≤–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: —Å–∏—Å—Ç–µ–º–∞ JWT –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ FastAPI –≥–æ—Ç–æ–≤—ã.
        - –í `src/api/routers/auth.py` –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –∫ –±—É–¥—É—â–∏–º API –¥–ª—è UI –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ `active_guild_id`.
- **–°—Ç–∞—Ç—É—Å**: –ë—ç–∫–µ–Ω–¥-—á–∞—Å—Ç—å Task 56 –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –û—Å—Ç–∞—é—Ç—Å—è Unit-—Ç–µ—Å—Ç—ã.

## Tasks 57, 58, 59: üñ•Ô∏è UI Backend Preparation for Player, RuleConfig, and AI Moderation
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –û–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–µ–Ω–¥ API (—á–µ—Ä–µ–∑ Master –∫–æ–º–∞–Ω–¥—ã), –∞ —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞—Ç—å TypeScript –¥–µ—Ñ–∏–Ω–∏—Ü–∏–∏ –∏ —Å—Ç–∞–±—ã UI —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ò–≥—Ä–æ–∫–∞–º–∏/–ü–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ (Task 57), –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ü—Ä–∞–≤–∏–ª (Task 58) –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π/–º–æ–¥–µ—Ä–∞—Ü–∏–µ–π AI –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (Task 59).
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - **–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –¥–ª—è Task 57 (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ò–≥—Ä–æ–∫–∞–º–∏/–ü–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏)**:
        - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã `player_master_commands.py` –∏ `npc_master_commands.py`.
        - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–∞–Ω–¥ –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ `Player` –∏ `GeneratedNpc`.
        - –û—Ç–º–µ—á–µ–Ω–æ, —á—Ç–æ –∫–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (`update`) —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–ø–æ–ª—å–Ω–æ, —á—Ç–æ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ UI –∏–ª–∏ API —à–ª—é–∑–∞ –¥–ª—è –±–æ–ª–µ–µ REST-–ø–æ–¥–æ–±–Ω–æ–≥–æ bulk-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞ –ø—Ä–∏–∑–Ω–∞–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º.
    - **–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –¥–ª—è Task 58 (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RuleConfig)**:
        - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `ruleconfig_master_commands.py`.
        - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–∞–Ω–¥ –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ `RuleConfig`.
        - –ö–æ–º–∞–Ω–¥–∞ `list` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫; –æ—Ç–º–µ—á–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä–µ—Ñ–∏–∫—Å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–¥–ª—è –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è UI), —Ç–∞–∫ –∫–∞–∫ CRUD –º–µ—Ç–æ–¥—ã (`get_multi_by_guild_and_prefix`) —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    - **–®–∞–≥ 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Backend API –¥–ª—è Task 59 (–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ú–æ–¥–µ—Ä–∞—Ü–∏—è AI –∫–æ–Ω—Ç–µ–Ω—Ç–∞)**:
        - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π Cog `src/bot/commands/master_commands/pending_generation_master_commands.py`.
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã:
            - `/master_pending_generation trigger`: –î–ª—è –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ai_orchestrator.trigger_ai_generation_flow`. *–û—Ç–º–µ—á–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ `trigger_ai_generation_flow` –∏ `prepare_ai_prompt` –¥–ª—è –ª—É—á—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ `entity_type` –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.*
            - `/master_pending_generation list`: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π `PendingGeneration` —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å—É –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.
            - `/master_pending_generation view <id>`: –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ `PendingGeneration`.
            - `/master_pending_generation approve <id>`: –î–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ai_orchestrator.save_approved_generation`.
            - `/master_pending_generation update <id>`: –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, REJECTED, EDITED_PENDING_APPROVAL), –∑–∞–º–µ—Ç–∫–∏ –º–∞—Å—Ç–µ—Ä–∞ –∏–ª–∏ —Å–∞–º–∏—Ö –¥–∞–Ω–Ω—ã—Ö (`parsed_validated_data_json`) –¥–ª—è –∑–∞–ø–∏—Å–∏ `PendingGeneration`.
        - –ù–æ–≤—ã–π Cog –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/config/settings.py`.
    - **–®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ TypeScript –¥–µ—Ñ–∏–Ω–∏—Ü–∏–π –¥–ª—è UI**:
        - –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/ui/src/types/` —Å–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã:
            - `entities.ts`: –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `Player`, `GeneratedNpc`, `PlayerPayload`, `GeneratedNpcPayload`, `PaginatedResponse`.
            - `ruleconfig.ts`: –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `RuleConfigEntry`, `RuleConfigMap`, `RuleConfigUpdatePayload`.
            - `pending_generation.ts`: –°–æ–¥–µ—Ä–∂–∏—Ç enum `UIMRModerationStatus`, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `UIPendingGeneration` –∏ –ø–µ–π–ª–æ–∞–¥—ã `TriggerGenerationPayload`, `UpdatePendingGenerationPayload`.
    - **–®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–±–æ–≤ API —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ UI**:
        - –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/ui/src/services/` —Å–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã:
            - `apiClient.ts`: –ú–æ–∫–æ–≤—ã–π API –∫–ª–∏–µ–Ω—Ç.
            - `playerService.ts`: –°—Ç–∞–±—ã —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –∏–≥—Ä–æ–∫–∞–º–∏.
            - `npcService.ts`: –°—Ç–∞–±—ã —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ NPC.
            - `ruleConfigService.ts`: –°—Ç–∞–±—ã —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ `RuleConfig`.
            - `pendingGenerationService.ts`: –°—Ç–∞–±—ã —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π.
        - –í—Å–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ TypeScript —Ç–∏–ø—ã –∏ –º–æ–∫–æ–≤—ã–π `apiClient`.
- **–°—Ç–∞—Ç—É—Å**: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±—ç–∫–µ–Ω–¥–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –¥–ª—è UI –∑–∞–≤–µ—Ä—à–µ–Ω—ã. –ó–∞–¥–∞—á–∏ 57, 58, 59 –≥–æ—Ç–æ–≤—ã –∫ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π UI —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è UI-—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏).
- **–ó–∞–º–µ—á–∞–Ω–∏–µ**: –í —Ö–æ–¥–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `trigger_generation` –≤—ã—è–≤–ª–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ `ai_orchestrator.trigger_ai_generation_flow` –∏ `ai_prompt_builder.prepare_ai_prompt` –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ `entity_type` –∏ `generation_context_json`. –≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ –±—ã–ª–æ —á–∞—Å—Ç—å—é —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞–Ω–∞, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±—É–¥—É—â–µ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è.

## Task 55: üñ•Ô∏è UI.1 UI Technology Stack Selection and Basic Structure.
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Select a framework/library for developing the client UI application. Define the basic architecture of the UI application.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ UI**: –ò–∑—É—á–µ–Ω—ã –∑–∞–¥–∞—á–∏ UI.1 - UI.14 –≤ `Tasks.txt` –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞ —Ä–∞–±–æ—Ç –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.
    - **–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**: –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã React, Vue, Electron, PyQt.
        - React: –ü–æ–ø—É–ª—è—Ä–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å –±–æ–ª—å—à–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥.
        - Vue.js: –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –≤—Ö–æ–∂–¥–µ–Ω–∏—è, —Ö–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.
        - Electron: –î–ª—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã—Ö –¥–µ—Å–∫—Ç–æ–ø–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π.
        - PyQt: Python-–±–∏–Ω–¥–∏–Ω–≥–∏ –¥–ª—è Qt, –Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∏–¥, –Ω–æ –≤—ã—à–µ –∫—Ä–∏–≤–∞—è –æ–±—É—á–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–∏—è.
    - **–í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–µ–∫–∞**:
        - **UI –§—Ä–µ–π–º–≤–æ—Ä–∫**: React (–≥–∏–±–∫–æ—Å—Ç—å, –±–æ–ª—å—à–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–µ–±).
        - **–Ø–∑—ã–∫**: TypeScript (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è, —É–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ IDE).
        - **–°–±–æ—Ä—â–∏–∫ –ø—Ä–æ–µ–∫—Ç–∞**: Vite (–±—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ –∏ HMR).
        - **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**: React Router DOM.
        - **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º**: Zustand (–∏–ª–∏ React Context API).
    - **–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã UI –ø—Ä–æ–µ–∫—Ç–∞**:
        - –° –ø–æ–º–æ—â—å—é `npm create vite@latest src/ui -- --template react-ts` —Å–æ–∑–¥–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤ `src/ui/`.
        - –í `src/ui/README.md` –¥–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ç–µ–∫–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏.
        - –í `src/ui/AGENTS.md` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–≥–µ–Ω—Ç–∞ –ø–æ —Ä–∞–±–æ—Ç–µ —Å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –ø–æ –∫–æ–¥—É –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –≤—ã–±—Ä–∞–Ω, –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ UI –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞.

## Task 53: üß† 11.4 NLU and Intent Recognition in Dialogue (Guild-Scoped)
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Processing player input in dialogue mode. If player status is 'dialogue', NLU (13) does not save the action to collected_actions_json, but passes it directly to the Dialogue Management Module (46) via the handle_dialogue_input API (46). NLU (13) still recognizes Intents/Entities and passes them to 46.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - **–ê–Ω–∞–ª–∏–∑**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã `src/core/action_processor.py` –∏ `src/core/dialogue_system.py`. –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ –±–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–∏–∞–ª–æ–≥–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏ `PlayerStatus.DIALOGUE` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `process_player_message_for_nlu`. –û–¥–Ω–∞–∫–æ, NLU-–ø–∞—Ä—Å–µ—Ä –Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è –¥–ª—è —ç—Ç–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
    - **–®–∞–≥ 1: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `src/core/action_processor.py` (—Ñ—É–Ω–∫—Ü–∏—è `process_player_message_for_nlu`):**
        - –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–∞–∫, —á—Ç–æ `nlu_service.parse_player_input` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä–æ–∫–∞.
        - –ï—Å–ª–∏ `player.current_status == PlayerStatus.DIALOGUE`, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ (`ParsedAction.intent` –∏ `ParsedAction.entities`) –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `dialogue_system.handle_dialogue_input` –≤–º–µ—Å—Ç–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è.
    - **–®–∞–≥ 2: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `src/core/dialogue_system.py` (—Ñ—É–Ω–∫—Ü–∏—è `handle_dialogue_input`):**
        - –°–∏–≥–Ω–∞—Ç—É—Ä–∞ `handle_dialogue_input` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø—Ä–∏–µ–º–∞ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `parsed_intent: Optional[str]` –∏ `parsed_entities: Optional[List[Dict[str, Any]]]`.
        - –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `context_for_llm`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `generate_npc_dialogue`.
    - **–®–∞–≥ 3: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `src/core/ai_prompt_builder.py` (—Ñ—É–Ω–∫—Ü–∏—è `prepare_dialogue_generation_prompt`):**
        - –§—É–Ω–∫—Ü–∏—è `prepare_dialogue_generation_prompt` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è `parsed_intent` –∏ `parsed_entities` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.
        - –ï—Å–ª–∏ –∏–Ω—Ç–µ–Ω—Ç –Ω–µ "unknown_intent", —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–∏–Ω—Ç–µ–Ω—Ç –∏ —Å—É—â–Ω–æ—Å—Ç–∏) –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ NPC. –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ –ø—Ä–æ–º–ø—Ç: `(Player's message was analyzed by NLU. Recognized intent: '**'{intent}'**. Recognized NLU entities: {entities_str}.)`.
    - **–®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤:**
        - –í `tests/core/test_action_processor.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (`test_process_player_message_for_nlu_player_in_dialogue`, `test_process_player_message_for_nlu_player_in_dialogue_nlu_unknown_intent`) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–∑–æ–≤–∞ NLU –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ `handle_dialogue_input` –≤ —Ä–µ–∂–∏–º–µ –¥–∏–∞–ª–æ–≥–∞. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–µ—Å—Ç `test_process_player_message_for_nlu_player_not_in_dialogue_queues_action` –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.
        - –í `tests/core/test_dialogue_system.py` –æ–±–Ω–æ–≤–ª–µ–Ω —Ç–µ—Å—Ç `test_handle_dialogue_input_success` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `test_handle_dialogue_input_success_with_nlu_data`) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–µ–º–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ NLU-–¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è `generate_npc_dialogue`.
        - –í `tests/core/test_ai_prompt_builder.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (`test_prepare_dialogue_prompt_with_nlu_data`, `test_prepare_dialogue_prompt_with_nlu_unknown_intent`) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è NLU-–¥–∞–Ω–Ω—ã—Ö (–∏–ª–∏ –∏—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–∏ unknown_intent) –≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –ø—Ä–æ–º–ø—Ç.
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.

## –î–æ—Ä–∞–±–æ—Ç–∫–∞ Task 37: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –¥–∏–∞–ª–æ–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `tone_hint`)
- **–î–∞—Ç–∞**: [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]
- **–¶–µ–ª—å**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é —á–∞—Å—Ç—å Task 37, –∫–∞—Å–∞—é—â—É—é—Å—è –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ —Ç–æ–Ω NPC –≤ –¥–∏–∞–ª–æ–≥–∞—Ö.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - **–ê–Ω–∞–ª–∏–∑**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã `src/core/dialogue_system.py`, `src/core/ai_prompt_builder.py` –∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞—Å—Ç–∏ `AGENTS.md`. –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ `prepare_dialogue_generation_prompt` —É–∂–µ —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:dialogue:availability_and_tone` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `tone_hint`.
    - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `tone_hint`**:
        - –í `src/core/ai_prompt_builder.py` –≤ —Ñ—É–Ω–∫—Ü–∏—é `prepare_dialogue_generation_prompt` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞:
            - –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:dialogue:availability_and_tone` –∏–∑ `RuleConfig`.
            - –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞–π–¥–µ–Ω–æ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é `tone_modifiers`, –∞ —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ –∫ NPC:
                - –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏—Ç–µ—Ä–∞—Ü–∏—è –ø–æ `tone_modifiers` (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é –ø–æ—Ä–æ–≥–∞ `relationship_above`).
                - –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å –ø–æ—Ä–æ–≥–æ–º.
                - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tone_hint` –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥–æ—à–µ–¥—à–µ–≥–æ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞.
                - –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –ø–æ—Ä–æ–≥ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tone_hint` –∏–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Å `relationship_default: true` (–µ—Å–ª–∏ –µ—Å—Ç—å).
            - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π `derived_tone_hint` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Your current emotional tone towards {player_name} should reflect: **{derived_tone_hint}**.").
    - **Unit-—Ç–µ—Å—Ç—ã**:
        - –í `tests/core/test_ai_prompt_builder.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã 4 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞ (`test_dialogue_prompt_with_positive_relationship_tone_hint`, `test_dialogue_prompt_with_negative_relationship_tone_hint`, `test_dialogue_prompt_with_neutral_relationship_default_tone_hint`, `test_dialogue_prompt_no_relationship_influence_rule`) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `tone_hint`.
    - **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å `dialogue_option_availability`**: –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö" –≤ `AGENTS.md` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—É–Ω–∫—Ç, —Ç—Ä–µ–±—É—é—â–∏–π –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–µ–¥–∏–∑–∞–π–Ω–∞ —Å–∏—Å—Ç–µ–º—ã –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –æ–ø—Ü–∏–π.
- **–°—Ç–∞—Ç—É—Å**: –ß–∞—Å—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ `tone_hint` –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –≤ –¥–∏–∞–ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏ –ø–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏.

## Task 52: üß† 11.3 NPC Memory Management (Persistent, Per Guild)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Storing NPC interaction history with players/parties. Implement PlayerNpcMemory/PartyNpcMemory models. API `add_to_npc_memory` and `get_npc_memory`.
- **–ü–ª–∞–Ω**: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—ã—à–µ.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - **–®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `PartyNpcMemory`**:
        - –í —Ñ–∞–π–ª–µ `src/models/party_npc_memory.py` —Å–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `PartyNpcMemory`, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è `PlayerNpcMemory` —Å –∑–∞–º–µ–Ω–æ–π `player_id` –Ω–∞ `party_id`.
        - –ú–æ–¥–µ–ª—å `PartyNpcMemory` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py` –∏ –≤ –ª–æ–≥–≥–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–∞.
    - **–®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Alembic –¥–ª—è `PartyNpcMemory`**:
        - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `alembic`.
        - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/711257a22d1d_add_party_npc_memories_table.py`.
        - –ó–∞–ø–æ–ª–Ω–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `upgrade()` –∏ `downgrade()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `party_npc_memories` –∏ –µ–µ –∏–Ω–¥–µ–∫—Å–æ–≤.
    - **–®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å CRUD –¥–ª—è `PartyNpcMemory`**:
        - –í —Ñ–∞–π–ª–µ `src/core/crud/crud_party_npc_memory.py` —Å–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `CRUDPartyNpcMemory` —Å –º–µ—Ç–æ–¥–∞–º–∏ `get_multi_by_party_and_npc`, `get_multi_by_party`, `get_multi_by_npc`, `get_count_for_filters`.
        - `crud_party_npc_memory` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/crud/__init__.py`.
    - **–®–∞–≥ 4: –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å `npc_memory_system.py`**:
        - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/npc_memory_system.py` —Å –∑–∞–≥–ª—É—à–∫–∞–º–∏ –¥–ª—è API —Ñ—É–Ω–∫—Ü–∏–π.
        - –ú–æ–¥—É–ª—å –∏ –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/core/__init__.py`.
    - **–®–∞–≥ 5: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API `add_to_npc_memory` –≤ `npc_memory_system.py`**:
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É `player_id`/`party_id`, –≤—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ CRUD, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `details` –≤ `memory_data_json`.
    - **–®–∞–≥ 6: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API `get_npc_memory` –≤ `npc_memory_system.py`**:
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É `player_id`/`party_id` –∏ –≤—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö CRUD-–º–µ—Ç–æ–¥–æ–≤.
    - **–®–∞–≥ 7: –ù–∞–ø–∏—Å–∞—Ç—å Unit-—Ç–µ—Å—Ç—ã**:
        - –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–∏ `PartyNpcMemory` –≤ `tests/models/test_party_npc_memory.py`.
        - –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `CRUDPartyNpcMemory` –≤ `tests/core/crud/test_crud_party_npc_memory.py`.
        - –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `add_to_npc_memory` –∏ `get_npc_memory` –≤ `tests/core/test_npc_memory_system.py`.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º –ø–æ–ª–µ–π –≤ `GuildConfig` –∏ –¥–æ—Å—Ç—É–ø–æ–º –∫ `call_args` –º–æ–∫–æ–≤.
        - –¢–µ—Å—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ë–î SQLite (`test_party_npc_memory.py`, `test_crud_party_npc_memory.py`), –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `@pytest.mark.xfail` –∏–∑-–∑–∞ –Ω–µ—Ä–µ—à–µ–Ω–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã `MissingGreenlet` —Å `aiosqlite` –∏ `StaticPool` –≤ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
        - –¢–µ—Å—Ç—ã –¥–ª—è `test_npc_memory_system.py` (–∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –º–æ–∫–∏) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç.
    - **–®–∞–≥ 8: –û–±–Ω–æ–≤–∏—Ç—å `AGENTS.md`**: –≠—Ç–æ—Ç –ª–æ–≥.

## Task 51: üß† 11.2 Dialogue Context and Status (Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Implement logic for managing the state of a dialogue session for a player/party. API `start_dialogue`, `handle_dialogue_input`, `end_dialogue`.
- **–ü–ª–∞–Ω**:
    1.  **–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ò–∑—É—á–µ–Ω—ã Task 51, `action_processor.py`, `dialogue_system.py`, –º–æ–¥–µ–ª–∏ Player, Party, NPC, Enums (PlayerStatus, EventType), CRUDs, `game_events.py`.
        *   `PlayerStatus.DIALOGUE` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. `PartyTurnStatus` –¥–ª—è –¥–∏–∞–ª–æ–≥–∞ –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
        *   "–í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –æ –¥–∏–∞–ª–æ–≥–µ" –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ —Å–ª–æ–≤–∞—Ä–µ `active_dialogues` –≤ `dialogue_system.py`.
        *   `EventType.DIALOGUE_START, DIALOGUE_LINE, DIALOGUE_END` –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã.
    2.  **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è API `start_dialogue`**:
        *   –§—É–Ω–∫—Ü–∏—è `start_dialogue(session, guild_id, player_id, target_npc_id)` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/core/dialogue_system.py`.
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–∞, NPC.
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –¥–∏–∞–ª–æ–≥, —Å—Ç–∞—Ç—É—Å –±–æ—è –∏–≥—Ä–æ–∫–∞.
        *   –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `player.current_status = PlayerStatus.DIALOGUE`.
        *   –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `active_dialogues: Dict[Tuple[int, int], Dict[str, Any]]` –≤–∏–¥–∞ `(guild_id, player_id) -> {"npc_id", "npc_name", "dialogue_history"}`.
        *   –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `EventType.DIALOGUE_START`.
        *   –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
    3.  **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è API `handle_dialogue_input`**:
        *   –§—É–Ω–∫—Ü–∏—è `handle_dialogue_input(session, guild_id, player_id, message_text)` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/core/dialogue_system.py`.
        *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –∏–≥—Ä–æ–∫–∞.
        *   –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–≥—Ä–æ–∫. –†–µ–ø–ª–∏–∫–∞ –∏–≥—Ä–æ–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `dialogue_history`.
        *   –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `generate_npc_dialogue` (–∏–∑ Task 50).
        *   –û—Ç–≤–µ—Ç NPC –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `dialogue_history`.
        *   –õ–æ–≥–∏—Ä—É—é—Ç—Å—è `EventType.DIALOGUE_LINE` –¥–ª—è –∏–≥—Ä–æ–∫–∞ –∏ NPC.
        *   –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
    4.  **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è API `end_dialogue`**:
        *   –§—É–Ω–∫—Ü–∏—è `end_dialogue(session, guild_id, player_id)` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/core/dialogue_system.py`.
        *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞.
        *   –°–Ω–∏–º–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å `PlayerStatus.DIALOGUE` (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `PlayerStatus.EXPLORING`).
        *   –£–¥–∞–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –∏–∑ `active_dialogues`.
        *   –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è `EventType.DIALOGUE_END`.
        *   –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
    5.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Action Processing Module (Task 21/6.11)**:
        *   –í `src/core/action_processor.py` –≤ `ACTION_DISPATCHER` –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ "talk" (–∏ –Ω–æ–≤–æ–≥–æ "start_dialogue") –¥–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `_handle_talk_to_npc_action_wrapper`, –≤—ã–∑—ã–≤–∞—é—â–∏–π `start_dialogue`.
        *   –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `_handle_end_dialogue_action_wrapper` –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ "end_dialogue".
        *   –§—É–Ω–∫—Ü–∏—è `process_player_message_for_nlu` –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞: –µ—Å–ª–∏ `player.current_status == PlayerStatus.DIALOGUE`, –≤–≤–æ–¥ –∏–≥—Ä–æ–∫–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `handle_dialogue_input`, –∞ –æ—Ç–≤–µ—Ç NPC –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–≥—Ä–æ–∫—É. –ò–Ω–∞—á–µ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ NLU.
    6.  **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏ Enums**: –ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Enums –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –ù–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ –¥–∏–∞–ª–æ–≥–∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å –≤ –ø–∞–º—è—Ç–∏).
    7.  **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
        *   –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_dialogue_system.py`.
        *   –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `start_dialogue`, `handle_dialogue_input`, `end_dialogue`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—É—Å–ø–µ—Ö, –æ—à–∏–±–∫–∏, –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `active_dialogues`).
    8.  **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**: –≠—Ç–æ—Ç –ª–æ–≥.
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ Task 51 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.

## Task 50: üß† 11.1 Dialogue Generation Module (LLM, Multy-i18n, According to Rules) - –°–µ—Å—Å–∏—è 2024-07-26 (–ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Prepare the prompt for the LLM to generate NPC dialogue lines. API `generate_npc_dialogue(guild_id: int, context: dict) -> str`.
- **–ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–æ–≤ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π)**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ñ–∞–π–ª—ã `src/core/ai_prompt_builder.py`, `src/core/dialogue_system.py`, `src/core/__init__.py`, `tests/core/test_ai_prompt_builder.py`, `tests/core/test_dialogue_system.py`.
    - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ `prepare_dialogue_generation_prompt` –≤ `ai_prompt_builder.py` —É–∂–µ –¥–µ—Ç–∞–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—à–∏—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.
    - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ `generate_npc_dialogue` –≤ `dialogue_system.py` –≤—ã–∑—ã–≤–∞–µ—Ç `prepare_dialogue_generation_prompt` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ú–û–ö –¥–ª—è LLM (`random.choice`).
    - –≠–∫—Å–ø–æ—Ä—Ç—ã –≤ `__init__.py` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.
    - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –≤ `test_ai_prompt_builder.py` –∏ `test_dialogue_system.py` –ø–æ–∫—Ä—ã–≤–∞—é—Ç –±–∞–∑–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.
    - –í `ai_prompt_builder.py` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ CRUD.
- **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–Ω (–Ω–∞ —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é)**:
    1.  **–û–±–Ω–æ–≤–∏—Ç—å `AGENTS.md`**:
        *   –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Task 50 –≤ —Å–µ–∫—Ü–∏–∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π", –æ—Ç–º–µ—Ç–∏–≤, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ `prepare_dialogue_generation_prompt` –∏ `generate_npc_dialogue` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
        *   –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–ª–∞–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ —Å–µ–∫—Ü–∏—é "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –≤ `AGENTS.md`.
    2.  **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è `prepare_dialogue_generation_prompt` –≤ `tests/core/test_ai_prompt_builder.py`**:
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã (`test_prepare_dialogue_prompt_basic_success`, `test_prepare_dialogue_prompt_with_relationship_quest_hidden_context`, `test_prepare_dialogue_prompt_no_relationship`).
        *   –¢–µ—Å—Ç—ã –ø—Ä–∏–∑–Ω–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–±–æ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (NPC, –ò–≥—Ä–æ–∫, —è–∑—ã–∫, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ LLM, –ø–∞–º—è—Ç—å NPC, –û—Ç–Ω–æ—à–µ–Ω–∏—è, –°–∫—Ä—ã—Ç—ã–µ –û—Ç–Ω–æ—à–µ–Ω–∏—è, –ö–≤–µ—Å—Ç—ã). –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫ –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å.
    3.  **–ê–Ω–∞–ª–∏–∑ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è `generate_npc_dialogue` –≤ `tests/core/test_dialogue_system.py`**:
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã (`test_generate_npc_dialogue_success`, `test_generate_npc_dialogue_with_special_player_input`).
        *   –¢–µ—Å—Ç—ã –ø—Ä–∏–∑–Ω–∞–Ω—ã –∞–¥–µ–∫–≤–∞—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–º–∏ –≤—ã–∑–æ–≤ `prepare_dialogue_generation_prompt`, –≤—ã–∑–æ–≤ –º–æ–∫–∞ LLM (`random.choice`), –≤–æ–∑–≤—Ä–∞—Ç –æ–∂–∏–¥–∞–µ–º–æ–π —Å—Ç—Ä–æ–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ –≤ `player_input_text` –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–∫–∞. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫ –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å.
    4.  **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫**:
        *   –ü—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—ã –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ `pytest tests/`. –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã `ModuleNotFoundError`.
        *   –í—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ `pip install -r requirements.txt`. –û—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å.
        *   –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ `pip install --force-reinstall --no-cache-dir -r requirements.txt`. –û—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å.
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω `pytest.ini` - –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.
        *   –¢–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω—ã –∫–æ–º–∞–Ω–¥–æ–π `python -m pytest tests/`. –í—Å–µ 773 —Ç–µ—Å—Ç–∞ –ø—Ä–æ–π–¥–µ–Ωy. –í—ã—è–≤–ª–µ–Ω—ã –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (warnings), –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Task 50 –∏ –Ω–µ —è–≤–ª—è—é—â–∏–µ—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏.
- **–°—Ç–∞—Ç—É—Å –Ω–∞ –∫–æ–Ω–µ—Ü —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏**:
    - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–∏–∞–ª–æ–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (`prepare_dialogue_generation_prompt`, `generate_npc_dialogue`) –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø—Ä–∏–∑–Ω–∞–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –±–∞–∑–æ–≤—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Task 50.
    - –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç.
- **–°—Ç–∞—Ç—É—Å –Ω–∞ [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]**: –ó–∞–¥–∞—á–∞ Task 50 —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π. –û—Å–Ω–æ–≤–∞–Ω–∏–µ: —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ (`src/core/ai_prompt_builder.py::prepare_dialogue_generation_prompt`, `src/core/dialogue_system.py::generate_npc_dialogue`) –∏ —Ç–µ—Å—Ç—ã (`tests/core/test_ai_prompt_builder.py`, `tests/core/test_dialogue_system.py`) —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –±–∞–∑–æ–≤—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º, –∏–∑–ª–æ–∂–µ–Ω–Ω—ã–º –≤ `Tasks.txt`. –°–æ–≥–ª–∞—Å–Ω–æ –ª–æ–≥—É –æ—Ç "–°–µ—Å—Å–∏—è 2024-07-26", –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ (773) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏, —á—Ç–æ —Å–Ω–∏–º–∞–µ—Ç —Ä–∞–Ω–µ–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏.

## Task 49: üõ†Ô∏è 15.3 Monitoring Tools (Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Provide the Master with information about the game state and history in their guild. Viewing commands (Log, WS, Map, Entities, Statistics) filtered by guild_id and formatted in Master's language.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - –°–æ–∑–¥–∞–Ω Cog `MasterMonitoringCog` (`src/bot/commands/master_commands/monitoring_master_commands.py`).
    - Cog –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/config/settings.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω CRUD –¥–ª—è `StoryLog` (`src/core/crud/crud_story_log.py`) —Å –±–∞–∑–æ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/crud/__init__.py`.
    - –í `CRUDBase` (`src/core/crud_base_definitions.py`) –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `count` –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –∑–∞–ø–∏—Å–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ `guild_id`.
    - –í `CRUDRuleConfig` (`src/core/crud/crud_rule_config.py`) –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `get_multi_by_guild_and_prefix` –∏ `count_by_guild_and_prefix`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å –ø–æ–¥–≥—Ä—É–ø–ø–∞–º–∏ –≤ `MasterMonitoringCog`:
        -   **`/master_monitor log`**:
            -   `view <log_id>`: –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ `StoryLog`.
            -   `list [page] [limit] [event_type_filter]`: –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π `StoryLog` —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è.
        -   **`/master_monitor worldstate`** (–¥–∞–Ω–Ω—ã–µ –∏–∑ `RuleConfig`):
            -   `get <key>`: –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ WorldState.
            -   `list [page] [limit] [prefix]`: –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π WorldState —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É –∫–ª—é—á–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "worldstate:").
        -   **`/master_monitor map`**:
            -   `list_locations [page] [limit]`: –°–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π.
            -   `view_location <identifier>`: –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ª–æ–∫–∞—Ü–∏–∏ –ø–æ ID –∏–ª–∏ static_id.
        -   **`/master_monitor entities`**:
            -   `list_players [page] [limit]`: –°–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤.
            -   `view_player <player_id>`: –î–µ—Ç–∞–ª–∏ –∏–≥—Ä–æ–∫–∞.
            -   `list_npcs [page] [limit]`: –°–ø–∏—Å–æ–∫ `GeneratedNpc`.
            -   `view_npc <npc_id>`: –î–µ—Ç–∞–ª–∏ `GeneratedNpc`.
            -   `list_parties [page] [limit]`: –°–ø–∏—Å–æ–∫ `Party`.
            -   `view_party <party_id>`: –î–µ—Ç–∞–ª–∏ `Party`.
            -   `list_global_npcs [page] [limit]`: –°–ø–∏—Å–æ–∫ `GlobalNpc`.
            -   `view_global_npc <global_npc_id>`: –î–µ—Ç–∞–ª–∏ `GlobalNpc`.
            -   `list_mobile_groups [page] [limit]`: –°–ø–∏—Å–æ–∫ `MobileGroup`.
            -   `view_mobile_group <mobile_group_id>`: –î–µ—Ç–∞–ª–∏ `MobileGroup`.
    - –ö–æ–º–∞–Ω–¥–∞ `/master_monitor statistics get` –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —á–µ—Ç–∫–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Å–æ–±–∏—Ä–∞–µ–º–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ.
    - –í—Å–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `interaction.guild_id`, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `get_localized_text`, –ø–∞–≥–∏–Ω–∞—Ü–∏—é –∏ –≤—ã–≤–æ–¥—è—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ `discord.Embed`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –±–∞–∑–æ–≤—ã—Ö Unit-—Ç–µ—Å—Ç–æ–≤ `tests/bot/commands/master_commands/test_monitoring_master_commands.py`.
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ (2024-07-23) –ø–æ Task 49 (—Å–≤—è–∑–∞–Ω–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∑–∞–ø—Ä–æ—Å–æ–º "–∑–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã –∏ –∏—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫–∏")**:
    - **–ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: –¢–µ—Å—Ç—ã –≤ `tests/bot/commands/master_commands/test_monitoring_master_commands.py` –ø–∞–¥–∞–ª–∏. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, `test_entities_view_player_found` –∏–º–µ–ª `AttributeError` –∏–∑-–∑–∞ –ø–æ–ø—ã—Ç–∫–∏ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é `get_localized_player_name`. –¢–µ—Å—Ç—ã `test_log_view_found` –∏ `test_worldstate_get_found` –ø–∞–¥–∞–ª–∏ —Å –æ—à–∏–±–∫–∞–º–∏ `AssertionError` –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–ª–µ–π –≤ —ç–º–±–µ–¥–∞—Ö.
    - **–ê–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
        - –î–ª—è `test_entities_view_player_found`:
            - –í—ã—è—Å–Ω–µ–Ω–æ, —á—Ç–æ –∫–æ–º–∞–Ω–¥–∞ `entities_view_player` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `player.name` –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞, –∞ –Ω–µ –∫–∞–∫—É—é-–ª–∏–±–æ —Ñ—É–Ω–∫—Ü–∏—é –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–º–µ–Ω–∏ –∏–≥—Ä–æ–∫–∞.
            - –£–¥–∞–ª–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ç—á `@patch("src.core.localization_utils.get_localized_player_name", ...)`.
            - –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –æ–∂–∏–¥–∞–µ–º—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π –≤ —ç–º–±–µ–¥–µ.
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–µ–Ω–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –º–æ–∫-–æ–±—ä–µ–∫—Ç–∞ –ø–ª–µ–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `discord_id` –≤–º–µ—Å—Ç–æ `discord_user_id`).
        - –î–ª—è `test_log_view_found`:
            - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã `log_view` –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–±–∞–≤–ª—è–µ–º—ã—Ö –µ—é –ø–æ–ª–µ–π.
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π —Å 7 –Ω–∞ 4.
            - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–º–µ–Ω –∏ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ–ª–µ–π.
        - –î–ª—è `test_worldstate_get_found`:
            - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã `worldstate_get`. –í—ã—è—Å–Ω–µ–Ω–æ, —á—Ç–æ –æ–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ 2 –ø–æ–ª—è ("Value", "Description"), –∞ –Ω–µ 3. –ü–æ–ª–µ "Description" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç "N/A" –∏–∑-–∑–∞ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥—ã.
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π —Å 3 –Ω–∞ 2.
            - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è "Description" –Ω–∞ "N/A".
    - **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Å–µ —Ç–µ—Å—Ç—ã –≤ `tests/bot/commands/master_commands/test_monitoring_master_commands.py` (7 —Ç–µ—Å—Ç–æ–≤) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

## –î–æ—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å —Ç–æ—Ä–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π (—Å–≤—è–∑–∞–Ω–æ —Å Task 37 –∏ Task 44)
- **–î–∞—Ç–∞**: 2024-07-24
- **–¶–µ–ª—å**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–ª–∏—è–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ —Ü–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ `src/core/trade_system.py`.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - **–ê–Ω–∞–ª–∏–∑ `src/core/trade_system.py`**:
        - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_calculate_item_price`. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –ª–æ–≥–∏–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:trade:price_adjustment` –∏–∑ `RuleConfig`, –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–æ–º –∏ NPC, –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ü–µ–Ω (–∫–∞–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ "—Ç–∏—Ä–æ–≤", —Ç–∞–∫ –∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ "—Ñ–æ—Ä–º—É–ª") —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
        - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ `src/core/relationship_system.py::update_relationship` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `handle_trade_action` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –ø–æ—Å–ª–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ (`tests/core/test_trade_system.py`)**:
        - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è `_calculate_item_price` –¥–ª—è –±–æ–ª–µ–µ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π:
            - –ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –±–µ–∑ default-—Ç–∏—Ä–∞ (—Ü–µ–Ω–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è).
            - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ default-—Ç–∏—Ä–∞, –∫–æ–≥–¥–∞ –¥—Ä—É–≥–∏–µ –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç.
            - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:trade:price_adjustment` (—Ü–µ–Ω–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è).
            - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª–∞ (—Ü–µ–Ω–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –±–µ–∑ –æ—à–∏–±–æ–∫).
            - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `sell_multiplier_mod` –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø—Ä–∏ –≤—ã—Å–æ–∫–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö.
            - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `buy_price_adjustment_formula` –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ø—Ä–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö.
        - –í—Å–µ —Ç–µ—Å—Ç—ã (21 –≤ `test_trade_system.py`) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∏ –∑–∞–ø—É—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö.
- **–°—Ç–∞—Ç—É—Å**: –ß–∞—Å—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏, –∫–∞—Å–∞—é—â–∞—è—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å —Ç–æ—Ä–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π, **–≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —Ç–µ—Å—Ç–∞–º–∏**. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å –≤ "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö" –æ–±–Ω–æ–≤–ª–µ–Ω–∞.

## Task 48: üõ†Ô∏è 15.2 Balance and Testing Tools (Per Guild)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Simulators and analyzers for the Master, operating within the guild context according to rules. Simulation APIs (Combat, Checks, Conflicts). AI generation analyzers. Results output in Master's language.
- **–°—Ç–∞—Ç—É—Å**: –ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω (–±–∞–∑–æ–≤—ã–µ —Å–∏–º—É–ª—è—Ç–æ—Ä—ã –∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –Ω–æ —Ç—Ä–µ–±—É—é—Ç —É–≥–ª—É–±–ª–µ–Ω–∏—è).
- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**:
    - –°–æ–∑–¥–∞–Ω Cog `MasterSimulationToolsCog` (`src/bot/commands/master_commands/master_simulation_tools_cog.py`) —Å –≥—Ä—É–ø–ø–∞–º–∏ –∫–æ–º–∞–Ω–¥ `/master_simulate` –∏ `/master_analyze`.
    - **–ö–æ–º–∞–Ω–¥–∞ `/master_simulate check`**:
        - –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `check_resolver.resolve_check`.
        - –í—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏.
    - **–ö–æ–º–∞–Ω–¥–∞ `/master_simulate combat_action`**:
        - –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `combat_engine.process_combat_action`.
        - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ù–µ —è–≤–ª—è–µ—Ç—Å—è "dry run" –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, `StoryLog`).
        - –í—ã–≤–æ–¥–∏—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±–æ—è.
    - **–ö–æ–º–∞–Ω–¥–∞ `/master_simulate conflict`**:
        - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π `conflict_simulation_system.simulate_conflict_detection`.
        - `simulate_conflict_detection` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è "—ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã—Ö" –∏–Ω—Ç–µ–Ω—Ç–æ–≤ –Ω–∞ –æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Ü–µ–ª–∏ (–∏–∑–≤–ª–µ–∫–∞–µ–º—É—é `_extract_primary_target_signature`).
        - –í—ã–≤–æ–¥–∏—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö (—Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö) –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö.
        - Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω—ã.
    - **–ö–æ–º–∞–Ω–¥–∞ `/master_analyze ai_generation`**:
        - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å `ai_analysis_system.analyze_generated_content`.
        - –ë—ç–∫–µ–Ω–¥-—Ñ—É–Ω–∫—Ü–∏—è `analyze_generated_content`:
            - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –ø—Ä–æ–º–ø—Ç-–±–∏–ª–¥–µ—Ä–∞–º–∏ –∏–∑ `ai_prompt_builder.py` –¥–ª—è —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π: "quest", "item", "npc" (—Å/–±–µ–∑ `location_id`), "faction". –î–ª—è "location" –∏ –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–µ–º.
            - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–µ –º–æ–∫-–æ—Ç–≤–µ—Ç—ã AI –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –†–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ AI –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.
            - –í—ã–ø–æ–ª–Ω—è–µ—Ç –±–∞–∑–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
                - –ü–æ–ª–Ω–æ—Ç–∞ i18n –ø–æ–ª–µ–π (–∏–º–µ–Ω–∞, –æ–ø–∏—Å–∞–Ω–∏—è –∏ —Ç.–¥., –≤–∫–ª—é—á–∞—è —à–∞–≥–∏ –∫–≤–µ—Å—Ç–∞).
                - –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π (–æ–ø–∏—Å–∞–Ω–∏—è/—Å–≤–æ–¥–∫–∏).
                - –ù–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π (–¥–ª—è item, npc, quest).
                - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π (`base_value` –¥–ª—è item, `level` –¥–ª—è npc).
            - –°–æ–±–∏—Ä–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Pydantic, –µ—Å–ª–∏ –æ–Ω–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ.
        - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ (–≤–∫–ª—é—á–∞—è –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –ø—Ä–µ–≤—å—é –¥–∞–Ω–Ω—ã—Ö) –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º `discord.Embed`.
        - Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –∏ –∫–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ (2024-07-19)**:
    - **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ OpenAI –≤ –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–µ AI**:
        - –í `src/core/ai_orchestrator.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `make_real_ai_call` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å OpenAI API (gpt-3.5-turbo).
        - `src/core/ai_analysis_system.py` (`analyze_generated_content`) –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `make_real_ai_call` –ø—Ä–∏ `use_real_ai=True`.
        - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `openai` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `requirements.txt`.
    - **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –±–∞–∑–æ–≤—ã–π "Dry Run" –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –±–æ–µ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π**:
        - –í `src/core/game_events.py` (`log_event`) –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `dry_run`. –ï—Å–ª–∏ `True`, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.
        - –í `src/core/combat_engine.py` (`process_combat_action`) –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `dry_run`. –ï—Å–ª–∏ `True`, –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `CombatEncounter` –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î, –∏ `log_event` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å `dry_run=True`.
        - –ö–æ–º–∞–Ω–¥–∞ `/master_simulate combat_action` –≤ `src/bot/commands/master_commands/master_simulation_tools_cog.py` –æ–±–Ω–æ–≤–ª–µ–Ω–∞:
            - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `dry_run: bool`.
            - –ó–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `process_combat_action`.
            - –í –æ—Ç–≤–µ—Ç–µ –∫–æ–º–∞–Ω–¥—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –±—ã–ª –ª–∏ —ç—Ç–æ dry run.
    - **–†–∞—Å—à–∏—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –≤ –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–µ AI (–Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ)**:
        - –í `src/core/ai_analysis_system.py` (`analyze_generated_content`) –¥–æ–±–∞–≤–ª–µ–Ω—ã:
            - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π (placeholder text) –≤ i18n –ø–æ–ª—è—Ö (—Å–ø–∏—Å–æ–∫ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π –∏–∑ `RuleConfig analysis:common:placeholder_texts`).
            - –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è NPC: `properties_json.stats.health` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å > 0 (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∏ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º).
- **–°—Ç–∞—Ç—É—Å**: –ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω. –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–º—É–ª—è—Ç–æ—Ä—ã –∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —É–ª—É—á—à–µ–Ω—ã.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ (2024-07-19) –ø–æ "–£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (`simulate_conflict_detection`)"**:
    - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `src/core/conflict_simulation_system.py::simulate_conflict_detection`.
    - –õ–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–∏—á–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ü–µ–ª–∏ (`_extract_primary_target_signature`) —É–ª—É—á—à–µ–Ω–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–æ–ª—å—à–µ–≥–æ —á–∏—Å–ª–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –∏–Ω—Ç–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `use_on_self`).
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ `CONFLICT_RULES_SAME_INTENT_SAME_TARGET` –∏ `CONFLICTING_INTENT_PAIRS_ON_SAME_TARGET` –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–æ–≤ `interact`, `use` (–Ω–∞ –æ–±—ä–µ–∫—Ç–∞—Ö), —Ç–æ—Ä–≥–æ–≤—ã—Ö –∏–Ω—Ç–µ–Ω—Ç–æ–≤ –∏ –ø–∞—Ä —Ç–∏–ø–∞ `attack` vs `talk`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–æ–≤—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª: `_apply_same_intent_conflict_rules`, `_apply_conflicting_intent_pairs_rules`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_check_use_self_vs_take_conflicts` –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ –Ω–∞ —Å–µ–±–µ –ø—Ä–æ—Ç–∏–≤ –µ–≥–æ –≤–∑—è—Ç–∏—è.
    - –ö–æ–¥ –±—ã–ª —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏.
    - –ù–∞–ø–∏—Å–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_conflict_simulation_system.py` –¥–ª—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏. –í—Å–µ —Ç–µ—Å—Ç—ã –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ (50) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/master_simulate conflict` –≤ `src/bot/commands/master_commands/master_simulation_tools_cog.py` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π `simulate_conflict_detection` –∏ –µ–µ –Ω–æ–≤—ã–º —Ç–∏–ø–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö (`List[PydanticConflictForSim]`).
- **–û—Å—Ç–∞–≤—à–∏–µ—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**:
    - **–î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –≤ –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–µ AI**: –î–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –±–∞–ª–∞–Ω—Å–∞, –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ª–æ—Ä—É. –¢–µ–∫—É—â–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±—ã–ª–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md` –æ—Ç 2024-07-19**: –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–æ Task 48, –≤–∫–ª—é—á–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–¥–∑–∞–¥–∞—á–∏ –ø–æ —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤. –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ (2024-07-22) –ø–æ "–£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (`simulate_conflict_detection`)"**:
    - –ü—Ä–æ–≤–µ–¥–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ `action_processor.py`. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —á—Ç–æ –æ–Ω –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ —Ö–æ–¥–∞, –∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.
    - –°–∏—Å—Ç–µ–º–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ `src/core/conflict_simulation_system.py` —É–ª—É—á—à–µ–Ω–∞:
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–∑ `RuleConfig` (–∫–ª—é—á–∏: `conflict_simulation:rules_same_intent_same_target`, `conflict_simulation:rules_conflicting_intent_pairs`, `conflict_simulation:enable_use_self_vs_take_check`).
        - –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ `RuleConfig`.
        - –†–∞—Å—à–∏—Ä–µ–Ω—ã —Ç–∏–ø—ã –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ–º—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è `go_to` –Ω–∞ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—É—é —Ç–æ—á–∫—É, –ø–∞—Ä—ã `interact`/`destroy_object`, `talk`/`use`).
        - –û–±–Ω–æ–≤–ª–µ–Ω—ã Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_conflict_simulation_system.py` –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `RuleConfig` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª.
        - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ Discord `/master_simulate conflict` –¥–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö, –≤–∫–ª—é—á–∞—è `target_signature` –∏ `action_entities`.
    - **–°—Ç–∞—Ç—É—Å –ø–æ–¥–∑–∞–¥–∞—á–∏ "–£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤"**: –í –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ (2024-07-24) –ø–æ "–£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (`simulate_conflict_detection`)"**:
    - **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã `src/core/conflict_simulation_system.py` –∏ `tests/core/test_conflict_simulation_system.py`. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–∑–Ω–∞–Ω–∞ –Ω–∞—Ö–æ–¥—è—â–µ–π—Å—è –≤ —Ö–æ—Ä–æ—à–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.
    - **–£–ª—É—á—à–µ–Ω–∏–µ `_extract_primary_target_signature`**:
        - –†–∞—Å—à–∏—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ `use`: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ç–µ–ø–µ—Ä—å: –ü—Ä–µ–¥–º–µ—Ç -> –ù–∞–≤—ã–∫ -> –û–±—ä–µ–∫—Ç –º–∏—Ä–∞. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ü–µ–ª—å –¥–ª—è `use`, –Ω–∞–ø—Ä–∏–º–µ—Ä, "use lever".
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**:
        - –í `DEFAULT_RULES_SAME_INTENT_SAME_TARGET_CFG`:
            - –ü—Ä–∞–≤–∏–ª–æ `EXCLUSIVE_OBJECT_INTERACTION` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ `EXCLUSIVE_OBJECT_MANIPULATION`.
            - –í –Ω–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ–Ω—Ç `use` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã —Å–∏–≥–Ω–∞—Ç—É—Ä (`use_obj_static:`, `use_obj_name:`) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –º–∏—Ä–∞.
            - –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (—É—á–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–∫—Ç–æ—Ä–∞).
        - –í `DEFAULT_RULES_CONFLICTING_INTENT_PAIRS_CFG`:
            - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ–º —Ç–æ—Ä–≥–æ–≤–ª–∏.
            - –†–∞—Å—à–∏—Ä–µ–Ω—ã –ø—Ä–µ—Ñ–∏–∫—Å—ã —Ü–µ–ª–µ–π –¥–ª—è –ø—Ä–∞–≤–∏–ª–∞ `["interact", "destroy_object"]`.
            - –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏–π.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ (`tests/core/test_conflict_simulation_system.py`)**:
        - –í `TestExtractPrimaryTargetSignature` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –∏–Ω—Ç–µ–Ω—Ç–∞ `use` —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –º–∏—Ä–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä—ã.

---
## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è UI Task 60: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º –∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏

–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã Discord (–∫–æ—Ç–æ—Ä—ã–µ UI –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ API —à–ª—é–∑), –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–º –∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏.

**–û–±—â–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**

*   –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ç—Ä–µ–±—É—é—Ç `guild_id`, –∫–æ—Ç–æ—Ä—ã–π UI –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å.
*   –î–ª—è –ø–æ–ª–µ–π JSON (–Ω–∞–ø—Ä–∏–º–µ—Ä, `name_i18n`, `properties_json`) –∫–æ–º–∞–Ω–¥—ã –æ–∂–∏–¥–∞—é—Ç —Å—Ç—Ä–æ–∫—É JSON. UI –¥–æ–ª–∂–µ–Ω —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –≤ JSON –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.
*   –û—Ç–≤–µ—Ç—ã –∫–æ–º–∞–Ω–¥ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö) –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —è–∑—ã–∫–µ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (–ú–∞—Å—Ç–µ—Ä–∞). UI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.
*   `GUILD_ID_PLACEHOLDER` –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö –≤—ã–∑–æ–≤–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤ UI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –≥–∏–ª—å–¥–∏–∏.
*   –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –≤—ã–∑–æ–≤–∞ –∫–æ–º–∞–Ω–¥ –≤ `apiClient` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/master_command_endpoint`) —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–π –∏ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ API —à–ª—é–∑–∞.

---

**1. –ü—Ä–µ–¥–º–µ—Ç—ã (Item Definitions)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `Item` (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞)
*   **–ú–æ–¥–µ–ª—å**: `src/models/item.py`
*   **TypeScript**: `src/ui/src/types/items.ts -> ItemDefinition, ItemPayload`
*   **–°–µ—Ä–≤–∏—Å UI**: `src/ui/src/services/itemService.ts`

*   **1.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –≥–∏–ª—å–¥–∏–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_item list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `page: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
        *   `limit: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–ø–∏—Å–æ–∫ `ItemDefinition` –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (—Å–º. `PaginatedResponse<ItemDefinition>`).
        *   –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–π JSON –æ—Ç API —à–ª—é–∑–∞):
            ```json
            {
              "items": [
                { "id": 1, "guild_id": 123, "static_id": "sword1", "name_i18n": {"en": "Sword"}, ... }
              ],
              "total": 1, "page": 1, "limit": 10
            }
            ```

*   **1.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_item view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `item_id: int`
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `ItemDefinition`.
        *   –ü—Ä–∏–º–µ—Ä: `{ "id": 1, "static_id": "sword1", ... }`

*   **1.3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_item create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`ItemPayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `static_id: str`
        *   `name_i18n_json: str` (JSON —Å—Ç—Ä–æ–∫–∞ –¥–ª—è `name_i18n: Record<string, string>`)
        *   `item_type_i18n_json: str` (JSON —Å—Ç—Ä–æ–∫–∞ –¥–ª—è `item_type_i18n: Record<string, string>`)
        *   `description_i18n_json: Optional[str]`
        *   `properties_json: Optional[str]`
        *   `base_value: Optional[int]`
        *   `slot_type: Optional[str]`
        *   `is_stackable: bool` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `True`)
        *   `item_category_i18n_json: Optional[str]`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `ItemDefinition`.

*   **1.4. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_item update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`itemId: number`, `payload: Partial<ItemPayload>`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `item_id: int`
        *   `data_json: str` (JSON —Å—Ç—Ä–æ–∫–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –æ–±—ä–µ–∫—Ç `Partial<ItemPayload>` —Å –æ–±–Ω–æ–≤–ª—è–µ–º—ã–º–∏ –ø–æ–ª—è–º–∏).
            *   –ù–∞–ø—Ä–∏–º–µ—Ä, `{"name_i18n": {"en": "New Name"}, "base_value": 150}`
    *   **–û—Ç–≤–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `ItemDefinition`.

*   **1.5. –£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_item delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `item_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ.

---

**2. –≠–∫–∑–µ–º–ø–ª—è—Ä—ã –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ (Inventory Items)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `InventoryItem` (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ —É –≤–ª–∞–¥–µ–ª—å—Ü–∞)
*   **–ú–æ–¥–µ–ª—å**: `src/models/inventory_item.py`
*   **TypeScript**: `src/ui/src/types/items.ts -> InventoryItemData, EnrichedInventoryItem`
*   **–°–µ—Ä–≤–∏—Å UI**: `src/ui/src/services/inventoryService.ts`

*   **2.1. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å—É—â–Ω–æ—Å—Ç–∏ (–ò–≥—Ä–æ–∫–∞ –∏–ª–∏ NPC)**
    *   **2.1.1. –î–ª—è –ò–≥—Ä–æ–∫–∞ (—Å –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)**
        *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_player view`
        *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
            *   `player_id: int`
            *   `include_inventory: bool = true`
        *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `Player` (—Å–º. `src/ui/src/types/entities.ts`), –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `inventory: EnrichedInventoryItem[]`.
    *   **2.1.2. –î–ª—è NPC (—Å –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)**
        *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_npc view`
        *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
            *   `npc_id: int`
            *   `include_inventory: bool = true`
        *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `GeneratedNpc` (—Å–º. `src/ui/src/types/entities.ts`), –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `inventory: EnrichedInventoryItem[]`.
    *   **2.1.3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–º–µ–Ω–µ–µ —É–¥–æ–±–Ω—ã–π –¥–ª—è UI, –µ—Å–ª–∏ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –Ω–µ –≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ view)**
        *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_inventory_item list`
        *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
            *   `owner_id: int`
            *   `owner_type: str` ("PLAYER" –∏–ª–∏ "GENERATED_NPC")
            *   `limit: int` (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä 1000)
        *   **–û—Ç–≤–µ—Ç**: –°–ø–∏—Å–æ–∫ `InventoryItemData`. UI –∑–∞—Ç–µ–º –¥–æ–ª–∂–µ–Ω –±—É–¥–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `item_id` –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —á–µ—Ä–µ–∑ `/master_item view`.

*   **2.2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å (—Å–æ–∑–¥–∞—Ç—å InventoryItem)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_inventory_item create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `owner_id: int`
        *   `owner_type: str` ("PLAYER" –∏–ª–∏ "GENERATED_NPC")
        *   `item_id: int` (ID –±–∞–∑–æ–≤–æ–≥–æ `Item`)
        *   `quantity: int` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
        *   `equipped_status: Optional[str]`
        *   `properties_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞ –¥–ª—è `instance_specific_properties_json`)
    *   **–û—Ç–≤–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `InventoryItemData` (–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ —Å ID).

*   **2.3. –û–±–Ω–æ–≤–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_inventory_item update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `inventory_item_id: int`
        *   `field_to_update: str` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "quantity", "equipped_status", "properties_json")
        *   `new_value: str` (–¥–ª—è `quantity` - —á–∏—Å–ª–æ; –¥–ª—è `equipped_status` - —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ "None"; –¥–ª—è `properties_json` - JSON —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ "None")
    *   **–û—Ç–≤–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `InventoryItemData` (–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ).
        *   *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ*: –ï—Å–ª–∏ `quantity` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–æ 0, –ø—Ä–µ–¥–º–µ—Ç —É–¥–∞–ª—è–µ—Ç—Å—è.

*   **2.4. –£–¥–∞–ª–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_inventory_item delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `inventory_item_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ.

*   **2.5. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –º–µ–∂–¥—É –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è–º–∏**
    *   **–ü—Ä—è–º–æ–π –∫–æ–º–∞–Ω–¥—ã –Ω–µ—Ç.**
    *   **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ UI**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤:
        1.  –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ `InventoryItem` (—á–µ—Ä–µ–∑ `/master_inventory_item view <source_inventory_item_id>`).
        2.  –£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É –∏—Å—Ç–æ—á–Ω–∏–∫–∞: `/master_inventory_item update --inventory_item_id <id> --field_to_update quantity --new_value <new_source_qty>` (–µ—Å–ª–∏ `new_source_qty` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 0, –ø—Ä–µ–¥–º–µ—Ç —É–¥–∞–ª–∏—Ç—Å—è).
        3.  –î–æ–±–∞–≤–∏—Ç—å/—É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É —Ü–µ–ª–∏: `/master_inventory_item create` (—Å `item_id` –∏–∑ —à–∞–≥–∞ 1, `instance_specific_properties_json` –∏–∑ —à–∞–≥–∞ 1, –∏ –ø–µ—Ä–µ–º–µ—â–∞–µ–º—ã–º `quantity`) –∏–ª–∏, –µ—Å–ª–∏ —É —Ü–µ–ª–∏ —É–∂–µ –µ—Å—Ç—å —Ç–∞–∫–æ–π —Å—Ç–∞–∫–∞–±–µ–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç, —Ç–æ `/master_inventory_item update` –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è `quantity` —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ `InventoryItem` —Ü–µ–ª–∏.
    *   **–¢—Ä–µ–±—É–µ—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–π –ª–æ–≥–∏–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ UI** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤—Å–µ–≥–æ —Å—Ç–∞–∫–∞, —á–∞—Å—Ç–∏ —Å—Ç–∞–∫–∞, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤, —Å—Ç–∞–∫–∞–±–µ–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –±–µ–∑ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤).

---
        - –í `TestSimulateConflictDetection` –¥–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç `test_conflict_two_uses_on_same_object_static_id` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª–∞ `EXCLUSIVE_OBJECT_MANIPULATION`. –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç `test_conflict_interact_vs_use_on_same_object_name` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–≥—Ä–∞–Ω–∏—á–Ω–æ–≥–æ —Å–ª—É—á–∞—è —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞–º–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (–æ–∂–∏–¥–∞–µ–º–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –ø–æ —Ç–µ–∫—É—â–µ–π –ª–æ–≥–∏–∫–µ).
        - –í `TestConflictRuleApplication` –æ–±–Ω–æ–≤–ª–µ–Ω–æ `sample_rules_same_intent` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ `EXCLUSIVE_OBJECT_MANIPULATION_TEST`. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã `test_apply_same_intent_two_uses_on_object` –∏ `test_apply_same_intent_interact_and_use_on_object_diff_sigs_no_conflict_here`.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã Discord `/master_simulate conflict`**:
        - –í `src/bot/commands/master_commands/master_simulation_tools_cog.py`:
            - –£—Ç–æ—á–Ω–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `actions_json` –¥–ª—è –ª—É—á—à–µ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –æ–∂–∏–¥–∞–µ–º–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `ParsedAction`.
            - –£–ª—É—á—à–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ `action_entities` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö: —Ç–µ–ø–µ—Ä—å –≤—ã–≤–æ–¥—è—Ç—Å—è –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏, –∏—Ö —Ç–∏–ø—ã –ª–æ–∫–∞–ª–∏–∑—É—é—Ç—Å—è (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ), —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ —Å—Ç–∞–ª –±–æ–ª–µ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –Ω–æ–≤—ã–π –∫–ª—é—á –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ `simulate_conflict:conflict_entity_action_detail_ext_v2`.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 48 (—Å–∏–º—É–ª—è—Ü–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤) (2024-07-25)**:
    - **–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã `src/core/conflict_simulation_system.py`, –∫–æ–º–∞–Ω–¥–∞ `/master_simulate conflict` –≤ `src/bot/commands/master_commands/master_simulation_tools_cog.py` –∏ —Ç–µ—Å—Ç—ã `tests/core/test_conflict_simulation_system.py`.
    - **–í—ã–≤–æ–¥**: –°–∏—Å—Ç–µ–º–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏ –∏–∑ –ª–æ–≥–∞ Task 48 (–æ—Ç 2024-07-24). –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤–∫–ª—é—á–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`, —É–ª—É—á—à–µ–Ω–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä —Ü–µ–ª–µ–π (–≤–∫–ª—é—á–∞—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ `use`), —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞ –ø—Ä–∞–≤–∏–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–æ–π Discord. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∫—Ä—ã—Ç–∞ 50 unit-—Ç–µ—Å—Ç–∞–º–∏.
    - **–°—Ç–∞—Ç—É—Å**: –ü–æ–¥–∑–∞–¥–∞—á–∞ –ø–æ —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ —Ä–∞–º–∫–∞—Ö Task 48 **–∑–∞–≤–µ—Ä—à–µ–Ω–∞**.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ ([–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]) –ø–æ "–î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –≤ –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–µ AI"**:
    - **–¶–µ–ª—å**: –£–≥–ª—É–±–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –±–∞–ª–∞–Ω—Å–∞, –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ª–æ—Ä—É –¥–ª—è AI-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
    - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `src/core/ai_analysis_system.py`**:
        - –ú–æ–¥–µ–ª—å `EntityAnalysisReport` –¥–æ–ø–æ–ª–Ω–µ–Ω–∞ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏: `balance_score_details`, `lore_score_details`, `quality_score_details`.
        - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–∞:
            - `_analyze_item_balance`: –û—Ü–µ–Ω–∏–≤–∞–µ—Ç `base_value` –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–≤–æ–π—Å—Ç–≤, —Ä–µ–¥–∫–æ—Å—Ç–∏) –∏ –≤—ã—è–≤–ª—è–µ—Ç —á—Ä–µ–∑–º–µ—Ä–Ω–æ –º–æ—â–Ω—ã–µ/—Å–ª–∞–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ (—É—Ä–æ–Ω –æ—Ä—É–∂–∏—è, —Å–∏–ª–∞ –∑–µ–ª–∏–π) –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`.
            - `_analyze_npc_balance`: –û—Ü–µ–Ω–∏–≤–∞–µ—Ç HP –∏ —Å—Ç–∞—Ç—ã –∞—Ç–∞–∫–∏ NPC –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —É—Ä–æ–≤–Ω—è, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `RuleConfig`.
            - `_analyze_quest_balance`: –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã (XP, –ø—Ä–µ–¥–º–µ—Ç—ã) –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —à–∞–≥–æ–≤) –∫–≤–µ—Å—Ç–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∏—Ö —É—Ä–æ–≤–Ω—è, –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`.
            - `_analyze_text_content_lore`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö/–Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏ —Å–ª–æ–≤, –Ω–∞—Ä—É—à–∞—é—â–∏—Ö —Å—Ç–∏–ª—å –ª–æ—Ä–∞ (–Ω–∞ –æ—Å–Ω–æ–≤–µ `RuleConfig`).
            - `_analyze_properties_json_structure`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π –≤ `properties_json` –¥–ª—è `Item` –∏ `NPC` (–Ω–∞ –æ—Å–Ω–æ–≤–µ `RuleConfig`).
        - **–£–ª—É—á—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫**:
            - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã i18n –ø–æ–ª–µ–π —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `GuildConfig.supported_languages_json` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —è–∑—ã–∫–æ–≤.
        - **–ù–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞—Ç—á–∞**:
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `static_id` —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–º –≤—ã–∑–æ–≤–µ.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `name_i18n`/`title_i18n` (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —è–∑—ã–∫–∞) —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ –æ–¥–Ω–æ–º –≤—ã–∑–æ–≤–µ.
        - **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –æ—Ü–µ–Ω–æ–∫**: –í–≤–µ–¥–µ–Ω —Ä–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–∏—Ö –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ (`overall_quality_avg`, `overall_lore_avg`) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç—á–µ—Ç–∞.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã Discord `/master_analyze ai_generation` (`src/bot/commands/master_commands/master_simulation_tools_cog.py`)**:
        - –í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ (`balance_score_details`, `lore_score_details`, `quality_score_details`) –∏ –∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
    - **Unit-—Ç–µ—Å—Ç—ã (`tests/core/test_ai_analysis_system.py`)**:
        - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∞–Ω–∞–ª–∏–∑–∞ (`_analyze_item_balance`, `_analyze_npc_balance`, `_analyze_quest_balance`, `_analyze_text_content_lore`, `_analyze_properties_json_structure`).
        - –î–æ–±–∞–≤–ª–µ–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `analyze_generated_content` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–∑–æ–≤–∞ –Ω–æ–≤—ã—Ö –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ i18n, –ø—Ä–æ–≤–µ—Ä–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –±–∞—Ç—á–µ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫.
- **–°—Ç–∞—Ç—É—Å Task 48**: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç. –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω—ã. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∞–ª—å–Ω–µ–π—à–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –≤ `RuleConfig` –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —ç–≤—Ä–∏—Å—Ç–∏–∫ –∞–Ω–∞–ª–∏–∑–∞.

## Task 50: üß† 11.1 Dialogue Generation Module (LLM, Multy-i18n, According to Rules)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Prepare the prompt for the LLM to generate NPC dialogue lines. API `generate_npc_dialogue(guild_id: int, context: dict) -> str`.
- **–ü–ª–∞–Ω**:
    1.  **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é `prepare_dialogue_generation_prompt` –≤ `src/core/ai_prompt_builder.py`**.
        *   –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å `session: AsyncSession`, `guild_id: int` –∏ `context: dict`.
        *   –°–ª–æ–≤–∞—Ä—å `context` –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞.
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä–∏ `prepare_dialogue_generation_prompt`.
        *   –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞.
    2.  **–°–æ–∑–¥–∞—Ç—å API —Ñ—É–Ω–∫—Ü–∏—é `generate_npc_dialogue` –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ `src/core/dialogue_system.py`**.
        *   –§—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å `session: AsyncSession`, `guild_id: int` –∏ `context: dict`.
        *   –í—ã–∑–≤–∞—Ç—å `prepare_dialogue_generation_prompt` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–º–ø—Ç–∞.
        *   –í—ã–∑–≤–∞—Ç—å LLM (–º–æ–∫).
        *   –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç –∏ –≤–µ—Ä–Ω—É—Ç—å —Å—Ç—Ä–æ–∫—É-—Ä–µ–ø–ª–∏–∫—É.
        *   –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç `generate_npc_dialogue` –∏–∑ `src/core/__init__.py`.
    3.  **–û–±–Ω–æ–≤–∏—Ç—å `AGENTS.md`**. (–≠—Ç–æ—Ç —à–∞–≥)
    4.  **–ù–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ Unit-—Ç–µ—Å—Ç—ã**.
    5.  **–ó–∞–≥–ª—É—à–∫–∏ –∏ —Ä–µ–∞–ª—å–Ω—ã–µ CRUD**.
- **–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π**:
    - **–®–∞–≥ 1 –≤—ã–ø–æ–ª–Ω–µ–Ω**: –§—É–Ω–∫—Ü–∏—è `prepare_dialogue_generation_prompt` —Å–æ–∑–¥–∞–Ω–∞ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `src/core/ai_prompt_builder.py`. –û–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (NPC, –∏–≥—Ä–æ–∫, –ø–∞—Ä—Ç–∏—è, –ª–æ–∫–∞—Ü–∏—è, –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –ø–∞–º—è—Ç—å NPC (–∑–∞–≥–ª—É—à–∫–∞), –∫–≤–µ—Å—Ç—ã, WorldState, –ø—Ä–∞–≤–∏–ª–∞ –¥–∏–∞–ª–æ–≥–∞) –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è LLM. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `ai_prompt_builder.py` –±—ã–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞–Ω—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
    - **–®–∞–≥ 2 –≤—ã–ø–æ–ª–Ω–µ–Ω**: API —Ñ—É–Ω–∫—Ü–∏—è `generate_npc_dialogue` —Å–æ–∑–¥–∞–Ω–∞ –≤ –Ω–æ–≤–æ–º —Ñ–∞–π–ª–µ `src/core/dialogue_system.py`. –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `prepare_dialogue_generation_prompt`, –≤—ã–∑—ã–≤–∞–µ—Ç –º–æ–∫ LLM (–ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π –º–æ–∫ –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤) –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç. –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
    - **–®–∞–≥ 3 –≤—ã–ø–æ–ª–Ω–µ–Ω**: `AGENTS.md` –æ–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Task 50 –∏ —Ç–µ–∫—É—â–∏–º –ø–ª–∞–Ω–æ–º.
    - **–®–∞–≥ 4 –≤—ã–ø–æ–ª–Ω–µ–Ω**: –ù–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è `prepare_dialogue_generation_prompt` –≤ `tests/core/test_ai_prompt_builder.py` –∏ –¥–ª—è `generate_npc_dialogue` –≤ `tests/core/test_dialogue_system.py`.
    - **–®–∞–≥ 5 –≤—ã–ø–æ–ª–Ω–µ–Ω**: –í—Å–µ –∑–∞–≥–ª—É—à–∫–∏ CRUD –≤ `ai_prompt_builder.py` (`guild_config_crud`, `generated_npc_crud`, `crud_relationship`, –∫–≤–µ—Å—Ç–æ–≤—ã–µ CRUD, `ability_crud`, `skill_crud`) –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∏–º–ø–æ—Ä—Ç—ã —Ä–µ–∞–ª—å–Ω—ã—Ö CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π.
- **–°—Ç–∞—Ç—É—Å**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω–æ –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º.
- **–ü—Ä–æ–±–ª–µ–º—ã**:
    *   –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ (`pytest tests/`) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ `ModuleNotFoundError` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'discord', 'sqlalchemy', 'pydantic'). –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ.
    *   –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ `pip install -r requirements.txt` (–≤ —Ç–æ–º —á–∏—Å–ª–µ —Å `--force-reinstall`) –Ω–µ —Ä–µ—à–∏–ª–∞ –ø—Ä–æ–±–ª–µ–º—É.
- **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å**:
    *   **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è**, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –∏—Ö –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞.
    *   –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è, **–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã** –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç–∞–º–∏.

## Task 47: üõ†Ô∏è 15.1 Master Command System (–ó–∞–≤–µ—Ä—à–µ–Ω–æ 2024-07-18)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä Discord-–∫–æ–º–∞–Ω–¥ –¥–ª—è –ú–∞—Å—Ç–µ—Ä–∞ –ò–≥—Ä—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–µ–π–º–ø–ª–µ–µ–º –∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ –µ–≥–æ –≥–∏–ª—å–¥–∏–∏. –ö–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å `guild_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–æ–º–∞–Ω–¥—ã. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —è–∑—ã–∫–µ –ú–∞—Å—Ç–µ—Ä–∞. CRUD API –¥–ª—è –í–°–ï–• –º–æ–¥–µ–ª–µ–π –ë–î. API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `RuleConfig`. –ö–æ–º–∞–Ω–¥—ã —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞/–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –í –ö–û–ù–¢–ï–ö–°–¢–ï `guild_id`. API `/master resolve_conflict <id> <outcome>` –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö–æ–¥–æ–≤.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    - **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥**: –ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã –±—ã–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ `master_admin_commands.py` –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ Cog'–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/bot/commands/master_commands/`, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º. –ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ –∫–æ–º–∞–Ω–¥ –ø–æ–ª—É—á–∏–ª–∞ —Å–≤–æ–π –ø—Ä–µ—Ñ–∏–∫—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/master_player`, `/master_item`).
    - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è CRUD-–∫–æ–º–∞–Ω–¥**:
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ CRUD (Create, Read, Update, Delete) –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π, –≤–∫–ª—é—á–∞—è: `Player`, `Party`, `Item`, `RuleConfig`, `Ability`, `PendingConflict`, `Faction`, `GeneratedNpc`, `Location`, `Questline`, `GeneratedQuest`, `QuestStep`, `PlayerQuestProgress`, `InventoryItem`, `Relationship`, `StatusEffectDefinition`, `StoryLog` (—á–∞—Å—Ç–∏—á–Ω–æ), `CraftingRecipe`, `Skill`, `PlayerNpcMemory`, `GlobalNpc`, `MobileGroup`.
        - –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `interaction.guild_id` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
    - **–£—Ç–∏–ª–∏—Ç–∞ `parse_json_parameter`**:
        - –í `src/bot/utils.py` —Å–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `parse_json_parameter` –¥–ª—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JSON-—Å—Ç—Ä–æ–∫, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –≤ –∫–æ–º–∞–Ω–¥—ã.
        - –≠—Ç–∞ —É—Ç–∏–ª–∏—Ç–∞ –±—ã–ª–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤–æ –≤—Å–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä-–∫–æ–≥–∞—Ö –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON-–ø–æ–ª–µ–π.
    - **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è**:
        - `MasterFactionCog`: –£–ª—É—á—à–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∫—Ü–∏–π, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ID –ª–∏–¥–µ—Ä–∞ NPC.
        - `MasterMobileGroupCog`: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏ (`static_id`, `description_i18n_json` –∏ –¥—Ä.).
        - `MasterPlayerCog`: `attributes_json` —Ç–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `parse_json_parameter`.
        - `MasterCombatEncounterCog`: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `combat_encounter_update`.
        - `MasterConflictCog`: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `conflict_delete`.
        - `MasterMemoryCog`: –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã `memory_create` –∏ `memory_update`.
        - `MasterQuestCog`: `progress_update` —Ç–µ–ø–µ—Ä—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å `progress_data_json`.
    - **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**: –û–±–µ—Å–ø–µ—á–µ–Ω–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `get_localized_message_template`.
    - **–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**: –ö–æ–º–∞–Ω–¥–∞ `/master_conflict resolve` —Ç–µ–ø–µ—Ä—å —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç `TurnController` –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö–æ–¥–æ–≤ –¥–ª—è –≥–∏–ª—å–¥–∏–∏, –µ—Å–ª–∏ –≤—Å–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã.
    - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ linting**: –í —Ö–æ–¥–µ —Ä–∞–±–æ—Ç—ã –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ linting (Pylance), —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ `try-except` –±–ª–æ–∫–∞–º–∏ –∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –≤ `inventory_master_commands.py`, `party_master_commands.py` –∏ `quest_master_commands.py`.
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ 47 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –°–∏—Å—Ç–µ–º–∞ –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –∏ —É–ª—É—á—à–µ–Ω–∞.

## –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Master Admin Commands (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞ –æ—Ç 2024-07-16)
- **–¶–µ–ª—å**: –î–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª `src/bot/commands/master_admin_commands.py` –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ Cog'–∏ –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏.
- **–°—Ç—Ä–∞—Ç–µ–≥–∏—è**:
    1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `src/bot/commands/master_commands/` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö Cog'–æ–≤.
    2. –î–ª—è –∫–∞–∂–¥–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ (Player, RuleConfig, Party –∏ —Ç.–¥.), —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –º–∞—Å—Ç–µ—Ä–∞, —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª Cog –≤ –Ω–æ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `player_master_commands.py`).
    3. –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π Cog –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –∫–æ—Ä–Ω–µ–≤—É—é –≥—Ä—É–ø–ø—É –∫–æ–º–∞–Ω–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/master_player`, `/master_ruleconfig`) –≤–º–µ—Å—Ç–æ –æ–±—â–µ–π –≥—Ä—É–ø–ø—ã `/master_admin`. –≠—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∫–æ–º–∞–Ω–¥.
    4. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∫–æ–º–∞–Ω–¥ –∏–∑ `master_admin_commands.py` –≤ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã Cog'–æ–≤.
    5. –û–±–Ω–æ–≤–∏—Ç—å `src/config/settings.py` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö Cog'–æ–≤.
    6. –û—á–∏—Å—Ç–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π `master_admin_commands.py` –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏**:
    - –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `src/bot/commands/master_commands/` –∏ —Ñ–∞–π–ª `__init__.py` –≤ –Ω–µ–π.
    - **Player Commands**:
        - –°–æ–∑–¥–∞–Ω `src/bot/commands/master_commands/player_master_commands.py`.
        - –°–æ–∑–¥–∞–Ω `MasterPlayerCog` —Å –≥—Ä—É–ø–ø–æ–π –∫–æ–º–∞–Ω–¥ `/master_player`.
        - –ö–æ–º–∞–Ω–¥—ã `player view`, `player list`, `player update` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ `master_admin_commands.py`.
    - **RuleConfig Commands**:
        - –°–æ–∑–¥–∞–Ω `src/bot/commands/master_commands/ruleconfig_master_commands.py`.
        - –°–æ–∑–¥–∞–Ω `MasterRuleConfigCog` —Å –≥—Ä—É–ø–ø–æ–π –∫–æ–º–∞–Ω–¥ `/master_ruleconfig`.
        - –ö–æ–º–∞–Ω–¥—ã `ruleconfig get`, `ruleconfig set`, `ruleconfig list`, `ruleconfig delete` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã.
    - **PendingConflict Commands**:
        - –°–æ–∑–¥–∞–Ω `src/bot/commands/master_commands/conflict_master_commands.py`.
        - –°–æ–∑–¥–∞–Ω `MasterConflictCog` —Å –≥—Ä—É–ø–ø–æ–π –∫–æ–º–∞–Ω–¥ `/master_conflict`.
        - –ö–æ–º–∞–Ω–¥—ã `conflict view`, `conflict resolve`, `conflict list` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã.
    - **Party Commands**:
        - –°–æ–∑–¥–∞–Ω `src/bot/commands/master_commands/party_master_commands.py`.
        - –°–æ–∑–¥–∞–Ω `MasterPartyCog` —Å –≥—Ä—É–ø–ø–æ–π –∫–æ–º–∞–Ω–¥ `/master_party`.
        - –ö–æ–º–∞–Ω–¥—ã `party view`, `party list`, `party create`, `party update`, `party delete` –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã.
    - –í `src/config/settings.py` —Å—Ç–∞—Ä–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ `master_admin_commands` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞, –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∫ –Ω–æ–≤—ã–º Cog'–∞–º:
        - `"src.bot.commands.master_commands.player_master_commands"`
        - `"src.bot.commands.master_commands.ruleconfig_master_commands"`
        - `"src.bot.commands.master_commands.conflict_master_commands"`
        - `"src.bot.commands.master_commands.party_master_commands"`
        - `"src.bot.commands.master_commands.npc_master_commands"`
        - `"src.bot.commands.master_commands.location_master_commands"`
        - `"src.bot.commands.master_commands.item_master_commands"`
        - `"src.bot.commands.master_commands.faction_master_commands"`
        - `"src.bot.commands.master_commands.relationship_master_commands"`
        - `"src.bot.commands.master_commands.quest_master_commands"`
        - `"src.bot.commands.master_commands.combat_master_commands"`
        - `"src.bot.commands.master_commands.global_npc_master_commands"`
        - `"src.bot.commands.master_commands.mobile_group_master_commands"`
        - `"src.bot.commands.master_commands.inventory_master_commands"`
        - `"src.bot.commands.master_commands.ability_master_commands"`
        - `"src.bot.commands.master_commands.status_effect_master_commands"`
        - `"src.bot.commands.master_commands.story_log_master_commands"`
    - –§–∞–π–ª `src/bot/commands/master_admin_commands.py` –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –≤—Å—è –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞.
- **–°—Ç–∞—Ç—É—Å**: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–∞–Ω–¥ –ú–∞—Å—Ç–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω. –ö–æ–¥ —Å—Ç–∞–ª –±–æ–ª–µ–µ –º–æ–¥—É–ª—å–Ω—ã–º –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã–º.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ "–î–æ—Ä–∞–±–æ—Ç–∫–∞ Player.attributes_json –¥–ª—è Task 32" (–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞)
- **–ó–∞–¥–∞—á–∞**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–ª–µ `Player.attributes_json` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
    1.  **–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**:
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –º–æ–¥–µ–ª—å `src/models/player.py`: –ø–æ–ª–µ `attributes_json: Mapped[Dict[str, Any]] = mapped_column(JSON, default=lambda: {}, nullable=False)` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω `src/core/crud/crud_player.py`: –º–µ—Ç–æ–¥ `create_with_defaults` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `attributes_json` –∏–∑ `RuleConfig` (–∫–ª—é—á `character_attributes:base_values`).
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω `src/core/experience_system.py`: —Ñ—É–Ω–∫—Ü–∏—è `spend_attribute_points` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `player.attributes_json`.
    2.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**:
        *   –ù–∞–π–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `alembic/versions/e221edc41551_add_attributes_json_to_player.py`.
        *   –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ –ø—Ä–∏–∑–Ω–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º (`op.add_column('players', sa.Column('attributes_json', sa.JSON(), nullable=False, server_default=sa.text("'{}'::jsonb")))`).
    3.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ Unit-—Ç–µ—Å—Ç–æ–≤**:
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –≤ `tests/models/test_player.py`, `tests/core/crud/test_crud_player.py`, `tests/core/test_experience_system.py`, `tests/bot/commands/test_character_commands.py`.
        *   –¢–µ—Å—Ç—ã, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–ª—è `Player.attributes_json`, —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (—Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ CRUD, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ –æ–ø—ã—Ç–∞ –∏ –∫–æ–º–∞–Ω–¥–∞—Ö).
        *   –ó–∞–ø—É—â–µ–Ω—ã —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã —Ç–µ—Å—Ç–æ–≤:
            *   `python -m unittest tests/models/test_player.py` - OK (5 passed)
            *   `python -m unittest tests/core/crud/test_crud_player.py` - OK (9 passed)
            *   `python -m pytest tests/core/test_experience_system.py` - OK (16 passed)
            *   `python -m pytest tests/bot/commands/test_character_commands.py` - OK (7 passed)
        *   –û–±—â–∏–π –∑–∞–ø—É—Å–∫ `pytest tests/` –≤—ã—è–≤–∏–ª 8 –æ—à–∏–±–æ–∫ –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö (`test_global_event.py`, `test_global_npc.py`, `test_mobile_group.py`, `test_quest.py`), –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å `Player.attributes_json`. –≠—Ç–∏ –æ—à–∏–±–∫–∏ —Ç—Ä–µ–±—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è.
- **–°—Ç–∞—Ç—É—Å**: –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ "–î–æ—Ä–∞–±–æ—Ç–∫–∞ Player.attributes_json –¥–ª—è Task 32" –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏.

---
## –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ –¥–∏–∞–ª–æ–≥–æ–≤ (—Å–≤—è–∑–∞–Ω–æ —Å Task 37)**:
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –í —Ä–∞–º–∫–∞—Ö Task 37 –±—ã–ª–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é (–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ü–µ–Ω) –∏ –¥–∏–∞–ª–æ–≥–∏ (—Ç–æ–Ω NPC, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π). –û–¥–Ω–∞–∫–æ, —Ç–∞–∫ –∫–∞–∫ –º–æ–¥—É–ª–∏ `trade_system` –∏ `dialogue_system` –µ—â–µ –Ω–µ –±—ã–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Task 37, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —ç—Ç–æ–π –ª–æ–≥–∏–∫–∏ –±—ã–ª–∞ –æ—Ç–ª–æ–∂–µ–Ω–∞.
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
        1.  **–¢–æ—Ä–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `handle_trade_action` (Task 44), –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–µ–µ –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:trade:price_adjustment`, –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–æ–º –∏ NPC-—Ç–æ—Ä–≥–æ–≤—Ü–µ–º, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è —Ü–µ–Ω—ã –∏ –µ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ.
        2.  **–î–∏–∞–ª–æ–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `generate_npc_dialogue` (Task 50) –∏/–∏–ª–∏ `handle_dialogue_input` (Task 51), –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:dialogue:availability_and_tone`, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `tone_hint` –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –µ–≥–æ –≤ –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `dialogue_option_availability` –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–ø—Ü–∏–π –¥–∏–∞–ª–æ–≥–∞. (–ß–∞—Å—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π –≤ Task 38)
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –í —Ä–∞–º–∫–∞—Ö Task 37 –±—ã–ª–∞ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é (–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ü–µ–Ω) –∏ –¥–∏–∞–ª–æ–≥–∏ (—Ç–æ–Ω NPC, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π).
        - –ß–∞—Å—Ç—å, –∫–∞—Å–∞—é—â–∞—è—Å—è **—Ç–æ—Ä–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã**, –±—ã–ª–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è (–≤ `src/core/trade_system.py::_calculate_item_price` —É–∂–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–æ `relationship_influence:trade:price_adjustment`). Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_trade_system.py` –±—ã–ª–∏ –¥–æ–ø–æ–ª–Ω–µ–Ω—ã –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ —Ü–µ–Ω—ã. **–≠—Ç–∞ —á–∞—Å—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.**
        - –ß–∞—Å—Ç—å, –∫–∞—Å–∞—é—â–∞—è—Å—è **–¥–∏–∞–ª–æ–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã**, –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π.
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–æ—Å—Ç–∞–≤—à–∏–µ—Å—è)**:
        1.  **–î–∏–∞–ª–æ–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `generate_npc_dialogue` (Task 50) –∏/–∏–ª–∏ `handle_dialogue_input` (Task 51), –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:dialogue:availability_and_tone`, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `tone_hint` –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –µ–≥–æ –≤ –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `dialogue_option_availability` –ø–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–ø—Ü–∏–π –¥–∏–∞–ª–æ–≥–∞. (–ß–∞—Å—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π –≤ Task 38)
    - **–°—Ä–æ–∫ (–æ—Å—Ç–∞–≤—à–µ–π—Å—è —á–∞—Å—Ç–∏)**: –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 50/51 (–¥–∏–∞–ª–æ–≥–∏).
      **–°—Ç–∞—Ç—É—Å –Ω–∞ [—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞]**: –ß–∞—Å—Ç—å, –∫–∞—Å–∞—é—â–∞—è—Å—è `tone_hint`, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –ß–∞—Å—Ç—å —Å `dialogue_option_availability` –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É –Ω–∏–∂–µ. –≠—Ç–∞ –æ–±—â–∞—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ —Ç–µ–ø–µ—Ä—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –≤ —á–∞—Å—Ç–∏ `tone_hint`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Pydantic `parse_obj_as`**:
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –í —Ñ–∞–π–ª–µ `src/core/ai_response_parser.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `parse_obj_as`, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –≤ Pydantic V2 –∏ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –≤ V3.0.
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**: –ó–∞–º–µ–Ω–∏—Ç—å `parse_obj_as(GeneratedEntity, entity_data)` –Ω–∞ `TypeAdapter(GeneratedEntity).validate_python(entity_data)`. –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –∏–º–ø–æ—Ä—Ç–∞ `TypeAdapter` –∏–∑ `pydantic`.
    - **–°—Ä–æ–∫**: –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Pydantic.
- **–î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**:
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤ `src/core/conflict_simulation_system.py` –±—ã–ª–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö Task 48 (–¥–æ—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç 2024-07-19 –∏ 2024-07-22) –∏ —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `RuleConfig`. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å `action_processor.py` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –æ–∫–∞–∑–∞–ª–æ—Å—å –Ω–µ —Å–æ–≤—Å–µ–º —Ç–æ—á–Ω—ã–º, —Ç–∞–∫ –∫–∞–∫ `action_processor.py` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∞–∫–æ–π –ª–æ–≥–∏–∫–∏ –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ *–º–µ–∂–¥—É* –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –∏–≥—Ä–æ–∫–æ–≤. –°–∏—Å—Ç–µ–º–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –º–µ—Å—Ç–æ–º –¥–ª—è —ç—Ç–æ–π –ª–æ–≥–∏–∫–∏.
    - **–í–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è**:
        - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∏–ª–∏ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—á–∏—Ç—ã–≤–∞—é—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–æ—Ä–æ–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–µ–π—Å—Ç–≤–∏–π, —É—Å–ª–æ–≤–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è).
        - –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –∏—Ö —Ç–∏–ø–æ–≤.
        - –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —ç–≤—Ä–∏—Å—Ç–∏–∫ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ "—Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏" –∏–ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞, –≤–æ–∑–º–æ–∂–Ω–æ, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `RuleConfig`.
        - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞–±–æ—Ä–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –ø–æ—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö "–∏–∑ –∫–æ—Ä–æ–±–∫–∏".
    - **–°—Ä–æ–∫**: –ü–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏–º—É–ª—è—Ü–∏–∏. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Ä–µ–¥–Ω–∏–π.
- **–î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ –≤ –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–µ AI (—Å–≤—è–∑–∞–Ω–æ —Å Task 48)**:
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –í —Ä–∞–º–∫–∞—Ö Task 48 (–¥–æ—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞]) –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä AI –≤ `src/core/ai_analysis_system.py` –±—ã–ª –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤, NPC –∏ –∫–≤–µ—Å—Ç–æ–≤; –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ–∫—Å—Ç–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ª–æ—Ä—É; —É–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (i18n, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `properties_json`, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ –±–∞—Ç—á–µ). –ö–æ–º–∞–Ω–¥–∞ `/master_analyze ai_generation` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫.
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–¥–∞–ª—å–Ω–µ–π—à–∏–µ)**:
        1.  **–¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª `RuleConfig`**: –î–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ (–±–∞–ª–∞–Ω—Å, –ª–æ—Ä, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏ —Ç—â–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ `RuleConfig`. –¢–µ–∫—É—â–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ª–∏–±–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ª–∏–±–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª.
        2.  **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —ç–≤—Ä–∏—Å—Ç–∏–∫**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ü–µ–Ω–∫–∞ "—á—Ä–µ–∑–º–µ—Ä–Ω–æ—Å—Ç–∏" —Å–≤–æ–π—Å—Ç–≤ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç–∏–ª—é –ª–æ—Ä–∞) –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
        3.  **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Å—É—â–Ω–æ—Å—Ç–µ–π**: –ï—Å–ª–∏ AI –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `GlobalEvent`, `MobileGroup`), –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–±—É—á–∏—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –∏ —Å –Ω–∏–º–∏, –¥–æ–±–∞–≤–∏–≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –Ω–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏.
        4.  **–£–≥–ª—É–±–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫**: –ù–∞–ø—Ä–∏–º–µ—Ä, –∞–Ω–∞–ª–∏–∑ —É—Ä–æ–Ω–∞ –æ—Ä—É–∂–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–¥–µ–ª–∞–Ω –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä—Å–µ—Ä–∞ –¥–∞–π—Å-—Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—É—â–∏—Ö —É–ø—Ä–æ—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.
    - **–°—Ä–æ–∫**: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ, –ø–æ –º–µ—Ä–µ —Ä–∞–∑–≤–∏—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –æ–ø—ã—Ç–∞. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤–∏–ª `RuleConfig`: –≤—ã—Å–æ–∫–∏–π.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `dialogue_option_availability` –≤ —Å–∏—Å—Ç–µ–º–µ –¥–∏–∞–ª–æ–≥–æ–≤ (—Å–≤—è–∑–∞–Ω–æ —Å Task 37, –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π)**:
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ –¥–∏–∞–ª–æ–≥–∏ (Task 37, –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –≤ [—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞]) –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ `tone_hint`. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –∏–≥—Ä–æ–∫–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –µ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å NPC –∏ –¥—Ä—É–≥–∏—Ö —É—Å–ª–æ–≤–∏–π, –∫–∞–∫ —ç—Ç–æ –±—ã–ª–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ –≤ –ø—Ä–∞–≤–∏–ª–µ `relationship_influence:dialogue:availability_and_tone` (—Å–µ–∫—Ü–∏—è `option_availability_rules`).
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–®–∞–≥ 4 –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–ª–∞–Ω–∞)**:
        1.  **–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
            *   –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫ –∏ –≥–¥–µ –≤ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–µ –¥–∏–∞–ª–æ–≥–æ–≤ (–≤–µ—Ä–æ—è—Ç–Ω–æ, –≤ `src/core/dialogue_system.py` –∏/–∏–ª–∏ `src/core/action_processor.py` –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–≤–æ–¥–∞ –∏–≥—Ä–æ–∫–∞) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–±–æ—Ä –∏–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –æ–ø—Ü–∏–π –∏–≥—Ä–æ–∫—É. –°–µ–π—á–∞—Å –æ–ø—Ü–∏–∏, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –Ω–µ —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±—ç–∫–µ–Ω–¥–∞, –∞ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ NLU.
            *   –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º "—Ç–µ–≥–æ–≤ –æ–ø—Ü–∏–π" –∏–ª–∏ –¥—Ä—É–≥—É—é —Å–∏—Å—Ç–µ–º—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π/—Ñ—Ä–∞–∑.
            *   –†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å, –∫–∞–∫ `handle_dialogue_input` –∏–ª–∏ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —ç—Ç–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏—Ö.
        2.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `RuleConfig`**:
            *   –í `handle_dialogue_input` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ `relationship_influence:dialogue:availability_and_tone`.
            *   –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π "—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π" –æ–ø—Ü–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —É—Å–ª–æ–≤–∏—è –∏–∑ `option_availability_rules` —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞:
                *   `required_relationship_type` –∏ `min_value`: –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å —Ç–µ–∫—É—â–∏–º–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏ –∏–≥—Ä–æ–∫–∞ –∏ NPC.
                *   `unlock_condition_formula`: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã. –§–æ—Ä–º—É–ª–∞ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —É –∏–≥—Ä–æ–∫–∞ (–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—é), —Å–æ—Å—Ç–æ—è–Ω–∏–µ NPC, —Ñ–ª–∞–≥–∏ –º–∏—Ä–∞ –∏ —Ç.–¥. –≠—Ç–æ —Å–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å, —Ç—Ä–µ–±—É—é—â–∞—è –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `eval()` –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è —Ñ–æ—Ä–º—É–ª.
        3.  **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π**:
            *   –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ (–¥–æ—Å—Ç—É–ø–Ω—ã–µ) –æ–ø—Ü–∏–∏ –±—É–¥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∏–≥—Ä–æ–∫—É. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ –æ—Ç–≤–µ—Ç–µ NPC ("–£—á–∏—Ç—ã–≤–∞—è –Ω–∞—à–∏ –¥–æ–±—Ä—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —è –º–æ–≥ –±—ã —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ç–µ–±–µ –æ...") –∏–ª–∏, –≤ –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ, –ø–µ—Ä–µ–¥–∞—á–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –æ–ø—Ü–∏–π –∫–ª–∏–µ–Ω—Ç—É (–µ—Å–ª–∏ UI/–∫–ª–∏–µ–Ω—Ç —ç—Ç–æ –±—É–¥–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å).
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–®–∞–≥ 5 –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–ª–∞–Ω–∞ - Unit-—Ç–µ—Å—Ç—ã)**:
        *   –ù–∞–ø–∏—Å–∞—Ç—å Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –≤ `src/core/dialogue_system.py` (–∏–ª–∏ –≥–¥–µ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–ø—Ü–∏–π).
        *   –¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∫—Ä—ã–≤–∞—Ç—å:
            *   –ö–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ `option_availability_rules` –∏–∑ `RuleConfig`.
            *   –†–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–ø—Ü–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
            *   –ü—Ä–æ–≤–µ—Ä–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `unlock_condition_formula` (—Å –º–æ–∫–∞–º–∏ –¥–ª—è –∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–∏—Å—Ç–µ–º, —Ç–∞–∫–∏—Ö –∫–∞–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏—Ä–∞).
            *   –û–±—Ä–∞–±–æ—Ç–∫—É —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª–æ –∏–ª–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
    - **–°—Ä–æ–∫**: –ü–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —á–µ—Ç–∫–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –º–µ—Ö–∞–Ω–∏–∑–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –æ–ø—Ü–∏–π –∏–≥—Ä–æ–∫—É. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Ä–µ–¥–Ω–∏–π/–Ω–∏–∑–∫–∏–π, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫.
- **–ü—Ä–æ–±–ª–µ–º–∞ —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ CRUD –≤ `test_quest_master_commands.py` (–û—Ç–ª–æ–∂–µ–Ω–æ –∏–∑ Task 62)**:
    - **–§–∞–π–ª**: `tests/bot/commands/master_commands/test_quest_master_commands.py`
    - **–¢–µ—Å—Ç—ã**: `test_progress_create_success_player`, `test_progress_create_success_party`.
    - **–û—à–∏–±–∫–∞**: `AttributeError: ... does not have the attribute 'party_crud'` (–∏ –¥–ª—è `player_crud`).
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–æ–º–∞–Ω–¥–∞ `progress_create` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `player_crud` –∏ `party_crud` –ª–æ–∫–∞–ª—å–Ω–æ. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `@patch` –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è —Ç–µ—Å—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —ç—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã.
    - **–í–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–µ—Ö–Ω–∏–∫–∏ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `patch.dict(sys.modules, ...)` –∏–ª–∏ –ø–∞—Ç—á–∏–Ω–≥ —Å–∞–º–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º–æ–≥–æ –º–æ–¥—É–ª—è –¥–æ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è) –∏–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    - **–°—Ä–æ–∫**: –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ —Ç–µ—Å—Ç–æ–≤ –∏–ª–∏ —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–∞–Ω–¥. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Ä–µ–¥–Ω–∏–π.
- **–ü—Ä–æ–±–ª–µ–º–∞ —Å –º–æ–∫–æ–º `get_localized_text` –≤ `tests/bot/commands/test_party_commands.py` (–û—Ç–ª–æ–∂–µ–Ω–æ –∏–∑ Task 62)**:
    - **–§–∞–π–ª**: `tests/bot/commands/test_party_commands.py`
    - **–¢–µ—Å—Ç—ã**: `test_party_join_moves_player_location`, `test_party_join_success_by_name`.
    - **–û—à–∏–±–∫–∞**: `AssertionError: expected call not found.` `ctx.send` –ø–æ–ª—É—á–∞–µ—Ç `<coroutine object ...>` –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∏.
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: `get_localized_text` (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å `await` –≤ –∫–æ–¥–µ –∫–æ–º–∞–Ω–¥—ã. –ú–æ–∫ `side_effect` (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è) –¥–ª—è `get_localized_text` –≤ `setUp` —ç—Ç–∏—Ö —Ç–µ—Å—Ç–æ–≤, –≤–µ—Ä–æ—è—Ç–Ω–æ, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è `AsyncMock`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≤–æ–∑–≤—Ä–∞—Ç—É –∫–æ—Ä—É—Ç–∏–Ω—ã.
    - **–í–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–∫ `get_localized_text` –≤ `test_party_commands.py`, —á—Ç–æ–±—ã –æ–Ω –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–ª —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ —á—Ç–æ–±—ã `await` –Ω–∞ –º–æ–∫–µ –Ω–µ –ø—Ä–∏–≤–æ–¥–∏–ª –∫ –≤–æ–∑–≤—Ä–∞—Ç—É –∫–æ—Ä—É—Ç–∏–Ω—ã. –í–æ–∑–º–æ–∂–Ω–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `MagicMock(return_value=...)` –∏–ª–∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å, —á—Ç–æ–±—ã `side_effect` –Ω–µ –±—ã–ª `async def`.
    - **–°—Ä–æ–∫**: –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ —Ç–µ—Å—Ç–æ–≤ –∫–æ–º–∞–Ω–¥. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Ä–µ–¥–Ω–∏–π.
- **–†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `parsed_entities` –≤ `tests/core/test_action_processor.py` (–û—Ç–ª–æ–∂–µ–Ω–æ –∏–∑ Task 62)**:
    - **–§–∞–π–ª**: `tests/core/test_action_processor.py`
    - **–¢–µ—Å—Ç**: `test_process_player_message_for_nlu_player_in_dialogue`.
    - **–û—à–∏–±–∫–∞**: `AssertionError: expected call not found.` `mock_handle_dialogue_input` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å `parsed_entities` –∫–∞–∫ `List[Dict]`, —Ç–µ—Å—Ç –æ–∂–∏–¥–∞–µ—Ç `List[ActionEntity]`.
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: `dialogue_system.handle_dialogue_input` –æ–∂–∏–¥–∞–µ—Ç `List[Dict[str, Any]]`. `action_processor.process_player_message_for_nlu` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `List[ActionEntity]` –≤ `List[Dict]`. –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å —ç—Ç–æ.
    - **–í–æ–∑–º–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –∞—Å—Å–µ—Ä—Ç—ã –≤ —Ç–µ—Å—Ç–µ, —á—Ç–æ–±—ã –æ–∂–∏–¥–∞—Ç—å `parsed_entities` –≤ –≤–∏–¥–µ `List[Dict[str, Any]]`.
    - **–°—Ä–æ–∫**: –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Ä–µ—Å–º–æ—Ç—Ä–µ —Ç–µ—Å—Ç–æ–≤ `action_processor.py`. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Ä–µ–¥–Ω–∏–π.

---
## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è UI Task 63: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ (GlobalNpc, MobileGroup)

–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã Discord, –∫–æ—Ç–æ—Ä—ã–µ UI –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ API —à–ª—é–∑ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ), –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ NPC –∏ –º–æ–±–∏–ª—å–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏.

**–û–±—â–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**

*   –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ç—Ä–µ–±—É—é—Ç `guild_id`.
*   –î–ª—è –ø–æ–ª–µ–π JSON (–Ω–∞–ø—Ä–∏–º–µ—Ä, `name_i18n_json`, `properties_json`, `members_definition_json`, `route_json`) –∫–æ–º–∞–Ω–¥—ã –æ–∂–∏–¥–∞—é—Ç –≤–∞–ª–∏–¥–Ω—É—é JSON-—Å—Ç—Ä–æ–∫—É. UI –¥–æ–ª–∂–µ–Ω —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã JavaScript –≤ JSON.
*   –û—Ç–≤–µ—Ç—ã –∫–æ–º–∞–Ω–¥ –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —è–∑—ã–∫–µ –ú–∞—Å—Ç–µ—Ä–∞.
*   `GUILD_ID_PLACEHOLDER` –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö –≤—ã–∑–æ–≤–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤ UI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –≥–∏–ª—å–¥–∏–∏.
*   –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –≤—ã–∑–æ–≤–∞ –∫–æ–º–∞–Ω–¥ –≤ `apiClient` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/master_command_endpoint`) —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–π.

---

**1. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ NPC (GlobalNpc)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `GlobalNpc`
*   **–ú–æ–¥–µ–ª—å**: `src/models/global_npc.py`
*   **–ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã**: `/master_global_npc ...` (–∏–∑ `src/bot/commands/master_commands/global_npc_master_commands.py`)
*   **TypeScript**: `src/ui/src/types/globalEntity.ts -> GlobalNpcData, GlobalNpcPayload, GlobalNpcUpdatePayload`
*   **–°–µ—Ä–≤–∏—Å UI**: `src/ui/src/services/globalEntityService.ts`

*   **1.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ GlobalNpc (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_global_npc list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`getGlobalNpcs`) -> –ö–æ–º–∞–Ω–¥–∞**: `page: Optional[int]`, `limit: Optional[int]`
    *   **–û—Ç–≤–µ—Ç**: `PaginatedResponse<GlobalNpcData>`

*   **1.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ GlobalNpc**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_global_npc view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`getGlobalNpc`) -> –ö–æ–º–∞–Ω–¥–∞**: `global_npc_id: int`
    *   **–û—Ç–≤–µ—Ç**: `GlobalNpcData`

*   **1.3. –°–æ–∑–¥–∞—Ç—å GlobalNpc**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_global_npc create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`GlobalNpcPayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `static_id: str`
        *   `name_i18n_json: str` (JSON —Å—Ç—Ä–æ–∫–∞ `Record<string, string>`)
        *   `description_i18n_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞)
        *   `npc_template_id: Optional[int]` (ID –∏–∑ `GeneratedNpc`)
        *   `current_location_id: Optional[int]`
        *   `mobile_group_id: Optional[int]`
        *   `route_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞, –±—É–¥–µ—Ç —á–∞—Å—Ç—å—é `properties_json`)
        *   `properties_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞ `Record<string, any>`)
        *   `ai_metadata_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞) - *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∫–æ–º–∞–Ω–¥–∞ `/master_global_npc create` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `ai_metadata_json`, –Ω–æ –º–æ–¥–µ–ª—å `GlobalNpc` –Ω–µ –∏–º–µ–µ—Ç —ç—Ç–æ–≥–æ –ø–æ–ª—è –Ω–∞–ø—Ä—è–º—É—é, –æ–Ω–æ, –≤–µ—Ä–æ—è—Ç–Ω–æ, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∞—Å—Ç—å—é `properties_json` –∏–ª–∏ `base_npc.ai_metadata_json` –µ—Å–ª–∏ `base_npc_id` —É–∫–∞–∑–∞–Ω. –£—Ç–æ—á–Ω–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.* –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `ai_metadata_json` –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ.
    *   **–û—Ç–≤–µ—Ç**: `GlobalNpcData` (—Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç).

*   **1.4. –û–±–Ω–æ–≤–∏—Ç—å GlobalNpc**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_global_npc update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`updateGlobalNpc` —Å `GlobalNpcUpdatePayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `global_npc_id: int`
        *   `field_to_update: str` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `static_id`, `name_i18n_json`, `current_location_id`, `properties_json`, `route_json` (–∫–æ—Ç–æ—Ä–æ–µ –æ–±–Ω–æ–≤–∏—Ç `properties_json.route`))
        *   `new_value: str` (JSON —Å—Ç—Ä–æ–∫–∞ –¥–ª—è *_json –ø–æ–ª–µ–π, —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤, "None" –¥–ª—è –æ–±–Ω—É–ª–µ–Ω–∏—è)
    *   **–û—Ç–≤–µ—Ç**: `GlobalNpcData` (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç).
        *   *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ*: UI —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–æ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—ã–∑–æ–≤–æ–≤ –∫–æ–º–∞–Ω–¥—ã `update` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—è, –∏–ª–∏ API —à–ª—é–∑ –º–æ–∂–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–π `GlobalNpcUpdatePayload` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã.

*   **1.5. –£–¥–∞–ª–∏—Ç—å GlobalNpc**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_global_npc delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`deleteGlobalNpc`) -> –ö–æ–º–∞–Ω–¥–∞**: `global_npc_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ.

---

**2. –ú–æ–±–∏–ª—å–Ω—ã–µ –ì—Ä—É–ø–ø—ã (MobileGroup)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `MobileGroup`
*   **–ú–æ–¥–µ–ª—å**: `src/models/mobile_group.py`
*   **–ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã**: `/master_mobile_group ...` (–∏–∑ `src/bot/commands/master_commands/mobile_group_master_commands.py`)
*   **TypeScript**: `src/ui/src/types/globalEntity.ts -> MobileGroupData, MobileGroupPayload, MobileGroupUpdatePayload`
*   **–°–µ—Ä–≤–∏—Å UI**: `src/ui/src/services/globalEntityService.ts`

*   **2.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ MobileGroup (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_mobile_group list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`getMobileGroups`) -> –ö–æ–º–∞–Ω–¥–∞**: `page: Optional[int]`, `limit: Optional[int]`
    *   **–û—Ç–≤–µ—Ç**: `PaginatedResponse<MobileGroupData>`

*   **2.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ MobileGroup**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_mobile_group view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`getMobileGroup`) -> –ö–æ–º–∞–Ω–¥–∞**: `group_id: int`
    *   **–û—Ç–≤–µ—Ç**: `MobileGroupData`

*   **2.3. –°–æ–∑–¥–∞—Ç—å MobileGroup**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_mobile_group create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`MobileGroupPayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `static_id: str`
        *   `name_i18n_json: str` (JSON —Å—Ç—Ä–æ–∫–∞ `Record<string, string>`)
        *   `description_i18n_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞)
        *   `current_location_id: Optional[int]`
        *   `leader_global_npc_id: Optional[int]`
        *   `members_definition_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞ `List<Record<string, any>>`, –Ω–∞–ø—Ä–∏–º–µ—Ä `[{"global_npc_static_id": "id1", "role_i18n": {"en":"Guard"}}]`)
        *   `behavior_type_i18n_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞)
        *   `route_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞)
        *   `properties_json: Optional[str]` (JSON —Å—Ç—Ä–æ–∫–∞ `Record<string, any>`)
    *   **–û—Ç–≤–µ—Ç**: `MobileGroupData` (—Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç).

*   **2.4. –û–±–Ω–æ–≤–∏—Ç—å MobileGroup**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_mobile_group update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`updateMobileGroup` —Å `MobileGroupUpdatePayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `group_id: int`
        *   `field_to_update: str` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `static_id`, `name_i18n_json`, `leader_global_npc_id`, `members_definition_json`, `properties_json`)
        *   `new_value: str`
    *   **–û—Ç–≤–µ—Ç**: `MobileGroupData` (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç).

*   **2.5. –£–¥–∞–ª–∏—Ç—å MobileGroup**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_mobile_group delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`deleteMobileGroup`) -> –ö–æ–º–∞–Ω–¥–∞**: `group_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ.

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è UI Task 61: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∫—Ü–∏—è–º–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏

–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã Discord (–∫–æ—Ç–æ—Ä—ã–µ UI –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ API —à–ª—é–∑), –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ—Ä–∞–∫—Ü–∏—è–º–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º–∏.

**–û–±—â–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è:** –°–º. Task 60.

---

**1. –§—Ä–∞–∫—Ü–∏–∏ (GeneratedFaction)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `GeneratedFaction`
*   **–ú–æ–¥–µ–ª—å**: `src/models/generated_faction.py`
*   **TypeScript**: `src/ui/src/types/faction.ts -> Faction, FactionPayload, FactionUpdatePayload`
*   **–°–µ—Ä–≤–∏—Å UI**: `src/ui/src/services/factionService.ts`

*   **1.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ—Ä–∞–∫—Ü–∏–π –≤ –≥–∏–ª—å–¥–∏–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_faction list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**: `page: Optional[int]`, `limit: Optional[int]`
    *   **–û—Ç–≤–µ—Ç**: `PaginatedResponse<Faction>` (–ø–æ–ª—è `items`, `total`, `page`, `limit`).
        *   –û–±—ä–µ–∫—Ç `Faction` –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª—è, –∫–∞–∫ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `Faction`, –≤–∫–ª—é—á–∞—è `leader_npc_details` (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ –∏–ª–∏ UI —Å–¥–µ–ª–∞–µ—Ç –¥–æ–ø. –∑–∞–ø—Ä–æ—Å).

*   **1.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—Ä–∞–∫—Ü–∏–∏**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_faction view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**: `faction_id: int`
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `Faction`.

*   **1.3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ñ—Ä–∞–∫—Ü–∏—é**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_faction create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`FactionPayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `static_id: str`
        *   `name_i18n_json: str` (JSON —Å—Ç—Ä–æ–∫–∞ `Record<string, string>`)
        *   `description_i18n_json: Optional[str]`
        *   `ideology_i18n_json: Optional[str]`
        *   `leader_npc_static_id: Optional[str]`
        *   `resources_json: Optional[str]`
        *   `ai_metadata_json: Optional[str]`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `Faction`.

*   **1.4. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–∞–∫—Ü–∏—é**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_faction update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`factionId: number`, `payload: FactionUpdatePayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `faction_id: int`
        *   `field_to_update: str` (–∏–∑ `FactionUpdatePayload.field_to_update`)
        *   `new_value: str` (JSON —Å—Ç—Ä–æ–∫–∞ –¥–ª—è *_json –ø–æ–ª–µ–π, –∏–ª–∏ —Å—Ç—Ä–æ–∫–∞ –¥–ª—è `static_id`, `leader_npc_static_id`)
    *   **–û—Ç–≤–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `Faction`.

*   **1.5. –£–¥–∞–ª–∏—Ç—å —Ñ—Ä–∞–∫—Ü–∏—é**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_faction delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**: `faction_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ.

---

**2. –û—Ç–Ω–æ—à–µ–Ω–∏—è (Relationship)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `Relationship`
*   **–ú–æ–¥–µ–ª—å**: `src/models/relationship.py`
*   **TypeScript**: `src/ui/src/types/relationship.ts -> RelationshipData, RelationshipPayload, RelationshipUpdatePayload`
*   **–°–µ—Ä–≤–∏—Å UI**: `src/ui/src/services/relationshipService.ts`

*   **2.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –≤ –≥–∏–ª—å–¥–∏–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_relationship list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `entity1_id: Optional[int]`
        *   `entity1_type: Optional[str]` (—Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `RelationshipEntityType`)
        *   `entity2_id: Optional[int]`
        *   `entity2_type: Optional[str]`
        *   `relationship_type_filter: Optional[str]`
        *   `page: Optional[int]`
        *   `limit: Optional[int]`
    *   **–û—Ç–≤–µ—Ç**: `PaginatedResponse<RelationshipData>`.
        *   –û–±—ä–µ–∫—Ç `RelationshipData` –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª—è, –∫–∞–∫ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ, –≤–∫–ª—é—á–∞—è `entity1_details` –∏ `entity2_details` (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ).

*   **2.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_relationship view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**: `relationship_id: int`
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `RelationshipData`.

*   **2.3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_relationship create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`RelationshipPayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `entity1_id: int`
        *   `entity1_type: str`
        *   `entity2_id: int`
        *   `entity2_type: str`
        *   `relationship_type: str`
        *   `value: int`
        *   `source_log_id: Optional[int]`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `RelationshipData`.

*   **2.4. –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_relationship update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`relationshipId: number`, `payload: RelationshipUpdatePayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `relationship_id: int`
        *   `field_to_update: str` (–∏–∑ `RelationshipUpdatePayload.field_to_update`, —Ç.–µ. "relationship_type" –∏–ª–∏ "value")
        *   `new_value: str` (—Å—Ç—Ä–æ–∫–∞ –¥–ª—è `relationship_type`, —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∞ –¥–ª—è `value`)
    *   **–û—Ç–≤–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `RelationshipData`.

*   **2.5. –£–¥–∞–ª–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–µ**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_relationship delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**: `relationship_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ.

---
## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è UI Task 62: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–∞–º–∏

–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã Discord (–∫–æ—Ç–æ—Ä—ã–µ UI –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ API —à–ª—é–∑), –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞–º–∏, —Ü–µ–ø–æ—á–∫–∞–º–∏ –∫–≤–µ—Å—Ç–æ–≤, —à–∞–≥–∞–º–∏ –∫–≤–µ—Å—Ç–æ–≤ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

**–û–±—â–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**

*   –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ç—Ä–µ–±—É—é—Ç `guild_id`, –∫–æ—Ç–æ—Ä—ã–π UI –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å (–æ–±—ã—á–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ UI).
*   –î–ª—è –ø–æ–ª–µ–π JSON (–Ω–∞–ø—Ä–∏–º–µ—Ä, `title_i18n_json`, `properties_json`) –∫–æ–º–∞–Ω–¥—ã –æ–∂–∏–¥–∞—é—Ç –≤–∞–ª–∏–¥–Ω—É—é JSON-—Å—Ç—Ä–æ–∫—É. UI –¥–æ–ª–∂–µ–Ω —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã JavaScript –≤ JSON –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.
*   –û—Ç–≤–µ—Ç—ã –∫–æ–º–∞–Ω–¥ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö) –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —è–∑—ã–∫–µ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (–ú–∞—Å—Ç–µ—Ä–∞). UI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.
*   `GUILD_ID_PLACEHOLDER` –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö –≤—ã–∑–æ–≤–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤ UI –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID –≥–∏–ª—å–¥–∏–∏.
*   –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ –≤—ã–∑–æ–≤–∞ –∫–æ–º–∞–Ω–¥ –≤ `apiClient` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/master_command_endpoint`) —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–π –∏ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ API —à–ª—é–∑–∞ –º–µ–∂–¥—É UI –∏ Discord-–±–æ—Ç–æ–º.
*   –í—Å–µ `_i18n` –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `title_i18n`) –Ω–∞ –±—ç–∫–µ–Ω–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ JSON-–æ–±—ä–µ–∫—Ç—ã –≤–∏–¥–∞ `{"en": "English Text", "ru": "–†—É—Å—Å–∫–∏–π –¢–µ–∫—Å—Ç"}`. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ API –æ–∂–∏–¥–∞–µ—Ç—Å—è JSON-—Å—Ç—Ä–æ–∫–∞ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.
*   –î–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `created_at`, `updated_at`, `accepted_at`, `completed_at`) –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –Ω–∞ UI.

---

**1. –¶–µ–ø–æ—á–∫–∏ –∫–≤–µ—Å—Ç–æ–≤ (Questline)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `Questline`
*   **–ú–æ–¥–µ–ª—å**: `src/models/quest.py::Questline`
*   **–ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã**: `/master_quest questline_*`
*   **TypeScript (–æ–∂–∏–¥–∞–µ–º—ã–π)**: `src/ui/src/types/quest.ts -> QuestlineData, QuestlinePayload`

*   **1.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ü–µ–ø–æ—á–µ–∫ –∫–≤–µ—Å—Ç–æ–≤ –≤ –≥–∏–ª—å–¥–∏–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest questline_list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `page: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
        *   `limit: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10, –º–∞–∫—Å–∏–º—É–º 10)
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–ø–∏—Å–æ–∫ `QuestlineData` –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (—Å–º. `PaginatedResponse<QuestlineData>`).
        *   –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–π JSON –æ—Ç API —à–ª—é–∑–∞):
            ```json
            {
              "items": [
                {
                  "id": 1, "guild_id": "123...", "static_id": "main_story_arc_1",
                  "title_i18n": {"en": "The Ancient Evil", "ru": "–î—Ä–µ–≤–Ω–µ–µ –ó–ª–æ"},
                  "description_i18n": {"en": "First part of the main story.", "ru": "–ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å –≥–ª–∞–≤–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏."},
                  "starting_quest_static_id": "intro_quest",
                  "is_main_storyline": true,
                  "required_previous_questline_static_id": null,
                  "properties_json": {"color_theme": "dark_red"},
                  "created_at": "2024-07-28T10:00:00Z", "updated_at": "2024-07-28T10:00:00Z"
                }
              ],
              "total": 1, "page": 1, "limit": 10, "total_pages": 1
            }
            ```

*   **1.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ –∫–≤–µ—Å—Ç–æ–≤**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest questline_view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `questline_id: int`
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `QuestlineData`.

*   **1.3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ü–µ–ø–æ—á–∫—É –∫–≤–µ—Å—Ç–æ–≤**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest questline_create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`QuestlinePayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `static_id: str` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≥–∏–ª—å–¥–∏–∏)
        *   `title_i18n_json: str` (JSON-—Å—Ç—Ä–æ–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, `{"en": "New Story", "ru": "–ù–æ–≤–∞—è –ò—Å—Ç–æ—Ä–∏—è"}`)
        *   `description_i18n_json: Optional[str]`
        *   `starting_quest_static_id: Optional[str]`
        *   `is_main_storyline: bool` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)
        *   `prev_questline_id: Optional[str]` (static_id –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ü–µ–ø–æ—á–∫–∏)
        *   `properties_json: Optional[str]`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `QuestlineData`.

*   **1.4. –û–±–Ω–æ–≤–∏—Ç—å —Ü–µ–ø–æ—á–∫—É –∫–≤–µ—Å—Ç–æ–≤**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest questline_update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `questline_id: int`
        *   `field_to_update: str` (–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–æ–ª—è: `static_id`, `title_i18n_json`, `description_i18n_json`, `starting_quest_static_id`, `is_main_storyline`, `required_previous_questline_static_id`, `properties_json`)
        *   `new_value: str` (JSON-—Å—Ç—Ä–æ–∫–∞ –¥–ª—è `_json` –ø–æ–ª–µ–π; `True/False` –¥–ª—è boolean; `None` —Å—Ç—Ä–æ–∫–æ–π –¥–ª—è –æ–±–Ω—É–ª–µ–Ω–∏—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π)
    *   **–û—Ç–≤–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `QuestlineData` (–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ).

*   **1.5. –£–¥–∞–ª–∏—Ç—å —Ü–µ–ø–æ—á–∫—É –∫–≤–µ—Å—Ç–æ–≤**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest questline_delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `questline_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º—ã–µ –∫–≤–µ—Å—Ç—ã).

---

**2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –ö–≤–µ—Å—Ç—ã (GeneratedQuest)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `GeneratedQuest`
*   **–ú–æ–¥–µ–ª—å**: `src/models/quest.py::GeneratedQuest`
*   **–ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã**: `/master_quest generated_quest_*`
*   **TypeScript (–æ–∂–∏–¥–∞–µ–º—ã–π)**: `src/ui/src/types/quest.ts -> GeneratedQuestData, GeneratedQuestPayload`

*   **2.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–≤–µ—Å—Ç–æ–≤ –≤ –≥–∏–ª—å–¥–∏–∏ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ Questline)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest generated_quest_list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `questline_id: Optional[int]`
        *   `page: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
        *   `limit: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10, –º–∞–∫—Å–∏–º—É–º 10)
    *   **–û—Ç–≤–µ—Ç**: `PaginatedResponse<GeneratedQuestData>`.
        *   –ü—Ä–∏–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ `GeneratedQuestData`:
            ```json
            {
              "id": 101, "guild_id": "123...", "static_id": "intro_quest",
              "title_i18n": {"en": "Goblin Menace", "ru": "–£–≥—Ä–æ–∑–∞ –ì–æ–±–ª–∏–Ω–æ–≤"},
              "description_i18n": {"en": "...", "ru": "..."},
              "questline_id": 1,
              "giver_entity_type": "NPC", "giver_entity_id": 5,
              "min_level": 1, "is_repeatable": false,
              "rewards_json": {"xp": 100, "gold": 50},
              "properties_json": {"quest_type": "SLAY", "difficulty": "easy"},
              "ai_metadata_json": {"prompt_version": "v1.2"},
              "created_at": "2024-07-28T10:00:00Z", "updated_at": "2024-07-28T10:00:00Z"
            }
            ```

*   **2.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest generated_quest_view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_id: int`
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `GeneratedQuestData`. UI –º–æ–∂–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —à–∞–≥–∏ –∫–≤–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ `/master_quest quest_step_list --quest_id <id>`.

*   **2.3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–≤–µ—Å—Ç**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest generated_quest_create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`GeneratedQuestPayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `static_id: str`
        *   `title_i18n_json: str`
        *   `description_i18n_json: Optional[str]`
        *   `quest_type: Optional[str]` (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `properties_json.quest_type`)
        *   `questline_id: Optional[int]`
        *   `is_repeatable: bool` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`)
        *   `properties_json: Optional[str]`
        *   `rewards_json: Optional[str]`
        *   (–ü–æ–ª—è `giver_entity_type`, `giver_entity_id`, `min_level`, `ai_metadata_json` –Ω–µ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–æ–π, –∞ –∑–∞–¥–∞—é—Ç—Å—è –¥—Ä—É–≥–∏–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –∏–ª–∏ —á–µ—Ä–µ–∑ `properties_json` –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ).
    *   **–û—Ç–≤–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `GeneratedQuestData`.

*   **2.4. –û–±–Ω–æ–≤–∏—Ç—å –∫–≤–µ—Å—Ç**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest generated_quest_update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_id: int`
        *   `field_to_update: str` (–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–æ–ª—è: `static_id`, `title_i18n_json`, `description_i18n_json`, `quest_type` (–æ–±–Ω–æ–≤–ª—è–µ—Ç `properties_json.quest_type`), `questline_id`, `is_repeatable`, `properties_json`, `rewards_json`)
        *   `new_value: str`
    *   **–û—Ç–≤–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `GeneratedQuestData`.

*   **2.5. –£–¥–∞–ª–∏—Ç—å –∫–≤–µ—Å—Ç**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest generated_quest_delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ. –£–¥–∞–ª—è–µ—Ç —Ç–∞–∫–∂–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ `QuestStep` –∏ `PlayerQuestProgress`.

---

**3. –®–∞–≥–∏ –∫–≤–µ—Å—Ç–∞ (QuestStep)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `QuestStep`
*   **–ú–æ–¥–µ–ª—å**: `src/models/quest.py::QuestStep`
*   **–ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã**: `/master_quest quest_step_*`
*   **TypeScript (–æ–∂–∏–¥–∞–µ–º—ã–π)**: `src/ui/src/types/quest.ts -> QuestStepData, QuestStepPayload`

*   **3.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest quest_step_list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_id: int` (ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ `GeneratedQuest`)
        *   `page: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
        *   `limit: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10, –º–∞–∫—Å–∏–º—É–º 10)
    *   **–û—Ç–≤–µ—Ç**: `PaginatedResponse<QuestStepData>`.
        *   –ü—Ä–∏–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ `QuestStepData`:
            ```json
            {
              "id": 201, "quest_id": 101, "step_order": 1,
              "title_i18n": {"en": "Slay 5 Goblins", "ru": "–£–±–∏—Ç—å 5 –≥–æ–±–ª–∏–Ω–æ–≤"},
              "description_i18n": {"en": "...", "ru": "..."},
              "required_mechanics_json": {"type": "SLAY_TARGETS", "details_subset": {"target_static_id": "goblin_grunt", "count": 5}},
              "abstract_goal_json": {"summary_i18n": {"en": "Clear the goblin camp", "ru": "–ó–∞—á–∏—Å—Ç–∏—Ç—å –ª–∞–≥–µ—Ä—å –≥–æ–±–ª–∏–Ω–æ–≤"}},
              "consequences_json": {"on_complete": [{"type": "ADVANCE_QUEST"}]},
              "next_step_order": 2,
              "properties_json": {},
              "created_at": "2024-07-28T10:00:00Z", "updated_at": "2024-07-28T10:00:00Z"
            }
            ```

*   **3.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —à–∞–≥–∞ –∫–≤–µ—Å—Ç–∞**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest quest_step_view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_step_id: int`
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `QuestStepData`.

*   **3.3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —à–∞–≥ –∫–≤–µ—Å—Ç–∞**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest quest_step_create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`QuestStepPayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_id: int` (ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ `GeneratedQuest`)
        *   `step_order: int`
        *   `title_i18n_json: str`
        *   `description_i18n_json: str`
        *   `required_mechanics_json: Optional[str]`
        *   `abstract_goal_json: Optional[str]`
        *   `consequences_json: Optional[str]`
        *   `next_step_order: Optional[int]`
        *   `properties_json: Optional[str]`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `QuestStepData`.

*   **3.4. –û–±–Ω–æ–≤–∏—Ç—å —à–∞–≥ –∫–≤–µ—Å—Ç–∞**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest quest_step_update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_step_id: int`
        *   `field_to_update: str` (–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–æ–ª—è: `step_order`, `title_i18n_json`, `description_i18n_json`, `required_mechanics_json`, `abstract_goal_json`, `consequences_json`, `next_step_order`, `properties_json`)
        *   `new_value: str`
    *   **–û—Ç–≤–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `QuestStepData`.

*   **3.5. –£–¥–∞–ª–∏—Ç—å —à–∞–≥ –∫–≤–µ—Å—Ç–∞**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest quest_step_delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_step_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏–ª–∏ –æ—à–∏–±–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —à–∞–≥ —è–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–º –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–µ).

---

**4. –ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–≤–µ—Å—Ç–æ–≤ (PlayerQuestProgress)**

*   **–°—É—â–Ω–æ—Å—Ç—å**: `PlayerQuestProgress`
*   **–ú–æ–¥–µ–ª—å**: `src/models/quest.py::PlayerQuestProgress`
*   **–ú–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥—ã**: `/master_quest progress_*`
*   **TypeScript (–æ–∂–∏–¥–∞–µ–º—ã–π)**: `src/ui/src/types/quest.ts -> PlayerQuestProgressData, PlayerQuestProgressPayload` (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è)

*   **4.1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –∫–≤–µ—Å—Ç–æ–≤ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest progress_list`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `player_id: Optional[int]`
        *   `party_id: Optional[int]`
        *   `quest_id: Optional[int]`
        *   `status: Optional[str]` (–∏–º—è –∏–∑ `QuestStatus` enum, –Ω–∞–ø—Ä–∏–º–µ—Ä, "IN_PROGRESS")
        *   `page: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
        *   `limit: Optional[int]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5, –º–∞–∫—Å–∏–º—É–º 5)
    *   **–û—Ç–≤–µ—Ç**: `PaginatedResponse<PlayerQuestProgressData>`.
        *   –ü—Ä–∏–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ `PlayerQuestProgressData`:
            ```json
            {
              "id": 301, "guild_id": "123...",
              "player_id": 7, "party_id": null,
              "quest_id": 101, "current_step_id": 201,
              "status": "IN_PROGRESS",
              "progress_data_json": {"goblins_slain": 2},
              "accepted_at": "2024-07-28T11:00:00Z", "completed_at": null,
              "created_at": "2024-07-28T11:00:00Z", "updated_at": "2024-07-28T11:05:00Z"
            }
            ```

*   **4.2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest progress_view`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `progress_id: int`
    *   **–û—Ç–≤–µ—Ç**: –û–±—ä–µ–∫—Ç `PlayerQuestProgressData`.

*   **4.3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –∫–≤–µ—Å—Ç–∞ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest progress_create`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI (`PlayerQuestProgressPayload`) -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `quest_id: int`
        *   `player_id: Optional[int]`
        *   `party_id: Optional[int]` (–æ–¥–Ω–æ –∏–∑ `player_id` –∏–ª–∏ `party_id` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–æ)
        *   `status: Optional[str]` (–∏–º—è –∏–∑ `QuestStatus` enum, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "NOT_STARTED")
        *   `current_step_id: Optional[int]` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ID —à–∞–≥–∞, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ `quest_id`)
        *   `progress_data_json: Optional[str]`
        *   `accepted_at_iso: Optional[str]` (—Å—Ç—Ä–æ–∫–∞ –¥–∞—Ç—ã-–≤—Ä–µ–º–µ–Ω–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601)
    *   **–û—Ç–≤–µ—Ç**: –°–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `PlayerQuestProgressData`.

*   **4.4. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest progress_update`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `progress_id: int`
        *   `field_to_update: str` (–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–æ–ª—è: `status`, `current_step_id`, `progress_data_json`)
        *   `new_value: str` (–∏–º—è Enum –¥–ª—è `status`, ID –¥–ª—è `current_step_id`, JSON-—Å—Ç—Ä–æ–∫–∞ –¥–ª—è `progress_data_json`, "None" –¥–ª—è –æ–±–Ω—É–ª–µ–Ω–∏—è `current_step_id` –∏–ª–∏ `progress_data_json`)
    *   **–û—Ç–≤–µ—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç `PlayerQuestProgressData`.

*   **4.5. –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ**
    *   **–ö–æ–º–∞–Ω–¥–∞ Discord**: `/master_quest progress_delete`
    *   **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã UI -> –ö–æ–º–∞–Ω–¥–∞**:
        *   `progress_id: int`
    *   **–û—Ç–≤–µ—Ç**: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ.

---

### –°—Ç—Ä—É–∫—Ç—É—Ä—ã `RuleConfig` –¥–ª—è –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –°–∏—Å—Ç–µ–º—ã (Task 42)

1.  **–ë–∞–∑–æ–≤—ã–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º/—Ç–∏–ø–∞–º (`economy:base_item_values`)**
    *   **–ö–ª—é—á**: `economy:base_item_values:<item_category_or_type_key>` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `economy:base_item_values:weapon_sword_common`, `economy:base_item_values:potion_healing_minor`)
    *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∞–∑–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–µ–¥–º–µ—Ç–∞. –≠—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, –µ—Å–ª–∏ —É —Å–∞–º–æ–≥–æ `Item.base_value` –Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è, –∏–ª–∏ –∫–∞–∫ –æ—Å–Ω–æ–≤–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤.
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**:
        ```json
        {
          "value": 100,
          "currency": "gold"
        }
        ```

2.  **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ü–µ–Ω –ø—Ä–∏ —Ç–æ—Ä–≥–æ–≤–ª–µ (`economy:price_modifiers`)**
    *   **–ö–ª—é—á**: `economy:price_modifiers:<modifier_type>` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `economy:price_modifiers:trade_skill`, `economy:price_modifiers:faction_relationship`, `economy:price_modifiers:location_tax`)
    *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è—é—Ç –Ω–∞ –∫–æ–Ω–µ—á–Ω—É—é —Ü–µ–Ω—É –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏.
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json` (–ø—Ä–∏–º–µ—Ä –¥–ª—è `trade_skill`)**:
        ```json
        {
          "description": "Price modifier based on player's trade skill level.",
          "buy_price_multiplier_formula": "1.5 - (skill_level * 0.02)",
          "sell_price_multiplier_formula": "0.5 + (skill_level * 0.02)",
          "min_buy_multiplier": 1.1,
          "max_sell_multiplier": 0.9
        }
        ```
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json` (–ø—Ä–∏–º–µ—Ä –¥–ª—è `faction_relationship`)**:
        ```json
        {
          "description": "Price modifier based on relationship with trader's faction.",
          "tiers": [
            {"relationship_above": 75, "buy_multiplier_mod": -0.15, "sell_multiplier_mod": 0.15},
            {"relationship_above": 25, "buy_multiplier_mod": -0.05, "sell_multiplier_mod": 0.05},
            {"relationship_above": -25, "buy_multiplier_mod": 0, "sell_multiplier_mod": 0},
            {"relationship_above": -75, "buy_multiplier_mod": 0.10, "sell_multiplier_mod": -0.10},
            {"relationship_default": true, "buy_multiplier_mod": 0.20, "sell_multiplier_mod": -0.20}
          ]
        }
        ```

3.  **–®–∞–±–ª–æ–Ω—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –¥–ª—è NPC-—Ç–æ—Ä–≥–æ–≤—Ü–µ–≤ (`economy:npc_inventory_templates`)**
    *   **–ö–ª—é—á**: `economy:npc_inventory_templates:<npc_role_or_type_key>` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `economy:npc_inventory_templates:general_store_owner`)
    *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É NPC-—Ç–æ—Ä–≥–æ–≤—Ü–∞.
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**:
        ```json
        {
          "description": "Inventory template for a general store owner.",
          "restock_interval_hours": 24,
          "item_groups": [
            {
              "group_name": "potions_basic",
              "items": [
                {"item_static_id": "potion_healing_minor", "quantity_min": 2, "quantity_max": 5, "chance_to_appear": 0.9},
                {"item_static_id": "potion_mana_minor", "quantity_min": 1, "quantity_max": 3, "chance_to_appear": 0.7}
              ]
            },
            {
              "group_name": "weapons_common",
              "items": [
                {"item_static_id": "sword_short_common", "quantity_min": 1, "quantity_max": 1, "chance_to_appear": 0.5}
              ],
              "max_items_from_group": 1
            }
          ]
        }
        ```

4.  **–ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º/–ª–æ–∫–∞—Ü–∏—è–º (`economy:regional_item_availability`)**
    *   **–ö–ª—é—á**: `economy:regional_item_availability:<location_static_id_or_tag>`
    *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –ª–æ–∫–∞—Ü–∏—è—Ö.
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**:
        ```json
        {
          "description": "Item availability for 'Oakwood'.",
          "available_categories": ["food_basic", "tools_simple"],
          "restricted_item_static_ids": ["magic_scroll_powerful"],
          "rarity_modifier": {
            "category_weapons_rare": 0.1,
            "item_potion_super_healing": 0.01
          }
        }
        ```
---

## –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π

## Task 44: üí∞ 10.3 Trade System (Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Managing a trade session. API `handle_trade_action`. Prices calculated dynamically according to rules, considering relationships. Transactional item/gold transfer. Logging, feedback, relationship changes.
- **–ü–ª–∞–Ω**:
    1.  **–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞**:
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–æ–¥–µ–ª–∏ (`Item`, `InventoryItem`, `Player`, `GeneratedNpc`, `RuleConfig`, `Relationship`, `EventType`).
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (`item_crud`, `inventory_item_crud`, `player_crud`, `npc_crud`, `crud_relationship`).
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–æ–¥—É–ª–∏ (`core.rules`, `core.relationship_system`, `core.game_events`, `core.report_formatter`, `core.localization_utils`).
        *   –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `EventType` (`TRADE_ITEM_BOUGHT`, `TRADE_ITEM_SOLD`, `TRADE_INITIATED`) –ø—Ä–∏–∑–Ω–∞–Ω—ã –ø–æ–¥—Ö–æ–¥—è—â–∏–º–∏.
    2.  **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è `trade_system.py`**:
        *   –§–∞–π–ª `src/core/trade_system.py` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –∏ —Å–æ–¥–µ—Ä–∂–∞–ª –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—É—é —á–∞—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
        *   API —Ñ—É–Ω–∫—Ü–∏—è `async def handle_trade_action(...)` –∏ Pydantic-–º–æ–¥–µ–ª—å `TradeActionResult` —É–∂–µ –±—ã–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ —Ñ–∞–π–ª–µ.
        *   –≠–∫—Å–ø–æ—Ä—Ç `handle_trade_action` –∏ `TradeActionResult` –∏–∑ `src/core/__init__.py` —É–∂–µ –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω.
    3.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `handle_trade_action` - –æ–±—â–∞—è —á–∞—Å—Ç—å –∏ "view_inventory"**:
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–∞/NPC, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç—Ä–µ–π–¥–µ—Ä–∞.
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è `action_type == "view_inventory"`: –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–π, —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω —á–µ—Ä–µ–∑ `_calculate_item_price`, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `TradeActionResult`, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è `TRADE_INITIATED`.
    4.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `handle_trade_action` - —Ä–∞—Å—á–µ—Ç —Ü–µ–Ω**:
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_calculate_item_price`. –ü—Ä–∏–∑–Ω–∞–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (–±–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞–≤—ã–∫–æ–≤ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `RuleConfig`).
    5.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `handle_trade_action` - –ª–æ–≥–∏–∫–∞ "buy"**:
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ø–æ–∏—Å–∫ –ø—Ä–µ–¥–º–µ—Ç–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ –∑–æ–ª–æ—Ç–∞, –≤—ã–∑–æ–≤ `_calculate_item_price`, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–æ–ª–æ—Ç–∞, –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ `inventory_item_crud`), –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `TRADE_ITEM_BOUGHT`, –≤—ã–∑–æ–≤ `update_relationship`. –í–Ω–µ—Å–µ–Ω—ã –º–µ–ª–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π.
    6.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `handle_trade_action` - –ª–æ–≥–∏–∫–∞ "sell"**:
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ø–æ–∏—Å–∫ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –∏–≥—Ä–æ–∫–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –≤—ã–∑–æ–≤ `_calculate_item_price`, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `TRADE_ITEM_SOLD`, –≤—ã–∑–æ–≤ `update_relationship`. –í–Ω–µ—Å–µ–Ω—ã –º–µ–ª–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏.
    7.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π**:
        *   –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –≤—ã–∑–æ–≤—ã `relationship_system.update_relationship` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –ª–æ–≥–∏–∫—É "buy" –∏ "sell".
    8.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**:
        *   –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `TradeActionResult` —Å `success`, `message_key` –∏ `message_params` –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
    9.  **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `action_processor.py`**:
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `src/core/action_processor.py`. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –∏–Ω—Ç–µ–Ω—Ç—ã `trade_view_inventory`, `trade_buy_item`, `trade_sell_item` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±–µ—Ä—Ç–∫–∏ (`_handle_trade_*_action_wrapper`), –≤—ã–∑—ã–≤–∞—é—â–∏–µ `handle_trade_action`, —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    10. **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
        *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª `tests/core/test_trade_system.py`. –ü—Ä–∏–∑–Ω–∞–Ω —Å–æ–¥–µ—Ä–∂–∞—â–∏–º –æ–±—à–∏—Ä–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏—Ö `_calculate_item_price` –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ `handle_trade_action`.
    11. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**:
        *   –≠—Ç–æ—Ç –ª–æ–≥ –¥–æ–±–∞–≤–ª–µ–Ω. "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.
    12. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: (–ë—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ)
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —à–∞–≥–æ–≤ –≤–∫–ª—é—á–∞–ª–æ –∞–Ω–∞–ª–∏–∑ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –≤ `src/core/trade_system.py` –∏ `tests/core/test_trade_system.py`.
    - –í–Ω–µ—Å–µ–Ω—ã –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –≤ `src/core/trade_system.py` –¥–ª—è `view_inventory`, `buy`, `sell` (—É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π, —É—Ç–æ—á–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏).
    - –§–∞–π–ª `src/core/__init__.py` —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.
    - –§–∞–π–ª `tests/core/test_trade_system.py` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã.
- **–°—Ç–∞—Ç—É—Å**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Task 44 –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ú–æ–¥—É–ª—å `trade_system` —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏.

## Task 39: üìö 9.1 Quest and Step Structure (Guild-Scoped, i18n)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: GeneratedQuest, Questline, QuestStep models. MUST INCLUDE guild_id. Link to player OR party in this guild. Step structure with required_mechanics_json, abstract_goal_json, consequences_json. _i18n text fields.
- **–ü–ª–∞–Ω**:
    1.  –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π Task 39.
    2.  –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π –∫–≤–µ—Å—Ç–æ–≤ –≤ `src/models/quest.py`.
    3.  –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–µ–ª–µ–π `Questline`, `GeneratedQuest`, `QuestStep`, `PlayerQuestProgress` –≤ `src/models/quest.py`: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª–µ–π (–≤–∫–ª—é—á–∞—è `party_id` –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ `accepted_at`/`completed_at` –¥–ª—è `PlayerQuestProgress`), –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ `TimestampMixin`, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–º–µ–Ω –ø–æ–ª–µ–π `_i18n`.
    4.  –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î.
    5.  –°–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π –≤ `src/core/crud/crud_quest.py` (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è `party_id` –≤ `CRUDPlayerQuestProgress`) –∏ –∏—Ö —ç–∫—Å–ø–æ—Ä—Ç –≤ `src/core/crud/__init__.py`.
    6.  –ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –º–æ–¥–µ–ª–µ–π (`tests/models/test_quest.py`) –∏ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π (`tests/core/crud/test_crud_quest.py`).
    7.  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1-2**: –ü—Ä–æ–≤–µ–¥–µ–Ω –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π. –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª–∏ `Questline`, `GeneratedQuest`, `QuestStep`, `PlayerQuestProgress` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ `src/models/quest.py`, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–æ–∫.
    - **–®–∞–≥ 3**: –ú–æ–¥–µ–ª–∏ –≤ `src/models/quest.py` –¥–æ—Ä–∞–±–æ—Ç–∞–Ω—ã:
        - –í—Å–µ –º–æ–¥–µ–ª–∏ (`Questline`, `GeneratedQuest`, `QuestStep`, `PlayerQuestProgress`) —Ç–µ–ø–µ—Ä—å –Ω–∞—Å–ª–µ–¥—É—é—Ç `TimestampMixin` (–¥–ª—è `created_at`, `updated_at`).
        - –í `Questline` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è: `title_i18n` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –∏–∑ `name_i18n`), `starting_quest_static_id`, `is_main_storyline`, `required_previous_questline_static_id`, `properties_json`.
        - –í `GeneratedQuest` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è: `is_repeatable`, `properties_json`.
        - –í `QuestStep` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è: `next_step_order`, `properties_json`.
        - –í `PlayerQuestProgress` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è: `party_id` (–∏ —Å–≤—è–∑—å `party`), `accepted_at`, `completed_at`. –ü–æ–ª–µ `player_id` —Å–¥–µ–ª–∞–Ω–æ `nullable`. –î–æ–±–∞–≤–ª–µ–Ω—ã `UniqueConstraint` –¥–ª—è (`guild_id`, `party_id`, `quest_id`) –∏ `CheckConstraint` (`player_id IS NOT NULL OR party_id IS NOT NULL`).
        - –°–≤—è–∑—å `Player.quest_progress` –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞, —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞.
    - **–®–∞–≥ 4**: –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic `alembic/versions/20240710100000_add_quest_system_models_and_updates.py`. –ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `name_i18n` -> `title_i18n` –≤ `questlines`, `player_id` nullable –≤ `player_quest_progress`), —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ –∏–Ω–¥–µ–∫—Å–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–∞–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–º–µ–Ω–µ `down_revision` –∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∏–º–µ–Ω constraint'–æ–≤.
    - **–®–∞–≥ 5**: –§–∞–π–ª `src/core/crud/crud_quest.py` –¥–æ—Ä–∞–±–æ—Ç–∞–Ω: –≤ `CRUDPlayerQuestProgress` –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `get_by_party_and_quest` –∏ `get_all_for_party`. –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –≤—Å–µ CRUD –∫–≤–µ—Å—Ç–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑ `src/core/crud/__init__.py`; –æ–±–Ω–æ–≤–ª–µ–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞.
    - **–®–∞–≥ 6**: –°–æ–∑–¥–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã:
        - `tests/models/test_quest.py`: —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –º–æ–¥–µ–ª–µ–π, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π (–≤–∫–ª—é—á–∞—è i18n, JSON, timestamp), –∏ –±–∞–∑–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã relationships.
        - `tests/core/crud/test_crud_quest.py`: —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤ `AsyncSession`.
    - **–®–∞–≥ 7**: `AGENTS.md` –æ–±–Ω–æ–≤–ª–µ–Ω (—ç—Ç–æ—Ç –ª–æ–≥, –æ—á–∏—â–µ–Ω "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω").
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ 39 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∫–≤–µ—Å—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î, CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã, –Ω–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã.

## Task 42: üí∞ 10.1 Data Structure (Guild-Scoped, i18n) - –≠–∫–æ–Ω–æ–º–∏–∫–∞: –ú–æ–¥–µ–ª–∏ Item –∏ InventoryItem
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Item, ItemProperty models. With a guild_id field. name_i18n, description_i18n. Properties, base value, category. Economy rules (rules_config 13/0.3/41).
- **–ü–ª–∞–Ω**:
    1.  –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π `Item` –∏ `InventoryItem`.
    2.  –î–æ—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–µ–ª–∏ `Item` (`src/models/item.py`): –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π `slot_type` (Text, nullable=True, index=True) –∏ `is_stackable` (Boolean, default=True, nullable=False).
    3.  –î–æ—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–µ–ª–∏ `InventoryItem` (`src/models/inventory_item.py`): –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `equipped_status` (Text, nullable=True, index=True).
    4.  –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `relationship` `inventory_items` –≤ –º–æ–¥–µ–ª–∏ `Player` (`src/models/player.py`) –∏ `GeneratedNpc` (`src/models/generated_npc.py`) –¥–ª—è —Å–≤—è–∑–∏ —Å `InventoryItem`.
    5.  –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ `Item` –∏ `InventoryItem` –≤ `src/models/__init__.py` (–∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å).
    6.  –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î.
    7.  –°–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π: `CRUDItem` (—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª, –ø—Ä–∏–∑–Ω–∞–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º) –∏ —Å–æ–∑–¥–∞–Ω–∏–µ `CRUDInventoryItem` —Å –º–µ—Ç–æ–¥–∞–º–∏ `get_inventory_for_owner`, `add_item_to_owner`, `remove_item_from_owner`. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/core/crud/__init__.py`.
    8.  –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∞–≤–∏–ª —ç–∫–æ–Ω–æ–º–∏–∫–∏ –≤ `RuleConfig` (–≤ `AGENTS.md`).
    9.  –ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –º–æ–¥–µ–ª–µ–π `Item`, `InventoryItem` –∏ –∏—Ö CRUD –æ–ø–µ—Ä–∞—Ü–∏–π.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1-2**: –ú–æ–¥–µ–ª—å `Item` –≤ `src/models/item.py` –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞: –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `slot_type` –∏ `is_stackable`.
    - **–®–∞–≥ 3-4**: –ú–æ–¥–µ–ª—å `InventoryItem` –≤ `src/models/inventory_item.py` –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–∞: –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `equipped_status`. –í –º–æ–¥–µ–ª–∏ `Player` –∏ `GeneratedNpc` –¥–æ–±–∞–≤–ª–µ–Ω—ã `relationships` `inventory_items`.
    - **–®–∞–≥ 5**: –ò–º–ø–æ—Ä—Ç—ã –≤ `src/models/__init__.py` –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã, `Item` –∏ `InventoryItem` —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏.
    - **–®–∞–≥ 6**: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic `768728ada8e2_add_fields_to_items_and_inventory_items.py`. –§—É–Ω–∫—Ü–∏–∏ `upgrade` –∏ `downgrade` –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –∏ –∏–Ω–¥–µ–∫—Å–æ–≤. (–ë—ã–ª–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —à–∞–≥–∏ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π `alembic`, `pydantic`, `psycopg2-binary` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏).
    - **–®–∞–≥ 7**: –ü—Ä–æ–≤–µ—Ä–µ–Ω `src/core/crud/crud_item.py` (–ø—Ä–∏–∑–Ω–∞–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º). –°–æ–∑–¥–∞–Ω `src/core/crud/crud_inventory_item.py` —Å –∫–ª–∞—Å—Å–æ–º `CRUDInventoryItem` –∏ –º–µ—Ç–æ–¥–∞–º–∏ `get_inventory_for_owner`, `add_item_to_owner`, `remove_item_from_owner`. –§–∞–π–ª `src/core/crud/__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω.
    - **–®–∞–≥ 8**: –°—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∞–≤–∏–ª —ç–∫–æ–Ω–æ–º–∏–∫–∏ –¥–ª—è `RuleConfig` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ `AGENTS.md` (–≤ —Å–µ–∫—Ü–∏–∏ "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏").
    - **–®–∞–≥ 9**: –°–æ–∑–¥–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã:
        - `tests/models/test_item.py` –¥–ª—è –º–æ–¥–µ–ª–∏ `Item`.
        - `tests/models/test_inventory_item.py` –¥–ª—è –º–æ–¥–µ–ª–∏ `InventoryItem`.
        - `tests/core/crud/test_crud_item.py` –¥–ª—è `CRUDItem`.
        - `tests/core/crud/test_crud_inventory_item.py` –¥–ª—è `CRUDInventoryItem`.
- **–°—Ç–∞—Ç—É—Å**: –ú–æ–¥–µ–ª–∏ –∏ –±–∞–∑–æ–≤—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª —ç–∫–æ–Ω–æ–º–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞.

## Task 43: üí∞ 10.2 AI Economic Entity Generation (Per Guild)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: AI generates items and NPC traders for a guild according to rules. Called from 10 (Generation Cycle). AI (16/17) is prompted to generate according to rules 13/41 FOR THIS GUILD, including traders (with roles, inventory), base prices (calculated by rules 13/41), i18n texts. Entities get guild_id.
- **–ü–ª–∞–Ω**:
    1.  **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ AI (`src/core/ai_response_parser.py`)**:
        *   –î–æ–ø–æ–ª–Ω–∏—Ç—å `ParsedItemData` –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–æ–ª—è–º–∏ (`static_id` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, `base_value` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ) –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏.
        *   –°–æ–∑–¥–∞—Ç—å `ParsedNpcTraderData` (–Ω–∞—Å–ª–µ–¥—É—è –æ—Ç `ParsedNpcData`) —Å –ø–æ–ª—è–º–∏ `role_i18n`, `inventory_template_key`, `generated_inventory_items`.
        *   –°–æ–∑–¥–∞—Ç—å `GeneratedInventoryItemEntry` –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è.
        *   –û–±–Ω–æ–≤–∏—Ç—å `GeneratedEntity` Union –∏ `_perform_semantic_validation`.
    2.  **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø—Ä–æ–º–ø—Ç–∞ AI (`src/core/ai_prompt_builder.py`)**:
        *   –û–±–Ω–æ–≤–∏—Ç—å `_get_entity_schema_terms()` —Å—Ö–µ–º–∞–º–∏ `item_schema` –∏ `npc_trader_schema`.
        *   –°–æ–∑–¥–∞—Ç—å `prepare_economic_entity_generation_prompt` –¥–ª—è —Å–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª —ç–∫–æ–Ω–æ–º–∏–∫–∏ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞.
    3.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (`src/core/world_generation.py`)**:
        *   –°–æ–∑–¥–∞—Ç—å `generate_economic_entities`.
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤ AI, –ø–∞—Ä—Å–∏–Ω–≥, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `Item` –∏ `GeneratedNpc` (—Ç–æ—Ä–≥–æ–≤—Ü–µ–≤), –≤–∫–ª—é—á–∞—è –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (—á–µ—Ä–µ–∑ `generated_inventory_items`).
        *   –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ `WORLD_EVENT_ECONOMIC_ENTITIES_GENERATED`. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é.
    4.  **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π `RuleConfig`**:
        *   –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ `AGENTS.md` –∫–ª—é—á–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ç–∏–ø—ã, —Ä–æ–ª–∏, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏).
    5.  **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
        *   –¢–µ—Å—Ç—ã –¥–ª—è Pydantic –º–æ–¥–µ–ª–µ–π (`tests/core/test_ai_response_parser.py`).
        *   –¢–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø—Ä–æ–º–ø—Ç–∞ (`tests/core/test_ai_prompt_builder.py`).
        *   –¢–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π (`tests/core/test_world_generation.py`).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1 (Pydantic –º–æ–¥–µ–ª–∏)**:
        - –í `src/core/ai_response_parser.py`:
            - `ParsedItemData` –¥–æ–ø–æ–ª–Ω–µ–Ω–∞: `static_id` —Å–¥–µ–ª–∞–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º, –¥–æ–±–∞–≤–ª–µ–Ω –≤–∞–ª–∏–¥–∞—Ç–æ—Ä `check_item_static_id`.
            - –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `GeneratedInventoryItemEntry` —Å –ø–æ–ª—è–º–∏ `item_static_id`, `quantity_min`, `quantity_max`, `chance_to_appear` –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏ (–≤–∫–ª—é—á–∞—è `model_validator` –¥–ª—è `quantity_max >= quantity_min`).
            - –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `ParsedNpcTraderData(ParsedNpcData)` —Å `entity_type="npc_trader"` –∏ –ø–æ–ª—è–º–∏ `role_i18n`, `inventory_template_key`, `generated_inventory_items: Optional[List[GeneratedInventoryItemEntry]]` –∏ –∏—Ö –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏.
            - `ParsedNpcTraderData` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `GeneratedEntity`.
            - `_perform_semantic_validation` –¥–æ–ø–æ–ª–Ω–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `role_i18n` –≤ `ParsedNpcTraderData`.
    - **–®–∞–≥ 2 (–ü—Ä–æ–º–ø—Ç AI)**:
        - –í `src/core/ai_prompt_builder.py`:
            - –í `_get_entity_schema_terms()`:
                - `item_schema` –æ–±–Ω–æ–≤–ª–µ–Ω–∞: `static_id`, `name_i18n`, `description_i18n`, `item_type` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã; `base_value` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ.
                - –î–æ–±–∞–≤–ª–µ–Ω–∞ `npc_trader_schema` —Å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º –æ—Ç `npc_schema` –∏ –ø–æ–ª—è–º–∏ `entity_type`, `role_i18n`, `inventory_template_key`, `generated_inventory_items` (—Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `GeneratedInventoryItemEntry`).
            - –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `prepare_economic_entity_generation_prompt(session: AsyncSession, guild_id: int)`. –û–Ω–∞ —Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ —ç–∫–æ–Ω–æ–º–∏–∫–∏ –∏–∑ `RuleConfig` (–∫–ª—é—á–∏ `economy:*` –∏ `ai:economic_generation:*`), —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI.
    - **–®–∞–≥ 3 (–õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)**:
        - –í `src/models/enums.py` –¥–æ–±–∞–≤–ª–µ–Ω `EventType.WORLD_EVENT_ECONOMIC_ENTITIES_GENERATED`.
        - –í `src/core/world_generation.py`:
            - –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_economic_entities(session: AsyncSession, guild_id: int)`.
            - –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `prepare_economic_entity_generation_prompt`, –º–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç AI.
            - –û—Ç–≤–µ—Ç –ø–∞—Ä—Å–∏—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `parse_and_validate_ai_response`.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `Item` (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç `static_id`) –∏ `GeneratedNpc` (—Ç–æ—Ä–≥–æ–≤—Ü–µ–≤, —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç `static_id`). `role_i18n` –∏ `inventory_template_key` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `properties_json` NPC.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –¥–ª—è NPC –Ω–∞ –æ—Å–Ω–æ–≤–µ `generated_inventory_items` (—Å —É—á–µ—Ç–æ–º `chance_to_appear`, `quantity_min/max`, –ø–æ–∏—Å–∫ `item_id`).
            - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `WORLD_EVENT_ECONOMIC_ENTITIES_GENERATED`.
            - –§—É–Ω–∫—Ü–∏—è `generate_economic_entities` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
    - **–®–∞–≥ 4 (RuleConfig)**:
        - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ `AGENTS.md` (–≤ –ª–æ–≥–µ —ç—Ç–æ–π –∑–∞–¥–∞—á–∏) –∫–ª—é—á–∏ `RuleConfig`: `ai:economic_generation:target_item_count`, `ai:economic_generation:target_trader_count`, `ai:economic_generation:item_type_distribution`, `ai:economic_generation:trader_role_distribution`, `ai:economic_generation:quality_instructions_i18n`. –¢–∞–∫–∂–µ —É–ø–æ–º—è–Ω—É—Ç—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `economy:base_item_values:*` –∏ `economy:npc_inventory_templates:*`.
    - **–®–∞–≥ 5 (Unit-—Ç–µ—Å—Ç—ã)**:
        - –í `tests/core/test_ai_response_parser.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `ParsedItemData`, `GeneratedInventoryItemEntry`, `ParsedNpcTraderData`. –û–±–Ω–æ–≤–ª–µ–Ω —Ç–µ—Å—Ç `test_parse_valid_item_and_trader_data`.
        - –í `tests/core/test_ai_prompt_builder.py` —Å–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `TestAIEconomicPromptBuilder` –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã `test_prepare_economic_entity_generation_prompt_basic_structure` –∏ `test_prepare_economic_entity_generation_prompt_handles_missing_rules`.
        - –í `tests/core/test_world_generation.py` —Å–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `TestWorldGenerationEconomicEntities` –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã: `test_generate_economic_entities_success`, `test_generate_economic_entities_ai_parse_error`, `test_generate_economic_entities_handles_existing_item_and_npc`.
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (–ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ NPC-—Ç–æ—Ä–≥–æ–≤—Ü–µ–≤) —á–µ—Ä–µ–∑ AI —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –ø–æ–∫—Ä—ã—Ç–∞ –±–∞–∑–æ–≤—ã–º–∏ unit-—Ç–µ—Å—Ç–∞–º–∏.
- **–°—Ç—Ä—É–∫—Ç—É—Ä—ã `RuleConfig` –¥–ª—è Task 43 (AI Economic Entity Generation)**:
    1.  **`ai:economic_generation:target_item_count`**
        *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
        *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: `{"count": 10}`
    2.  **`ai:economic_generation:target_trader_count`**
        *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö NPC-—Ç–æ—Ä–≥–æ–≤—Ü–µ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
        *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: `{"count": 3}`
    3.  **`ai:economic_generation:item_type_distribution`**
        *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –ñ–µ–ª–∞–µ–º–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤.
        *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**:
            ```json
            {
              "types": [
                {"type_name": "weapon", "weight": 5, "name_i18n": {"en": "Weapon", "ru": "–û—Ä—É–∂–∏–µ"}},
                {"type_name": "armor", "weight": 4, "name_i18n": {"en": "Armor", "ru": "–ë—Ä–æ–Ω—è"}},
                {"type_name": "potion", "weight": 3, "name_i18n": {"en": "Potion", "ru": "–ó–µ–ª—å–µ"}}
              ]
            }
            ```
    4.  **`ai:economic_generation:trader_role_distribution`**
        *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –ñ–µ–ª–∞–µ–º–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –¥–ª—è NPC-—Ç–æ—Ä–≥–æ–≤—Ü–µ–≤.
        *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**:
            ```json
            {
              "roles": [
                {"role_key": "blacksmith", "weight": 3, "name_i18n": {"en": "Blacksmith", "ru": "–ö—É–∑–Ω–µ—Ü"}, "description_i18n": {"en": "Sells weapons and armor.", "ru": "–ü—Ä–æ–¥–∞–µ—Ç –æ—Ä—É–∂–∏–µ –∏ –±—Ä–æ–Ω—é."}},
                {"role_key": "alchemist", "weight": 2, "name_i18n": {"en": "Alchemist", "ru": "–ê–ª—Ö–∏–º–∏–∫"}, "description_i18n": {"en": "Sells potions and reagents.", "ru": "–ü—Ä–æ–¥–∞–µ—Ç –∑–µ–ª—å—è –∏ —Ä–µ–∞–≥–µ–Ω—Ç—ã."}}
              ]
            }
            ```
    5.  **`ai:economic_generation:quality_instructions_i18n`**
        *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—â–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –∏ —Å—Ç–∏–ª—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
        *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: `{"en": "Items should be thematic...", "ru": "–ü—Ä–µ–¥–º–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏..."}`
    6.  **`economy:base_item_values:<item_category_or_type_key>`** (—Å–º. —Ç–∞–∫–∂–µ –ª–æ–≥ Task 42/44)
        *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AI –∫–∞–∫ –æ—Ä–∏–µ–Ω—Ç–∏—Ä.
        *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: `{"value": 100, "currency": "gold"}`
    7.  **`economy:npc_inventory_templates:<npc_role_or_type_key>`** (—Å–º. —Ç–∞–∫–∂–µ –ª–æ–≥ Task 42/44)
        *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –®–∞–±–ª–æ–Ω—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –¥–ª—è NPC. AI –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ `inventory_template_key` –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤.
        *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: (—Å–º. –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –ª–æ–≥–µ Task 42/44 –∏–ª–∏ AGENTS.md)

## Task 45: üåå 14.1 Global Entity Models (Guild-Scoped, i18n)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Models for entities moving in the world within each guild. Implement GlobalNpc, MobileGroup, GlobalEvent models. All with a guild_id field. name_i18n. Routes, goals, composition.
- **–ü–ª–∞–Ω**:
    1.  ***–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π***:
        *   –ò–∑—É—á–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ Task 45.
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ –≤ `src/models/` –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–ª–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.
        *   –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (0.2 - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î, 7 - –æ–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –º–æ–¥–µ–ª–µ–π).
    2.  ***–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π***:
        *   –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è `GlobalNpc`, `MobileGroup`, `GlobalEvent` (–¥–µ—Ç–∞–ª–∏ —Å–º. –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ª–æ–≥–∞—Ö —ç—Ç–æ–≥–æ —à–∞–≥–∞).
    3.  ***–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π***:
        *   –°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã `src/models/global_npc.py`, `src/models/mobile_group.py`, `src/models/global_event.py`.
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–ª–∞—Å—Å—ã SQLAlchemy –º–æ–¥–µ–ª–µ–π.
        *   –ú–æ–¥–µ–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/models/__init__.py`.
        *   –û–±–Ω–æ–≤–ª–µ–Ω—ã `back_populates` –≤ `GuildConfig` (`src/models/guild.py`) –∏ `Location` (`src/models/location.py`).
    4.  ***–°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Alembic***:
        *   –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/20240715120000_add_global_entities_models.py` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü `global_npcs`, `mobile_groups`, `global_events`.
    5.  ***–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –º–æ–¥–µ–ª–µ–π***:
        *   –°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã —Ç–µ—Å—Ç–æ–≤ `tests/models/test_global_npc.py`, `tests/models/test_mobile_group.py`, `tests/models/test_global_event.py`.
        *   –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ —Å–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –º–æ–¥–µ–ª–µ–π –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤.
- **–°—Ç–∞—Ç—É—Å**: –ú–æ–¥–µ–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã, –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞, unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π –Ω–∞–ø–∏—Å–∞–Ω—ã.

## Task 46: üß¨ 14.2 Global Entity Management (Per-Guild Iteration)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Module simulating the life and movement of global entities for each guild. Async Worker(s): Iterates through the list of all active guilds. For each guild_id: Loads Global Entities, rules for this guild. Simulates GE movement. Simulates interactions (detection, reaction, triggers). Log events.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `src/core/global_entity_manager.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `simulate_global_entities_for_guild` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`_simulate_entity_movement`, `_determine_next_location_id`, `_simulate_entity_interactions`, `_get_entities_in_location`, `_choose_reaction_action`, `_get_entity_type_for_rules`, `_get_relationship_entity_type_enum`).
    - –õ–æ–≥–∏–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (GlobalNpc, MobileGroup), —Å–∏–º—É–ª—è—Ü–∏—é –∏—Ö –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º –∏–ª–∏ –∫ —Ü–µ–ª—è–º, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ –ª–æ–∫–∞—Ü–∏–∏ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `resolve_check` –∏ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`), –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π, –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–∏–∞–ª–æ–≥–∞, –≤—ã–∑–æ–≤ `start_combat`).
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `RuleConfig` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–µ–º, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º –∏ —Ä–µ–∞–∫—Ü–∏—è–º–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ `EventType` (`GLOBAL_ENTITY_MOVED`, `GLOBAL_ENTITY_DETECTED_ENTITY`, `GLOBAL_ENTITY_ACTION`, `GE_TRIGGERED_DIALOGUE_PLACEHOLDER`) –∏ `RelationshipEntityType` (`GLOBAL_NPC`, `MOBILE_GROUP`) –≤ `src/models/enums.py`.
    - –°–æ–∑–¥–∞–Ω—ã CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è `GlobalNpc` –∏ `MobileGroup` –≤ `src/core/crud/crud_global_npc.py` –∏ `src/core/crud/crud_mobile_group.py` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. –¢–∞–∫–∂–µ —Å–æ–∑–¥–∞–Ω `crud_rule_config.py`. –û–±–Ω–æ–≤–ª–µ–Ω `src/core/crud/__init__.py`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã –¥–ª—è `global_entity_manager.py` –≤ `tests/core/test_global_entity_manager.py`, –∫–æ—Ç–æ—Ä—ã–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –º–æ–∫–æ–≤.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–∞—Ö (`test_crud_quest.py`, `test_world_generation.py`), –≤–æ–∑–Ω–∏–∫—à–∏–µ –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–æ–¥–µ–ª—è—Ö (`GuildConfig`, `Questline`) –∏ Enum (`QuestStatus`).
- **–°—Ç–∞—Ç—É—Å**: –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í—Å–µ —Ç–µ—Å—Ç—ã –≤ `tests/core/` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã. –ß–∞—Å—Ç—å —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ (–¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ, –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–∞–≤–∞ MobileGroup –≤ –±–æ—é) –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª Async Worker –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞–ª—Å—è –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–π –∑–∞–¥–∞—á–∏.

## Task 47: üõ†Ô∏è 15.1 Master Command System
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä Discord-–∫–æ–º–∞–Ω–¥ –¥–ª—è –ú–∞—Å—Ç–µ—Ä–∞ –ò–≥—Ä—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–µ–π–º–ø–ª–µ–µ–º –∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ –≥–∏–ª—å–¥–∏–∏.
- **–ü–ª–∞–Ω**:
    1.  **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: –°–æ–∑–¥–∞–Ω–∏–µ `MasterAdminCog`, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `BOT_COGS`, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.
    2.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è CRUD-–∫–æ–º–∞–Ω–¥ –¥–ª—è –º–æ–¥–µ–ª–µ–π**: –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è `Player` (view, list, update) –∏ `RuleConfig` (get, set, list).
    3.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ –¥–ª—è `RuleConfig`**: –í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞.
    4.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã `/master_admin resolve_conflict`**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã `resolve` –∏ `view` –¥–ª—è `PendingConflict`. –ú–µ—Ö–∞–Ω–∏–∑–º —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ `Turn Processing Module` –æ—Ç–ª–æ–∂–µ–Ω.
    5.  **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å**: –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_localized_message_template`, –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ `player_view`.
    6.  **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª unit-—Ç–µ—Å—Ç–æ–≤, –Ω–∞–ø–∏—Å–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤.
    7.  **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**: –≠—Ç–æ—Ç –ª–æ–≥.
    8.  **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π (Commit)**.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1**: –°–æ–∑–¥–∞–Ω `src/bot/commands/master_admin_commands.py` —Å `MasterAdminCog` –∏ –≥—Ä—É–ø–ø–æ–π `/master_admin`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@is_administrator`. Cog –¥–æ–±–∞–≤–ª–µ–Ω –≤ `settings.py`. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `get_localized_message_template` –∏ –∫–ª—é—á–∏ –≤ `RuleConfig`.
    - **–®–∞–≥ 2 & 3**: –í `MasterAdminCog` –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥–≥—Ä—É–ø–ø—ã –∏ –∫–æ–º–∞–Ω–¥—ã:
        - `/master_admin player view <id>`
        - `/master_admin player list [page] [limit]`
        - `/master_admin player update <id> <field> <value>` (–¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –ø–æ–ª–µ–π)
        - `/master_admin ruleconfig get <key>`
        - `/master_admin ruleconfig set <key> <value_json>`
        - `/master_admin ruleconfig list [page] [limit]`
    - **–®–∞–≥ 4**: –í `MasterAdminCog` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã:
        - `/master_admin conflict resolve <id> <outcome_status> [notes]`
        - `/master_admin conflict view <id>`
        - –ú–µ—Ö–∞–Ω–∏–∑–º –∞–∫—Ç–∏–≤–Ω–æ–π —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ `Turn Processing Module` –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, —Ç–∞–∫ –∫–∞–∫ `action_processor.py` –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –Ω–µ –∏–º–µ–µ—Ç –ª–æ–≥–∏–∫–∏ –∏—Ö –æ–∂–∏–¥–∞–Ω–∏—è. –ö–æ–º–∞–Ω–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –≤ –ë–î.
    - **–®–∞–≥ 5**: –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_localized_message_template` –≤ `src/core/localization_utils.py`. –ö–æ–º–∞–Ω–¥–∞ `/master_admin player view` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è. –ü—Ä–∏–Ω—Ü–∏–ø –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∫–æ–º–∞–Ω–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω.
    - **–®–∞–≥ 6**: –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/test_master_admin_commands.py` —Å –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `player_view` –∏ `ruleconfig_set`.
- **–°—Ç–∞—Ç—É—Å**: –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Task 47 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã. –ü–æ–ª–Ω–æ–µ CRUD-–ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –∏ –ø–æ–ª–Ω–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã. –ú–µ—Ö–∞–Ω–∏–∑–º —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è `resolve_conflict` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–æ—Ä–∞–±–æ—Ç–æ–∫ –≤ `action_processor.py`.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (–°–µ—Å—Å–∏—è 2024-07-05)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ–µ–∫—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Pyright, –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
        - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã –∏–∑ `requirements.txt` —Å –ø–æ–º–æ—â—å—é `pip install -r requirements.txt`.
    - **–®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Pyright**:
        - Pyright —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å –ø–æ–º–æ—â—å—é `pip install pyright`.
    - **–®–∞–≥ 3: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ Pyright –∏ –∞–Ω–∞–ª–∏–∑ (125 –æ—à–∏–±–æ–∫)**:
        - Pyright –∑–∞–ø—É—â–µ–Ω, –≤—ã–≤–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω. –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 125 –æ—à–∏–±–æ–∫.
        - –û—Å–Ω–æ–≤–Ω–∞—è –º–∞—Å—Å–∞ –æ—à–∏–±–æ–∫ —Å–≤—è–∑–∞–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `db: AsyncSession` –≤–º–µ—Å—Ç–æ `session: AsyncSession` –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∏—Ö –≤—ã–∑–æ–≤–∞—Ö –≤ CRUD-–∫–ª–∞—Å—Å–∞—Ö –∏ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –º–æ–¥—É–ª—è—Ö.
    - **–®–∞–≥ 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ `db`/`session`**:
        - `src/core/crud/crud_player.py`: –ü–∞—Ä–∞–º–µ—Ç—Ä `db` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `session`.
        - `src/core/crud_base_definitions.py`: –ü–∞—Ä–∞–º–µ—Ç—Ä `db` –≤ –º–µ—Ç–æ–¥–µ `create` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `session`.
        - `src/core/crud/crud_location.py`: –ü–∞—Ä–∞–º–µ—Ç—Ä `db` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `session`.
        - `src/core/crud/crud_party.py`: –ü–∞—Ä–∞–º–µ—Ç—Ä `db` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `session`.
        - `src/core/crud/crud_npc.py`: –ü–∞—Ä–∞–º–µ—Ç—Ä `db` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `session`.
        - `src/core/crud/crud_relationship.py`: –ü–∞—Ä–∞–º–µ—Ç—Ä `db` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `session`.
        - `src/core/crud/crud_item.py`: –ü–∞—Ä–∞–º–µ—Ç—Ä `db` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `session`.
        - `src/core/check_resolver.py`: –ü–∞—Ä–∞–º–µ—Ç—Ä `db` –≤ `resolve_check` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `session`.
        - `src/core/action_processor.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã CRUD-—Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `session=session` –≤–º–µ—Å—Ç–æ `db=session`.
        - `src/core/ai_orchestrator.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã CRUD-—Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `session=session`.
        - `src/core/ai_prompt_builder.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã CRUD-—Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `session=session`.
        - `src/core/localization_utils.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `crud_instance.get_many_by_ids` –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `session=session`.
        - `tests/core/crud/test_crud_base_definitions.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã CRUD-—Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `session=mock_db_session`.
    - **–®–∞–≥ 5: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫ –ø–æ –æ—Ç—á–µ—Ç—É Pyright**:
        - `src/core/combat_engine.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø `actor_entity_type` –∏ `target_entity_type` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `resolve_check` (—Å—Ç—Ä–æ–∫–∞ -> Enum).
        - `src/bot/commands/character_commands.py`: –î–æ–±–∞–≤–ª–µ–Ω–æ `# type: ignore` –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞, –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ `@transactional`, —Ç–∞–∫ –∫–∞–∫ Pyright –Ω–µ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–µ—Ä–µ–¥–∞—á—É —Å–µ—Å—Å–∏–∏.
        - `requirements.txt`: –î–æ–±–∞–≤–ª–µ–Ω `chardet` –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞.
        - `tests/core/test_ai_orchestrator.py`: –£–¥–∞–ª–µ–Ω –æ—à–∏–±–æ—á–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `entity_type` –∏–∑ –≤—ã–∑–æ–≤–æ–≤ `trigger_ai_generation_flow`. –î–æ–±–∞–≤–ª–µ–Ω–æ `# type: ignore[attr-defined]` –¥–ª—è `mock_update_entity.call_args_list`.
        - `tests/core/test_ai_response_parser.py`: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ `None` –¥–ª—è `faction_min.name_i18n` –∏ `faction_full.resources_json` –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º –ø–æ –∫–ª—é—á—É (—Ö–æ—Ç—è –ø–æ –º–æ–¥–µ–ª—è–º –æ–Ω–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `None`).
        - `tests/core/test_command_utils.py`: –ò–∑–º–µ–Ω–µ–Ω –≤—ã–∑–æ–≤ `_get_localized_string(value=None, ...)` –¥–ª—è —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞ `None`, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å Pyright.
        - `tests/core/test_interaction_handlers.py`: –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ `assert mock_log_event.call_args is not None` –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º –∫ `mock_log_event.call_args.kwargs`.
        - `tests/models/test_command_info.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ `CommandInfo`, `CommandParameterInfo`, `CommandListResponse` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∏ `description=None` —Ç–∞–º, –≥–¥–µ Pyright –æ—à–∏–±–æ—á–Ω–æ —Å—á–∏—Ç–∞–ª –µ–≥–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.
    - **–®–∞–≥ 6: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ Pyright –∏ –∞–Ω–∞–ª–∏–∑ (30 –æ—à–∏–±–æ–∫)**:
        - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ —Å–æ–∫—Ä–∞—Ç–∏–ª–æ—Å—å –¥–æ 30. –í—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –æ—à–∏–±–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö.
        - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –æ—à–∏–±–æ–∫, –≤–µ—Ä–æ—è—Ç–Ω–æ, —Å–≤—è–∑–∞–Ω—ã —Å –≤—ã–≤–æ–¥–æ–º —Ç–∏–ø–æ–≤ –¥–ª—è –º–æ–∫–æ–≤ –∏–ª–∏ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞.
- **–°—Ç–∞—Ç—É—Å**: –û—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –û—Å—Ç–∞–≤—à–∏–µ—Å—è –æ—à–∏–±–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö —Ç—Ä–µ–±—É—é—Ç –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ê–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ (–°–µ—Å—Å–∏—è 2024-07-09)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç, –≤—ã—è–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã, –Ω–∞–ø–∏—Å–∞—Ç—å –∏—Ö, –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏.
- **–ü–ª–∞–Ω**:
    1.  **–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –∫–æ–¥–∞:**
        *   –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å `src/core/world_generation.py` –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
        *   –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å `tests/core/test_world_generation.py` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è.
    2.  **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤:** (–î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–º. –≤ –ª–æ–≥–µ –Ω–∏–∂–µ)
    3.  **–ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤:**
        *   –î–æ–ø–æ–ª–Ω–∏—Ç—å `tests/core/test_world_generation.py` –Ω–æ–≤—ã–º–∏ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏.
    4.  **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.**
    5.  **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫:**
        *   –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ –∏/–∏–ª–∏ —Ç–µ—Å—Ç–∞—Ö.
    6.  **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**.
    7.  **–ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π**.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1 (–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞)**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã `src/core/world_generation.py` –∏ `tests/core/test_world_generation.py`.
    - **–®–∞–≥ 2 (–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤)**:
        - –î–ª—è `generate_location`:
            *   `parent_location_id` —É–∫–∞–∑–∞–Ω, –Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –ª–æ–∫–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
            *   `potential_neighbors` —Å–æ–¥–µ—Ä–∂–∏—Ç —ç–ª–µ–º–µ–Ω—Ç —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º `static_id_or_name`.
            *   `connection_details_i18n` –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –ø—Ä–∏ —è–≤–Ω–æ–º —Å–≤—è–∑—ã–≤–∞–Ω–∏–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
            *   –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `neighbor_locations_json` —É `new_location_db` –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `current_neighbor_links_for_new_loc`).
        - –î–ª—è `generate_factions_and_relationships`:
            *   `prepare_faction_relationship_generation_prompt` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É.
            *   `static_id_to_db_id_map` –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç ID –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
            *   –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π `entity_type` –≤ `ParsedRelationshipData`.
            *   –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è.
            *   –û–±—Ä–∞–±–æ—Ç–∫–∞ `player_default` –≤ `static_id` –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
        - –î–ª—è `generate_quests_for_guild`:
            *   `prepare_quest_generation_prompt` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É.
            *   `questline_static_id` —É–∫–∞–∑–∞–Ω, –Ω–æ `Questline` –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
            *   AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–≤–µ—Å—Ç –±–µ–∑ —à–∞–≥–æ–≤.
            *   `generated_quest_crud.create` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None`.
    - **–®–∞–≥ 3 (–ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤)**: –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –≤ `tests/core/test_world_generation.py` –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤—ã—à–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
    - **–®–∞–≥ 4 (–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤)**:
        - –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ (`python -m unittest discover -s tests`): `ModuleNotFoundError: No module named 'pytest'` –≤ `tests/test_main.py`.
        - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `pytest` (`pip install pytest`).
        - –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ (`pytest`): –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ `ModuleNotFoundError` (discord, sqlalchemy, pydantic, pytest-asyncio).
        - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt` (`pip install -r requirements.txt`).
        - –¢—Ä–µ—Ç—å—è –ø–æ–ø—ã—Ç–∫–∞ (`pytest`): 19 –æ—à–∏–±–æ–∫, –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.
            - `TypeError: GeneralCog.start_command() missing 1 required positional argument: 'interaction'`
            - `TypeError: object MagicMock can't be used in 'await' expression` (–≤ `src/core/ability_system.py`)
            - `TypeError: trigger_ai_generation_flow() got an unexpected keyword argument 'entity_type'`
            - `NameError: name 'StoryLog' is not defined` (–≤ `src/core/game_events.py`)
            - `AttributeError: 'str' object has no attribute 'value'` (–≤ `src/core/interaction_handlers.py`)
            - `AssertionError` –≤ `tests/core/test_npc_combat_strategy.py`
            - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è `RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited`
    - **–®–∞–≥ 5 (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫)**:
        - `NameError` –≤ `src/core/game_events.py`: –ü–µ—Ä–µ–º–µ—â–µ–Ω –∏–º–ø–æ—Ä—Ç `StoryLog` –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –º–æ–¥—É–ª—è.
        - `TypeError` –≤ `tests/bot/commands/test_general_commands.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `self.cog.start_command.callback` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `self.cog` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–≤–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞.
        - `TypeError` –≤ `src/core/ability_system.py`: –í —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö `mock_session_no_existing_status` –∏ `mock_session_with_existing_status_factory` –≤ `tests/core/test_ability_system.py` –º–æ–∫ `session.delete` –∏–∑–º–µ–Ω–µ–Ω —Å `MagicMock` –Ω–∞ `AsyncMock`.
        - `TypeError` –≤ `trigger_ai_generation_flow`: –£–¥–∞–ª–µ–Ω –ª–∏—à–Ω–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç `entity_type` –∏–∑ –≤—ã–∑–æ–≤–æ–≤ `trigger_ai_generation_flow` –≤ —Ç–µ—Å—Ç–∞—Ö `tests/core/test_ai_orchestrator.py`.
        - `AttributeError` –≤ `src/core/interaction_handlers.py`: –í —Ç–µ—Å—Ç–∞—Ö `test_interact_object_with_check_success` –∏ `test_interact_object_with_check_failure` –≤ `tests/core/test_interaction_handlers.py` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ `CheckOutcome`, —á—Ç–æ–±—ã `status` –±—ã–ª —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º Enum `CheckOutcomeStatus`, –∞ –Ω–µ —Å—Ç—Ä–æ–∫–æ–π.
        - `AssertionError` –≤ `tests/core/test_npc_combat_strategy.py`: –í —Ç–µ—Å—Ç–µ `test_get_npc_ai_rules_merges_defaults_and_specific_relationship_rules` –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ —Å `assert "key" not in dict` –Ω–∞ `self.assertEqual(dict.get("key"), [])`, —Ç–∞–∫ –∫–∞–∫ –∫–ª—é—á –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫).
        - `RuntimeWarning` –≤ `tests/bot/commands/test_general_commands.py`: –î–æ–±–∞–≤–ª–µ–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ `guild_crud` –∏ –µ–≥–æ –º–µ—Ç–æ–¥–æ–≤ `get`/`create` –≤ `setUp` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–∞—Ö. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `GuildConfig`.
        - `RuntimeWarning` –≤ `tests/core/test_action_processor.py` –∏ `tests/core/test_turn_controller.py`: –ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å, —Ç–∞–∫ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –æ—á–µ–≤–∏–¥–µ–Ω –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω —Å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –∏ asyncio. –û—Å–Ω–æ–≤–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ `FAILURES`.
- **–°—Ç–∞—Ç—É—Å**: –û—à–∏–±–∫–∏ `FAILURES` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è `RuntimeWarning` –æ—Å—Ç–∞—é—Ç—Å—è. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã.

## Task 37: üé≠ 8.5 Relationship Influence (Full, According to Rules, Multy-i18n)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Implement the use of relationship values from the DB (34) as parameters or conditions in various game mechanics according to game rules.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
        - –ò–∑—É—á–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ Task 37. –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–æ–¥—É–ª–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: `check_resolver` (12), `npc_combat_strategy` (28), `trade_system` (44/42), `dialogue_system` (46/48), `action_processor` (21).
        - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–æ–¥–µ–ª–∏ `Relationship`, `RuleConfig` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ CRUD/—É—Ç–∏–ª–∏—Ç—ã (`crud_relationship`, `rules`).
        - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–æ–¥—É–ª–∏ `ai_orchestrator`, `ai_prompt_builder` –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–æ–≤.
        - –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `handle_trade_action` –∏ API –¥–∏–∞–ª–æ–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (`start_dialogue`, `handle_dialogue_input`, `end_dialogue`, `generate_npc_dialogue`) –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã.
    - **–®–∞–≥ 2: –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π**:
        - **–û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∞–≤–∏–ª –≤ `RuleConfig`** –¥–ª—è –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞:
            - –ü—Ä–æ–≤–µ—Ä–∫–∏ (`relationship_influence:checks:<check_type>`).
            - –ü–æ–≤–µ–¥–µ–Ω–∏–µ NPC –≤ –±–æ—é (`relationship_influence:npc_combat:behavior`).
            - –¢–æ—Ä–≥–æ–≤—ã–µ —Ü–µ–Ω—ã (`relationship_influence:trade:price_adjustment`).
            - –î–∏–∞–ª–æ–≥–∏ (`relationship_influence:dialogue:availability_and_tone`).
        - **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω `src/core/check_resolver.py`**:
            - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `crud_relationship`, `RelationshipEntityType`, `re`.
            - –í `resolve_check` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ (—Å–µ–∫—Ü–∏—è 2.c) –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∞–≤–∏–ª–∞ `relationship_influence:checks:<check_type>`.
            - –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –≤–∫–ª—é—á–µ–Ω–æ, –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∞–∫—Ç–æ—Ä–∞ —Å —Ü–µ–ª–µ–≤–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é –ø—Ä–æ–≤–µ—Ä–∫–∏.
            - –û—Ç–Ω–æ—à–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `relationship_type_pattern`.
            - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è `roll_modifier_formula` –∏–ª–∏ –ø–æ—Ä–æ–≥–æ–≤—ã–µ `modifiers` –∏–∑ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è `total_modifier`.
            - –í `ModifierDetail` –∏ `rules_snapshot` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–ª–∏—è–Ω–∏–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
            - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `eval()` –¥–ª—è —Ñ–æ—Ä–º—É–ª (—Å –æ–≥–æ–≤–æ—Ä–∫–æ–π –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏).
        - **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω `src/core/npc_combat_strategy.py`**:
            - –í `_get_npc_ai_rules` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–ª–∏—è–Ω–∏—è –ø—Ä–∞–≤–∏–ª `relationship_influence:npc_combat:behavior` —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ AI NPC.
            - –í `_is_hostile` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `hostility_threshold_modifier_formula` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ—Ä–æ–≥–æ–≤ –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏/–¥—Ä—É–∂–µ–ª—é–±–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
            - –í `_calculate_target_score` (–¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ `highest_threat_score`) –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `target_score_modifier_formula` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ —É–≥—Ä–æ–∑—ã —Ü–µ–ª–∏.
            - –í `_choose_action` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `weight_multiplier` –∏–∑ –ø—Ä–∞–≤–∏–ª `action_choice` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å —Ü–µ–ª—å—é.
        - **–î–ª—è —Å–∏—Å—Ç–µ–º —Ç–æ—Ä–≥–æ–≤–ª–∏ –∏ –¥–∏–∞–ª–æ–≥–æ–≤**:
            - –û—Ç–º–µ—á–µ–Ω–æ, —á—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `handle_trade_action` –∏ API –¥–∏–∞–ª–æ–≥–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
            - –°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω—ã TODO –∏ –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–ª–∏—è–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –≤ —ç—Ç–∏ —Å–∏—Å—Ç–µ–º—ã, –∫–æ–≥–¥–∞ –æ–Ω–∏ –±—É–¥—É—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–≤ —á–∞—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Ü–µ–Ω –∏ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ç–æ–Ω/–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –¥–∏–∞–ª–æ–≥–∞).
    - **–®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (Feedback)**:
        - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `report_formatter.py`. –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ `ModifierDetail.description`, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –≤ `check_resolver.py`, –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è.
        - **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω `src/core/report_formatter.py`**:
            - –í `_format_log_entry_with_names_cache` –¥–ª—è `EventType.COMBAT_ACTION` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π `CheckResult` (–≤–∫–ª—é—á–∞—è `roll_used`, `total_modifier`, `final_value`, `difficulty_class` –∏ —Å–ø–∏—Å–æ–∫ `modifier_details.description`).
            - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (`terms.checks.*`).
    - **–®–∞–≥ 4: –ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
        - **–î–ª—è `check_resolver.py` (`tests/core/test_check_resolver.py`)**:
            - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ mock-–æ–±—ä–µ–∫—Ç—ã –∏ –ø–∞—Ç—á–∏ –¥–ª—è `crud_relationship`.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã: `test_relationship_influence_roll_modifier_formula_positive`, `test_relationship_influence_threshold_modifier_friendly`, `test_relationship_influence_disabled`, `test_relationship_influence_pattern_mismatch`, `test_relationship_influence_formula_error`.
        - **–î–ª—è `npc_combat_strategy.py` (`tests/core/test_npc_combat_strategy.py`)**:
            - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ–∏–∫—Å—Ç—É—Ä–∞ `mock_ai_rules` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Å–µ–∫—Ü–∏–∏ `relationship_influence`.
            - –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç `test_get_npc_ai_rules_merges_defaults_and_specific_relationship_rules`.
            - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã `test_is_hostile_relationship_formula_makes_friendly` –∏ `test_is_hostile_relationship_formula_makes_hostile`.
            - –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç `test_calculate_target_score_relationship_formula_modifies_threat`.
            - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã `test_choose_action_relationship_friendly_prefers_non_attack_or_heal` –∏ `test_choose_action_relationship_hostile_prefers_strong_attack`.
        - **–î–ª—è `report_formatter.py` (`tests/core/test_report_formatter.py`)**:
            - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç `test_format_combat_action_with_check_result_and_relationship_details` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π `CheckResult` –≤ –ª–æ–≥–∞—Ö `COMBAT_ACTION`, –≤–∫–ª—é—á–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –æ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–π.

## Task 36: üé≠ 8.4 Relationship Changes Through Actions (According to Rules, Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: Implement logic for updating numerical relationship values in response to game events based on Master-configurable rules.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è `src/core/relationship_system.py`**:
        - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/relationship_system.py` —Å –±–∞–∑–æ–≤—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ (`AsyncSession`, `Relationship`, `RelationshipEntityType`, `EventType`, `crud_relationship`, `get_rule`, `log_event`) –∏ –∑–∞–≥–ª—É—à–∫–∞–º–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π `update_relationship` –∏ `_get_canonical_entity_pair`.
    - **–®–∞–≥ 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è API `update_relationship` –∏ `_get_canonical_entity_pair`**:
        - –í `src/core/relationship_system.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_get_canonical_entity_pair` –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è –ø–∞—Ä—ã —Å—É—â–Ω–æ—Å—Ç–µ–π (—Å–Ω–∞—á–∞–ª–∞ –ø–æ `entity_type.value`, –∑–∞—Ç–µ–º –ø–æ `entity_id`).
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `update_relationship`:
            - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `_get_canonical_entity_pair`.
            - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `RuleConfig` –ø–æ –∫–ª—é—á—É –≤–∏–¥–∞ `relationship_rules:{EVENT_TYPE}`.
            - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∞–≤–∏–ª–∞.
            - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç `delta`, `min_val`, `max_val`, `relationship_type` –∏–∑ –ø—Ä–∞–≤–∏–ª–∞.
            - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `crud_relationship.get_relationship_between_entities` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏.
            - –í—ã—á–∏—Å–ª—è–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `value`, –ø—Ä–∏–º–µ–Ω—è—è `delta` –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è `min_val`/`max_val`.
            - –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ—Ç `value` –∏ `source_log_id` —á–µ—Ä–µ–∑ `crud_relationship.update`.
            - –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é `Relationship` –Ω–∞–ø—Ä—è–º—É—é (–∏—Å–ø–æ–ª—å–∑—É—è `Relationship(**data)`) –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–µ—Å—Å–∏—é (`session.add`, `session.flush`, `session.refresh`).
            - –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `EventType.RELATIONSHIP_CHANGE` —á–µ—Ä–µ–∑ `game_events.log_event` —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.
    - **–®–∞–≥ 3: –≠–∫—Å–ø–æ—Ä—Ç `update_relationship`**:
        - –ú–æ–¥—É–ª—å `relationship_system` –∏ —Ñ—É–Ω–∫—Ü–∏—è `update_relationship` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∏–º–ø–æ—Ä—Ç—ã –∏ —Å–ø–∏—Å–æ–∫ `__all__` –≤ `src/core/__init__.py`. –û–±–Ω–æ–≤–ª–µ–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞ –≤ `src/core/__init__.py`.
    - **–®–∞–≥ 4: –ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è `relationship_system.py`**:
        - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_relationship_system.py`.
        - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `_get_canonical_entity_pair`.
        - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `update_relationship`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ:
            - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è.
            - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è.
            - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ `RuleConfig`.
            - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∞–≤–∏–ª–∞.
            - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (`clamping`) –ø–æ `min_val`/`max_val`.
            - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ `source_log_id` –Ω–µ –º–µ–Ω—è—é—Ç—Å—è (—É—Ç–æ—á–Ω–µ–Ω–æ: –µ—Å–ª–∏ –¥–µ–ª—å—Ç–∞ 0 –∏ `source_log_id` —Ç–æ—Ç –∂–µ).
            - –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ CRUD —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—Ç–∫–∞—Ç–∞ —Å–µ—Å—Å–∏–∏.
        - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –º–æ–∫–∏ –¥–ª—è `AsyncSession`, `crud_relationship`, `get_rule`, `log_event`.

## Task 35: üé≠ 8.3 AI Generation of Factions and Relationships (Multilang, Per Guild)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ—Ä–∞–∫—Ü–∏–∏ –∏ –∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è –¥–ª—è –≥–∏–ª—å–¥–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ Task 10 (Generation Cycle). –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –º–æ–¥–µ–ª—è—Ö `GeneratedFaction` –∏ `Relationship`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ CRUD –¥–ª—è `GeneratedFaction`**:
        - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/crud/crud_faction.py`.
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å `CRUDFaction(CRUDBase[GeneratedFaction])` —Å –º–µ—Ç–æ–¥–∞–º–∏ `get_by_static_id` –∏ `get_multi_by_guild_id`.
        - –≠–∫–∑–µ–º–ø–ª—è—Ä `crud_faction` —Å–æ–∑–¥–∞–Ω –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω.
        - `crud_faction` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/crud/__init__.py` (–∏–º–ø–æ—Ä—Ç—ã, `__all__`, –ª–æ–≥–≥–µ—Ä).
    - **–®–∞–≥ 2: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Pydantic-–º–æ–¥–µ–ª–µ–π –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ AI**:
        - –í `src/core/ai_response_parser.py`:
            - –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `ParsedFactionData(BaseGeneratedEntity)` —Å –ø–æ–ª—è–º–∏ (`static_id`, `name_i18n`, `description_i18n`, `ideology_i18n`, `leader_npc_static_id`, `resources_json`, `ai_metadata_json`) –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏.
            - –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `ParsedRelationshipData(BaseGeneratedEntity)` —Å –ø–æ–ª—è–º–∏ (`entity1_static_id`, `entity1_type`, `entity2_static_id`, `entity2_type`, `relationship_type`, `value`) –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞–º–∏.
            - `GeneratedEntity = Union[...]` –æ–±–Ω–æ–≤–ª–µ–Ω, –≤–∫–ª—é—á–∏–≤ `ParsedFactionData` –∏ `ParsedRelationshipData`.
            - `_perform_semantic_validation` –¥–æ–ø–æ–ª–Ω–µ–Ω –¥–ª—è –±–∞–∑–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ i18n –ø–æ–ª–µ–π `ParsedFactionData` –∏ –ø–æ–ª—è `value` –≤ `ParsedRelationshipData`.
    - **–®–∞–≥ 3: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø—Ä–æ–º–ø—Ç–∞ AI**:
        - –í `src/core/ai_prompt_builder.py`:
            - –í `_get_entity_schema_terms()` –¥–æ–±–∞–≤–ª–µ–Ω—ã `faction_schema` –∏ `relationship_schema`.
            - –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `async def prepare_faction_relationship_generation_prompt(session: AsyncSession, guild_id: int) -> str`.
            - –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è AI, –∑–∞–ø—Ä–∞—à–∏–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ñ—Ä–∞–∫—Ü–∏–π –∏ –∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å—Ö–µ–º JSON. –£—á–∏—Ç—ã–≤–∞–µ—Ç —è–∑—ã–∫ –≥–∏–ª—å–¥–∏–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ—Ä–∞–∫—Ü–∏–π, —Ç–µ–º—ã, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏–π.
    - **–®–∞–≥ 4: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**:
        - –í `src/core/world_generation.py`:
            - –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `async def generate_factions_and_relationships(...)`.
            - –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `prepare_faction_relationship_generation_prompt`, –º–æ–∫-–≤—ã–∑–æ–≤ AI, –∏ `parse_and_validate_ai_response`.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `GeneratedFaction` –∏ `Relationship` –≤ –ë–î —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `crud_faction` –∏ `crud_relationship`.
            - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º–∞–ø–ø–∏–Ω–≥ `static_id` –Ω–∞ `db_id` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–≤—è–∑–µ–π.
            - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `WORLD_EVENT_FACTIONS_GENERATED`.
        - –§—É–Ω–∫—Ü–∏—è `generate_factions_and_relationships` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
    - **–®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**:
        - –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Task 35 –∑–∞–ø–∏—Å–∞–Ω –≤ —Å–µ–∫—Ü–∏—é "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω".
        - –ó–∞–ø–∏—Å–∞–Ω –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è Task 35.
    - **–®–∞–≥ 6: Unit-—Ç–µ—Å—Ç—ã**:
        - **–¢–µ—Å—Ç—ã –¥–ª—è `crud_faction`**:
            - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/crud/test_crud_faction.py`.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `create`, `get`, `get_by_static_id`, `get_multi_by_guild_id`, `update`, `delete`.
            - –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
        - **–¢–µ—Å—Ç—ã –¥–ª—è Pydantic-–º–æ–¥–µ–ª–µ–π `ParsedFactionData`, `ParsedRelationshipData` –∏ —Ñ—É–Ω–∫—Ü–∏–∏ `parse_and_validate_ai_response`**:
            - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_ai_response_parser.py`.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π `ParsedFactionData` –∏ `ParsedRelationshipData`.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ `parse_and_validate_ai_response`, –≤–∫–ª—é—á–∞—è —É—Å–ø–µ—à–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏, –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Pydantic) –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é (–ø—Ä–æ–≤–µ—Ä–∫–∞ —è–∑—ã–∫–æ–≤, –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π).
            - –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
            - *–ó–∞–º–µ—á–∞–Ω–∏–µ*: –í—ã—è–≤–ª–µ–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ deprecated `parse_obj_as` –≤ Pydantic. –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏".
        - **–¢–µ—Å—Ç—ã –¥–ª—è `prepare_faction_relationship_generation_prompt` –≤ `ai_prompt_builder.py`**:
            - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_ai_prompt_builder.py`.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–º–ø—Ç–∞, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞ –≥–∏–ª—å–¥–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`, –∞ —Ç–∞–∫–∂–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
            - –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
        - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `generate_factions_and_relationships` –≤ `world_generation.py`**:
            - –î–æ–ø–æ–ª–Ω–µ–Ω —Ñ–∞–π–ª `tests/core/test_world_generation.py` (–ø–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ `unittest` —Å—Ç–∏–ª—å).
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ AI, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ—Ä–∞–∫—Ü–∏–π –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –≤ –ë–î, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è).
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è —Å–ª—É—á–∞–µ–≤ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ AI.
            - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö `static_id` —Ñ—Ä–∞–∫—Ü–∏–π.
            - –í—Å–µ —Ç–µ—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ—Ä–∞–∫—Ü–∏–π –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –ø–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏ (—Å –º–æ–∫-–æ—Ç–≤–µ—Ç–æ–º –æ—Ç AI).

---
## –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
*(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –æ—á–∏—â–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Task 35)*
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ Player.attributes_json –¥–ª—è Task 32**:
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –í —Ä–∞–º–∫–∞—Ö Task 32 –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã `/levelup`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ —É –º–æ–¥–µ–ª–∏ `Player` –ø–æ–ª—è `attributes_json` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (—Å–∏–ª–∞, –ª–æ–≤–∫–æ—Å—Ç—å –∏ —Ç.–¥.). –û–¥–Ω–∞–∫–æ —Å–∞–º–æ –ø–æ–ª–µ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã.
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
        1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `attributes_json: Mapped[Dict[str, Any]] = mapped_column(JSON, default=lambda: {}, nullable=False)` –≤ –º–æ–¥–µ–ª—å `src/models/player.py`.
        2. –°–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Alembic –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `players`.
        3. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –±–∞–∑–æ–≤—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤ `player.attributes_json` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `player_crud.create_with_defaults`, –∏—Å–ø–æ–ª—å–∑—É—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `RuleConfig` –ø–æ –∫–ª—é—á—É —Ç–∏–ø–∞ `character_attributes:base_values`).
    - **–°—Ä–æ–∫**: –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ `/levelup`. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Pydantic `parse_obj_as`**:
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –í —Ñ–∞–π–ª–µ `src/core/ai_response_parser.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ `parse_obj_as`, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –≤ Pydantic V2 –∏ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –≤ V3.0.
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**: –ó–∞–º–µ–Ω–∏—Ç—å `parse_obj_as(GeneratedEntity, entity_data)` –Ω–∞ `TypeAdapter(GeneratedEntity).validate_python(entity_data)`. –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –∏–º–ø–æ—Ä—Ç–∞ `TypeAdapter` –∏–∑ `pydantic`.
    - **–°—Ä–æ–∫**: –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Pydantic.

---
### –°—Ç—Ä—É–∫—Ç—É—Ä—ã `RuleConfig` –¥–ª—è –°–∏—Å—Ç–µ–º—ã –ö–≤–µ—Å—Ç–æ–≤ (Task 41)

1.  **–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∫ –∏ —Å–æ–±—ã—Ç–∏–π (`quest_rules:mechanic_matching:<EVENT_TYPE_NAME>`)**
    *   **–ö–ª—é—á**: `quest_rules:mechanic_matching:<EVENT_TYPE_NAME>` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `quest_rules:mechanic_matching:COMBAT_END`)
    *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –¥–µ—Ç–∞–ª–∏ –∏–∑ `StoryLog.details_json` –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ `EVENT_TYPE_NAME` –¥–æ–ª–∂–Ω—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Å –ø–æ–ª—è–º–∏ –≤ `QuestStep.required_mechanics_json.details_subset`.
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**:
        ```json
        {
            "description": "Rules for matching COMBAT_END event for quest steps.",
            "event_details_to_check": [
                {"json_path": "winning_team", "required": true},
                {"json_path": "defeated_npc_static_ids", "comparison_type": "contains_all_from_required"}
            ],
            "allow_missing_details_subset_in_step": false
        }
        ```
    *   **–ü–æ—è—Å–Ω–µ–Ω–∏—è –∫ –ø–æ–ª—è–º `event_details_to_check`**:
        *   `json_path`: –ö–ª—é—á –∏–ª–∏ –ø—É—Ç—å –∫ –ø–æ–ª—é –≤ `StoryLog.details_json`.
        *   `required`: `true`, –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.
        *   `comparison_type` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –¢–∏–ø —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ª–æ–≥–∞ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏–∑ `required_mechanics.details_subset`. –í–∞—Ä–∏–∞–Ω—Ç—ã:
            *   `"exact_match"` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): –ó–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å.
            *   `"contains_all_from_required"`: –ó–Ω–∞—á–µ–Ω–∏–µ –≤ –ª–æ–≥–µ (—Å–ø–∏—Å–æ–∫) –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `required_mechanics.details_subset` (—Å–ø–∏—Å–æ–∫).
            *   `"contains_any_from_required"`: –ó–Ω–∞—á–µ–Ω–∏–µ –≤ –ª–æ–≥–µ (—Å–ø–∏—Å–æ–∫) –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `required_mechanics.details_subset` (—Å–ø–∏—Å–æ–∫).
            *   `"has_key"`: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞ –≤ `event.details_json` (–∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `required_mechanics.details_subset` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è).
            *   `"value_greater_equal"`, `"value_less_equal"`, `"value_greater"`, `"value_less"`: –ß–∏—Å–ª–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ.
    *   `allow_missing_details_subset_in_step`: –ï—Å–ª–∏ `true` –∏ –≤ `QuestStep.required_mechanics_json` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `details_subset`, —Ç–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ `event_type` —Å—á–∏—Ç–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º.

2.  **–û—Ü–µ–Ω–∫–∞ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–π —Ü–µ–ª–∏ –∫–≤–µ—Å—Ç–∞ (–¥–ª—è `evaluation_method: "rule_based"`)**
    *   **–ö–ª—é—á**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ `QuestStep.abstract_goal_json.rule_config_key` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `quest_goals:is_faction_leader_impressed`).
    *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–π —Ü–µ–ª–∏.
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: –ú–∞—Å—Å–∏–≤ –ø—Ä–∞–≤–∏–ª, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã (–ª–æ–≥–∏–∫–∞ "–ò"). –ö–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ - –æ–±—ä–µ–∫—Ç.
        ```json
        [
            {
                "description": "Player's reputation with 'eldoria_mages' must be >= 50.",
                "evaluation_type": "player_stat_check",
                "stat_details": {
                   "type": "relationship_value",
                   "target_entity_type": "FACTION",
                   "target_entity_static_id": "eldoria_mages"
                },
                "operator": ">=",
                "required_value": 50
            },
            {
                "description": "World flag 'ancient_gate_opened' must be true.",
                "evaluation_type": "world_state_check",
                "stat_details": {
                    "type": "world_state_flag",
                    "flag_name": "ancient_gate_opened"
                },
                "operator": "==",
                "required_value": true
            },
            {
                "description": "Player must have killed at least 5 goblins of type 'goblin_grunt' during this quest step.",
                "evaluation_type": "event_aggregation",
                "event_to_aggregate": {
                    "type": "COMBAT_NPC_DEFEATED", // –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
                    "filters": [ // –§–∏–ª—å—Ç—Ä—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—á–∏—Ç–∞—Ç—å
                        {"json_path_in_event_details": "npc_static_id", "value": "goblin_grunt"}
                    ]
                },
                "aggregation_scope": "current_quest_step", // "current_quest", "since_timestamp_from_progress_data"
                "aggregation_function": "count", // "sum(field_name)", "avg(field_name)"
                "operator": ">=",
                "required_value": 5
            }
        ]
        ```
    *   **`evaluation_type`**: `player_stat_check`, `world_state_check`, `event_aggregation`.
    *   **`stat_details`**: –ö–æ–Ω–∫—Ä–µ—Ç–∏–∑–∏—Ä—É–µ—Ç, –∫–∞–∫–æ–π —Å—Ç–∞—Ç/—Ñ–ª–∞–≥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è.
    *   **`operator`**: –û–ø–µ—Ä–∞—Ç–æ—Ä —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (`==`, `!=`, `>`, `<`, `>=`, `<=`).
    *   **`required_value`**: –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

3.  **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –∫–≤–µ—Å—Ç–∞ (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ `consequences_json`)**
    *   **–ö–ª—é—á**: –ù–∞–ø—Ä–∏–º–µ—Ä, `quest_rewards:xp:easy_combat_quest`, `quest_rewards:item:potion_delivery`
    *   **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–≥—Ä–∞–¥–∞–º–∏/–ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è–º–∏, –µ—Å–ª–∏ `QuestStep.consequences_json` –∏–ª–∏ `GeneratedQuest.rewards_json` —Å–æ–¥–µ—Ä–∂–∞—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –∫–ª—é—á `RuleConfig` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.
    *   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è.
        *   –î–ª—è XP: `{"amount": 100}` –∏–ª–∏ `{"formula": "player_level * 50"}`
        *   –î–ª—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤: `[{"item_static_id": "potion_minor_heal", "quantity": 2}]`
        *   –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π: `{"target_entity_static_id": "village_elder", "target_entity_type": "NPC", "delta": 10, "relationship_type_override": "personal_respect"}`
    *   **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `_apply_quest_consequences`**: –ï—Å–ª–∏ –≤ `consequences_json` —É–∫–∞–∑–∞–Ω `rule_key` –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –∑–∞–≥—Ä—É–∑–∏—Ç—å —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.

---

## Task 34: üé≠ 8.2 Relationships Model (Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å `Relationship` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - –ú–æ–¥–µ–ª—å `src/models/relationship.py` –æ–±–Ω–æ–≤–ª–µ–Ω–∞:
        - –ü–æ–ª–µ `relationship_type_i18n` (JSONB) –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `relationship_type` (Text, default="neutral").
        - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `source_log_id` (Integer, FK –Ω–∞ `story_logs.id`, nullable, ondelete SET NULL).
        - –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–ª–µ `ai_metadata_json`.
    - Enum `RelationshipEntityType` –≤ `src/models/enums.py` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –∏ –±—ã–ª –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.
    - –§–∞–π–ª `src/models/__init__.py` –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    - –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è Alembic `alembic/versions/6344a0089ba3_update_relationships_table_fields.py` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü—ã `relationships`:
        - –£–¥–∞–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `ai_metadata_json`.
        - –£–¥–∞–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `relationship_type_i18n` –∏ —Å–æ–∑–¥–∞–µ—Ç `relationship_type` (Text).
        - –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `source_log_id` —Å –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–æ–º –∏ –∏–Ω–¥–µ–∫—Å–æ–º.
- **–°—Ç–∞—Ç—É—Å**: –ú–æ–¥–µ–ª—å –∏ –º–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã.

## Task 33: üé≠ 8.1 Factions Model (Guild-Scoped, i18n)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å `GeneratedFaction` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ñ—Ä–∞–∫—Ü–∏—è—Ö.
- **–ê–Ω–∞–ª–∏–∑**:
    - –ú–æ–¥–µ–ª—å `src/models/generated_faction.py` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
    - –ú–æ–¥–µ–ª—å –≤ `src/models/__init__.py` —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞.
    - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è `generated_factions` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `alembic/versions/fcb2e6d12a18_initial_schema_setup.py`.
- **–í—ã–≤–æ–¥**: –ó–∞–¥–∞—á–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–∞–Ω–µ–µ. –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

## Task 32: ‚ö°Ô∏è 13.3 Applying Level Up (Multy-i18n)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—á–∫–æ–≤ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è (`unspent_xp`) –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
- **–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è**:
    - –ê—Ç—Ä–∏–±—É—Ç—ã –∏–≥—Ä–æ–∫–∞ (—Å–∏–ª–∞, –ª–æ–≤–∫–æ—Å—Ç—å –∏ —Ç.–¥.) –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–æ–ª–µ `Player.attributes_json: JSONB`. (–ü–æ–ª–µ `attributes_json` –Ω–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–æ–¥–µ–ª—å `Player` –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–π –∑–∞–¥–∞—á–∏, —Ç–∞–∫ –∫–∞–∫ –ø–ª–∞–Ω –∏–∑–º–µ–Ω–∏–ª—Å—è –∏ —Å–Ω–∞—á–∞–ª–∞ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, –∞ —Ä–∞–±–æ—Ç–∞ —Å –º–æ–¥–µ–ª—å—é –≤—ã–Ω–µ—Å–µ–Ω–∞ –Ω–∞ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏–π —à–∞–≥).
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (–∏–º–µ–Ω–∞, –æ–ø–∏—Å–∞–Ω–∏—è), –∏—Ö –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–∫–∞—á–∫–∏ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ `RuleConfig`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è API `spend_attribute_points`**:
    - –í `src/core/experience_system.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `async def spend_attribute_points(session, player, attribute_name, points_to_spend, guild_id)`.
    - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `unspent_xp`, –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∞—Ç—Ä–∏–±—É—Ç–∞ (—á–µ—Ä–µ–∑ `RuleConfig` –∫–ª—é—á `character_attributes:definitions`), —Ç—Ä–∞—Ç–∏—Ç –æ—á–∫–∏, –æ–±–Ω–æ–≤–ª—è–µ—Ç `player.unspent_xp` –∏ `player.attributes_json`.
    - –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `ATTRIBUTE_POINTS_SPENT` (–Ω–æ–≤—ã–π —Ç–∏–ø –≤ `EventType`).
    - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
- **–°–æ–∑–¥–∞–Ω–∏–µ Cog `CharacterCog`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/bot/commands/character_commands.py`.
    - Cog `CharacterCog` –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `src/config/settings.py`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã `/levelup`**:
    - –í `CharacterCog` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/levelup <attribute_name: str> <points_to_spend: int>`.
    - –ö–æ–º–∞–Ω–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –∏–≥—Ä–æ–∫–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `unspent_xp`.
    - –í—ã–∑—ã–≤–∞–µ—Ç API `spend_attribute_points`.
    - –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–≥—Ä–æ–∫—É, –∏—Å–ø–æ–ª—å–∑—É—è —à–∞–±–ª–æ–Ω—ã –∏–∑ `RuleConfig` (–∫–ª—é—á–∏ —Ç–∏–ø–∞ `levelup_success`, `levelup_error_not_enough_xp` –∏ —Ç.–¥.) –∏ `localization_utils.get_localized_text`. –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è-–∑–∞–≥–ª—É—à–∫–∏.
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∞–≤–∏–ª –¥–ª—è `RuleConfig`**:
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–ª—é—á–∏ –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤: `character_attributes:definitions`, `character_attributes:base_values`, `character_attributes:cost_per_point`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–ª—é—á–∏ –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–º–∞–Ω–¥—ã: `levelup_success`, `levelup_error_no_unspent_xp`, `levelup_error_invalid_points_value`, `levelup_error_not_enough_xp`, `levelup_error_invalid_attribute`, `levelup_error_not_enough_xp_for_cost`, `levelup_error_generic`, `player_not_started_game`.
- **Unit-—Ç–µ—Å—Ç—ã**:
    - –í `tests/core/test_experience_system.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `spend_attribute_points`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –æ—à–∏–±–∫–∏ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP, –Ω–µ–≤–µ—Ä–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç, –Ω–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤), –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/test_character_commands.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/levelup`. –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–∏–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–µ—Ç –æ—á–∫–æ–≤), –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API –∏ —Å–∏—Å—Ç–µ–º–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.

## Task 30: ‚ö°Ô∏è 13.1 Experience System Structure (Rules)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∞–≤–∏–ª –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ–ø—ã—Ç–∞ (–ø–æ–ª—É—á–µ–Ω–∏–µ XP, –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤) –≤ `RuleConfig` –¥–ª—è –∫–∞–∂–¥–æ–π –≥–∏–ª—å–¥–∏–∏.
- **–ê–Ω–∞–ª–∏–∑ –º–æ–¥–µ–ª–∏ `RuleConfig`**: –ú–æ–¥–µ–ª—å `src/models/rule_config.py` (–ø–æ–ª—è `key` –∏ `value_json`) –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–∞–º–æ–π –º–æ–¥–µ–ª–∏.
- **–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –¥–ª—è –ø—Ä–∞–≤–∏–ª XP –≤ `RuleConfig`**:
    -   **–ö–ª—é—á**: `experience_system:xp_gain_rules`
        -   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –æ–ø—ã—Ç –∑–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è.
        -   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: –û–±—ä–µ–∫—Ç, –≥–¥–µ –∫–∞–∂–¥—ã–π –∫–ª—é—á - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∞—è —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `combat_victory_normal_enemy`, `combat_victory_elite_enemy`, `quest_completed_main`, `quest_completed_side`, `skill_usage_crafting`, `skill_usage_exploration`), –∞ –∑–Ω–∞—á–µ–Ω–∏–µ - –æ–±—ä–µ–∫—Ç —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.
        -   **–ü—Ä–∏–º–µ—Ä `value_json`**:
            ```json
            {
              "combat_victory_normal_enemy": {
                "base_xp": 50,
                "per_level_above_player": 10, // XP —Å–≤–µ—Ä—Ö –±–∞–∑–æ–≤–æ–≥–æ –∑–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—Ä–∞–≥–∞ –≤—ã—à–µ —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞
                "per_level_below_player": -5, // –®—Ç—Ä–∞—Ñ –∫ XP –∑–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—Ä–∞–≥–∞ –Ω–∏–∂–µ —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞ (–º–∏–Ω. 0)
                "player_level_scaling_factor": 1.0 // –ú–Ω–æ–∂–∏—Ç–µ–ª—å XP –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –∫—Ä–∏–≤–æ–π)
              },
              "quest_completed_main": {
                "base_xp": 500,
                "bonus_for_optional_objectives": 100
              },
              "skill_usage_exploration": {
                "base_xp_per_discovery": 25
              }
            }
            ```
    -   **–ö–ª—é—á**: `experience_system:level_curve`
        -   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è.
        -   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —É—Ä–æ–≤–Ω—é. –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ *—Å —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π*.
        -   **–ü—Ä–∏–º–µ—Ä `value_json`**:
            ```json
            [
              { "current_level": 1, "xp_to_reach_next_level": 1000 },
              { "current_level": 2, "xp_to_reach_next_level": 2500 },
              { "current_level": 3, "xp_to_reach_next_level": 5000 }
              // ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
            ]
            ```
            *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ*: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ XP, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: `[ { "level": 1, "total_xp_required": 0 }, { "level": 2, "total_xp_required": 1000 } ]`. –ü–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (xp_to_reach_next_level) –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—â–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ "XP –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è".
    -   **–ö–ª—é—á**: `experience_system:level_up_rewards`
        -   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–∫–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –æ—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏), –∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è.
        -   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: –û–±—ä–µ–∫—Ç, –≥–¥–µ –∫–ª—é—á `"default"` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ª—é–±–æ–≥–æ —É—Ä–æ–≤–Ω—è, –∞ —á–∏—Å–ª–æ–≤—ã–µ –∫–ª—é—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"5"`, `"10"`) –º–æ–≥—É—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏–ª–∏ –¥–æ–ø–æ–ª–Ω—è—Ç—å –Ω–∞–≥—Ä–∞–¥—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π.
        -   **–ü—Ä–∏–º–µ—Ä `value_json`**:
            ```json
            {
              "default": { // –ù–∞–≥—Ä–∞–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
                "attribute_points": 1,
                "skill_points": 2
              },
              "5": { // –û—Å–æ–±–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –Ω–∞ 5-–º —É—Ä–æ–≤–Ω–µ (–¥–æ–ø–æ–ª–Ω—è–µ—Ç –∏–ª–∏ –∑–∞–º–µ–Ω—è–µ—Ç default)
                "attribute_points": 2, // –ë–æ–ª—å—à–µ –æ—á–∫–æ–≤ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
                "skill_points": 3,
                "bonus_ability_static_id": "special_perk_level_5", // ID —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
                "notification_message_key": "level_5_milestone_reached" // –ö–ª—é—á –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
              },
              "10": {
                "feature_unlock": "new_feature_unlocked_at_level_10"
              }
            }
            ```
- **–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏**: –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç Task 30. –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ (31, 32) –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã –æ–ø—ã—Ç–∞.

## Task 31: ‚ö°Ô∏è 13.2 XP Awarding and Progress
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è.
- **–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è `experience_system.py`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/experience_system.py`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π `award_xp` –∏ `_check_for_level_up`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è API `award_xp`**:
    - –§—É–Ω–∫—Ü–∏—è `award_xp(session, guild_id, entity_id, entity_type, xp_to_award, source_event_type, source_log_id)` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤-–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π:
        - –î–ª—è `EntityType.PLAYER`: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–≥—Ä–æ–∫ –ø–æ `entity_id` –∏ `guild_id`.
        - –î–ª—è `EntityType.PARTY`: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–∞—Ä—Ç–∏—è –∏ –µ–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (`party.players`).
    - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ XP: –¥–ª—è –ø–∞—Ä—Ç–∏–∏ XP –¥–µ–ª–∏—Ç—Å—è –ø–æ—Ä–æ–≤–Ω—É (TODO: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `RuleConfig` –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫).
    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `player.xp` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞-–ø–æ–ª—É—á–∞—Ç–µ–ª—è.
    - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è `EventType.XP_GAINED` —á–µ—Ä–µ–∑ `core.game_events.log_event`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `_check_for_level_up`**:
    - –§—É–Ω–∫—Ü–∏—è `_check_for_level_up(session, guild_id, player)` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.
    - –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª `experience_system:level_curve` –∏ `experience_system:level_up_rewards` –∏–∑ `RuleConfig` (—á–µ—Ä–µ–∑ `core.rules.get_rule`).
    - –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è:
        - –ï—Å–ª–∏ `player.xp` –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Å–æ–≥–ª–∞—Å–Ω–æ `level_curve`, —É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–∞ (`player.level`) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, XP –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è.
        - –ù–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞–≥—Ä–∞–¥—ã (`player.unspent_xp` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `attribute_points` –∏–∑ `level_up_rewards`).
        - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `EventType.LEVEL_UP`.
    - –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã —Å–ª—É—á–∞–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–∞–≤–∏–ª –∏–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫—Ä–∏–≤–æ–π.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `_check_for_level_up` –≤ `award_xp`**:
    - `_check_for_level_up` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –µ–º—É XP.
    - `session.commit()` –∏ `session.refresh()` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Ü–µ `award_xp` –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤.
- **–≠–∫—Å–ø–æ—Ä—Ç API**:
    - `award_xp` –∏ –º–æ–¥—É–ª—å `experience_system` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/core/__init__.py` –∏ –≤ `__all__`.
- **Unit-—Ç–µ—Å—Ç—ã**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_experience_system.py`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –∏–≥—Ä–æ–∫—É –∏ –ø–∞—Ä—Ç–∏–∏, –ø–æ–≤—ã—à–µ–Ω–∏–µ –Ω–∞ –æ–¥–∏–Ω –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª/—Å—É—â–Ω–æ—Å—Ç–µ–π, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –Ω—É–ª–µ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ XP.

## Task 47: üõ†Ô∏è 15.1 Master Command System
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä Discord-–∫–æ–º–∞–Ω–¥ –¥–ª—è –ú–∞—Å—Ç–µ—Ä–∞ –ò–≥—Ä—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–µ–π–º–ø–ª–µ–µ–º –∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ –µ–≥–æ –≥–∏–ª—å–¥–∏–∏. –ö–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å `guild_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–æ–º–∞–Ω–¥—ã. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –¥–ª—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —è–∑—ã–∫–µ –ú–∞—Å—Ç–µ—Ä–∞. CRUD API –¥–ª—è –í–°–ï–• –º–æ–¥–µ–ª–µ–π –ë–î. API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `RuleConfig`. –ö–æ–º–∞–Ω–¥—ã —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞/–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –í –ö–û–ù–¢–ï–ö–°–¢–ï `guild_id`. API `/master resolve_conflict <id> <outcome>` –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö–æ–¥–æ–≤.
- **–ü–ª–∞–Ω (–æ–±–æ–±—â–µ–Ω–Ω—ã–π –ø–æ –∏—Ç–æ–≥–∞–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)**:
    1.  –ê–Ω–∞–ª–∏–∑ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–º–∞–Ω–¥–∞–º–∏.
    2.  –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ Cog'–∏ –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∫–∞–∫ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π —à–∞–≥ –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç—å—é –∑–∞–¥–∞—á–∏).
    3.  –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è CRUD-–∫–æ–º–∞–Ω–¥ (Create, Read, Update, Delete) –¥–ª—è –∫–∞–∂–¥–æ–π –∑–Ω–∞—á–∏–º–æ–π –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö.
    4.  –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –≤–∏–¥–∏–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ú–∞—Å—Ç–µ—Ä—É).
    5.  –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/master_conflict resolve` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å `action_processor.py`.
    6.  –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏/–∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏ –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.
    7.  –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–º–∞–Ω–¥**: –ö–æ–º–∞–Ω–¥—ã –º–∞—Å—Ç–µ—Ä–∞ –±—ã–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ –æ–¥–Ω–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ Cog'–∏, —Ä–∞–∑–º–µ—â–µ–Ω–Ω—ã–µ –≤ `src/bot/commands/master_commands/`, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `player_master_commands.py`, `item_master_commands.py` –∏ —Ç.–¥.). –ö–∞–∂–¥–∞—è –≥—Ä—É–ø–ø–∞ –∫–æ–º–∞–Ω–¥ –ø–æ–ª—É—á–∏–ª–∞ —Å–≤–æ–π –ø—Ä–µ—Ñ–∏–∫—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/master_player`, `/master_item`).
    - **CRUD –∫–æ–º–∞–Ω–¥—ã**:
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ CRUD (Create, Read, Update, Delete) –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π:
            - `Player` (`player_master_commands.py`): create, view, list, update, delete.
            - `Party` (`party_master_commands.py`): create, view, list, update, delete. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `properties_json` –≤ –º–æ–¥–µ–ª—å –∏ –º–∏–≥—Ä–∞—Ü–∏—é.
            - `Item` (`item_master_commands.py`): create, view, list, update, delete.
            - `RuleConfig` (`ruleconfig_master_commands.py`): get, set, list, delete.
            - `Ability` (`ability_master_commands.py`): create, view, list, update, delete. –ú–æ–¥–µ–ª—å `Ability` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (–ø–æ–ª–µ `type`, `guild_id` nullable), —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è.
            - `PendingConflict` (`conflict_master_commands.py`): view, list, resolve.
            - `Faction` (`faction_master_commands.py`): create, view, list, update, delete.
            - `GeneratedNpc` (`npc_master_commands.py`): create, view, list, update, delete.
            - `Location` (`location_master_commands.py`): create, view, list, update, delete.
            - `Questline`, `GeneratedQuest`, `QuestStep`, `PlayerQuestProgress` (`quest_master_commands.py`): –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π CRUD –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∫–≤–µ—Å—Ç–∞–º–∏.
            - `InventoryItem` (`inventory_master_commands.py`): view, list, update (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ), delete. Create –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –¥—Ä—É–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/master_item give`).
            - `Relationship` (`relationship_master_commands.py`): create, view, list, update, delete.
            - `StatusEffect` (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è) (`status_effect_master_commands.py`): create, view, list, update, delete. –ú–æ–¥–µ–ª—å `StatusEffect` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (`guild_id` nullable), —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è.
            - `ActiveStatusEffect` (–ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã): –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã —Å—É—â–Ω–æ—Å—Ç–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/master_player apply_status`). –û—Ç–¥–µ–ª—å–Ω–æ–≥–æ CRUD –¥–ª—è `ActiveStatusEffect` –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–æ—Å—å, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏.
            - `StoryLog` (`story_log_master_commands.py`): view, list. Create –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, update/delete –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –¥–ª—è –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥.
            - `CraftingRecipe` (`master_crafting_recipe_commands.py`): create, view, list, update, delete. –°–æ–∑–¥–∞–Ω CRUD `crud_crafting_recipe.py`.
            - `Skill` (`master_skill_commands.py`): create, view, list, update, delete. –°–æ–∑–¥–∞–Ω CRUD `crud_skill.py`.
            - `PlayerNpcMemory` (`master_memory_commands.py`): view, list, delete. –°–æ–∑–¥–∞–Ω CRUD `crud_player_npc_memory.py`.
        - –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `interaction.guild_id` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
        - –î–ª—è –ø–æ–ª–µ–π JSON (`attributes_json`, `properties_json` –∏ —Ç.–¥.) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º.
    - **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**:
        - –ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –æ—à–∏–±–∫–∏, –º–µ—Ç–∫–∏ –ø–æ–ª–µ–π –≤ —ç–º–±–µ–¥–∞—Ö) –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `get_localized_message_template`.
        - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è "N/A", "None", "All", "Global", "Guild (ID)" –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –ª–æ–∫–∞–ª–∏–∑—É–µ–º—ã–µ –∫–ª—é—á–∏.
    - **–ú–µ—Ö–∞–Ω–∏–∑–º —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è `/master_conflict resolve`**:
        - `action_processor.py` (`process_actions_for_guild`): –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö `PendingConflict` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING_RESOLUTION` –¥–ª—è –≥–∏–ª—å–¥–∏–∏. –ï—Å–ª–∏ —Ç–∞–∫–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –µ—Å—Ç—å, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ö–æ–¥–∞ –¥–ª—è –≥–∏–ª—å–¥–∏–∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.
        - `conflict_master_commands.py` (`resolve_conflict`): –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ (–∏–∑–º–µ–Ω–µ–Ω–∏—è –µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞), –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –¥—Ä—É–≥–∏–µ –Ω–µ—Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –¥–ª—è –¥–∞–Ω–Ω–æ–π –≥–∏–ª—å–¥–∏–∏. –ï—Å–ª–∏ –Ω–µ—Ç, –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `turn_controller.trigger_guild_turn_processing` –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö–æ–¥–∞.
    - **Unit-—Ç–µ—Å—Ç—ã**:
        - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/master_commands/test_master_player_commands.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/master_player create`, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CRUD –∫–æ–º–∞–Ω–¥.
        - –í `tests/core/test_action_processor.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö–æ–¥–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.
        - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/master_commands/test_master_conflict_commands.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–º–∞–Ω–¥–µ `/master_conflict resolve`.
    - **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ —É—Ç–∏–ª–∏—Ç—ã**:
        - –í `src/bot/utils.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `parse_json_parameter` –¥–ª—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö JSON-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–º–∞–Ω–¥–∞—Ö, –≤–∫–ª—é—á–∞—è –ø–∞—Ä—Å–∏–Ω–≥ –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫.
        - –ö–æ–º–∞–Ω–¥–∞ `/master_player create` –±—ã–ª–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π —É—Ç–∏–ª–∏—Ç—ã.
- **–°—Ç–∞—Ç—É—Å**: –ó–∞–¥–∞—á–∞ 47 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –º–∞—Å—Ç–µ—Ä-–∫–æ–º–∞–Ω–¥, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –∫–ª—é—á–µ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é –∏ –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤. –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã `parse_json_parameter` –∫–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è –≤ –ø–ª–∞–Ω–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏
- **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã**: –í—ã—è–≤–ª–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –¥–≤—É—Ö —Ñ–∞–π–ª–æ–≤ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: `src/bot/general_commands.py` (–∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã) –∏ `src/bot/commands/general_commands.py` (–∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥—ã –∏ –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥). –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `src/config/settings.py` –∑–∞–≥—Ä—É–∂–∞–ª–∏ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é (`src/bot/general_commands.py`).
- **–ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥**:
    - –ö–æ–º–∞–Ω–¥–∞ `ping` –∏–∑ `src/bot/general_commands.py` –±—ã–ª–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ `src/bot/commands/general_commands.py`.
    - –ö–æ–º–∞–Ω–¥–∞ `ping` –±—ã–ª–∞ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞–∫ —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥–∞ (`app_command`) –≤ `GeneralCog`.
    - –§–∞–π–ª `src/bot/commands/general_commands.py` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–æ–º–∞–Ω–¥ `start` –∏ `ping` –≤ –≤–∏–¥–µ —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–≥–æ–≤**:
    - –í —Ñ–∞–π–ª–µ `src/config/settings.py` —Å–ø–∏—Å–æ–∫ `BOT_COGS` –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–≥–∞ –∏–∑ `src.bot.commands.general_commands`.
    - –£–¥–∞–ª–µ–Ω–∞ –∑–∞–ø—É—Ç–∞–Ω–Ω–∞—è —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π –∫–æ–≥–æ–≤.
- **–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**:
    - –§–∞–π–ª `src/bot/general_commands.py` –±—ã–ª —É–¥–∞–ª–µ–Ω.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤**:
    - –û–±–Ω–∞—Ä—É–∂–µ–Ω –∏–º–ø–æ—Ä—Ç —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–≥–∞ (`CommandCog` –∏–∑ `src.bot.general_commands`) –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ `tests/bot/test_general_commands_mocked.py`.
    - –£—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `tests/bot/test_general_commands_mocked.py` –±—ã–ª —É–¥–∞–ª–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è.
- **–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤**:
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `GeneralCog` –≤ `src/bot/commands/general_commands.py`, –≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç—ã –¥–ª—è —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥ `/ping` –∏ `/start` —Å —É—á–µ—Ç–æ–º –∏—Ö –ª–æ–≥–∏–∫–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Discord API –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

## Task 1.2: üåç Player and Party System (ORM, Commands, Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 1.2.
- **–ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:
    - –ú–æ–¥–µ–ª–∏ `Player` (`src/models/player.py`) –∏ `Party` (`src/models/party.py`) —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
    - –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –¥–ª—è —ç—Ç–∏—Ö –º–æ–¥–µ–ª–µ–π —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    - –£—Ç–∏–ª–∏—Ç—ã `get_player`, `get_party`, `get_players_in_location` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ CRUD-–º–æ–¥—É–ª–∏.
    - –ö–æ–º–∞–Ω–¥—ã Discord `/start` –∏ `/party` (create, leave, disband, join) —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.
    - **–í—ã—è–≤–ª–µ–Ω –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π, CRUD –∏ –∫–æ–º–∞–Ω–¥, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å Player –∏ Party.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/models/test_player.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –º–æ–¥–µ–ª–∏ `Player`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/models/test_party.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –º–æ–¥–µ–ª–∏ `Party`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/crud/test_crud_player.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `CRUDPlayer`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/crud/test_crud_party.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `CRUDParty`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/test_general_commands.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/start`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/test_party_commands.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥ `/party`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**: –û–±–Ω–æ–≤–ª–µ–Ω "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –¥–ª—è Task 1.2.

## Task 1.1: üåç Location Model (i18n, Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 1.1.
- **–ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –ü–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–∞–π–ª `src/models/location.py`: –ú–æ–¥–µ–ª—å `Location` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–∞–π–ª `src/core/locations_utils.py`: –£—Ç–∏–ª–∏—Ç—ã `get_location`, `get_location_by_static_id`, `get_localized_text` —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic (`alembic/versions/`): –ú–∏–≥—Ä–∞—Ü–∏–∏ `fcb2e6d12a18_initial_schema_setup.py` (—Å–æ–∑–¥–∞–Ω–∏–µ) –∏ `0005_use_jsonb_for_location_fields.py` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ JSONB) —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ç–µ—Å—Ç—ã: `tests/models/test_location.py` –∏ `tests/core/test_locations_utils.py` —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã.
- **–í—ã–≤–æ–¥**: –ó–∞–¥–∞—á–∞ 1.1 –±—ã–ª–∞ —Ä–∞–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –Ω–æ –Ω–µ –æ—Ç–º–µ—á–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**: –û–±–Ω–æ–≤–ª–µ–Ω "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –∑–∞–¥–∞—á–∏.

## Task 29: ‚öîÔ∏è 5.4 Combat Cycle Refactoring (Multiplayer Combat State Machine)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 29: Combat Cycle Refactoring.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 29.
- **–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è `combat_cycle_manager.py`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/combat_cycle_manager.py` —Å –±–∞–∑–æ–≤—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏, –ª–æ–≥–≥–µ—Ä–æ–º –∏ –∑–∞–≥–ª—É—à–∫–∞–º–∏ –¥–ª—è –∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–∏—Å—Ç–µ–º (XP, Loot, Relationships, WorldState, Quests).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `start_combat` API**:
    - –í `src/core/combat_cycle_manager.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `start_combat`.
    - –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å `CombatEncounter`, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (`participants_json`) –∏ –∏—Ö –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—ã.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã (dice roll + dex modifier) –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `turn_order_json`.
    - –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–Ω–∏–º–æ–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –±–æ–µ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –≤ `rules_config_snapshot_json`.
    - –°—Ç–∞—Ç—É—Å `CombatEncounter` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `ACTIVE`. –°—Ç–∞—Ç—É—Å—ã —É—á–∞—Å—Ç–≤—É—é—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ (`PlayerStatus.IN_COMBAT`) –∏ –ø–∞—Ä—Ç–∏–π (`PartyTurnStatus.IN_COMBAT`) –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.
    - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `COMBAT_START`.
    - –§—É–Ω–∫—Ü–∏—è `start_combat` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `start_combat` —Å `action_processor.py`**:
    - –í `src/core/crud/crud_combat_encounter.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_active_combat_for_entity` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Å—É—â–Ω–æ—Å—Ç—å —É–∂–µ –≤ –±–æ—é.
    - –í `src/core/action_processor.py` —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `_handle_attack_action_wrapper` –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ "attack".
    - `_handle_attack_action_wrapper` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–µ–ª—å –∞—Ç–∞–∫–∏, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–æ—è –¥–ª—è –∞–∫—Ç–æ—Ä–∞ –∏–ª–∏ —Ü–µ–ª–∏.
    - –ï—Å–ª–∏ –±–æ–π –Ω–µ –Ω–∞—á–∞—Ç, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `combat_cycle_manager.start_combat`. –ó–∞—Ç–µ–º –ø–µ—Ä–≤–∞—è –∞—Ç–∞–∫–∞ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `combat_engine.process_combat_action`.
    - –ï—Å–ª–∏ –±–æ–π —É–∂–µ –∏–¥–µ—Ç, –∏ —ç—Ç–æ —Ö–æ–¥ –∞—Ç–∞–∫—É—é—â–µ–≥–æ, –∞—Ç–∞–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `combat_engine.process_combat_action`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `process_combat_turn` API –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**:
    - –í `src/core/combat_cycle_manager.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `process_combat_turn`.
    - –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç `CombatEncounter`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ —Å—Ç–∞—Ç—É—Å.
    - –ï—Å–ª–∏ —Ö–æ–¥ NPC: –≤—ã–∑—ã–≤–∞–µ—Ç `npc_combat_strategy.get_npc_combat_action`, –∑–∞—Ç–µ–º `combat_engine.process_combat_action`.
    - –ü–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è (–∏–≥—Ä–æ–∫–∞ –∏–ª–∏ NPC) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `session.refresh(combat_encounter)`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_check_combat_end` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–æ—è –∏ –ø–æ–±–µ–¥–∏–≤—à–µ–π –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ `participants_json`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_advance_turn` –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∂–∏–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `current_turn_entity_id/type`, `current_index` –∏ `current_turn_number`.
    - –ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è —Ö–æ–¥–∞ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç —Ö–æ–¥ NPC, `process_combat_turn` —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö–æ–¥–∞ —ç—Ç–æ–≥–æ NPC (–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö, –ø–æ–∫–∞ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏—Ç —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞ –∏–ª–∏ –∫–æ–Ω–µ—Ü –±–æ—è).
    - –§—É–Ω–∫—Ü–∏—è `process_combat_turn` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `_handle_combat_end_consequences`**:
    - –í `src/core/combat_cycle_manager.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_handle_combat_end_consequences`.
    - –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö.
    - –í—ã–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º XP (`xp_awarder.award_xp`), –ª—É—Ç–∞ (`loot_generator.distribute_loot`), –æ—Ç–Ω–æ—à–µ–Ω–∏–π (`relationship_updater.update_relationships_post_combat`), —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏—Ä–∞ (`world_state_updater.update_world_state_post_combat`) –∏ –∫–≤–µ—Å—Ç–æ–≤ (`quest_system.handle_combat_event_for_quests`).
    - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –±–æ–µ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏–≥—Ä–æ–∫–æ–≤ –∏ –ø–∞—Ä—Ç–∏–π.
    - –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `COMBAT_END`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤—ã–∑–æ–≤–∞ `process_combat_turn`**:
    - –í `src/core/action_processor.py` (–≤ `_handle_attack_action_wrapper`) –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –±–æ—é –∏–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤ –Ω–æ–≤–æ–º –±–æ—é —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `combat_cycle_manager.process_combat_turn` –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_combat_cycle_manager.py`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `start_combat` (—É—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–∞—Å—á–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).
    - –ù–∞–ø–∏—Å–∞–Ω —Å–∫–µ–ª–µ—Ç —Ç–µ—Å—Ç–∞ –¥–ª—è `process_combat_turn` —Å –º–æ–∫–∞–º–∏ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `_check_combat_end` –∏ `_advance_turn`.
    - –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–∞—Ä—Ç–∏–∏ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –±–æ—è.

## Task 28: ‚öîÔ∏è 5.3 NPC Combat Strategy Module (AI)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 28: NPC Combat Strategy Module.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 28, –≤–∫–ª—é—á–∞—é—â–∏–π –∞–Ω–∞–ª–∏–∑, –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ñ—É–Ω–∫—Ü–∏–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏, –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.
- **–ê–Ω–∞–ª–∏–∑ Task 28**: –ò–∑—É—á–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `get_npc_combat_action`, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π (NPC, CombatEncounter, RuleConfig, Relationship, CheckResolver) –∏ –¥–∞–Ω–Ω—ã—Ö (—Å—Ç–∞—Ç—ã NPC, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—è, –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è AI).
- **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è `npc_combat_strategy.py`**:
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `get_npc_combat_action`.
    - –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: `_get_npc_data`, `_get_combat_encounter_data`, `_get_participant_entity`, `_get_relationship_value`, `_get_npc_ai_rules`, `_is_hostile`, `_get_potential_targets`, `_calculate_target_score`, `_select_target`, `_get_available_abilities`, `_simulate_action_outcome`, `_evaluate_action_effectiveness`, `_choose_action`, `_format_action_result`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö**:
    - –í `src/core/npc_combat_strategy.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `_get_npc_data`, `_get_combat_encounter_data`, `_get_participant_entity`, `_get_relationship_value`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_get_npc_ai_rules` —Å –±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig` (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `core.rules.get_rule`), –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –ø—Ä–æ—Å—Ç—ã—Ö –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–∏—á–Ω–æ—Å—Ç–∏ NPC.
    - –ú–æ–¥—É–ª—å `npc_combat_strategy` –∏ —Ñ—É–Ω–∫—Ü–∏—è `get_npc_combat_action` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/core/__init__.py`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏ (Aggro System)**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_is_hostile` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏ —Ü–µ–ª–∏ (—É—á–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–π, —Ñ—Ä–∞–∫—Ü–∏–π, –ø—Ä–∞–≤–∏–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_get_potential_targets` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–∞–∂–¥–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–µ–±—è, –ø–æ–±–µ–∂–¥–µ–Ω–Ω—ã—Ö, –Ω–µ–≤—Ä–∞–∂–¥–µ–±–Ω—ã—Ö).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_calculate_target_score` –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ü–µ–ª–µ–π –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –º–µ—Ç—Ä–∏–∫–∞–º (HP (–ø—Ä–æ—Ü–µ–Ω—Ç/–∞–±—Å–æ–ª—é—Ç), —É–≥—Ä–æ–∑–∞). –ú–µ—Ç—Ä–∏–∫–∞ —É–≥—Ä–æ–∑—ã (`highest_threat_score`) –≤–∫–ª—é—á–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (—É—Ä–æ–Ω –ø–æ —Å–µ–±–µ, —Ä–æ–ª—å —Ü–µ–ª–∏, –Ω–∏–∑–∫–æ–µ HP —Ü–µ–ª–∏, –æ—Ç–Ω–æ—à–µ–Ω–∏—è).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_select_target` –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–∞–∏–ª—É—á—à–µ–π —Ü–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –º–µ—Ç—Ä–∏–∫ –∏–∑ AI-–ø—Ä–∞–≤–∏–ª.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_get_available_abilities` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π NPC —Å —É—á–µ—Ç–æ–º –∫—É–ª–¥–∞—É–Ω–æ–≤ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_simulate_action_outcome` (placeholder) –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —à–∞–Ω—Å–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –∏ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —É—Ä–æ–Ω–∞.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_evaluate_action_effectiveness` –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –æ–±—â–µ–π –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è (—É—Ä–æ–Ω, —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—É—Å–æ–≤/–ª–µ—á–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_choose_action` –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–∞–∏–ª—É—á—à–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö (–∞—Ç–∞–∫–∞, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–º–æ–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º HP).
- **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_format_action_result` –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç, –æ–∂–∏–¥–∞–µ–º—ã–π `CombatEngine`.
    - –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `get_npc_combat_action` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_npc_combat_strategy.py`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –º–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (`mock_session`, `mock_actor_npc`, `mock_target_player`, `mock_combat_encounter`, `mock_ai_rules` –∏ –¥—Ä.).
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `_get_available_abilities` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–Ω—ã, –∫—É–ª–¥–∞—É–Ω–æ–≤).
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `_is_hostile` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π, —Ñ—Ä–∞–∫—Ü–∏–π).
    - –ù–∞–ø–∏—Å–∞–Ω –±–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç –¥–ª—è `_get_potential_targets`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `get_npc_combat_action`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: —É—Å–ø–µ—à–Ω—ã–π –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è, –ø–æ–±–µ–∂–¥–µ–Ω–Ω—ã–π NPC, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª–µ–π.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–º—ã—Å–ª–µ–Ω–Ω–∞—è)**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ `npc_combat_strategy` —Å `CombatEngine`. –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ç–æ—á–∫–∏ –≤—ã–∑–æ–≤–∞, —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –û—Ç–º–µ—á–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `CombatEncounter.participants_json` –º–æ–¥—É–ª–µ–º `CombatEngine`.

## Task 27: ‚öîÔ∏è 5.2 Combat Engine Module
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 27.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 27.
- **–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ò–∑—É—á–µ–Ω—ã –º–æ–¥–µ–ª–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã.
- **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `process_combat_action`**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**: –§—É–Ω–∫—Ü–∏–∏ `_get_combat_rule`, `_calculate_attribute_modifier`, `_get_participant_stat` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `CombatActionResult`**: –ú–æ–¥–µ–ª–∏ `CheckResult` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã, –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏**: –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—ã–∑–æ–≤—ã –∫ –¥—Ä—É–≥–∏–º –º–æ–¥—É–ª—è–º.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**: –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–∞—Ä–∫–∞—Å –¥–ª—è `process_combat_action`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `process_combat_action`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `process_combat_action` –≤ `src/core/combat_engine.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è "attack", –≤–∫–ª—é—á–∞—è —Ä–∞—Å—á–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è, —É—Ä–æ–Ω–∞, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–¥–∞—Ä–æ–≤ (—Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏) –∏ –ø—Ä–æ–º–∞—Ö–æ–≤.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –Ω–µ –Ω–∞–π–¥–µ–Ω –±–æ–π, –∞–∫—Ç–æ—Ä, —Ü–µ–ª—å; —Ü–µ–ª—å —É–∂–µ –ø–æ–±–µ–∂–¥–µ–Ω–∞; –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è.
    - HP —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `CombatEncounter.participants_json`.
    - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–æ—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `CombatEncounter.combat_log_json` –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π `StoryLog`.
    - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏ –≤ `src/core/__init__.py`.
    - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤ –∏–∑-–∑–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ –∫—Ä–∏—Ç. —É–¥–∞—Ä–∞, –ø—Ä–∏–≤–æ–¥–∏–≤—à–∞—è –∫ –Ω–µ–≤–µ—Ä–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—ã–∑–æ–≤–æ–≤ `roll_dice`.
    - –í—Å–µ 15 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_combat_engine.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**: –û–±–Ω–æ–≤–ª–µ–Ω –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –∏ –æ—á–∏—â–µ–Ω —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (–ø–æ—Å–ª–µ Task 22 –∏ 25)
- **–ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–∞ Pyright**: –í—ã—è–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ `src/core/ability_system.py`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞**:
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `get_entity_stat`, `change_entity_stat` –∏–∑ `src.core.entity_stats_utils`.
    - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `func` –∏–∑ `sqlalchemy.sql`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏**:
    - –£–¥–∞–ª–µ–Ω–∞ –ª–∏—à–Ω—è—è –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –≤ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –±–ª–æ–∫–µ –∫–æ–¥–∞ (—Ä–∞–π–æ–Ω —Å—Ç—Ä–æ–∫–∏ 385), –≤—ã–∑—ã–≤–∞–≤—à–∞—è –æ—à–∏–±–∫—É "Expected expression".
- **–û–±–∑–æ—Ä –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∞**:
    - –£–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è (—Å—Ç–∞—Ä–∞—è, –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è) —Ñ—É–Ω–∫—Ü–∏—è `activate_ability`.
    - –ü–∞—Ä–∞–º–µ—Ç—Ä `ability_id` –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `activate_ability` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `ability_identifier` —Å —Ç–∏–ø–æ–º `Union[int, str]` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ª–æ–≥–∏–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –∏–º–ø–æ—Ä—Ç `PlayerStatus` –∏–∑ `src.models.enums` –≤ `src/core/ability_system.py` (–±—ã–ª –Ω–∞ –º–µ—Å—Ç–µ, –æ—à–∏–±–∫–∞ Pylance, –≤–µ—Ä–æ—è—Ç–Ω–æ, –∏–∑-–∑–∞ –∫—ç—à–∞).

## –ó–∞–¥–∞—á–∞ 25: üó∫Ô∏è 4.3 Location Transitions (Guild-Scoped)
- **–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ Task 25.
    - –ò–∑—É—á–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `execute_move_for_player_action` –≤ `src/core/movement_logic.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏. –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ - –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏.
- **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `execute_move_for_player_action` (–¥–æ—Ä–∞–±–æ—Ç–∫–∞)**:
    - –í `execute_move_for_player_action` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏ –∏–∑ `RuleConfig` (–∫–ª—é—á `rules:party:movement:policy`).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ `"leader_only"`: –¥–≤–∏–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä —è–≤–ª—è–µ—Ç—Å—è –ª–∏–¥–µ—Ä–æ–º –ø–∞—Ä—Ç–∏–∏ (`party.leader_player_id == player.id`).
    - –î–ª—è —ç—Ç–æ–≥–æ –≤ –º–æ–¥–µ–ª—å `Party` (`src/models/party.py`) –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `leader_player_id` (ForeignKey –∫ `players.id`) –∏ —Å–≤—è–∑—å `leader`.
    - –°–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic (`7c27451a6727_add_leader_player_id_to_party.py`) –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è.
    - –ü–æ–ª–∏—Ç–∏–∫–∞ `"any_member"` (–ª—é–±–æ–π —á–ª–µ–Ω –ø–∞—Ä—Ç–∏–∏ –º–æ–∂–µ—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ) –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `execute_move_for_player_action` –≤ `action_processor.py`. –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å.
- **Unit-—Ç–µ—Å—Ç—ã**:
    - –û–±–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω —Ñ–∞–π–ª `tests/core/test_movement_logic.py`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `execute_move_for_player_action`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —É—Å–ø–µ—à–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (—Å–æ–ª–æ –∏ –≤ –ø–∞—Ä—Ç–∏–∏), –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤–∏–ª –ø–∞—Ä—Ç–∏–∏ ("leader_only", "any_member"), –æ—à–∏–±–∫–∏ (–ª–æ–∫–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –Ω–µ—Ç —Å–≤—è–∑–∏).
    - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `_find_location_by_identifier` (–ø–æ–∏—Å–∫ –ø–æ static_id, –ø–æ –∏–º–µ–Ω–∏ —Å —É—á–µ—Ç–æ–º —è–∑—ã–∫–∞ –∏ fallback).

## –ó–∞–¥–∞—á–∞ 22: üß† 3.3 API for Activating Abilities and Applying Statuses (Guild-Scoped)
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ `ability_system.py`**:
    - –§—É–Ω–∫—Ü–∏–∏ `activate_ability_v2` –∏ `apply_status_v2` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤ `activate_ability` –∏ `apply_status` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ; —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ —É–¥–∞–ª–µ–Ω—ã.
    - –í –º–æ–¥–µ–ª—å `ActiveStatusEffect` (`src/models/status_effect.py`) –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `source_entity_id` –∏ `source_entity_type` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–∞.
    - –°–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic `b3920fb77c09_add_source_entity_to_active_status_.py` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –ë–î.
    - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª `src/core/entity_stats_utils.py` —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è HP –∏ –¥—Ä—É–≥–∏—Ö —Å—Ç–∞—Ç–æ–≤/—Ä–µ—Å—É—Ä—Å–æ–≤ —É —Å—É—â–Ω–æ—Å—Ç–µ–π (`Player`, `GeneratedNpc`).
    - –§—É–Ω–∫—Ü–∏—è `activate_ability` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `change_entity_hp` –∏–∑ `entity_stats_utils`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ `activate_ability`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ (–ø–æ–ª–µ `cost` –∏–∑ `properties_json` —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `get_entity_stat` –∏ `change_entity_stat`. –í —Å–ª—É—á–∞–µ –Ω–µ—Ö–≤–∞—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è.
    - –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ "caster_must_be_in_combat" –Ω–∞ –æ—Å–Ω–æ–≤–µ `RuleConfig` –∏ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞—Å—Ç–µ—Ä–∞ (`Player.current_status` –∏–ª–∏ `GeneratedNpc.properties_json["stats"]["status"]`).
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏-TODO –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–∞—Å—Ç–µ—Ä—É, –∫—É–ª–¥–∞—É–Ω—ã).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤ `activate_ability`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `effect_data.target_scope` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è "self", "first_target", "all_targets").
    - –≠—Ñ—Ñ–µ–∫—Ç "damage": –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `change_entity_hp` –¥–ª—è –Ω–∞–Ω–µ—Å–µ–Ω–∏—è —É—Ä–æ–Ω–∞. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è `outcome.damage_dealt`.
    - –≠—Ñ—Ñ–µ–∫—Ç "healing": –¥–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–∏–ø —ç—Ñ—Ñ–µ–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `change_entity_hp` –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è HP. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è `outcome.healing_done`.
    - –≠—Ñ—Ñ–µ–∫—Ç "apply_status": –≤—ã–∑—ã–≤–∞–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é `apply_status`, –ø–µ—Ä–µ–¥–∞–≤–∞—è `status_static_id` –∏ `duration` –∏–∑ `effect_data`. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è `outcome.applied_statuses`.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `apply_status`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞ –Ω–∞ —Ü–µ–ª–∏.
    - –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ `StatusEffect.properties_json` —Å–æ–¥–µ—Ä–∂–∏—Ç `duration_refresh: true`, —Ç–æ —É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ `ActiveStatusEffect` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è `duration_turns`, `remaining_turns`, `applied_at` –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–µ. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ (–µ—Å–ª–∏ `duration_refresh: false` –∏–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ), –∏ —Å—Ç–∞—Ç—É—Å —É–∂–µ –µ—Å—Ç—å, –Ω–æ–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `False`).
    - –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π `ActiveStatusEffect`.
    - –ü–æ–ª—è `source_entity_id` –∏ `source_entity_type` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è.
    - –ü–æ–ª–µ `remaining_turns` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º `duration_turns`.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `remove_status`**:
    - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ `active_status_id`) –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏ –¥–ª—è Task 22.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ `AbilityOutcomeDetails` –≤ `activate_ability`**:
    - `AbilityOutcomeDetails` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ `damage_dealt`, `healing_done`, `applied_statuses`, `caster_updates`.
    - –û–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–Ω–µ—É–¥–∞—á–µ –≤ `outcome.message` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.
    - `log_event_details` –≤ `AbilityOutcomeDetails` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π JSON –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ `StoryLog`.
    - –í—ã–∑–æ–≤ `log_event` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∫–æ–Ω—Ü–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ `activate_ability` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Å–µ—Å—Å–∏—é –∏ –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π (commit/rollback), —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_ability_system.py`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è `activate_ability`, `apply_status` –∏ `remove_status`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—É—Å–ø–µ—Ö, –Ω–µ—Ö–≤–∞—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤.

## –ó–∞–¥–∞—á–∞ 19 / –ó–∞–¥–∞—á–∞ 54 (Log and Feedback Formatting): –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- –í—ã–ø–æ–ª–Ω–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md` –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.
- –ó–∞–¥–∞—á–∞ 54 ("‚öôÔ∏è 6.7.1 Log and Feedback Formatting System (Full, Multy-i18n, Guild-Scoped)") —É–¥–∞–ª–µ–Ω–∞ –∏–∑ `Tasks.txt`.
- –ó–∞–ø–∏—Å—å –æ Task 19 ("üìö 7.3 Turn and Report Formatting (Guild-Scoped)") –≤ `Done.txt` –ø—Ä–∏–∑–Ω–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏ –ø–æ–ª–Ω–æ–π.
- –°–µ–∫—Ü–∏—è "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –≤ `AGENTS.md` –æ—á–∏—â–µ–Ω–∞.

## –ó–∞–¥–∞—á–∞ 19 (–†–∞–Ω–µ–µ): üìö 7.3 Turn and Report Formatting (Guild-Scoped)
- **–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
    - –ò–∑—É—á–µ–Ω—ã `src/models/story_log.py`, `src/models/enums.py` (–¥–ª—è `EventType`), `src/core/rules.py`, `src/core/localization_utils.py`, `src/core/report_formatter.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã.
    - –í—ã–≤–æ–¥: –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –¥–ª—è Task 19 —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤–∫–ª—é—á–∞—è `get_localized_entity_name`, `get_batch_localized_entity_names`, `_format_log_entry_with_names_cache` (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –º–Ω–æ–≥–∏—Ö `EventType`), `format_turn_report` –∏ `_collect_entity_refs_from_log_entry`. –ó–∞–¥–∞—á–∞ —Å–≤–æ–¥–∏—Ç—Å—è –∫ –¥–æ—Ä–∞–±–æ—Ç–∫–µ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ `get_localized_entity_name`**:
    - –§—É–Ω–∫—Ü–∏–∏ `get_localized_entity_name` –∏ `get_batch_localized_entity_names` –≤ `src/core/localization_utils.py` –ø—Ä–∏–∑–Ω–∞–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `_format_log_entry_with_names_cache` –≤ `src/core/report_formatter.py`**:
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–ª–∏ —É–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö `EventType`: `NPC_ACTION`, `ITEM_USED`, `ITEM_DROPPED`, `DIALOGUE_START`, `DIALOGUE_END`, `FACTION_CHANGE`.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–ª—è –∏–≥—Ä–æ–∫–∞ —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SYSTEM_EVENT`, —Å–æ–±—ã—Ç–∏—è AI, —Å–æ–±—ã—Ç–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π), –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–æ–¥–∏—Ç —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ `details_json`.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_report_formatter.py` –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ `format_turn_report`**:
    - –§—É–Ω–∫—Ü–∏—è `format_turn_report` –≤ `src/core/report_formatter.py` –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ –ø—Ä–∏–∑–Ω–∞–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `_collect_entity_refs_from_log_entry` –≤ `src/core/report_formatter.py`**:
    - –î–æ–ø–æ–ª–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–±–æ—Ä–∞ ID —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è `NPC_ACTION`, `ITEM_USED`, `ITEM_DROPPED`, `DIALOGUE_START`, `DIALOGUE_END`, `FACTION_CHANGE`.
    - –î–æ–±–∞–≤–ª–µ–Ω –±–∞–∑–æ–≤—ã–π —Å–±–æ—Ä ID –¥–ª—è –æ–±—â–∏—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_report_formatter.py` –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ `src/core/__init__.py`**:
    - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`format_turn_report`, `get_localized_entity_name`, `get_batch_localized_entity_names`, `get_localized_text`) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è. –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∏—Å—å.

## –ó–∞–¥–∞—á–∞ 6.1.1: ‚öôÔ∏è Intra-Location Interaction Handler Module
- **–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –∏ –ª–æ–≥–æ–≤**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `Tasks.txt` –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–æ–≥ –≤ `AGENTS.MD` (–ó–∞–¥–∞—á–∞ 29), –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ó–∞–¥–∞—á–µ 6.1.1.
    - –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `handle_intra_location_action` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (NLU, `action_processor`) —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
    - –ö–ª—é—á–µ–≤–∞—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∞—è —á–∞—Å—Ç—å: –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –∏–Ω—Ç–µ–Ω—Ç–∞ `interact` —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π `RuleConfig` –∏ `resolve_check`.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ç–µ–Ω—Ç–∞ `interact` –≤ `src/core/interaction_handlers.py`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏–∑ `RuleConfig` –ø–æ –∫–ª—é—á—É `interactions:<interaction_rules_key>`.
    - –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (`requires_check: true`):
        - –°–æ–±–∏—Ä–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è `resolve_check` (—Ç–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏, –∞—Ç—Ä–∏–±—É—Ç –∏–≥—Ä–æ–∫–∞, DC).
        - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `core.check_resolver.resolve_check`.
        - –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`log_event`). –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–ª—é—á –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –¥–ª—è –±—É–¥—É—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    - –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:
        - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–ª—é—á –ø—Ä—è–º—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –≤ `_format_feedback` –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤ `interact`.
    - –û–±–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è `player_interact` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –æ –ø—Ä–∞–≤–∏–ª–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_interaction_handlers.py`**:
    - –¢–µ—Å—Ç `test_interact_existing_object_with_rules_placeholder` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `test_interact_object_with_check_success` –∏ –æ–±–Ω–æ–≤–ª–µ–Ω.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã:
        - `test_interact_object_with_check_failure` (–ø—Ä–æ–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏).
        - `test_interact_object_no_check_required` (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏).
        - `test_interact_object_rule_not_found` (–ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–ª—é—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ RuleConfig).
    - –¢–µ—Å—Ç `test_interact_existing_object_no_rules` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `test_interact_object_no_interaction_key` –∏ —É—Ç–æ—á–Ω–µ–Ω.
    - –¢–µ—Å—Ç—ã –º–æ–∫–∏—Ä—É—é—Ç `get_rule` –∏ `resolve_check`, –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏—Ö –≤—ã–∑–æ–≤–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

## –ó–∞–¥–∞—á–∞ 27: ‚öîÔ∏è 5.2 Combat Engine Module
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `process_combat_action` –∏–∑ `Tasks.txt`.
    - –ò–∑—É—á–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `src/core/combat_engine.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (`CombatEncounter`, `Player`, `GeneratedNpc`, `CombatActionResult`, `CheckResult`).
    - –í—ã—è–≤–ª–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`, –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `resolve_check` –∏ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–Ω–∞.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `CombatActionResult`**:
    - –í `src/models/combat_outcomes.py` —É—Ç–æ—á–Ω–µ–Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–ª—è `check_result` –Ω–∞ `Optional[CheckResult]` –≤–º–µ—Å—Ç–æ `Optional[Dict[str, Any]]`.
    - –î–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä—è–º–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ `CheckResult` –µ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–≤–º–µ—Å—Ç–µ —Å `ModifierDetail`, `CheckOutcome`) –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –∏–∑ `src/core/check_resolver.py` –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `src/models/check_results.py`.
    - –í `src/models/__init__.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (`CheckResult`, `CheckOutcome`, `ModifierDetail`) –∏ –≤—ã–∑–æ–≤—ã `model_rebuild()` –¥–ª—è `CombatActionResult` –∏ —ç—Ç–∏—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ forward-—Å—Å—ã–ª–æ–∫ Pydantic.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `process_combat_action` –≤ `src/core/combat_engine.py`**:
    - **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –£–ª—É—á—à–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ `CombatEncounter` (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `guild_id`), –∞–∫—Ç–æ—Ä–∞ –∏ —Ü–µ–ª–∏. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π.
    - **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
        - `_get_combat_rule`: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –±–æ—è, —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –∏–∑ `combat_encounter.rules_config_snapshot_json`, –∑–∞—Ç–µ–º –∏–∑ `RuleConfig` (`core.rules.get_rule`).
        - `_get_participant_stat`: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –±–æ—è, —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –∏–∑ `participant_data` (–≤ `CombatEncounter.participants_json`), –∑–∞—Ç–µ–º –∏–∑ –±–∞–∑–æ–≤–æ–π –º–æ–¥–µ–ª–∏ (`Player`, `GeneratedNpc.properties_json.stats`), —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞—Å—á–µ—Ç–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (`_modifier` –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Å—Ç–∞—Ç–∞).
        - `_calculate_attribute_modifier`: –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∞—Ç—Ä–∏–±—É—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ñ–æ—Ä–º—É–ª—ã –∏–∑ `RuleConfig` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `(value - 10) // 2`).
    - **–õ–æ–≥–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è "attack"**:
        - **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è "attack" (—Ç–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏, –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –∞—Ç–∞–∫–∏/—É—Ä–æ–Ω–∞, DC, —Ñ–æ—Ä–º—É–ª–∞ —É—Ä–æ–Ω–∞, –ø—Ä–∞–≤–∏–ª–∞ –∫—Ä–∏—Ç. —É–¥–∞—Ä–∞) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `_get_combat_rule`.
        - **–†–∞—Å—á–µ—Ç DC**: DC –¥–ª—è –∞—Ç–∞–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `dc_base` (–∏–∑ –ø—Ä–∞–≤–∏–ª) + –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—Ç—Ä–∏–±—É—Ç–∞ —Ü–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≤–∫–æ—Å—Ç–∏, –∏–∑ –ø—Ä–∞–≤–∏–ª).
        - **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**: –í—ã–∑–æ–≤ `core.check_resolver.resolve_check` —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–≥–æ DC, —Ç–∏–ø–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏, –¥–µ—Ç–∞–ª–µ–π –∞–∫—Ç–æ—Ä–∞/—Ü–µ–ª–∏. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `CheckError`.
        - **–†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞**:
            - –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞: –ø–æ–ª—É—á–∞–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—Ç—Ä–∏–±—É—Ç–∞ —É—Ä–æ–Ω–∞ –∞–∫—Ç–æ—Ä–∞. –§–æ—Ä–º—É–ª–∞ —É—Ä–æ–Ω–∞ (–∏–∑ –ø—Ä–∞–≤–∏–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, "1d6+@actor_strength_modifier") –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è: –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º. `core.dice_roller.roll_dice` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ —Ñ–æ—Ä–º—É–ª—ã.
            - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–Ω–æ–∂–∏—Ç–µ–ª—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–Ω–∞ (–∏–∑ –ø—Ä–∞–≤–∏–ª), –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ - –∫—Ä–∏—Ç. —É—Å–ø–µ—Ö.
            - –£—Ä–æ–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º.
        - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP**: HP —Ü–µ–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `participants_data` (in-memory —Å–ø–∏—Å–æ–∫ –¥–ª—è `combat_encounter.participants_json`).
        - **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è**: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–∞ –∞—Ç–∞–∫–∏.
        - **`CombatActionResult`**: –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ (—É—Å–ø–µ—Ö, —É—Ä–æ–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ–ø–∏—Å–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞).
    - **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `CombatActionResult` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è**: `combat_encounter.participants_json` –∏ `combat_encounter.combat_log_json` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.
    - **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ StoryLog**: –í—ã–∑–æ–≤ `core.game_events.log_event` —Å –ø–æ–ª–Ω—ã–º–∏ `details_json` (–≤–∫–ª—é—á–∞—è `action_result`) –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º `entity_ids_json` (–∞–∫—Ç–æ—Ä –∏ —Ü–µ–ª—å). –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –≤—ã–∑–æ–≤ `log_event`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_combat_engine.py`**:
    - –¢–µ—Å—Ç—ã –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `async def` —Ñ—É–Ω–∫—Ü–∏–π –∏ –∏—Ö `side_effect` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `async def` —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ `side_effect` –¥–ª—è `AsyncMock`).
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ü–µ–ª–∏ –ø–∞—Ç—á–µ–π –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –≤ `combat_engine.py` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `patch('src.core.combat_engine.get_rule', ...)` –≤–º–µ—Å—Ç–æ `patch('src.core.rules.get_rule', ...)`).
    - –ú–æ–∫ –¥–ª—è `dice_roller.roll_dice` –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `MagicMock`, —Ç–∞–∫ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è.
    - –ú–æ–∫ –¥–ª—è `resolve_check` –≤ —Ç–µ—Å—Ç–µ –Ω–∞ `CheckError` —Ç–µ–ø–µ—Ä—å –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ `side_effect`.
    - –ü–æ–∫—Ä—ã—Ç—ã —Å—Ü–µ–Ω–∞—Ä–∏–∏: —É—Å–ø–µ—à–Ω–∞—è –∞—Ç–∞–∫–∞ (–ø–æ–ø–∞–¥–∞–Ω–∏–µ, —É—Ä–æ–Ω, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP), –ø—Ä–æ–º–∞—Ö, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–∑ snapshot, –æ—à–∏–±–∫–∏ (–±–æ–π/–∞–∫—Ç–æ—Ä/—Ü–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –æ—à–∏–±–∫–∞ –≤ `resolve_check`).
    - –í—Å–µ 7 —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∑–∞–¥–∞—á–∏ (Task 26)**:
    - –ó–∞–¥–∞—á–∞ 26 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ `Tasks.txt`.
    - –ó–∞–¥–∞—á–∞ 26 –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `Done.txt`.

## –ó–∞–¥–∞—á–∞ 19 (—Å—Ç–∞—Ä—ã–π –ª–æ–≥): üìö 7.3 Turn and Report Formatting (Guild-Scoped) - Revisit
- **–¶–µ–ª—å –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞**: –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —á–∏—Å–ª–∞ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π –≤ `src/core/report_formatter.py`.
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π**:
    - –ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ `_collect_entity_refs_from_log_entry` –∏ `_format_log_entry_with_names_cache` –±—ã–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `COMBAT_START`, `QUEST_ACCEPTED`, `QUEST_STEP_COMPLETED`, `QUEST_COMPLETED`, `LEVEL_UP`, `XP_GAINED`, `RELATIONSHIP_CHANGE`, `STATUS_APPLIED`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:
    - –í —Ñ—É–Ω–∫—Ü–∏—é `_format_log_entry_with_names_cache` –¥–æ–±–∞–≤–ª–µ–Ω—ã –±–ª–æ–∫–∏ `elif` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 8 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.
    - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ `log_entry_details_json`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `get_name_from_cache` –¥–ª—è –∏–º–µ–Ω —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ `get_term` –¥–ª—è –ª–æ–∫–∞–ª–∏–∑—É–µ–º—ã—Ö —Å—Ç—Ä–æ–∫ –∏ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π.
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –í `tests/core/test_report_formatter.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 8 –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å–æ–±—ã—Ç–∏–π.
    - –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —è–∑—ã–∫–æ–≤ `en` –∏ `ru`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞ –∏–º–µ–Ω –∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ `RuleConfig` (—á–µ—Ä–µ–∑ –º–æ–∫–∏).
- **–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:
    - –ë—ã–ª–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –∏–∑ `EventType`. –ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `DIALOGUE_LINE`, `STATUS_REMOVED` –∏ `QUEST_FAILED` –∫–∞–∫ –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –æ—Ç—á–µ—Ç–æ–≤.
    - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_collect_entity_refs_from_log_entry` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–±–æ—Ä–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è `DIALOGUE_LINE` –∏ `QUEST_FAILED` (–¥–ª—è `STATUS_REMOVED` —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è `STATUS_APPLIED` –ø–æ–¥—Ö–æ–¥–∏—Ç).
    - –í `_format_log_entry_with_names_cache` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `DIALOGUE_LINE`, `STATUS_REMOVED`, `QUEST_FAILED`.
    - –í `tests/core/test_report_formatter.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è —ç—Ç–∏—Ö —Ç—Ä–µ—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.
- **–û–±–∑–æ—Ä –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**:
    - –ü—Ä–æ–≤–µ–¥–µ–Ω –æ–±–∑–æ—Ä –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º. –í–æ–ø—Ä–æ—Å –ø–µ—Ä–µ–¥–∞—á–∏ —Å–µ—Å—Å–∏–∏ –≤ `get_rule` —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º–∞—Ç–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –∏–∑–≤–µ—Å—Ç–Ω–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å—é, –Ω–µ —Ç—Ä–µ–±—É—é—â–µ–π –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–æ–¥—É–ª—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π, —É–ª—É—á—à–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤.
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (–°–µ—Å—Å–∏—è 2024-07-04):**
    - **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å `AsyncSession` –≤ `_format_log_entry_with_names_cache`**:
        - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ `_format_log_entry_with_names_cache` –¥–ª—è –ø—Ä–∏–µ–º–∞ `AsyncSession` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.
        - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è `get_term` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `core.rules.get_rule`.
        - –§—É–Ω–∫—Ü–∏—è `format_turn_report` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `AsyncSession` –≤ `_format_log_entry_with_names_cache`.
        - Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_report_formatter.py` —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `mock_session` –≤ –≤—ã–∑–æ–≤—ã `_format_log_entry_with_names_cache`.
    - **–£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —è–∑—ã–∫–æ–≤–æ–≥–æ fallback –≤ `get_term`**:
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π fallback:
            1. –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∏–∑ `RuleConfig`.
            2. –û—Å–Ω–æ–≤–Ω–æ–π fallback-—è–∑—ã–∫ ("en") –∏–∑ `RuleConfig`.
            3. –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∏–∑ `default_text_map`.
            4. –û—Å–Ω–æ–≤–Ω–æ–π fallback-—è–∑—ã–∫ ("en") –∏–∑ `default_text_map`.
            5. –ü–µ—Ä–≤–æ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `default_text_map`.
            6. –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –µ—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω.
    - –í—Å–µ —Ç–µ—Å—Ç—ã (356) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è: –ê–Ω–∞–ª–∏–∑ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ó–∞–¥–∞—á 1.1 –∏ 1.2 (—Å—Ç–∞—Ä—ã–π –ª–æ–≥)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–æ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏) ...

## –ó–∞–¥–∞—á–∞ 19 (—Å—Ç–∞—Ä—ã–π –ª–æ–≥): üìö 7.3 Turn and Report Formatting (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 23: üó∫Ô∏è 4.1 Location Model (i18n, Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 21: üß† 3.2 Entity Status Model (i18n, Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 18: üìö 7.2 AI Narrative Generation (Multilang)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 20: üß† 3.1 Ability Model (i18n, Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 26: ‚öîÔ∏è 5.1 Combat and Participant Model (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 1: üó∫Ô∏è 4.3 Location Transitions (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 2: üß† 3.3 API for Activating Abilities and Applying Statuses (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 4: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç–∞
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 5: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 7: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-—Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 8: üé≤ 6.3.2 Check Resolver Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 9: üé≤ 6.3.1 Dice Roller Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 10: –°–µ—Å—Å–∏—è [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è]: –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 11: üöÄ 0.1 Discord Bot Project Initialization
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 12: üóÑÔ∏è 0.2 DBMS Setup and Database Model Definition
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 13: üõ†Ô∏è 0.3 Core Utils
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 14: üåç 1.1 Location Model, Utils, and Default Population
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 15: üë• 1.2 Player and Party System
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 16: üö∂ 1.3 Movement Logic and Command
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 17: üì¶ 2.1 Finalize Definition of ALL DB Schemas
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 18 (—Å—Ç–∞—Ä—ã–π): ü§ñ 2.2 AI Prompt Preparation Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 19 (–æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã–π): ‚úÖ 2.3 AI Prompt Construction Logic
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 20 (—Å—Ç–∞—Ä—ã–π): üß† 2.6 AI Generation, Moderation, and Saving Logic
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 21 (—Å—Ç–∞—Ä—ã–π): ‚öôÔ∏è 6.10 Action Parsing and Recognition Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 22: ‚öôÔ∏è 6.12 Turn Queue System
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 23 (—Å—Ç–∞—Ä—ã–π): ‚öôÔ∏è 6.11 Central Collected Actions Processing Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 24: üó∫Ô∏è 4.2 Guild Map Generation and Editing (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 25 (—Å—Ç–∞—Ä—ã–π): –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç –¥–ª—è main.py
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 26 (—Å—Ç–∞—Ä—ã–π): –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –∏ TypeError
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 27 (—Å—Ç–∞—Ä—ã–π): –í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ –º–∏–≥—Ä–∞—Ü–∏—è—Ö Alembic
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 28: üìö 7.1 Event Log Model (Story Log, i18n, Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 29: ‚öôÔ∏è 6.1.1 Intra-Location Interaction Handler Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 30: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 31: üìö 7.2 AI Narrative Generation (Multilang)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 32: üìö 7.3 Turn and Report Formatting (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 33: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 34: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 35: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 36: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...
