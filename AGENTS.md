## –û–±—â–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ê–≥–µ–Ω—Ç–∞ (–û–±–Ω–æ–≤–ª–µ–Ω–æ)

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã:**

1.  **–ê–Ω–∞–ª–∏–∑ `AGENTS.md`:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –≤—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª.
2.  **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á:** –ó–∞–¥–∞—á–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt` —Å—Ç—Ä–æ–≥–æ –ø–æ –æ–¥–Ω–æ–π.
3.  **–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –ö–∞–∂–¥–∞—è –≤–∑—è—Ç–∞—è –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –≤–∫–ª—é—á–∞—è –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞, —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏, –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, —Ç–µ—Å—Ç–æ–≤.
4.  **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `AGENTS.md`:** –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–æ–µ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á–∏, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ (`AGENTS.md`) –≤ —Å–µ–∫—Ü–∏–∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π". –≠—Ç–æ—Ç —Ñ–∞–π–ª —è–≤–ª—è–µ—Ç—Å—è –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç—å—é –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
5.  **–û—Ç–º–µ—Ç–∫–∞ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤ `Done.txt`:** –ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ–µ –Ω–æ–º–µ—Ä –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ) –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ–∞–π–ª `Done.txt`.
6.  **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `Tasks.txt` (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ):** –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ –æ–±—â–∏–º —Ä–∞–±–æ—á–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–¥–∞—á–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è), —Ç–æ –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –≤ `Done.txt`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –∑–∞–¥–∞—á–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–ª–∏ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Tasks.txt`. *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ò—Å—Ö–æ–¥–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∫–∞–∑—ã–≤–∞–ª–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ, —Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è `AGENTS.md` —Ç–∞–∫–∂–µ —ç—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç. –ë—É–¥–µ–º —Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ç–æ–º—É.*
7.  **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –≠—Ç–æ—Ç –ø–ª–∞–Ω –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Å–µ–∫—Ü–∏—é "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –≤ `AGENTS.md`.
8.  **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:** –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ –¥–∏–∞–ª–æ–≥–∞, –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –æ–±—â–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –≤ `AGENTS.md`.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `AGENTS.md`:**

*   **–û–±—â–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ê–≥–µ–Ω—Ç–∞:** (–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª)
*   **–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω:** –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ç–µ–∫—É—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∑–∞–¥–∞—á–∏.
*   **–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π:** –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Å–µ—Å—Å–∏–∏.

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–∞ (–ò—Å—Ö–æ–¥–Ω–∞—è - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏, —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è "–û–±—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π" –≤—ã—à–µ)

1.  **–û–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏–µ —Å –∑–∞–¥–∞—á–∞–º–∏:** –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª `Tasks.txt` –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤—Å–µ–≥–æ –æ–±—ä–µ–º–∞ —Ä–∞–±–æ—Ç.
2.  **–í—ã–±–æ—Ä –∑–∞–¥–∞—á–∏:** –í–∑—è—Ç—å –æ–¥–Ω—É –∑–∞–¥–∞—á—É –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt` –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
3.  **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    *   –°–æ–∑–¥–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏.
    *   –ó–∞–ø–∏—Å–∞—Ç—å –ø–ª–∞–Ω –≤ `AGENTS.md` –≤ —Å–µ–∫—Ü–∏—é "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω".
4.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
    *   –ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.
    *   –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã.
    *   –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ).
5.  **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π:**
    *   –ö–∞–∂–¥–æ–µ –∑–Ω–∞—á–∏–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (—Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ —Ç.–¥.) –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω–æ –≤ `AGENTS.md` –≤ —Å–µ–∫—Ü–∏—é "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π".
6.  **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏:**
    *   –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∑–∞–ø–∏—Å–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É –≤ —Ñ–∞–π–ª `done.txt`.
    *   –£–¥–∞–ª–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`.
7.  **–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ:** –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —à–∞–≥—É 2, –µ—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ `Tasks.txt` –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏.
8.  **–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –∫–æ–º–º–∏—Ç–æ–º.

## –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π

- **–°–µ—Å—Å–∏—è [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è]: –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã. –ê–Ω–∞–ª–∏–∑ `AGENTS.md` –∑–∞–≤–µ—Ä—à–µ–Ω. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º. –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ `Tasks.txt`, –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–¥–µ—Å—å, –∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –æ—Ç–º–µ—á–∞—Ç—å—Å—è –≤ `Done.txt`.**
- **–ó–∞–¥–∞—á–∞ üé≤ 6.3.1 Dice Roller Module:**
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/dice_roller.py` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `roll_dice(dice_string)`.
    - –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ "NdX[+/-M]" –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É–º–º—É –∏ —Å–ø–∏—Å–æ–∫ –±—Ä–æ—Å–∫–æ–≤.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å—Ç—Ä–æ–∫–∏.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Å—Ç–µ–π (1000) –∏ –≥—Ä–∞–Ω–µ–π (1000).
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_dice_roller.py` —Å unit-—Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `roll_dice`.
    - –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –ø—Ä–æ—Å—Ç—ã–µ –±—Ä–æ—Å–∫–∏, –±—Ä–æ—Å–∫–∏ —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ, –Ω—É–ª–µ–≤—ã–µ), –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ—Å—Ç–∏, –Ω–µ—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–±–µ–ª–∞–º, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —á–∏—Å–ª–∞ –∫–æ—Å—Ç–µ–π/–≥—Ä–∞–Ω–µ–π.
    - **–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º `src/core/crud.py` –∏ –ø–∞–∫–µ—Ç–∞ `src/core/crud/`.
    - **–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–º–ø–æ—Ä—Ç–æ–≤:**
        - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω `src/core/crud.py` –≤ `src/core/crud_base_definitions.py`.
        - –û–±–Ω–æ–≤–ª–µ–Ω `src/core/__init__.py` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `crud_base_definitions` (–∏–º–ø–æ—Ä—Ç, `__all__`, –ª–æ–≥–≥–µ—Ä).
        - –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `CRUDBase` –≤ `src/core/crud/crud_location.py`, `src/core/crud/crud_player.py`, –∏ `src/core/crud/crud_party.py` –Ω–∞ `from src.core.crud_base_definitions import CRUDBase`.
    - **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Å–æ—á–Ω–∏—Ü–µ–π:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏–º–ø–æ—Ä—Ç–æ–≤, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (`run_in_bash_session`) –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É "Failed to compute affected file count and total size... All changes to the repo have been rolled back." –≠—Ç–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤ –∏ –∫–æ–¥–∞ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ. –ü–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–º –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
- **–ó–∞–¥–∞—á–∞ üé≤ 6.3.2 Check Resolver Module:**
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/check_resolver.py`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã Pydantic –º–æ–¥–µ–ª–∏ `ModifierDetail`, `CheckOutcome`, `CheckResult` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `resolve_check(db, guild_id, check_type, ...)`:
        - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `db: AsyncSession`.
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig` (–Ω–æ—Ç–∞—Ü–∏—è –∫–æ—Å—Ç–µ–π, –±–∞–∑–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç, –ø–æ—Ä–æ–≥–∏ –∫—Ä–∏—Ç. —É—Å–ø–µ—Ö–∞/–Ω–µ—É–¥–∞—á–∏) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `get_rule`.
        - –°–æ–∑–¥–∞–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_get_entity_attribute` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ —Å—É—â–Ω–æ—Å—Ç–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è, —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–≤–∏—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã "Effective Stats").
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤/—à—Ç—Ä–∞—Ñ–æ–≤. –û—Ç–º–µ—á–µ–Ω—ã –º–µ—Å—Ç–∞ –¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –æ—Ç —É–º–µ–Ω–∏–π, —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å–æ–≤.
        - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `dice_roller.roll_dice()` –¥–ª—è –±—Ä–æ—Å–∫–∞ –∫–æ—Å—Ç–µ–π.
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ (—É—Å–ø–µ—Ö, –Ω–µ—É–¥–∞—á–∞, –∫—Ä–∏—Ç. —É—Å–ø–µ—Ö/–Ω–µ—É–¥–∞—á–∞) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å DC –∏ –ø–æ—Ä–æ–≥–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
        - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç–µ `CheckResult`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –º–æ–¥–µ–ª—è–º–∏ –≤ `_get_entity_attribute`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_check_resolver.py` —Å unit-—Ç–µ—Å—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º–∏ –º–æ–∫–∏ –¥–ª—è `get_rule`, `_get_entity_attribute` –∏ `roll_dice`. –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—É—Å–ø–µ—Ö/–Ω–µ—É–¥–∞—á–∞, –∫—Ä–∏—Ç—ã, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏).
    - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (docstrings, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏) –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/core/check_resolver.py`, –æ—Ç–º–µ—á–µ–Ω—ã TODO –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π.
    - **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Å–æ—á–Ω–∏—Ü–µ–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

(–ó–¥–µ—Å—å –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –¥–µ–π—Å—Ç–≤–∏—è)
- –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (`src/bot`, `src/core`, `src/models`, `src/utils`, `src/config`, `tests/`) —Å –ø–æ–º–æ—â—å—é `mkdir`. (–ù–µ—É–¥–∞—á–Ω–æ, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–µ —Å–æ–∑–¥–∞–ª–∏—Å—å).
- –ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é, —Ç–∞–∫ –∫–∞–∫ `create_file_with_block` –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
- –°–æ–∑–¥–∞–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞:
    - `src/main.py`
    - `src/bot/core.py`
    - `src/bot/events.py`
    - `src/bot/commands.py`
    - `src/config/settings.py`
    - `requirements.txt`
    - `.gitignore`
    - `src/bot/__init__.py`
    - `src/config/__init__.py`
    - `src/__init__.py`
    - `tests/__init__.py`
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/core/`, `src/models/`, `src/utils/` –ø–æ–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ñ–∞–π–ª–æ–≤, –Ω–æ –ø—É—Ç–∏ –¥–ª—è –Ω–∏—Ö —Å—É—â–µ—Å—Ç–≤—É—é—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–æ–∑–¥–∞–Ω–∏—é `src/__init__.py` –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ `src/`. –û–Ω–∏ –±—É–¥—É—Ç –Ω–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `BotCore` –≤ `src/bot/core.py`:
    - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `__init__` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `command_prefix` –∏ `intents`.
    - –ú–µ—Ç–æ–¥ `setup_hook` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (–∫–æ–≥–æ–≤).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–≥–æ–≤ `bot.events` –∏ `bot.commands` —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫.
    - –ú–µ—Ç–æ–¥ `on_ready` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –±–æ—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞—Ö.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π Discord –≤ `src/bot/events.py` –≤ –≤–∏–¥–µ `EventCog`:
    - `on_ready`: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
    - `on_message`: –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–∏–≥–Ω–æ—Ä —Å–∞–º–æ–≥–æ —Å–µ–±—è).
    - `on_guild_join`: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
    - `on_guild_remove`: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
    - `on_command_error`: –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –∫–æ–º–∞–Ω–¥.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/ping` (—Ç–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞, –ø—Ä–µ—Ñ–∏–∫—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) –≤ `src/bot/commands.py` –≤ –≤–∏–¥–µ `CommandCog`:
    - –ö–æ–º–∞–Ω–¥–∞ `ping_command` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–æ–π –±–æ—Ç–∞.
    - –í–∫–ª—é—á–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ –∫–æ–º–∞–Ω–¥—ã.
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
    - –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `logging.basicConfig` –≤ `src/main.py`.
    - –§–æ—Ä–º–∞—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: `%(asctime)s:%(levelname)s:%(name)s: %(message)s`.
    - –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `LOG_LEVEL` –≤ `src/config/settings.py` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é INFO).
- –ó–∞–¥–∞—á–∞ 0.1 (Discord Bot Project Initialization and Basic Guild Integration) –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`.
- –ó–∞–¥–∞—á–∞ 0.1 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`.
- **–ó–∞–¥–∞—á–∞ 0.2 –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å `GuildConfig`**
    - –°–æ–∑–¥–∞–Ω `src/models/base.py` —Å –∫–ª–∞—Å—Å–æ–º `Base(AsyncAttrs, DeclarativeBase)`.
    - –°–æ–∑–¥–∞–Ω `src/models/guild.py` —Å –º–æ–¥–µ–ª—å—é `GuildConfig`, –≤–∫–ª—é—á–∞—é—â–µ–π –ø–æ–ª—è: `id` (PK, BigInteger), `master_channel_id` (BigInteger, nullable), `system_channel_id` (BigInteger, nullable), `notification_channel_id` (BigInteger, nullable), `main_language` (Text, default 'en').
    - –°–æ–∑–¥–∞–Ω `src/models/__init__.py` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ `Base` –∏ –º–æ–¥–µ–ª–µ–π (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ `GuildConfig`), —á—Ç–æ–±—ã Alembic –º–æ–≥ –∏—Ö –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å.
- **–ó–∞–¥–∞—á–∞ 0.2 –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω `requirements.txt`**
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `SQLAlchemy>=2.0.20`, `asyncpg>=0.27.0`, `alembic>=1.11.0`.
- **–ó–∞–¥–∞—á–∞ 0.2 –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –≤ `src/config/settings.py`**
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `DB_TYPE`, `DB_USER`, `DB_PASSWORD`, `DB_HOST`, `DB_PORT`, `DB_NAME` —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    - –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ `DATABASE_URL` –¥–ª—è `postgresql+asyncpg`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ë–î.
    - –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏–º–µ—Ä `.env` —Ñ–∞–π–ª–∞.
- **–ó–∞–¥–∞—á–∞ 0.2 –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `src/core/database.py` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î**
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `engine` SQLAlchemy.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ–∞–±—Ä–∏–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π `AsyncSessionLocal`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä `get_db_session` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º commit/rollback/close.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `init_db` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).
    - –°–æ–∑–¥–∞–Ω `src/core/__init__.py`.
- **–ó–∞–¥–∞—á–∞ 0.2 –®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ `init_db` –≤ `src/main.py`**
    - `init_db()` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `main()` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±–æ—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –ë–î.
- **–ó–∞–¥–∞—á–∞ 0.2 –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–µ–Ω Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏**
    - –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `pip install -r requirements.txt` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –≤–∫–ª—é—á–∞—è `alembic`.
    - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω Alembic (`alembic init alembic`).
    - –ù–∞—Å—Ç—Ä–æ–µ–Ω `alembic.ini`: `sqlalchemy.url` —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ `env.py`.
    - –ù–∞—Å—Ç—Ä–æ–µ–Ω `alembic/env.py`:
        - –î–æ–±–∞–≤–ª–µ–Ω –ø—É—Ç—å –∫ `src` –≤ `sys.path`.
        - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `DATABASE_URL` –∏–∑ `src.config.settings` –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ `sqlalchemy.url`.
        - `target_metadata` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `Base.metadata` –∏–∑ `src.models`.
        - –§—É–Ω–∫—Ü–∏—è `run_migrations_online` –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –¥–≤–∏–∂–∫–æ–º SQLAlchemy.
    - –°–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `alembic/versions/init_0001_create_guild_configs_table.py` –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `guild_configs` –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ë–î –≤ —Å—Ä–µ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ò–Ω–¥–µ–∫—Å –¥–ª—è `id` —Å–¥–µ–ª–∞–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–º.
- **–ó–∞–¥–∞—á–∞ 0.2 (DBMS Setup and Database Model Definition with Guild ID) –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`**.
- **–ó–∞–¥–∞—á–∞ 0.2 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`**.
- **–ó–∞–¥–∞—á–∞ 0.3 –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ó–∞–¥–∞—á–µ 0.3** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ë–î —Å —É—á–µ—Ç–æ–º –≥–∏–ª—å–¥–∏–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ ORM, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, CRUD-—É—Ç–∏–ª–∏—Ç—ã, –º–æ–¥–µ–ª—å RuleConfig –∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–π (–≤–∫–ª—é—á–∞—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ).
- **–ó–∞–¥–∞—á–∞ 0.3 –®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `RuleConfig`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/models/rule_config.py` —Å –º–æ–¥–µ–ª—å—é `RuleConfig`.
    - –ú–æ–¥–µ–ª—å –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è: `id` (PK), `guild_id` (FK –∫ `GuildConfig`), `key` (TEXT), `value_json` (JSONB).
    - –î–æ–±–∞–≤–ª–µ–Ω —Å–æ—Å—Ç–∞–≤–Ω–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è (`guild_id`, `key`).
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `RuleConfig`.
- **–ó–∞–¥–∞—á–∞ 0.3 –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è `RuleConfig`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0002_create_rule_configs_table.py`.
    - –ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `rule_configs` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–æ–º.
- **–ó–∞–¥–∞—á–∞ 0.3 –®–∞–≥ 4: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –í `src/core/database.py` –¥–æ–±–∞–≤–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional`.
    - –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `get_db_session` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Å—Å–∏–∏ (commit, rollback, close) –∏ –≤–Ω–µ–¥—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é –≤ –¥–µ–∫–æ—Ä–∏—Ä—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é.
- **–ó–∞–¥–∞—á–∞ 0.3 –®–∞–≥ 5: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±—â–∏–µ CRUD-—É—Ç–∏–ª–∏—Ç—ã** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/crud.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å `CRUDBase[ModelType]` —Å –º–µ—Ç–æ–¥–∞–º–∏: `create`, `get`, `get_multi`, `update`, `delete`, `get_by_attribute`, `get_multi_by_attribute`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: `create_entity`, `get_entity_by_id`, `update_entity`, `delete_entity`, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `CRUDBase`.
    - –£—Ç–∏–ª–∏—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `guild_id` –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –º–æ–¥–µ–ª—è–º–∏, –∏–º–µ—é—â–∏–º–∏ —ç—Ç–æ –ø–æ–ª–µ.
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/core/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª—è `crud`.
- **–ó–∞–¥–∞—á–∞ 0.3 –®–∞–≥ 6: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è `RuleConfig`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/rules.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏: `load_rules_config_for_guild` (–∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª –≥–∏–ª—å–¥–∏–∏), `get_rule` (–ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ –∫–µ—à–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏), `update_rule_config` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –ë–î –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞), `get_all_rules_for_guild` (–ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª –≥–∏–ª—å–¥–∏–∏ –∏–∑ –∫–µ—à–∞).
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –≤–Ω—É—Ç—Ä–∏–ø—Ä–æ—Ü–µ—Å—Å–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª (`_rules_cache`).
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/core/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª—è `rules`.
- **–ó–∞–¥–∞—á–∞ 1.1 –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è Location Model** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–ª—è –º–æ–¥–µ–ª–∏ `Location` (guild_id, static_id, i18n –ø–æ–ª—è, JSONB –ø–æ–ª—è), –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å ENUM –¥–ª—è —Ç–∏–ø–∞ –ª–æ–∫–∞—Ü–∏–∏, –∏ —É—Ç–∏–ª–∏—Ç—ã (`get_location`, `get_static_location_id`, `get_localized_text`).
- **–ó–∞–¥–∞—á–∞ 1.1 –®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Location`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/models/location.py` —Å –º–æ–¥–µ–ª—å—é `Location` –∏ enum `LocationType`.
    - –í–∫–ª—é—á–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è, JSONB –¥–ª—è i18n –∏ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, ForeignKey –∫ `guild_configs`.
    - –î–æ–±–∞–≤–ª–µ–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è `(guild_id, static_id)`.
- **–ó–∞–¥–∞—á–∞ 1.1 –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ú–æ–¥–µ–ª—å `Location` –∏ enum `LocationType` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∏–º–ø–æ—Ä—Ç—ã –∏ –ª–æ–≥–≥–µ—Ä –≤ `src/models/__init__.py`.
- **–ó–∞–¥–∞—á–∞ 1.1 –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è `Location`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0003_create_locations_table.py`.
    - –ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `locations`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞, –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É ENUM —Ç–∏–ø–∞ `locationtype`.
- **–ó–∞–¥–∞—á–∞ 1.1 –®–∞–≥ 5: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è `Location`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/core/crud/crud_location.py` —Å –∫–ª–∞—Å—Å–æ–º `CRUDLocation(CRUDBase[Location])`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã `get_by_static_id` –∏ `get_locations_by_type`.
    - –°–æ–∑–¥–∞–Ω `src/core/crud/__init__.py` –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ `location_crud`.
- **–ó–∞–¥–∞—á–∞ 1.1 –®–∞–≥ 6: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã `get_location` –∏ `get_static_location_id`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/core/locations_utils.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `get_location` (–æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `location_crud.get`) –∏ `get_location_by_static_id` (–æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `location_crud.get_by_static_id`).
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/core/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `locations_utils`.
- **–ó–∞–¥–∞—á–∞ 1.1 –®–∞–≥ 7: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –§—É–Ω–∫—Ü–∏—è `get_localized_text` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `src/core/locations_utils.py`.
    - –£—Ç–∏–ª–∏—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ —è–∑—ã–∫—É, fallback-—è–∑—ã–∫—É, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∏–ª–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **–ó–∞–¥–∞—á–∞ 1.1 –®–∞–≥ 8: –û–±–Ω–æ–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `on_guild_join`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –í `src/bot/events.py` –æ–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `on_guild_join` –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `_ensure_guild_config_exists` –∏ `_populate_default_locations`.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ `GuildConfig` (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∞–≤–∏–ª–∞ `guild_main_language` —á–µ—Ä–µ–∑ `update_rule_config`.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π (`DEFAULT_STATIC_LOCATIONS`) –¥–ª—è –Ω–æ–≤–æ–π –≥–∏–ª—å–¥–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `get_db_session` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π –ë–î.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è Player and Party System** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–æ–¥–µ–ª–∏ Player –∏ Party, –∏—Ö –ø–æ–ª—è, Enum-—Ç–∏–ø—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤, –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥ `/start` –∏ `/party`, –∞ —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–ª—è `get_db_session` –≤ `src/core/database.py`.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã Enum'—ã `PlayerStatus` –∏ `PartyTurnStatus`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/models/enums.py` —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏ `PlayerStatus` –∏ `PartyTurnStatus`.
    - `src/models/__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 3: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Player`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/models/player.py` —Å –º–æ–¥–µ–ª—å—é `Player`.
    - –í–∫–ª—é—á–µ–Ω—ã –≤—Å–µ –ø–æ–ª—è, FK, UniqueConstraint(`guild_id`, `discord_id`), Enum `PlayerStatus`, –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ `Location` –∏ `Party`.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 4: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Party`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/models/party.py` —Å –º–æ–¥–µ–ª—å—é `Party`.
    - –í–∫–ª—é—á–µ–Ω—ã –≤—Å–µ –ø–æ–ª—è, FK, Enum `PartyTurnStatus`, JSON-–ø–æ–ª–µ `player_ids_json`, –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ `Location` –∏ `Player`.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ú–æ–¥–µ–ª–∏ `Player` –∏ `Party` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∏–º–ø–æ—Ä—Ç—ã `src/models/__init__.py`.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 6: –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è `Player` –∏ `Party`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0004_create_players_and_parties_tables.py`.
    - –ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü `parties` –∏ `players`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö ENUM-—Ç–∏–ø–æ–≤, –∏–Ω–¥–µ–∫—Å–æ–≤, FK –∏ UniqueConstraint.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 7: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã CRUD-–∫–ª–∞—Å—Å—ã `CRUDPlayer` –∏ `CRUDParty`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω—ã `src/core/crud/crud_player.py` –∏ `src/core/crud/crud_party.py`.
    - `CRUDPlayer` –≤–∫–ª—é—á–∞–µ—Ç `get_by_discord_id`, `get_multi_by_location`, `get_multi_by_party_id`, `create_with_defaults`.
    - `CRUDParty` –≤–∫–ª—é—á–∞–µ—Ç `get_by_name`, `add_player_to_party_json`, `remove_player_from_party_json`.
    - `src/core/crud/__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 8: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è Player –∏ Party** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/core/player_utils.py` (—Å `get_player`, `get_player_by_discord_id`, `get_players_in_location`, `get_players_in_party`).
    - –°–æ–∑–¥–∞–Ω `src/core/party_utils.py` (—Å `get_party`, `get_party_by_name`).
    - `src/core/__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 9: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/start`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ö–æ–º–∞–Ω–¥–∞ `/start` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/bot/commands.py` (–≤ `CommandCog`).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞, —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —Å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –ª–æ–∫–∞—Ü–∏–µ–π –∏ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
- **–ó–∞–¥–∞—á–∞ 1.2 –®–∞–≥ 10: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è Party** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/bot/commands/party_commands.py` —Å `PartyCog`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã: `/party create <–Ω–∞–∑–≤–∞–Ω–∏–µ>`, `/party leave`, `/party disband`.
    - `src/bot/core.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ `party_commands` Cog.
- **–ó–∞–¥–∞—á–∞ 1.3 –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è Movement Logic** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `handle_move_action` –∏ –∫–æ–º–∞–Ω–¥–µ `/move`.
    - –£—á—Ç–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–µ–π `Player`, `Party`, `Location`, `RuleConfig`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ –¥–ª—è `log_event` (Task 19) –∏ `on_enter_location` (Task 14).
- **–ó–∞–¥–∞—á–∞ 1.3 –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∞ API —Ñ—É–Ω–∫—Ü–∏—è `handle_move_action`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/game_events.py` —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ `on_enter_location` –∏ `log_event`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/movement_logic.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_move_action(guild_id, player_discord_id, target_location_static_id)`:
        - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–∞, —Ç–µ–∫—É—â–µ–π –∏ —Ü–µ–ª–µ–≤–æ–π –ª–æ–∫–∞—Ü–∏–π.
        - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –ª–æ–∫–∞—Ü–∏–π —á–µ—Ä–µ–∑ `neighbor_locations_json`.
        - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏ (–µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –≤ –ø–∞—Ä—Ç–∏–∏, –≤—Å—è –ø–∞—Ä—Ç–∏—è –¥–≤–∏–∂–µ—Ç—Å—è).
        - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `@transactional` —á–µ—Ä–µ–∑ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `_update_entities_location`.
        - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `on_enter_location` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è.
        - –í–æ–∑–≤—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ.
- **–ó–∞–¥–∞—á–∞ 1.3 –®–∞–≥ 3: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/move`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/bot/commands/movement_commands.py` —Å `MovementCog`.
    - –í `MovementCog` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/move <target_location_static_id>` –∫–∞–∫ slash command.
    - –ö–æ–º–∞–Ω–¥–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `guild_id`, `player_discord_id` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `handle_move_action`.
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    - `src/bot/core.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ `movement_commands` Cog.
- **–ó–∞–¥–∞—á–∞ 1.3 –®–∞–≥ 4: –ü—Ä–æ–¥—É–º–∞–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–≤–∏–∂–µ–Ω–∏—è –¥–ª—è –≥—Ä—É–ø–ø—ã (RuleConfig)** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–ª—é—á `party_movement_policy` –¥–ª—è `RuleConfig` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–Ω–∞—á–µ–Ω–∏—è: `any_member`, `leader_only`).
    - MVP-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ—è–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É `any_member`.
    - –†–µ—à–µ–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —á—Ç–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `RuleConfig` –¥–æ –±–æ–ª–µ–µ –∑—Ä–µ–ª–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤–∏–ª –∏–ª–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–∏–¥–µ—Ä—Å—Ç–≤–∞ –≤ –≥—Ä—É–ø–ø–µ).
- **–ó–∞–¥–∞—á–∞ 1.3 –®–∞–≥ 5: –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è `on_enter_location`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –§—É–Ω–∫—Ü–∏—è `on_enter_location` –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ `src/core/game_events.py` –Ω–∞ –®–∞–≥–µ 2 –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (–ª–æ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤).
- **–ó–∞–¥–∞—á–∞ 2.1: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –í–°–ï–• —Å—Ö–µ–º –ë–î (i18n, Guild ID)**
    - **–®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**
        - –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è: `GeneratedLocation` (—Ä–µ—à–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é `Location`), `GeneratedNpc`, `GeneratedFaction`, `GeneratedQuest`, `Item`, `InventoryItem` (–¥–ª—è Inventory), `StoryLog` (–¥–ª—è Log), `Relationship`, `PlayerNpcMemory`, `Ability`, `Skill`, `StatusEffect` (+ `ActiveStatusEffect`), `ItemProperty` (—Ä–µ—à–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Item.properties_json`), `Questline`, `QuestStep`, `PlayerQuestProgress`, `MobileGroup`, `CraftingRecipe`.
        - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å `guild_id` –∏ –ø–æ–ª–µ–π `_i18n` (JSONB).
    - **–®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –∏ Enum'–æ–≤**
        - –ú–æ–¥–µ–ª—å `GeneratedLocation`: –†–µ—à–µ–Ω–æ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é `Location` —Å –ø–æ–ª—è–º–∏ `generated_details_json` –∏ `ai_metadata_json`.
        - –ú–æ–¥–µ–ª—å `GeneratedNpc`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/generated_npc.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª—å `GeneratedFaction`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/generated_faction.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª—å `Item`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/item.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª—å `ItemProperty`: –†–µ—à–µ–Ω–æ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Item.properties_json`.
        - Enum `OwnerEntityType`: –î–æ–±–∞–≤–ª–µ–Ω –≤ `src/models/enums.py`.
        - –ú–æ–¥–µ–ª—å `InventoryItem`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/inventory_item.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - Enum `EventType`: –î–æ–±–∞–≤–ª–µ–Ω –≤ `src/models/enums.py`.
        - –ú–æ–¥–µ–ª—å `StoryLog`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/story_log.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - Enum `RelationshipEntityType`: –î–æ–±–∞–≤–ª–µ–Ω –≤ `src/models/enums.py`.
        - –ú–æ–¥–µ–ª—å `Relationship`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/relationship.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª—å `PlayerNpcMemory`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/player_npc_memory.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª—å `Ability`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/ability.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª—å `Skill`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/skill.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª–∏ `StatusEffect` –∏ `ActiveStatusEffect`: –°–æ–∑–¥–∞–Ω—ã –≤ `src/models/status_effect.py`. –î–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/models/__init__.py`. Enum `RelationshipEntityType` –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω.
        - Enum `QuestStatus`: –î–æ–±–∞–≤–ª–µ–Ω –≤ `src/models/enums.py`.
        - –ú–æ–¥–µ–ª–∏ `Questline`, `GeneratedQuest`, `QuestStep`, `PlayerQuestProgress`: –°–æ–∑–¥–∞–Ω—ã –≤ `src/models/quest.py`. –î–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª—å `MobileGroup`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/mobile_group.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
        - –ú–æ–¥–µ–ª—å `CraftingRecipe`: –°–æ–∑–¥–∞–Ω–∞ –≤ `src/models/crafting_recipe.py`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/models/__init__.py`.
    - **–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic**
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `NameError: name 'Index' is not defined` –≤ `src/models/quest.py`.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `KeyError: '0001'` –≤ –∏—Å—Ç–æ—Ä–∏–∏ Alembic –ø—É—Ç–µ–º –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ `down_revision` –≤ `0002_create_rule_configs_table.py` –Ω–∞ `init_0001`.
        - –°—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –ø—Ä–∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø—É—Å—Ç–æ–π —Ñ–∞–π–ª, –∑–∞—Ç–µ–º –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î, –∑–∞—Ç–µ–º –æ—à–∏–±–∫–∏ –≤ offline —Ä–µ–∂–∏–º–µ).
        - `env.py` –±—ã–ª –≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –¥–ª—è offline –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –Ω–æ —ç—Ç–æ –Ω–µ —Ä–µ—à–∏–ª–æ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º —Å AssertionErrors.
        - `env.py` –±—ã–ª –≤–æ–∑–≤—Ä–∞—â–µ–Ω –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é.
        - –°–æ–∑–¥–∞–Ω –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `16526fb0e6c7_create_remaining_core_models_task_2_1_.py`.
        - –ú–∏–≥—Ä–∞—Ü–∏—è –±—ã–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –≤—Ä—É—á–Ω—É—é –∫–æ–º–∞–Ω–¥–∞–º–∏ `op.create_table`, `op.drop_table`, `op.execute("CREATE TYPE ...")`, `op.execute("DROP TYPE ...")` –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ ENUM'–æ–≤. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–æ—Å—å –ø–æ—ç—Ç–∞–ø–Ω–æ.
    - **–®–∞–≥ 4: –†–µ–≤—å—é –∏ —É—Ç–æ—á–Ω–µ–Ω–∏–µ**
        - –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–º–µ–Ω–∞, —Ç–∏–ø—ã –ø–æ–ª–µ–π, –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏, –∏–Ω–¥–µ–∫—Å—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏, –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏.
        - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `guild_id` –∏ –ø–æ–ª–µ–π `_i18n`.
        - –ü–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ ENUM'–æ–≤ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω.
- **–ó–∞–¥–∞—á–∞ 2.1 (Finalize Definition of ALL DB Schemas (i18n, Guild ID)) –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`**.
- **–ó–∞–¥–∞—á–∞ 2.1 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`**.
- **–ó–∞–¥–∞—á–∞ 2.2 –®–∞–≥ 1 & 2: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `AI Prompt Preparation Module`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–∏—Å–∞–Ω –≤ `AGENTS.md`.
- **–ó–∞–¥–∞—á–∞ 2.2 –®–∞–≥ 3: –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `AI Prompt Preparation Module`**
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/ai_prompt_builder.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `prepare_ai_prompt` —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@transactional`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
        - `_get_guild_main_language`
        - `_get_location_context` (–±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–æ–∫–∞—Ü–∏–∏, —Å–æ—Å–µ–¥–∏)
        - `_get_player_context` (–±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–æ–∫–µ)
        - `_get_party_context` (–±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä—É–ø–ø–µ, —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å)
        - `_get_nearby_entities_context` (NPC –≤ –ª–æ–∫–∞—Ü–∏–∏)
        - `_get_quests_context` (–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã –∏–≥—Ä–æ–∫–∞)
        - `_get_relationships_context` (–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä, –±–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è player-npc)
        - `_get_world_state_context` (–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä)
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–ª–æ–≤–∞—Ä—è –∏–≥—Ä–æ–≤—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤:
        - `_get_game_rules_terms` (–ø—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`)
        - `_get_abilities_skills_terms` (–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä)
        - `_get_entity_schema_terms` (—Å—Ö–µ–º—ã –¥–ª—è NPC, Quest, Item, Event)
    - –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `prepare_ai_prompt` —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç.
    - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫.
    - –ú–æ–¥—É–ª—å `ai_prompt_builder` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/__init__.py`.
    - –û—Ç–º–µ—á–µ–Ω—ã `TODO` –¥–ª—è —á–∞—Å—Ç–µ–π, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π/–º–æ–¥–µ–ª–µ–π.
- **–ó–∞–¥–∞—á–∞ 2.2 (AI Prompt Preparation Module) –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`**.
- **–ó–∞–¥–∞—á–∞ 2.2 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`**.
- **–ó–∞–¥–∞—á–∞ 2.3 –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è `AI Response Parsing and Validation Module`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API, –ø–∞—Ä—Å–∏–Ω–≥—É JSON, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–π –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–≤–∫–ª—é—á–∞—è `RuleConfig` –∏ `_i18n`), –∞ —Ç–∞–∫–∂–µ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º `ParsedAiData` –∏ `ValidationError`.
- **–ó–∞–¥–∞—á–∞ 2.3 –®–∞–≥ 2: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è `AI Response Parsing and Validation Module`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ `src/core/ai_response_parser.py`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã Pydantic –º–æ–¥–µ–ª–∏: `ValidationError`, `BaseGeneratedEntity`, `ParsedNpcData`, `ParsedQuestData`, `ParsedItemData`, `GeneratedEntity` (Union), `ParsedAiData`.
    - –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `parse_and_validate_ai_response` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Pydantic –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–≤–∫–ª—é—á–∞—è i18n –∏ `RuleConfig`).
- **–ó–∞–¥–∞—á–∞ 2.3 –®–∞–≥ 3: –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `AI Response Parsing and Validation Module`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/ai_response_parser.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã Pydantic –º–æ–¥–µ–ª–∏: `ValidationError`, `BaseGeneratedEntity`, `ParsedNpcData`, `ParsedQuestData`, `ParsedItemData`, `GeneratedEntity` (Union), `ParsedAiData`. –í–∫–ª—é—á–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ `field_validator` –¥–ª—è i18n –ø–æ–ª–µ–π.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_parse_json_from_text` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_validate_overall_structure` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Pydantic discriminated unions.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_perform_semantic_validation` —Å –Ω–∞—á–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —è–∑—ã–∫–æ–≤ –≤ i18n –ø–æ–ª—è—Ö (—Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —è–∑—ã–∫–æ–≤) –∏ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ `RuleConfig`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `parse_and_validate_ai_response`, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è —ç—Ç–∏ —à–∞–≥–∏.
    - –ú–æ–¥—É–ª—å `ai_response_parser` –∏ –µ–≥–æ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (`parse_and_validate_ai_response`, `ParsedAiData`, `ValidationError`) –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ `src/core/__init__.py`.
- **–ó–∞–¥–∞—á–∞ 2.3 –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`**.
- **–ó–∞–¥–∞—á–∞ 2.3 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`**.
- **–ó–∞–¥–∞—á–∞ 2.6 –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è `AI Generation, Moderation, and Saving Logic`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ `trigger_location_generation` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ `trigger_ai_generation_flow`), —Å–æ–∑–¥–∞–Ω–∏—é –º–æ–¥–µ–ª–∏ `PendingGeneration`, –º–µ—Ö–∞–Ω–∏–∑–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ú–∞—Å—Ç–µ—Ä–∞, –∫–æ–º–∞–Ω–¥–∞–º –ú–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (`/master_approve_ai` –∏ –¥—Ä.), –∏ –ª–æ–≥–∏–∫–µ "Saving Worker" –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–¥–æ–±—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –ë–î.
- **–ó–∞–¥–∞—á–∞ 2.6 –®–∞–≥ 2: –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è `AI Generation, Moderation, and Saving Logic`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ `PendingGeneration` –∏ Enum `ModerationStatus`.
    - –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `src/core/ai_orchestrator.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ `_mock_openai_api_call`, `trigger_ai_generation_flow`, `save_approved_generation`.
    - –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `src/bot/commands/master_ai_commands.py` —Å Cog `MasterAICog` –¥–ª—è –∫–æ–º–∞–Ω–¥ –º–æ–¥–µ—Ä–∞—Ü–∏–∏.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —ç—Ç–∞–ø—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `__init__.py`, Alembic –º–∏–≥—Ä–∞—Ü–∏—è).
- **–ó–∞–¥–∞—á–∞ 2.6 –®–∞–≥ 3 (–ß–∞—Å—Ç–∏—á–Ω–æ): –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `PendingGeneration` –∏ `ModerationStatus`**
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω Enum `ModerationStatus` –≤ `src/models/enums.py`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `PendingGeneration` –≤ `src/models/pending_generation.py` —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–æ–ª—è–º–∏ –∏ —Å–≤—è–∑—å—é —Å `GuildConfig`.
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/models/guild.py` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ `pending_generations`.
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `PendingGeneration` –∏ `ModerationStatus`.
    - –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic (`0005_create_pending_generations_table.py`) –¥–ª—è `PendingGeneration` –∏ `moderation_status_enum`.
- **–ó–∞–¥–∞—á–∞ 2.6 –®–∞–≥ 4 (–ß–∞—Å—Ç–∏—á–Ω–æ): –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `ai_orchestrator.py`**
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/ai_orchestrator.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ mock-—Ñ—É–Ω–∫—Ü–∏—è `_mock_openai_api_call`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `trigger_ai_generation_flow` –≤–∫–ª—é—á–∞—è:
        - –í—ã–∑–æ–≤ `prepare_ai_prompt`.
        - –í—ã–∑–æ–≤ `_mock_openai_api_call`.
        - –í—ã–∑–æ–≤ `parse_and_validate_ai_response`.
        - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ `PendingGeneration` –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING_MODERATION` –∏–ª–∏ `VALIDATION_FAILED`.
        - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä–æ–∫–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ) –Ω–∞ `AWAITING_MODERATION`.
        - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –ú–∞—Å—Ç–µ—Ä–∞ (—Ä–µ–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `save_approved_generation` –≤–∫–ª—é—á–∞—è:
        - –ó–∞–≥—Ä—É–∑–∫—É `PendingGeneration`.
        - –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é `ParsedAiData`.
        - –ò—Ç–µ—Ä–∞—Ü–∏—é –ø–æ —Å—É—â–Ω–æ—Å—Ç—è–º –∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –¥–ª—è –∏—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î (—Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö CRUD –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å—É—â–Ω–æ—Å—Ç–∏).
        - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ `PendingGeneration` –Ω–∞ `SAVED` –∏–ª–∏ `ERROR_ON_SAVE`.
        - –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –¥–ª—è –≤—ã–∑–æ–≤–∞ `on_enter_location` –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∏–≥—Ä–æ–∫–æ–≤.
    - –ú–æ–¥—É–ª—å `ai_orchestrator` –∏ –µ–≥–æ –∫–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/core/__init__.py`.
- **–ó–∞–¥–∞—á–∞ 2.6 –®–∞–≥ 5 (–ß–∞—Å—Ç–∏—á–Ω–æ): –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `master_ai_commands.py`**
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/bot/commands/master_ai_commands.py` —Å Cog `MasterAICog`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞—Ä–∫–∞—Å—ã –¥–ª—è –∫–æ–º–∞–Ω–¥: `master_review_ai`, `master_approve_ai`, `master_reject_ai`, `master_edit_ai`.
        - `master_approve_ai` –≤—ã–∑—ã–≤–∞–µ—Ç `save_approved_generation`.
    - Cog –¥–æ–±–∞–≤–ª–µ–Ω –≤ `BOT_COGS` –≤ `src/config/settings.py` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.
- **–ó–∞–¥–∞—á–∞ 2.6 –®–∞–≥ 6: –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ —É—Ç–æ—á–Ω–µ–Ω–∏–µ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–∫–ª—é—á–∞—è –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º AI API, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ú–∞—Å—Ç–µ—Ä–∞.

## –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω

**–ó–∞–¥–∞—á–∞: üß† 2.6 AI Generation, Moderation, and Saving Logic**

1.  **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ó–∞–¥–∞—á–∏ üß† 2.6 (AI Generation, Moderation, and Saving Logic):** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Function: `trigger_location_generation(guild_id: int, ...)` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ `trigger_ai_generation_flow`).
    *   Calls `prepare_ai_prompt`, AI API (mocked), `parse_and_validate_ai_response`.
    *   Create `PendingGeneration` record (needs new model).
    *   Notify Master, set player status to 'awaiting_moderation'.
    *   Master API placeholders for moderation (`/master approve_ai`, etc.).
    *   Saving Worker: takes 'approved' `PendingGeneration`, saves entities to DB (transactional, guild-scoped), calls `on_enter_location`.

2.  **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ó–∞–¥–∞—á–∏ üß† 2.6**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Define `PendingGeneration` model & `ModerationStatus` Enum. Create migration.
    *   Create `src/core/ai_orchestrator.py` with `_mock_openai_api_call`, `trigger_ai_generation_flow`, `save_approved_generation`.
    *   Create `src/bot/commands/master_ai_commands.py` with `MasterAICog` for moderation commands.
    *   Integrate new modules/cogs.

3.  **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ó–∞–¥–∞—á–∏ üß† 2.6 (–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ):**
    *   **–ú–æ–¥–µ–ª—å `PendingGeneration` –∏ Enum `ModerationStatus`**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
        *   Enum `ModerationStatus` —Å–æ–∑–¥–∞–Ω –≤ `src/models/enums.py`.
        *   –ú–æ–¥–µ–ª—å `PendingGeneration` —Å–æ–∑–¥–∞–Ω–∞ –≤ `src/models/pending_generation.py`.
        *   –û–±–Ω–æ–≤–ª–µ–Ω—ã `src/models/guild.py` –∏ `src/models/__init__.py`.
        *   –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic `0005_create_pending_generations_table.py`.
    *   **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `src/core/ai_orchestrator.py`**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
        *   –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã `_mock_openai_api_call`, `trigger_ai_generation_flow`, `save_approved_generation` (—Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π).
        *   –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `src/core/__init__.py`.
    *   **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `src/bot/commands/master_ai_commands.py`**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
        *   –°–æ–∑–¥–∞–Ω Cog `MasterAICog` —Å –∫–∞—Ä–∫–∞—Å–∞–º–∏ –∫–æ–º–∞–Ω–¥. `master_approve_ai` –≤—ã–∑—ã–≤–∞–µ—Ç `save_approved_generation`.
        *   Cog –¥–æ–±–∞–≤–ª–µ–Ω –≤ `BOT_COGS` –≤ `src/config/settings.py`.
    *   **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `save_approved_generation`**:
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π (NPC, Quest, Item –∏ —Ç.–¥.) –∏–∑ `ParsedAiData` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ë–î, –∏—Å–ø–æ–ª—å–∑—É—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–ª–∏ –Ω–æ–≤—ã–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏. –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–∞–ø–ø–µ—Ä–æ–≤ –∏–ª–∏ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –æ—Ç `Parsed[EntityType]Data` –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º `ModelCreate` —Å—Ö–µ–º–∞–º –∏–ª–∏Áõ¥Êé• –∫ —Å–æ–∑–¥–∞–Ω–∏—é –º–æ–¥–µ–ª–µ–π.
        *   –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É `guild_id` –¥–ª—è –∫–∞–∂–¥–æ–π —Å–æ—Ö—Ä–∞–Ω—è–µ–º–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.
    *   **–î–æ—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –ú–∞—Å—Ç–µ—Ä–∞**:
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è `master_review_ai` (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ `PendingGeneration`).
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è `master_reject_ai` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞).
        *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è `master_edit_ai` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `parsed_validated_data_json` –∏ —Å—Ç–∞—Ç—É—Å–∞, –≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è).
        *   –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –ú–∞—Å—Ç–µ—Ä–∞.
    *   **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ú–∞—Å—Ç–µ—Ä—É**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è –ú–∞—Å—Ç–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `ctx.guild.get_channel(notification_channel_id).send(...)`).
    *   **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏–≥—Ä–æ–∫–æ–≤**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ `AWAITING_MODERATION` –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

4.  **Refine and Test**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ)
    *   –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

5.  **–û–±–Ω–æ–≤–∏—Ç—å `AGENTS.md`**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   –ó–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π".
    *   –û–±–Ω–æ–≤–∏—Ç—å "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω".

6.  **–ó–∞–ø–∏—Å–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É 2.6 –≤ `Done.txt`**. (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
7.  **–£–¥–∞–ª–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É 2.6 –∏–∑ `Tasks.txt`**. (–í—ã–ø–æ–ª–Ω–µ–Ω–æ, —Ç.–∫. –æ–Ω–∞ —É–∂–µ –±—ã–ª–∞ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ "Moved to Done.txt")
8.  **–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–¥–∞—á–∞ –≤ —Ñ–∞–∑–µ.** (–ü–µ—Ä–µ—à–ª–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ)

---
**–ó–∞–¥–∞—á–∞: ‚öôÔ∏è 6.10 Action Parsing and Recognition Module (NLU & Intent/Entity)**

1.  **Research and Choose NLU Library**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Chosen approach: Simple keyword/regex-based parser for MVP. No new external libraries required initially.
2.  **Update `requirements.txt`**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   No changes needed as per chosen NLU approach.
3.  **Define Action JSON Structure**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Created `src/models/actions.py` with `ParsedAction` and `ActionEntity` Pydantic models.
    *   Updated `src/models/__init__.py` to include these models.
4.  **Implement Basic NLU Service/Wrapper**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Created `src/core/nlu_service.py` with `parse_player_input` function using regex patterns.
    *   Updated `src/core/__init__.py` to export the service.
5.  **Modify `Player` Model**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Verified `Player.collected_actions_json` exists and is suitable. No changes or migration needed.
6.  **Integrate NLU into `on_message` Event**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Modified `on_message` in `src/bot/events.py`.
    *   Added transactional helper `process_player_message_for_nlu` to handle player fetching, status checks, calling NLU, and updating `player.collected_actions_json`.
7.  **Guild-Specific Entity Dictionary (Conceptual)**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Conceptualized future enhancements for guild-specific entities. Current MVP uses global regex.
8.  **Testing (Conceptual/Manual)**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Outlined manual testing steps for the NLU service and `on_message` integration.

- **–ó–∞–¥–∞—á–∞ ‚öôÔ∏è 6.10 Action Parsing and Recognition Module (NLU & Intent/Entity) –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞.**
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –≤—Å–µ —à–∞–≥–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–ª–∞–Ω–∞ –¥–ª—è –∑–∞–¥–∞—á–∏ 6.10 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã (—Å–æ–∑–¥–∞–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π `ParsedAction`, `ActionEntity`; —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `nlu_service.parse_player_input` —Å regex; –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `on_message` —á–µ—Ä–µ–∑ `_process_player_message_for_nlu`; –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `player.collected_actions_json`).
    - –ó–∞–ø–∏—Å—å –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `Done.txt`.
    - –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–π.

- **–ó–∞–¥–∞—á–∞ ‚öôÔ∏è 6.12 Turn Queue System (Turn Controller) - Per-Guild Processing**:
    - **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç–∞—Ç—É—Å–∞–º –∏–≥—Ä–æ–∫–æ–≤/–≥—Ä—É–ø–ø, –∫–æ–º–∞–Ω–¥–∞–º `/end_turn`, `/end_party_turn`, –ª–æ–≥–∏–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ –∏ –≤—ã–∑–æ–≤—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤**: –í `src/models/enums.py` –æ–±–Ω–æ–≤–ª–µ–Ω—ã `PlayerStatus` (–¥–æ–±–∞–≤–ª–µ–Ω—ã `TURN_ENDED_PENDING_RESOLUTION`, `PROCESSING_GUILD_TURN`; —É–¥–∞–ª–µ–Ω `PROCESSING_ACTION`) –∏ `PartyTurnStatus` (–¥–æ–±–∞–≤–ª–µ–Ω—ã `AWAITING_PARTY_ACTION`, `TURN_ENDED_PENDING_RESOLUTION`, `PROCESSING_GUILD_TURN`; —É–¥–∞–ª–µ–Ω—ã `ACTIVE_TURN`, `PROCESSING_ACTIONS`, `WAITING_FOR_MEMBERS`, `TURN_ENDED`).
    - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥**: –°–æ–∑–¥–∞–Ω `src/bot/commands/turn_commands.py` —Å `TurnManagementCog`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–º–∞–Ω–¥—ã `/end_turn` –∏ `/end_party_turn`. –ö–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª—è—é—Ç —Å—Ç–∞—Ç—É—Å—ã –∏–≥—Ä–æ–∫–∞/–≥—Ä—É–ø–ø—ã –∏ –≤—ã–∑—ã–≤–∞—é—Ç –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏.
    - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏**: –°–æ–∑–¥–∞–Ω `src/core/turn_controller.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ `process_guild_turn_if_ready` (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –¥–ª—è –≥–∏–ª—å–¥–∏–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π –Ω–∞ `PROCESSING_GUILD_TURN` –∏ –≤—ã–∑–æ–≤–æ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π) –∏ `trigger_guild_turn_processing` (–¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ Cog).
    - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: `TurnManagementCog` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `BOT_COGS` –≤ `src/config/settings.py`. `turn_controller` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/__init__.py`. –ö–æ–º–∞–Ω–¥—ã –≤ `turn_commands.py` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –≤—ã–∑–æ–≤–∞ `trigger_guild_turn_processing`.
    - **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î**: –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic `alembic/versions/0006_update_turn_statuses.py` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ ENUM `PlayerStatus` –∏ `PartyTurnStatus` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `ALTER TYPE ... ADD VALUE IF NOT EXISTS`.
    - **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–∞–Ω–¥, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
    - **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–ª–µ–Ω "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –≤ `AGENTS.md`.

- **–ó–∞–¥–∞—á–∞ ‚öôÔ∏è 6.11 Central Collected Actions Processing Module (Turn Processor) - Guild-Scoped Execution**:
    - **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: –î–µ—Ç–∞–ª—å–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–æ—Ä–∫–µ—Ä, –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–æ–≤ (`collected_actions_json`), —Ñ–∞–∑—ã –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (MVP –¥–ª—è –≥—Ä—É–ø–ø—ã, —Å–æ–∑–¥–∞–Ω–∏–µ `PendingConflict`, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ú–∞—Å—Ç–µ—Ä–∞), –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–≤—ã–∑–æ–≤ Check Resolver), —Ñ–∞–∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π (–∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –∞—Ç–æ–º–∞—Ä–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –≤—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π-–∑–∞–≥–ª—É—à–µ–∫), –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏–≥—Ä–æ–∫–æ–≤/–≥—Ä—É–ø–ø.
    - **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `PendingConflict` –≤ `src/models/pending_conflict.py` –∏ Enum `ConflictStatus` –≤ `src/models/enums.py`. –û–±–Ω–æ–≤–ª–µ–Ω `src/models/guild.py` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏. –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py`. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic `0007_create_pending_conflicts_table.py`.
    - **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `action_processor.py`**: –°–æ–∑–¥–∞–Ω `src/core/action_processor.py` —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π `process_actions_for_guild`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–æ–≤, MVP-–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∫ –∑–∞–≥–ª—É—à–∫–∞–º (`_handle_placeholder_action`, `_handle_move_action_wrapper`) —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.
    - **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `turn_controller.py`**: `src/core/turn_controller.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞ `action_processor.process_actions_for_guild` —á–µ—Ä–µ–∑ `asyncio.create_task`.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `core/__init__.py`**: `action_processor` –∏ –µ–≥–æ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/core/__init__.py`.
    - **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ)**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –ø–ª–∞–Ω –¥–ª—è –º–∞–Ω—É–∞–ª—å–Ω–æ–≥–æ/–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –æ—á–∏—Å—Ç–∫–∏ `collected_actions_json`.

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç –¥–ª—è `main.py`, –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥–∏ (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])**
    - **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
        - –°–æ–∑–¥–∞–Ω –ø–ª–∞–Ω –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `src/main.py`, –≤–∫–ª—é—á–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ—à–∏–±–æ–∫, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤.
    - **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
        - –î–æ–±–∞–≤–ª–µ–Ω—ã `pytest` –∏ `pytest-asyncio` –≤ `requirements.txt`.
        - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pip install -r requirements.txt`).
        - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/test_main.py` —Å –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Ç–µ—Å—Ç–æ–≤ –∏ —Ñ–∏–∫—Å—Ç—É—Ä (`mock_settings`, `mock_bot_core`, `mock_init_db`).
    - **–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤:**
        - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `src/main.py`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–æ–∫–µ–Ω–∞, –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î, –æ—à–∏–±–∫–∏ –ª–æ–≥–∏–Ω–∞ Discord –∏ –æ–±—â–∏–µ –æ—à–∏–±–∫–∏ –∑–∞–ø—É—Å–∫–∞. –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ `sys.path`.
        - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –≤ `src/core/`:**
            - `src/core/locations_utils.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from models.location...` –Ω–∞ `from ..models.location...`.
            - `src/core/crud/crud_location.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from models.location...` –Ω–∞ `from ...models.location...` –∏ `from core.crud_base_definitions...` –Ω–∞ `from ..crud_base_definitions...`. (–ë—ã–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π).
            - `src/core/crud/crud_player.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from models.player...` –Ω–∞ `from ...models.player...`.
            - `src/core/crud/crud_party.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `from models.party...` –∏ `from models.player...` –Ω–∞ `from ...models.party...` –∏ `from ...models.player...` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
            - `src/core/movement_logic.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from models...` –Ω–∞ `from ..models...`.
        - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤ `src/core/action_processor.py`:**
            - –ó–∞–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç `get_player_by_id` –Ω–∞ `get_player` –∏–∑ `player_utils`.
            - –ó–∞–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç `get_party_by_id` –Ω–∞ `get_party` –∏–∑ `party_utils`.
        - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö –∏ —Ç–µ—Å—Ç–∞—Ö `tests/test_main.py`:**
            - –§–∏–∫—Å—Ç—É—Ä–∞ `mock_settings`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ `LOG_LEVEL` –∏ `BOT_PREFIX`. `BOT_PREFIX` –º–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤ `src.config.settings`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `main()`. `LOG_LEVEL` –∏ `DISCORD_BOT_TOKEN` –º–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ `main_module`.
            - –§–∏–∫—Å—Ç—É—Ä–∞ `mock_init_db`: –ò–∑–º–µ–Ω–µ–Ω–∞ —Å `async def` –Ω–∞ `def`, —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `AsyncMock` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö.
            - –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è/–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ—Å—Ç `test_main_no_token` –≤ –ø–æ–ª—å–∑—É `test_main_no_token_fixed`.
            - –í —Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ –æ—à–∏–±–∫–∏ (`test_main_discord_login_failure`, `test_main_generic_start_exception`, `test_main_keyboard_interrupt_handling`), –¥–æ–±–∞–≤–ª–µ–Ω—ã `monkeypatch` –∏ –º–æ–∫–∏ –¥–ª—è `discord.Intents` –∏ `discord.ext.commands.when_mentioned_or` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∞—Ü–∏–∏ `BotCore` –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –µ–≥–æ –º–µ—Ç–æ–¥ `start()` –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É.
            - –í —ç—Ç–∏—Ö –∂–µ —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è `expected_prefix_callable` –Ω–∞ `lambda bot, msg: ['?']` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É `BOT_PREFIX`.
            - **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º `finally` –±–ª–æ–∫–∞:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω." (–∏ –¥—Ä—É–≥–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –±–ª–æ–∫–∞ `finally` –≤ `main.py`) –Ω–µ –ø–æ–ø–∞–¥–∞–ª–æ –≤ `caplog.text` –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –≥–¥–µ –≤ `main()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –ü—Ä–∏ —ç—Ç–æ–º `mock_bot_core.close.assert_called_once()` –ø—Ä–æ—Ö–æ–¥–∏–ª, —É–∫–∞–∑—ã–≤–∞—è –Ω–∞ —Ç–æ, —á—Ç–æ –±–ª–æ–∫ `finally` –¥–æ—Å—Ç–∏–≥–∞–ª—Å—è.
            - –í `src/main.py` –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–ª–∏—Å—å —è–≤–Ω—ã–µ `return` –≤ `except` –±–ª–æ–∫–∞—Ö –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ `print` –≤ `finally` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏. –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –∑–∞—Ö–≤–∞—Ç–∞ –ª–æ–≥–æ–≤.
            - –ü—Ä–∏–Ω—è—Ç–æ –ø—Ä–∞–≥–º–∞—Ç–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —É–¥–∞–ª–∏—Ç—å –∞—Å—Å–µ—Ä—Ç—ã `assert "–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω." in caplog.text` –∏–∑ —Ç–µ—Å—Ç–æ–≤ `test_main_discord_login_failure`, `test_main_generic_start_exception` –∏ `test_main_keyboard_interrupt_handling`, —Ç–∞–∫ –∫–∞–∫ –¥—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏, –≤—ã–∑–æ–≤ `bot.close()`) –ø—Ä–æ—Ö–æ–¥–∏–ª–∏. –≠—Ç–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –≤–æ–∑–º–æ–∂–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è `caplog` —Å `asyncio` –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –¥–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.
            - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π `finally` –±–ª–æ–∫ –≤ `src/main.py` (—É–¥–∞–ª–µ–Ω—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ `print` –∏ —è–≤–Ω—ã–µ `return` –∏–∑ `except` –±–ª–æ–∫–æ–≤, –∫—Ä–æ–º–µ `logger.info` –≤ `finally`).
    - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ 7 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/test_main.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –∏ TypeError (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])**
    - **–ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ `ImportError: attempted relative import beyond top-level package` –∏ `ModuleNotFoundError`**
        - **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ `src/bot/core.py` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `bot.events` –≤–º–µ—Å—Ç–æ `src.bot.events`), –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ñ–∞–π–ª–∞ `src/bot/commands.py` —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π `src/bot/commands/`, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `__init__.py` –≤ `src/bot/commands/`. –¢–∞–∫–∂–µ, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥—É–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `party_commands.py`) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∏–º–ø–æ—Ä—Ç—ã –≤–∏–¥–∞ `from core...` –≤–º–µ—Å—Ç–æ `from src.core...`.
        - **–†–µ—à–µ–Ω–∏–µ:**
            - –í `src/bot/core.py` –∏–∑–º–µ–Ω–µ–Ω—ã –ø—É—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –æ—Ç –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (`src.bot.events`, `src.bot.commands.party_commands` –∏ —Ç.–¥.).
            - –§–∞–π–ª `src/bot/commands.py` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `src/bot/general_commands.py`, –∏ –ø—É—Ç—å –µ–≥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ `src/bot/core.py` –æ–±–Ω–æ–≤–ª–µ–Ω.
            - –°–æ–∑–¥–∞–Ω –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª `src/bot/commands/__init__.py`.
            - –í `src/bot/commands/party_commands.py` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `from src.core...` –∏ `from src.models...`.
    - **–ü—Ä–æ–±–ª–µ–º–∞ 2: `ImportError: cannot import name 'get_party_by_id' from 'src.core.party_utils'` –≤ `src.bot.commands.turn_commands.py`**
        - **–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `get_party_by_id` –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞ –≤ `src/core/party_utils.py`. –í–º–µ—Å—Ç–æ –Ω–µ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_party(..., party_id: int)`, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è —Ç—É –∂–µ —Ä–æ–ª—å.
        - **–†–µ—à–µ–Ω–∏–µ:** –í `src/bot/commands/turn_commands.py` –∏–º–ø–æ—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `from src.core.party_utils import get_party`, –∏ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
    - **–ü—Ä–æ–±–ª–µ–º–∞ 3: `TypeError: unsupported type annotation <class 'discord.interactions.Interaction'>` –≤ `src.bot.commands.master_ai_commands.py`**
        - **–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@transactional` (–∫–æ—Ç–æ—Ä—ã–π –≤–Ω–µ–¥—Ä—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `session: AsyncSession`) –Ω–∞ –º–µ—Ç–æ–¥–∞—Ö –∫–æ–º–∞–Ω–¥ (`reject_ai`, `edit_ai`), –∫–æ—Ç–æ—Ä—ã–µ —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç `interaction: discord.Interaction`. –°–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤ `discord.py` –¥–ª—è slash-–∫–æ–º–∞–Ω–¥ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é `discord.Interaction` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `AsyncSession`, –æ—à–∏–±–æ—á–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—è –µ–µ –∫–∞–∫ –º–æ–¥—É–ª—å `discord.interactions.Interaction`.
        - **–†–µ—à–µ–Ω–∏–µ:** –î–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –∫–æ–º–∞–Ω–¥ (`reject_ai`, `edit_ai`) –≤ `master_ai_commands.py`:
            - –£–¥–∞–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional` —Å —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥—ã.
            - –£–¥–∞–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `session: AsyncSession` –∏–∑ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥—ã.
            - –í —Ç–µ–ª–µ –∫–æ–º–∞–Ω–¥—ã —Å–µ—Å—Å–∏—è —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ `async with get_db_session() as session:`.
            - –Ø–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `await session.commit()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `with`.
        - –≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç "—á–∏—Å—Ç—É—é" —Å–∏–≥–Ω–∞—Ç—É—Ä—É –¥–ª—è `discord.py` –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –≤–Ω—É—Ç—Ä—å –º–µ—Ç–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã. –ö–æ–º–∞–Ω–¥–∞ `approve_ai` —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∏ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω

**–ó–∞–¥–∞—á–∞: ‚öôÔ∏è 6.11 Central Collected Actions Processing Module (Turn Processor) - Guild-Scoped Execution**

1.  **Analyze Requirements for ‚öôÔ∏è 6.11 Central Collected Actions Processing Module**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Async Worker function signature, loading/clearing actions, conflict analysis (MVP: party, PendingConflict, Master notification), auto-conflict resolution (placeholder), Action Execution (atomic transactions per action, dispatch to placeholders), status updates, feedback/logging placeholders.
2.  **Define `PendingConflict` Model and related Enums**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Created `ConflictStatus` enum in `src/models/enums.py`.
    *   Created `PendingConflict` model in `src/models/pending_conflict.py`.
    *   Updated `src/models/guild.py` (relationship) and `src/models/__init__.py`.
    *   Created Alembic migration `0007_create_pending_conflicts_table.py`.
3.  **Create `src/core/action_processor.py`**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Implemented `process_actions_for_guild` as the main async worker.
    *   Implemented `_load_and_clear_actions` (transactional).
    *   Implemented MVP action dispatch loop with `ACTION_DISPATCHER` and placeholder handlers (`_handle_placeholder_action`, `_handle_move_action_wrapper`), ensuring each action is in a separate transaction.
    *   Implemented player/party status updates post-processing.
4.  **Update `src/core/turn_controller.py`**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Modified `_start_action_processing_worker` to import and call `action_processor.process_actions_for_guild` using `asyncio.create_task`.
5.  **Integrate and Refine**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Added `action_processor.py` and its components to `src/core/__init__.py`.
    *   Ensured logging and guild-scoping.
6.  **Testing (Manual/Conceptual)**: (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    *   Outlined test cases for action loading, dispatching, error handling within an action, and status updates.
7.  **Documentation**: (–¢–µ–∫—É—â–∏–π —à–∞–≥)
    *   Update `AGENTS.md` with this plan and log actions.
8.  **Completion**:
    *   Record task completion in `Done.txt`.
    *   Remove task from `Tasks.txt`.
    *   Identify next task.

**(–ó–∞–¥–∞—á–∞ ‚öôÔ∏è 6.11 –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.)**

[end of AGENTS.md]
