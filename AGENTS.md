## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã:**

1.  **–ê–Ω–∞–ª–∏–∑ `AGENTS.md`:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ª—é–±–æ–π —Ä–∞–±–æ—Ç—ã –≤—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª (`AGENTS.md`).
2.  **–†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–∞–º–∏ –∏–∑ `tasks.txt`:**
    *   –í–∑—è—Ç—å –æ–¥–Ω—É –∑–∞–¥–∞—á—É –∏–∑ —Ñ–∞–π–ª–∞ `tasks.txt` –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.
    *   –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É.
    *   –ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).
    *   –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
        *   –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã.
        *   –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç, —Å–Ω–∞—á–∞–ª–∞ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É, –∑–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç.
        *   –ü–æ–≤—Ç–æ—Ä—è—Ç—å –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –≤—Å–µ —Ç–µ—Å—Ç—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –∑–∞–¥–∞—á–µ, –Ω–µ –ø—Ä–æ–π–¥—É—Ç.
    *   –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
        *   –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É –∏–∑ —Ñ–∞–π–ª–∞ `tasks.txt`.
        *   –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ (–¥–æ–±–∞–≤–∏—Ç—å) –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ –≤ —Ñ–∞–π–ª `done.txt`.
3.  **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
    *   –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—É–¥—É—â–µ–º, —Å–æ–∑–¥–∞—Ç—å –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ (`AGENTS.md`) —Å–µ–∫—Ü–∏—é "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏".
    *   –£–∫–∞–∑–∞—Ç—å –≤ —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏ –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å, –∏ —É–∫–∞–∑–∞—Ç—å, –∫–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å.
4.  **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md` –∏ –ö–æ–º–º–∏—Ç:**
    *   –ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–æ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏, –æ–±–Ω–æ–≤–∏—Ç—å `AGENTS.md` –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ (–≤ —Å–µ–∫—Ü–∏–∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π").
    *   –°–¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π.
5.  **–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –≤ `AGENTS.md`:**
    *   `AGENTS.md` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤–∞—à–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
    *   –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–æ–µ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ `AGENTS.md` –≤ —Å–µ–∫—Ü–∏–∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏.
6.  **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏:**
    *   –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    *   –≠—Ç–æ—Ç –ø–ª–∞–Ω –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Å–µ–∫—Ü–∏—é "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –≤ `AGENTS.md`. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —ç—Ç–∞ —Å–µ–∫—Ü–∏—è –æ—á–∏—â–∞–µ—Ç—Å—è –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏.
7.  **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:**
    *   –Ø–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞, –∏–º–µ—é—Ç –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
    *   –ó–∞—Ç–µ–º —Å–ª–µ–¥—É—é—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ ("–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞").

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `AGENTS.md` (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è):**

*   **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞:** (–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª)
*   **–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω:**
    *(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–ª–∞–Ω–æ–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏)*
*   **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
    *(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—É–¥—É—â–µ–º)*
*   **–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π:** –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞—á–∏, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–¥–∞—á–∞–º. –ó–∞–¥–∞—á–∏ –Ω—É–º–µ—Ä—É—é—Ç—Å—è.

---
## –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω
*(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ—á–∏—â–µ–Ω –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è Task 34)*
---
## –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ Player.attributes_json –¥–ª—è Task 32**:
    - **–û–ø–∏—Å–∞–Ω–∏–µ**: –í —Ä–∞–º–∫–∞—Ö Task 32 –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã `/levelup`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ —É –º–æ–¥–µ–ª–∏ `Player` –ø–æ–ª—è `attributes_json` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (—Å–∏–ª–∞, –ª–æ–≤–∫–æ—Å—Ç—å –∏ —Ç.–¥.). –û–¥–Ω–∞–∫–æ —Å–∞–º–æ –ø–æ–ª–µ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã.
    - **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**:
        1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `attributes_json: Mapped[Dict[str, Any]] = mapped_column(JSON, default=lambda: {}, nullable=False)` –≤ –º–æ–¥–µ–ª—å `src/models/player.py`.
        2. –°–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é Alembic –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç—Ç–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `players`.
        3. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –±–∞–∑–æ–≤—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤ `player.attributes_json` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `player_crud.create_with_defaults`, –∏—Å–ø–æ–ª—å–∑—É—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `RuleConfig` –ø–æ –∫–ª—é—á—É —Ç–∏–ø–∞ `character_attributes:base_values`).
    - **–°—Ä–æ–∫**: –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ `/levelup`. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ.

---

## –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π

## Task 34: üé≠ 8.2 Relationships Model (Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å `Relationship` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
    - –ú–æ–¥–µ–ª—å `src/models/relationship.py` –æ–±–Ω–æ–≤–ª–µ–Ω–∞:
        - –ü–æ–ª–µ `relationship_type_i18n` (JSONB) –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ `relationship_type` (Text, default="neutral").
        - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `source_log_id` (Integer, FK –Ω–∞ `story_logs.id`, nullable, ondelete SET NULL).
        - –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–ª–µ `ai_metadata_json`.
    - Enum `RelationshipEntityType` –≤ `src/models/enums.py` —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –∏ –±—ã–ª –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.
    - –§–∞–π–ª `src/models/__init__.py` –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    - –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è Alembic `alembic/versions/6344a0089ba3_update_relationships_table_fields.py` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü—ã `relationships`:
        - –£–¥–∞–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `ai_metadata_json`.
        - –£–¥–∞–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `relationship_type_i18n` –∏ —Å–æ–∑–¥–∞–µ—Ç `relationship_type` (Text).
        - –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `source_log_id` —Å –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–æ–º –∏ –∏–Ω–¥–µ–∫—Å–æ–º.
- **–°—Ç–∞—Ç—É—Å**: –ú–æ–¥–µ–ª—å –∏ –º–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã.

## Task 33: üé≠ 8.1 Factions Model (Guild-Scoped, i18n)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å `GeneratedFaction` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ñ—Ä–∞–∫—Ü–∏—è—Ö.
- **–ê–Ω–∞–ª–∏–∑**:
    - –ú–æ–¥–µ–ª—å `src/models/generated_faction.py` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
    - –ú–æ–¥–µ–ª—å –≤ `src/models/__init__.py` —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞.
    - –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è `generated_factions` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `alembic/versions/fcb2e6d12a18_initial_schema_setup.py`.
- **–í—ã–≤–æ–¥**: –ó–∞–¥–∞—á–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–∞–Ω–µ–µ. –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

## Task 32: ‚ö°Ô∏è 13.3 Applying Level Up (Multy-i18n)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—á–∫–æ–≤ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è (`unspent_xp`) –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
- **–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è**:
    - –ê—Ç—Ä–∏–±—É—Ç—ã –∏–≥—Ä–æ–∫–∞ (—Å–∏–ª–∞, –ª–æ–≤–∫–æ—Å—Ç—å –∏ —Ç.–¥.) –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–æ–ª–µ `Player.attributes_json: JSONB`. (–ü–æ–ª–µ `attributes_json` –Ω–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–æ–¥–µ–ª—å `Player` –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–π –∑–∞–¥–∞—á–∏, —Ç–∞–∫ –∫–∞–∫ –ø–ª–∞–Ω –∏–∑–º–µ–Ω–∏–ª—Å—è –∏ —Å–Ω–∞—á–∞–ª–∞ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, –∞ —Ä–∞–±–æ—Ç–∞ —Å –º–æ–¥–µ–ª—å—é –≤—ã–Ω–µ—Å–µ–Ω–∞ –Ω–∞ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏–π —à–∞–≥).
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (–∏–º–µ–Ω–∞, –æ–ø–∏—Å–∞–Ω–∏—è), –∏—Ö –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–∫–∞—á–∫–∏ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ `RuleConfig`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è API `spend_attribute_points`**:
    - –í `src/core/experience_system.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `async def spend_attribute_points(session, player, attribute_name, points_to_spend, guild_id)`.
    - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `unspent_xp`, –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∞—Ç—Ä–∏–±—É—Ç–∞ (—á–µ—Ä–µ–∑ `RuleConfig` –∫–ª—é—á `character_attributes:definitions`), —Ç—Ä–∞—Ç–∏—Ç –æ—á–∫–∏, –æ–±–Ω–æ–≤–ª—è–µ—Ç `player.unspent_xp` –∏ `player.attributes_json`.
    - –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `ATTRIBUTE_POINTS_SPENT` (–Ω–æ–≤—ã–π —Ç–∏–ø –≤ `EventType`).
    - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
- **–°–æ–∑–¥–∞–Ω–∏–µ Cog `CharacterCog`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/bot/commands/character_commands.py`.
    - Cog `CharacterCog` –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `src/config/settings.py`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥—ã `/levelup`**:
    - –í `CharacterCog` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/levelup <attribute_name: str> <points_to_spend: int>`.
    - –ö–æ–º–∞–Ω–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –∏–≥—Ä–æ–∫–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `unspent_xp`.
    - –í—ã–∑—ã–≤–∞–µ—Ç API `spend_attribute_points`.
    - –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–≥—Ä–æ–∫—É, –∏—Å–ø–æ–ª—å–∑—É—è —à–∞–±–ª–æ–Ω—ã –∏–∑ `RuleConfig` (–∫–ª—é—á–∏ —Ç–∏–ø–∞ `levelup_success`, `levelup_error_not_enough_xp` –∏ —Ç.–¥.) –∏ `localization_utils.get_localized_text`. –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è-–∑–∞–≥–ª—É—à–∫–∏.
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∞–≤–∏–ª –¥–ª—è `RuleConfig`**:
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–ª—é—á–∏ –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤: `character_attributes:definitions`, `character_attributes:base_values`, `character_attributes:cost_per_point`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–ª—é—á–∏ –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–º–∞–Ω–¥—ã: `levelup_success`, `levelup_error_no_unspent_xp`, `levelup_error_invalid_points_value`, `levelup_error_not_enough_xp`, `levelup_error_invalid_attribute`, `levelup_error_not_enough_xp_for_cost`, `levelup_error_generic`, `player_not_started_game`.
- **Unit-—Ç–µ—Å—Ç—ã**:
    - –í `tests/core/test_experience_system.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `spend_attribute_points`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –æ—à–∏–±–∫–∏ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ XP, –Ω–µ–≤–µ—Ä–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç, –Ω–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤), –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/test_character_commands.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/levelup`. –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–∏–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–µ—Ç –æ—á–∫–æ–≤), –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API –∏ —Å–∏—Å—Ç–µ–º–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.

## Task 30: ‚ö°Ô∏è 13.1 Experience System Structure (Rules)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∞–≤–∏–ª –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ–ø—ã—Ç–∞ (–ø–æ–ª—É—á–µ–Ω–∏–µ XP, –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤) –≤ `RuleConfig` –¥–ª—è –∫–∞–∂–¥–æ–π –≥–∏–ª—å–¥–∏–∏.
- **–ê–Ω–∞–ª–∏–∑ –º–æ–¥–µ–ª–∏ `RuleConfig`**: –ú–æ–¥–µ–ª—å `src/models/rule_config.py` (–ø–æ–ª—è `key` –∏ `value_json`) –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–∞–º–æ–π –º–æ–¥–µ–ª–∏.
- **–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –¥–ª—è –ø—Ä–∞–≤–∏–ª XP –≤ `RuleConfig`**:
    -   **–ö–ª—é—á**: `experience_system:xp_gain_rules`
        -   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –æ–ø—ã—Ç –∑–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è.
        -   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: –û–±—ä–µ–∫—Ç, –≥–¥–µ –∫–∞–∂–¥—ã–π –∫–ª—é—á - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—â–∞—è —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `combat_victory_normal_enemy`, `combat_victory_elite_enemy`, `quest_completed_main`, `quest_completed_side`, `skill_usage_crafting`, `skill_usage_exploration`), –∞ –∑–Ω–∞—á–µ–Ω–∏–µ - –æ–±—ä–µ–∫—Ç —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.
        -   **–ü—Ä–∏–º–µ—Ä `value_json`**:
            ```json
            {
              "combat_victory_normal_enemy": {
                "base_xp": 50,
                "per_level_above_player": 10, // XP —Å–≤–µ—Ä—Ö –±–∞–∑–æ–≤–æ–≥–æ –∑–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—Ä–∞–≥–∞ –≤—ã—à–µ —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞
                "per_level_below_player": -5, // –®—Ç—Ä–∞—Ñ –∫ XP –∑–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—Ä–∞–≥–∞ –Ω–∏–∂–µ —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞ (–º–∏–Ω. 0)
                "player_level_scaling_factor": 1.0 // –ú–Ω–æ–∂–∏—Ç–µ–ª—å XP –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –∫—Ä–∏–≤–æ–π)
              },
              "quest_completed_main": {
                "base_xp": 500,
                "bonus_for_optional_objectives": 100
              },
              "skill_usage_exploration": {
                "base_xp_per_discovery": 25
              }
            }
            ```
    -   **–ö–ª—é—á**: `experience_system:level_curve`
        -   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è.
        -   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —É—Ä–æ–≤–Ω—é. –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø—ã—Ç–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ *—Å —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π*.
        -   **–ü—Ä–∏–º–µ—Ä `value_json`**:
            ```json
            [
              { "current_level": 1, "xp_to_reach_next_level": 1000 },
              { "current_level": 2, "xp_to_reach_next_level": 2500 },
              { "current_level": 3, "xp_to_reach_next_level": 5000 }
              // ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ
            ]
            ```
            *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ*: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ XP, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: `[ { "level": 1, "total_xp_required": 0 }, { "level": 2, "total_xp_required": 1000 } ]`. –ü–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (xp_to_reach_next_level) –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—â–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤ "XP –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è".
    -   **–ö–ª—é—á**: `experience_system:level_up_rewards`
        -   **–û–ø–∏—Å–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–∫–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –æ—á–∫–∏ –Ω–∞–≤—ã–∫–æ–≤, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏), –∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è.
        -   **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `value_json`**: –û–±—ä–µ–∫—Ç, –≥–¥–µ –∫–ª—é—á `"default"` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ª—é–±–æ–≥–æ —É—Ä–æ–≤–Ω—è, –∞ —á–∏—Å–ª–æ–≤—ã–µ –∫–ª—é—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"5"`, `"10"`) –º–æ–≥—É—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏–ª–∏ –¥–æ–ø–æ–ª–Ω—è—Ç—å –Ω–∞–≥—Ä–∞–¥—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π.
        -   **–ü—Ä–∏–º–µ—Ä `value_json`**:
            ```json
            {
              "default": { // –ù–∞–≥—Ä–∞–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
                "attribute_points": 1,
                "skill_points": 2
              },
              "5": { // –û—Å–æ–±–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –Ω–∞ 5-–º —É—Ä–æ–≤–Ω–µ (–¥–æ–ø–æ–ª–Ω—è–µ—Ç –∏–ª–∏ –∑–∞–º–µ–Ω—è–µ—Ç default)
                "attribute_points": 2, // –ë–æ–ª—å—à–µ –æ—á–∫–æ–≤ –∞—Ç—Ä–∏–±—É—Ç–æ–≤
                "skill_points": 3,
                "bonus_ability_static_id": "special_perk_level_5", // ID —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π
                "notification_message_key": "level_5_milestone_reached" // –ö–ª—é—á –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
              },
              "10": {
                "feature_unlock": "new_feature_unlocked_at_level_10"
              }
            }
            ```
- **–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏**: –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç Task 30. –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ (31, 32) –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã –æ–ø—ã—Ç–∞.

## Task 31: ‚ö°Ô∏è 13.2 XP Awarding and Progress
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è.
- **–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è `experience_system.py`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/experience_system.py`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π `award_xp` –∏ `_check_for_level_up`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è API `award_xp`**:
    - –§—É–Ω–∫—Ü–∏—è `award_xp(session, guild_id, entity_id, entity_type, xp_to_award, source_event_type, source_log_id)` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤-–ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π:
        - –î–ª—è `EntityType.PLAYER`: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–≥—Ä–æ–∫ –ø–æ `entity_id` –∏ `guild_id`.
        - –î–ª—è `EntityType.PARTY`: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–∞—Ä—Ç–∏—è –∏ –µ–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ (`party.players`).
    - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ XP: –¥–ª—è –ø–∞—Ä—Ç–∏–∏ XP –¥–µ–ª–∏—Ç—Å—è –ø–æ—Ä–æ–≤–Ω—É (TODO: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `RuleConfig` –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫).
    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `player.xp` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞-–ø–æ–ª—É—á–∞—Ç–µ–ª—è.
    - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è `EventType.XP_GAINED` —á–µ—Ä–µ–∑ `core.game_events.log_event`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `_check_for_level_up`**:
    - –§—É–Ω–∫—Ü–∏—è `_check_for_level_up(session, guild_id, player)` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.
    - –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª `experience_system:level_curve` –∏ `experience_system:level_up_rewards` –∏–∑ `RuleConfig` (—á–µ—Ä–µ–∑ `core.rules.get_rule`).
    - –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è:
        - –ï—Å–ª–∏ `player.xp` –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è —Å–æ–≥–ª–∞—Å–Ω–æ `level_curve`, —É—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–∞ (`player.level`) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, XP –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è.
        - –ù–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞–≥—Ä–∞–¥—ã (`player.unspent_xp` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `attribute_points` –∏–∑ `level_up_rewards`).
        - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `EventType.LEVEL_UP`.
    - –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã —Å–ª—É—á–∞–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–∞–≤–∏–ª –∏–ª–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫—Ä–∏–≤–æ–π.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `_check_for_level_up` –≤ `award_xp`**:
    - `_check_for_level_up` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –µ–º—É XP.
    - `session.commit()` –∏ `session.refresh()` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Ü–µ `award_xp` –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤.
- **–≠–∫—Å–ø–æ—Ä—Ç API**:
    - `award_xp` –∏ –º–æ–¥—É–ª—å `experience_system` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/core/__init__.py` –∏ –≤ `__all__`.
- **Unit-—Ç–µ—Å—Ç—ã**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_experience_system.py`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –∏–≥—Ä–æ–∫—É –∏ –ø–∞—Ä—Ç–∏–∏, –ø–æ–≤—ã—à–µ–Ω–∏–µ –Ω–∞ –æ–¥–∏–Ω –∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª/—Å—É—â–Ω–æ—Å—Ç–µ–π, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –Ω—É–ª–µ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ XP.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏
- **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã**: –í—ã—è–≤–ª–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –¥–≤—É—Ö —Ñ–∞–π–ª–æ–≤ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: `src/bot/general_commands.py` (–∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã) –∏ `src/bot/commands/general_commands.py` (–∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥—ã –∏ –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥). –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `src/config/settings.py` –∑–∞–≥—Ä—É–∂–∞–ª–∏ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é (`src/bot/general_commands.py`).
- **–ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥**:
    - –ö–æ–º–∞–Ω–¥–∞ `ping` –∏–∑ `src/bot/general_commands.py` –±—ã–ª–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ `src/bot/commands/general_commands.py`.
    - –ö–æ–º–∞–Ω–¥–∞ `ping` –±—ã–ª–∞ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞–∫ —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥–∞ (`app_command`) –≤ `GeneralCog`.
    - –§–∞–π–ª `src/bot/commands/general_commands.py` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–æ–º–∞–Ω–¥ `start` –∏ `ping` –≤ –≤–∏–¥–µ —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–≥–æ–≤**:
    - –í —Ñ–∞–π–ª–µ `src/config/settings.py` —Å–ø–∏—Å–æ–∫ `BOT_COGS` –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–≥–∞ –∏–∑ `src.bot.commands.general_commands`.
    - –£–¥–∞–ª–µ–Ω–∞ –∑–∞–ø—É—Ç–∞–Ω–Ω–∞—è —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π –∫–æ–≥–æ–≤.
- **–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**:
    - –§–∞–π–ª `src/bot/general_commands.py` –±—ã–ª —É–¥–∞–ª–µ–Ω.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤**:
    - –û–±–Ω–∞—Ä—É–∂–µ–Ω –∏–º–ø–æ—Ä—Ç —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–≥–∞ (`CommandCog` –∏–∑ `src.bot.general_commands`) –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ `tests/bot/test_general_commands_mocked.py`.
    - –£—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `tests/bot/test_general_commands_mocked.py` –±—ã–ª —É–¥–∞–ª–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è.
- **–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤**:
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `GeneralCog` –≤ `src/bot/commands/general_commands.py`, –≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç—ã –¥–ª—è —Å–ª–µ—à-–∫–æ–º–∞–Ω–¥ `/ping` –∏ `/start` —Å —É—á–µ—Ç–æ–º –∏—Ö –ª–æ–≥–∏–∫–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Discord API –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

## Task 1.2: üåç Player and Party System (ORM, Commands, Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 1.2.
- **–ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:
    - –ú–æ–¥–µ–ª–∏ `Player` (`src/models/player.py`) –∏ `Party` (`src/models/party.py`) —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
    - –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –¥–ª—è —ç—Ç–∏—Ö –º–æ–¥–µ–ª–µ–π —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    - –£—Ç–∏–ª–∏—Ç—ã `get_player`, `get_party`, `get_players_in_location` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ CRUD-–º–æ–¥—É–ª–∏.
    - –ö–æ–º–∞–Ω–¥—ã Discord `/start` –∏ `/party` (create, leave, disband, join) —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.
    - **–í—ã—è–≤–ª–µ–Ω –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π, CRUD –∏ –∫–æ–º–∞–Ω–¥, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å Player –∏ Party.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/models/test_player.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –º–æ–¥–µ–ª–∏ `Player`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/models/test_party.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –º–æ–¥–µ–ª–∏ `Party`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/crud/test_crud_player.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `CRUDPlayer`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/crud/test_crud_party.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `CRUDParty`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/test_general_commands.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/start`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/commands/test_party_commands.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥ `/party`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**: –û–±–Ω–æ–≤–ª–µ–Ω "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –¥–ª—è Task 1.2.

## Task 1.1: üåç Location Model (i18n, Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 1.1.
- **–ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –ü–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–∞–π–ª `src/models/location.py`: –ú–æ–¥–µ–ª—å `Location` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–∞–π–ª `src/core/locations_utils.py`: –£—Ç–∏–ª–∏—Ç—ã `get_location`, `get_location_by_static_id`, `get_localized_text` —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic (`alembic/versions/`): –ú–∏–≥—Ä–∞—Ü–∏–∏ `fcb2e6d12a18_initial_schema_setup.py` (—Å–æ–∑–¥–∞–Ω–∏–µ) –∏ `0005_use_jsonb_for_location_fields.py` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ JSONB) —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ç–µ—Å—Ç—ã: `tests/models/test_location.py` –∏ `tests/core/test_locations_utils.py` —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã.
- **–í—ã–≤–æ–¥**: –ó–∞–¥–∞—á–∞ 1.1 –±—ã–ª–∞ —Ä–∞–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –Ω–æ –Ω–µ –æ—Ç–º–µ—á–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**: –û–±–Ω–æ–≤–ª–µ–Ω "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –∑–∞–¥–∞—á–∏.

## Task 29: ‚öîÔ∏è 5.4 Combat Cycle Refactoring (Multiplayer Combat State Machine)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 29: Combat Cycle Refactoring.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 29.
- **–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è `combat_cycle_manager.py`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/combat_cycle_manager.py` —Å –±–∞–∑–æ–≤—ã–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏, –ª–æ–≥–≥–µ—Ä–æ–º –∏ –∑–∞–≥–ª—É—à–∫–∞–º–∏ –¥–ª—è –∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–∏—Å—Ç–µ–º (XP, Loot, Relationships, WorldState, Quests).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `start_combat` API**:
    - –í `src/core/combat_cycle_manager.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `start_combat`.
    - –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å `CombatEncounter`, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (`participants_json`) –∏ –∏—Ö –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—ã.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã (dice roll + dex modifier) –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `turn_order_json`.
    - –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–Ω–∏–º–æ–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –±–æ–µ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –≤ `rules_config_snapshot_json`.
    - –°—Ç–∞—Ç—É—Å `CombatEncounter` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `ACTIVE`. –°—Ç–∞—Ç—É—Å—ã —É—á–∞—Å—Ç–≤—É—é—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ (`PlayerStatus.IN_COMBAT`) –∏ –ø–∞—Ä—Ç–∏–π (`PartyTurnStatus.IN_COMBAT`) –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.
    - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `COMBAT_START`.
    - –§—É–Ω–∫—Ü–∏—è `start_combat` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `start_combat` —Å `action_processor.py`**:
    - –í `src/core/crud/crud_combat_encounter.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_active_combat_for_entity` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Å—É—â–Ω–æ—Å—Ç—å —É–∂–µ –≤ –±–æ—é.
    - –í `src/core/action_processor.py` —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `_handle_attack_action_wrapper` –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ "attack".
    - `_handle_attack_action_wrapper` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–µ–ª—å –∞—Ç–∞–∫–∏, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–æ—è –¥–ª—è –∞–∫—Ç–æ—Ä–∞ –∏–ª–∏ —Ü–µ–ª–∏.
    - –ï—Å–ª–∏ –±–æ–π –Ω–µ –Ω–∞—á–∞—Ç, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `combat_cycle_manager.start_combat`. –ó–∞—Ç–µ–º –ø–µ—Ä–≤–∞—è –∞—Ç–∞–∫–∞ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `combat_engine.process_combat_action`.
    - –ï—Å–ª–∏ –±–æ–π —É–∂–µ –∏–¥–µ—Ç, –∏ —ç—Ç–æ —Ö–æ–¥ –∞—Ç–∞–∫—É—é—â–µ–≥–æ, –∞—Ç–∞–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `combat_engine.process_combat_action`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `process_combat_turn` API –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**:
    - –í `src/core/combat_cycle_manager.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `process_combat_turn`.
    - –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç `CombatEncounter`, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ —Å—Ç–∞—Ç—É—Å.
    - –ï—Å–ª–∏ —Ö–æ–¥ NPC: –≤—ã–∑—ã–≤–∞–µ—Ç `npc_combat_strategy.get_npc_combat_action`, –∑–∞—Ç–µ–º `combat_engine.process_combat_action`.
    - –ü–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è (–∏–≥—Ä–æ–∫–∞ –∏–ª–∏ NPC) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `session.refresh(combat_encounter)`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_check_combat_end` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–æ—è –∏ –ø–æ–±–µ–¥–∏–≤—à–µ–π –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ `participants_json`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_advance_turn` –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∂–∏–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `current_turn_entity_id/type`, `current_index` –∏ `current_turn_number`.
    - –ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è —Ö–æ–¥–∞ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç —Ö–æ–¥ NPC, `process_combat_turn` —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ö–æ–¥–∞ —ç—Ç–æ–≥–æ NPC (–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö, –ø–æ–∫–∞ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏—Ç —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞ –∏–ª–∏ –∫–æ–Ω–µ—Ü –±–æ—è).
    - –§—É–Ω–∫—Ü–∏—è `process_combat_turn` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ `src/core/__init__.py`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `_handle_combat_end_consequences`**:
    - –í `src/core/combat_cycle_manager.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_handle_combat_end_consequences`.
    - –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö.
    - –í—ã–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º XP (`xp_awarder.award_xp`), –ª—É—Ç–∞ (`loot_generator.distribute_loot`), –æ—Ç–Ω–æ—à–µ–Ω–∏–π (`relationship_updater.update_relationships_post_combat`), —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∏—Ä–∞ (`world_state_updater.update_world_state_post_combat`) –∏ –∫–≤–µ—Å—Ç–æ–≤ (`quest_system.handle_combat_event_for_quests`).
    - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –±–æ–µ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏–≥—Ä–æ–∫–æ–≤ –∏ –ø–∞—Ä—Ç–∏–π.
    - –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ `COMBAT_END`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤—ã–∑–æ–≤–∞ `process_combat_turn`**:
    - –í `src/core/action_processor.py` (–≤ `_handle_attack_action_wrapper`) –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –±–æ—é –∏–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤ –Ω–æ–≤–æ–º –±–æ—é —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `combat_cycle_manager.process_combat_turn` –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_combat_cycle_manager.py`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `start_combat` (—É—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–∞—Å—á–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).
    - –ù–∞–ø–∏—Å–∞–Ω —Å–∫–µ–ª–µ—Ç —Ç–µ—Å—Ç–∞ –¥–ª—è `process_combat_turn` —Å –º–æ–∫–∞–º–∏ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `_check_combat_end` –∏ `_advance_turn`.
    - –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–∞—Ä—Ç–∏–∏ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –±–æ—è.

## Task 28: ‚öîÔ∏è 5.3 NPC Combat Strategy Module (AI)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 28: NPC Combat Strategy Module.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 28, –≤–∫–ª—é—á–∞—é—â–∏–π –∞–Ω–∞–ª–∏–∑, –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ñ—É–Ω–∫—Ü–∏–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏, –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.
- **–ê–Ω–∞–ª–∏–∑ Task 28**: –ò–∑—É—á–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `get_npc_combat_action`, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π (NPC, CombatEncounter, RuleConfig, Relationship, CheckResolver) –∏ –¥–∞–Ω–Ω—ã—Ö (—Å—Ç–∞—Ç—ã NPC, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—è, –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è AI).
- **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è `npc_combat_strategy.py`**:
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `get_npc_combat_action`.
    - –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: `_get_npc_data`, `_get_combat_encounter_data`, `_get_participant_entity`, `_get_relationship_value`, `_get_npc_ai_rules`, `_is_hostile`, `_get_potential_targets`, `_calculate_target_score`, `_select_target`, `_get_available_abilities`, `_simulate_action_outcome`, `_evaluate_action_effectiveness`, `_choose_action`, `_format_action_result`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö**:
    - –í `src/core/npc_combat_strategy.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `_get_npc_data`, `_get_combat_encounter_data`, `_get_participant_entity`, `_get_relationship_value`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_get_npc_ai_rules` —Å –±–∞–∑–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig` (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `core.rules.get_rule`), –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –ø—Ä–æ—Å—Ç—ã—Ö –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–∏—á–Ω–æ—Å—Ç–∏ NPC.
    - –ú–æ–¥—É–ª—å `npc_combat_strategy` –∏ —Ñ—É–Ω–∫—Ü–∏—è `get_npc_combat_action` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/core/__init__.py`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–∏ (Aggro System)**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_is_hostile` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏ —Ü–µ–ª–∏ (—É—á–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–π, —Ñ—Ä–∞–∫—Ü–∏–π, –ø—Ä–∞–≤–∏–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_get_potential_targets` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–∞–∂–¥–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–µ–±—è, –ø–æ–±–µ–∂–¥–µ–Ω–Ω—ã—Ö, –Ω–µ–≤—Ä–∞–∂–¥–µ–±–Ω—ã—Ö).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_calculate_target_score` –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ü–µ–ª–µ–π –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –º–µ—Ç—Ä–∏–∫–∞–º (HP (–ø—Ä–æ—Ü–µ–Ω—Ç/–∞–±—Å–æ–ª—é—Ç), —É–≥—Ä–æ–∑–∞). –ú–µ—Ç—Ä–∏–∫–∞ —É–≥—Ä–æ–∑—ã (`highest_threat_score`) –≤–∫–ª—é—á–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (—É—Ä–æ–Ω –ø–æ —Å–µ–±–µ, —Ä–æ–ª—å —Ü–µ–ª–∏, –Ω–∏–∑–∫–æ–µ HP —Ü–µ–ª–∏, –æ—Ç–Ω–æ—à–µ–Ω–∏—è).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_select_target` –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–∞–∏–ª—É—á—à–µ–π —Ü–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –º–µ—Ç—Ä–∏–∫ –∏–∑ AI-–ø—Ä–∞–≤–∏–ª.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_get_available_abilities` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π NPC —Å —É—á–µ—Ç–æ–º –∫—É–ª–¥–∞—É–Ω–æ–≤ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_simulate_action_outcome` (placeholder) –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —à–∞–Ω—Å–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –∏ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —É—Ä–æ–Ω–∞.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_evaluate_action_effectiveness` –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –æ–±—â–µ–π –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è (—É—Ä–æ–Ω, —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—É—Å–æ–≤/–ª–µ—á–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤ —Å–∏–º—É–ª—è—Ü–∏–∏).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_choose_action` –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–∞–∏–ª—É—á—à–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö (–∞—Ç–∞–∫–∞, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö –æ—Ü–µ–Ω–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∞–º–æ–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º HP).
- **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_format_action_result` –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç, –æ–∂–∏–¥–∞–µ–º—ã–π `CombatEngine`.
    - –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `get_npc_combat_action` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_npc_combat_strategy.py`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –º–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö (`mock_session`, `mock_actor_npc`, `mock_target_player`, `mock_combat_encounter`, `mock_ai_rules` –∏ –¥—Ä.).
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `_get_available_abilities` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–Ω—ã, –∫—É–ª–¥–∞—É–Ω–æ–≤).
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `_is_hostile` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–∞–∂–¥–µ–±–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π, —Ñ—Ä–∞–∫—Ü–∏–π).
    - –ù–∞–ø–∏—Å–∞–Ω –±–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç –¥–ª—è `_get_potential_targets`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `get_npc_combat_action`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: —É—Å–ø–µ—à–Ω—ã–π –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è, –ø–æ–±–µ–∂–¥–µ–Ω–Ω—ã–π NPC, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª–µ–π.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–º—ã—Å–ª–µ–Ω–Ω–∞—è)**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ `npc_combat_strategy` —Å `CombatEngine`. –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ç–æ—á–∫–∏ –≤—ã–∑–æ–≤–∞, —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞. –û—Ç–º–µ—á–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `CombatEncounter.participants_json` –º–æ–¥—É–ª–µ–º `CombatEngine`.

## Task 27: ‚öîÔ∏è 5.2 Combat Engine Module
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**: –ü—Ä–æ—á–∏—Ç–∞–Ω `Tasks.txt`, –≤—ã–±—Ä–∞–Ω–∞ –∑–∞–¥–∞—á–∞ Task 27.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Å—Ç–∞–≤–ª–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Task 27.
- **–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –ò–∑—É—á–µ–Ω—ã –º–æ–¥–µ–ª–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã.
- **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `process_combat_action`**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**: –§—É–Ω–∫—Ü–∏–∏ `_get_combat_rule`, `_calculate_attribute_modifier`, `_get_participant_stat` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `CombatActionResult`**: –ú–æ–¥–µ–ª–∏ `CheckResult` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã, –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏**: –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—ã–∑–æ–≤—ã –∫ –¥—Ä—É–≥–∏–º –º–æ–¥—É–ª—è–º.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**: –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–∞—Ä–∫–∞—Å –¥–ª—è `process_combat_action`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `process_combat_action`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `process_combat_action` –≤ `src/core/combat_engine.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è "attack", –≤–∫–ª—é—á–∞—è —Ä–∞—Å—á–µ—Ç –ø–æ–ø–∞–¥–∞–Ω–∏—è, —É—Ä–æ–Ω–∞, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É–¥–∞—Ä–æ–≤ (—Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏) –∏ –ø—Ä–æ–º–∞—Ö–æ–≤.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: –Ω–µ –Ω–∞–π–¥–µ–Ω –±–æ–π, –∞–∫—Ç–æ—Ä, —Ü–µ–ª—å; —Ü–µ–ª—å —É–∂–µ –ø–æ–±–µ–∂–¥–µ–Ω–∞; –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è.
    - HP —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `CombatEncounter.participants_json`.
    - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–æ—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ `CombatEncounter.combat_log_json` –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–π `StoryLog`.
    - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏ –≤ `src/core/__init__.py`.
    - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤ –∏–∑-–∑–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ –∫—Ä–∏—Ç. —É–¥–∞—Ä–∞, –ø—Ä–∏–≤–æ–¥–∏–≤—à–∞—è –∫ –Ω–µ–≤–µ—Ä–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—ã–∑–æ–≤–æ–≤ `roll_dice`.
    - –í—Å–µ 15 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_combat_engine.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md`**: –û–±–Ω–æ–≤–ª–µ–Ω –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –∏ –æ—á–∏—â–µ–Ω —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (–ø–æ—Å–ª–µ Task 22 –∏ 25)
- **–ê–Ω–∞–ª–∏–∑ –æ—Ç—á–µ—Ç–∞ Pyright**: –í—ã—è–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ `src/core/ability_system.py`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞**:
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `get_entity_stat`, `change_entity_stat` –∏–∑ `src.core.entity_stats_utils`.
    - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `func` –∏–∑ `sqlalchemy.sql`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏**:
    - –£–¥–∞–ª–µ–Ω–∞ –ª–∏—à–Ω—è—è –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –≤ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –±–ª–æ–∫–µ –∫–æ–¥–∞ (—Ä–∞–π–æ–Ω —Å—Ç—Ä–æ–∫–∏ 385), –≤—ã–∑—ã–≤–∞–≤—à–∞—è –æ—à–∏–±–∫—É "Expected expression".
- **–û–±–∑–æ—Ä –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∞**:
    - –£–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è (—Å—Ç–∞—Ä–∞—è, –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è) —Ñ—É–Ω–∫—Ü–∏—è `activate_ability`.
    - –ü–∞—Ä–∞–º–µ—Ç—Ä `ability_id` –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `activate_ability` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `ability_identifier` —Å —Ç–∏–ø–æ–º `Union[int, str]` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ª–æ–≥–∏–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –∏–º–ø–æ—Ä—Ç `PlayerStatus` –∏–∑ `src.models.enums` –≤ `src/core/ability_system.py` (–±—ã–ª –Ω–∞ –º–µ—Å—Ç–µ, –æ—à–∏–±–∫–∞ Pylance, –≤–µ—Ä–æ—è—Ç–Ω–æ, –∏–∑-–∑–∞ –∫—ç—à–∞).

## –ó–∞–¥–∞—á–∞ 25: üó∫Ô∏è 4.3 Location Transitions (Guild-Scoped)
- **–ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏ –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ Task 25.
    - –ò–∑—É—á–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `execute_move_for_player_action` –≤ `src/core/movement_logic.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏. –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ - –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏.
- **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `execute_move_for_player_action` (–¥–æ—Ä–∞–±–æ—Ç–∫–∞)**:
    - –í `execute_move_for_player_action` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏ –∏–∑ `RuleConfig` (–∫–ª—é—á `rules:party:movement:policy`).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ `"leader_only"`: –¥–≤–∏–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä —è–≤–ª—è–µ—Ç—Å—è –ª–∏–¥–µ—Ä–æ–º –ø–∞—Ä—Ç–∏–∏ (`party.leader_player_id == player.id`).
    - –î–ª—è —ç—Ç–æ–≥–æ –≤ –º–æ–¥–µ–ª—å `Party` (`src/models/party.py`) –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `leader_player_id` (ForeignKey –∫ `players.id`) –∏ —Å–≤—è–∑—å `leader`.
    - –°–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic (`7c27451a6727_add_leader_player_id_to_party.py`) –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è.
    - –ü–æ–ª–∏—Ç–∏–∫–∞ `"any_member"` (–ª—é–±–æ–π —á–ª–µ–Ω –ø–∞—Ä—Ç–∏–∏ –º–æ–∂–µ—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ) –æ—Å—Ç–∞–µ—Ç—Å—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è `execute_move_for_player_action` –≤ `action_processor.py`. –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å.
- **Unit-—Ç–µ—Å—Ç—ã**:
    - –û–±–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω —Ñ–∞–π–ª `tests/core/test_movement_logic.py`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `execute_move_for_player_action`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —É—Å–ø–µ—à–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (—Å–æ–ª–æ –∏ –≤ –ø–∞—Ä—Ç–∏–∏), –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤–∏–ª –ø–∞—Ä—Ç–∏–∏ ("leader_only", "any_member"), –æ—à–∏–±–∫–∏ (–ª–æ–∫–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –Ω–µ—Ç —Å–≤—è–∑–∏).
    - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `_find_location_by_identifier` (–ø–æ–∏—Å–∫ –ø–æ static_id, –ø–æ –∏–º–µ–Ω–∏ —Å —É—á–µ—Ç–æ–º —è–∑—ã–∫–∞ –∏ fallback).

## –ó–∞–¥–∞—á–∞ 22: üß† 3.3 API for Activating Abilities and Applying Statuses (Guild-Scoped)
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ `ability_system.py`**:
    - –§—É–Ω–∫—Ü–∏–∏ `activate_ability_v2` –∏ `apply_status_v2` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤ `activate_ability` –∏ `apply_status` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ; —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ —É–¥–∞–ª–µ–Ω—ã.
    - –í –º–æ–¥–µ–ª—å `ActiveStatusEffect` (`src/models/status_effect.py`) –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `source_entity_id` –∏ `source_entity_type` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–∞.
    - –°–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic `b3920fb77c09_add_source_entity_to_active_status_.py` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ –ë–î.
    - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª `src/core/entity_stats_utils.py` —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è HP –∏ –¥—Ä—É–≥–∏—Ö —Å—Ç–∞—Ç–æ–≤/—Ä–µ—Å—É—Ä—Å–æ–≤ —É —Å—É—â–Ω–æ—Å—Ç–µ–π (`Player`, `GeneratedNpc`).
    - –§—É–Ω–∫—Ü–∏—è `activate_ability` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `change_entity_hp` –∏–∑ `entity_stats_utils`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ `activate_ability`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç —Ä–µ—Å—É—Ä—Å–æ–≤ (–ø–æ–ª–µ `cost` –∏–∑ `properties_json` —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `get_entity_stat` –∏ `change_entity_stat`. –í —Å–ª—É—á–∞–µ –Ω–µ—Ö–≤–∞—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è.
    - –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ "caster_must_be_in_combat" –Ω–∞ –æ—Å–Ω–æ–≤–µ `RuleConfig` –∏ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞—Å—Ç–µ—Ä–∞ (`Player.current_status` –∏–ª–∏ `GeneratedNpc.properties_json["stats"]["status"]`).
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏-TODO –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–∞—Å—Ç–µ—Ä—É, –∫—É–ª–¥–∞—É–Ω—ã).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤ `activate_ability`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ `effect_data.target_scope` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è "self", "first_target", "all_targets").
    - –≠—Ñ—Ñ–µ–∫—Ç "damage": –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `change_entity_hp` –¥–ª—è –Ω–∞–Ω–µ—Å–µ–Ω–∏—è —É—Ä–æ–Ω–∞. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è `outcome.damage_dealt`.
    - –≠—Ñ—Ñ–µ–∫—Ç "healing": –¥–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–∏–ø —ç—Ñ—Ñ–µ–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `change_entity_hp` –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è HP. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è `outcome.healing_done`.
    - –≠—Ñ—Ñ–µ–∫—Ç "apply_status": –≤—ã–∑—ã–≤–∞–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é `apply_status`, –ø–µ—Ä–µ–¥–∞–≤–∞—è `status_static_id` –∏ `duration` –∏–∑ `effect_data`. –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è `outcome.applied_statuses`.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `apply_status`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞ –Ω–∞ —Ü–µ–ª–∏.
    - –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ `StatusEffect.properties_json` —Å–æ–¥–µ—Ä–∂–∏—Ç `duration_refresh: true`, —Ç–æ —É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ `ActiveStatusEffect` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è `duration_turns`, `remaining_turns`, `applied_at` –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–µ. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ (–µ—Å–ª–∏ `duration_refresh: false` –∏–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ), –∏ —Å—Ç–∞—Ç—É—Å —É–∂–µ –µ—Å—Ç—å, –Ω–æ–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `False`).
    - –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π `ActiveStatusEffect`.
    - –ü–æ–ª—è `source_entity_id` –∏ `source_entity_type` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è.
    - –ü–æ–ª–µ `remaining_turns` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º `duration_turns`.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `remove_status`**:
    - –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ `active_status_id`) –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏ –¥–ª—è Task 22.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ `AbilityOutcomeDetails` –≤ `activate_ability`**:
    - `AbilityOutcomeDetails` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ `damage_dealt`, `healing_done`, `applied_statuses`, `caster_updates`.
    - –û–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–Ω–µ—É–¥–∞—á–µ –≤ `outcome.message` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.
    - `log_event_details` –≤ `AbilityOutcomeDetails` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π JSON –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ `StoryLog`.
    - –í—ã–∑–æ–≤ `log_event` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∫–æ–Ω—Ü–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ `activate_ability` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é —Å–µ—Å—Å–∏—é –∏ –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π (commit/rollback), —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_ability_system.py`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è `activate_ability`, `apply_status` –∏ `remove_status`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—É—Å–ø–µ—Ö, –Ω–µ—Ö–≤–∞—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤.

## –ó–∞–¥–∞—á–∞ 19 / –ó–∞–¥–∞—á–∞ 54 (Log and Feedback Formatting): –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- –í—ã–ø–æ–ª–Ω–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md` –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.
- –ó–∞–¥–∞—á–∞ 54 ("‚öôÔ∏è 6.7.1 Log and Feedback Formatting System (Full, Multy-i18n, Guild-Scoped)") —É–¥–∞–ª–µ–Ω–∞ –∏–∑ `Tasks.txt`.
- –ó–∞–ø–∏—Å—å –æ Task 19 ("üìö 7.3 Turn and Report Formatting (Guild-Scoped)") –≤ `Done.txt` –ø—Ä–∏–∑–Ω–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏ –ø–æ–ª–Ω–æ–π.
- –°–µ–∫—Ü–∏—è "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –≤ `AGENTS.md` –æ—á–∏—â–µ–Ω–∞.

## –ó–∞–¥–∞—á–∞ 19 (–†–∞–Ω–µ–µ): üìö 7.3 Turn and Report Formatting (Guild-Scoped)
- **–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**:
    - –ò–∑—É—á–µ–Ω—ã `src/models/story_log.py`, `src/models/enums.py` (–¥–ª—è `EventType`), `src/core/rules.py`, `src/core/localization_utils.py`, `src/core/report_formatter.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã.
    - –í—ã–≤–æ–¥: –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –¥–ª—è Task 19 —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤–∫–ª—é—á–∞—è `get_localized_entity_name`, `get_batch_localized_entity_names`, `_format_log_entry_with_names_cache` (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –º–Ω–æ–≥–∏—Ö `EventType`), `format_turn_report` –∏ `_collect_entity_refs_from_log_entry`. –ó–∞–¥–∞—á–∞ —Å–≤–æ–¥–∏—Ç—Å—è –∫ –¥–æ—Ä–∞–±–æ—Ç–∫–µ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ `get_localized_entity_name`**:
    - –§—É–Ω–∫—Ü–∏–∏ `get_localized_entity_name` –∏ `get_batch_localized_entity_names` –≤ `src/core/localization_utils.py` –ø—Ä–∏–∑–Ω–∞–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `_format_log_entry_with_names_cache` –≤ `src/core/report_formatter.py`**:
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–ª–∏ —É–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö `EventType`: `NPC_ACTION`, `ITEM_USED`, `ITEM_DROPPED`, `DIALOGUE_START`, `DIALOGUE_END`, `FACTION_CHANGE`.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–ª—è –∏–≥—Ä–æ–∫–∞ —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SYSTEM_EVENT`, —Å–æ–±—ã—Ç–∏—è AI, —Å–æ–±—ã—Ç–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π), –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–æ–¥–∏—Ç —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ `details_json`.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_report_formatter.py` –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ `format_turn_report`**:
    - –§—É–Ω–∫—Ü–∏—è `format_turn_report` –≤ `src/core/report_formatter.py` –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ –ø—Ä–∏–∑–Ω–∞–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `_collect_entity_refs_from_log_entry` –≤ `src/core/report_formatter.py`**:
    - –î–æ–ø–æ–ª–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–±–æ—Ä–∞ ID —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–ª—è `NPC_ACTION`, `ITEM_USED`, `ITEM_DROPPED`, `DIALOGUE_START`, `DIALOGUE_END`, `FACTION_CHANGE`.
    - –î–æ–±–∞–≤–ª–µ–Ω –±–∞–∑–æ–≤—ã–π —Å–±–æ—Ä ID –¥–ª—è –æ–±—â–∏—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_report_formatter.py` –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ `src/core/__init__.py`**:
    - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`format_turn_report`, `get_localized_entity_name`, `get_batch_localized_entity_names`, `get_localized_text`) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è. –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∏—Å—å.

## –ó–∞–¥–∞—á–∞ 6.1.1: ‚öôÔ∏è Intra-Location Interaction Handler Module
- **–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –∏ –ª–æ–≥–æ–≤**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `Tasks.txt` –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–æ–≥ –≤ `AGENTS.MD` (–ó–∞–¥–∞—á–∞ 29), –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ó–∞–¥–∞—á–µ 6.1.1.
    - –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `handle_intra_location_action` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (NLU, `action_processor`) —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
    - –ö–ª—é—á–µ–≤–∞—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∞—è —á–∞—Å—Ç—å: –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –∏–Ω—Ç–µ–Ω—Ç–∞ `interact` —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π `RuleConfig` –∏ `resolve_check`.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ç–µ–Ω—Ç–∞ `interact` –≤ `src/core/interaction_handlers.py`**:
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏–∑ `RuleConfig` –ø–æ –∫–ª—é—á—É `interactions:<interaction_rules_key>`.
    - –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ (`requires_check: true`):
        - –°–æ–±–∏—Ä–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è `resolve_check` (—Ç–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏, –∞—Ç—Ä–∏–±—É—Ç –∏–≥—Ä–æ–∫–∞, DC).
        - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `core.check_resolver.resolve_check`.
        - –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`log_event`). –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–ª—é—á –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –¥–ª—è –±—É–¥—É—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    - –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:
        - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–ª—é—á –ø—Ä—è–º—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –≤ `_format_feedback` –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ö–æ–¥–æ–≤ `interact`.
    - –û–±–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è `player_interact` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –æ –ø—Ä–∞–≤–∏–ª–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_interaction_handlers.py`**:
    - –¢–µ—Å—Ç `test_interact_existing_object_with_rules_placeholder` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `test_interact_object_with_check_success` –∏ –æ–±–Ω–æ–≤–ª–µ–Ω.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã:
        - `test_interact_object_with_check_failure` (–ø—Ä–æ–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏).
        - `test_interact_object_no_check_required` (–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏).
        - `test_interact_object_rule_not_found` (–ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–ª—é—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ RuleConfig).
    - –¢–µ—Å—Ç `test_interact_existing_object_no_rules` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `test_interact_object_no_interaction_key` –∏ —É—Ç–æ—á–Ω–µ–Ω.
    - –¢–µ—Å—Ç—ã –º–æ–∫–∏—Ä—É—é—Ç `get_rule` –∏ `resolve_check`, –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏—Ö –≤—ã–∑–æ–≤–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

## –ó–∞–¥–∞—á–∞ 27: ‚öîÔ∏è 5.2 Combat Engine Module
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `process_combat_action` –∏–∑ `Tasks.txt`.
    - –ò–∑—É—á–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `src/core/combat_engine.py` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (`CombatEncounter`, `Player`, `GeneratedNpc`, `CombatActionResult`, `CheckResult`).
    - –í—ã—è–≤–ª–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig`, –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `resolve_check` –∏ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–Ω–∞.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `CombatActionResult`**:
    - –í `src/models/combat_outcomes.py` —É—Ç–æ—á–Ω–µ–Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–ª—è `check_result` –Ω–∞ `Optional[CheckResult]` –≤–º–µ—Å—Ç–æ `Optional[Dict[str, Any]]`.
    - –î–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä—è–º–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ `CheckResult` –µ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–≤–º–µ—Å—Ç–µ —Å `ModifierDetail`, `CheckOutcome`) –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –∏–∑ `src/core/check_resolver.py` –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `src/models/check_results.py`.
    - –í `src/models/__init__.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (`CheckResult`, `CheckOutcome`, `ModifierDetail`) –∏ –≤—ã–∑–æ–≤—ã `model_rebuild()` –¥–ª—è `CombatActionResult` –∏ —ç—Ç–∏—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ forward-—Å—Å—ã–ª–æ–∫ Pydantic.
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `process_combat_action` –≤ `src/core/combat_engine.py`**:
    - **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –£–ª—É—á—à–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ `CombatEncounter` (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `guild_id`), –∞–∫—Ç–æ—Ä–∞ –∏ —Ü–µ–ª–∏. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π.
    - **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
        - `_get_combat_rule`: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –±–æ—è, —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –∏–∑ `combat_encounter.rules_config_snapshot_json`, –∑–∞—Ç–µ–º –∏–∑ `RuleConfig` (`core.rules.get_rule`).
        - `_get_participant_stat`: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–æ–≤ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –±–æ—è, —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –∏–∑ `participant_data` (–≤ `CombatEncounter.participants_json`), –∑–∞—Ç–µ–º –∏–∑ –±–∞–∑–æ–≤–æ–π –º–æ–¥–µ–ª–∏ (`Player`, `GeneratedNpc.properties_json.stats`), —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞—Å—á–µ—Ç–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ (`_modifier` –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Å—Ç–∞—Ç–∞).
        - `_calculate_attribute_modifier`: –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∞—Ç—Ä–∏–±—É—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ñ–æ—Ä–º—É–ª—ã –∏–∑ `RuleConfig` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `(value - 10) // 2`).
    - **–õ–æ–≥–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è "attack"**:
        - **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è "attack" (—Ç–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏, –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –∞—Ç–∞–∫–∏/—É—Ä–æ–Ω–∞, DC, —Ñ–æ—Ä–º—É–ª–∞ —É—Ä–æ–Ω–∞, –ø—Ä–∞–≤–∏–ª–∞ –∫—Ä–∏—Ç. —É–¥–∞—Ä–∞) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `_get_combat_rule`.
        - **–†–∞—Å—á–µ—Ç DC**: DC –¥–ª—è –∞—Ç–∞–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `dc_base` (–∏–∑ –ø—Ä–∞–≤–∏–ª) + –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—Ç—Ä–∏–±—É—Ç–∞ —Ü–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≤–∫–æ—Å—Ç–∏, –∏–∑ –ø—Ä–∞–≤–∏–ª).
        - **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**: –í—ã–∑–æ–≤ `core.check_resolver.resolve_check` —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–≥–æ DC, —Ç–∏–ø–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏, –¥–µ—Ç–∞–ª–µ–π –∞–∫—Ç–æ—Ä–∞/—Ü–µ–ª–∏. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `CheckError`.
        - **–†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞**:
            - –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞: –ø–æ–ª—É—á–∞–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∞—Ç—Ä–∏–±—É—Ç–∞ —É—Ä–æ–Ω–∞ –∞–∫—Ç–æ—Ä–∞. –§–æ—Ä–º—É–ª–∞ —É—Ä–æ–Ω–∞ (–∏–∑ –ø—Ä–∞–≤–∏–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, "1d6+@actor_strength_modifier") –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è: –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º. `core.dice_roller.roll_dice` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ —Ñ–æ—Ä–º—É–ª—ã.
            - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–Ω–æ–∂–∏—Ç–µ–ª—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–Ω–∞ (–∏–∑ –ø—Ä–∞–≤–∏–ª), –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ - –∫—Ä–∏—Ç. —É—Å–ø–µ—Ö.
            - –£—Ä–æ–Ω –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º.
        - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP**: HP —Ü–µ–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `participants_data` (in-memory —Å–ø–∏—Å–æ–∫ –¥–ª—è `combat_encounter.participants_json`).
        - **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è**: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–∞ –∞—Ç–∞–∫–∏.
        - **`CombatActionResult`**: –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Å–µ–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ (—É—Å–ø–µ—Ö, —É—Ä–æ–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ–ø–∏—Å–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞).
    - **–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `CombatActionResult` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—è**: `combat_encounter.participants_json` –∏ `combat_encounter.combat_log_json` –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è.
    - **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ StoryLog**: –í—ã–∑–æ–≤ `core.game_events.log_event` —Å –ø–æ–ª–Ω—ã–º–∏ `details_json` (–≤–∫–ª—é—á–∞—è `action_result`) –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º `entity_ids_json` (–∞–∫—Ç–æ—Ä –∏ —Ü–µ–ª—å). –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –≤—ã–∑–æ–≤ `log_event`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_combat_engine.py`**:
    - –¢–µ—Å—Ç—ã –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `async def` —Ñ—É–Ω–∫—Ü–∏–π –∏ –∏—Ö `side_effect` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `async def` —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ `side_effect` –¥–ª—è `AsyncMock`).
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ü–µ–ª–∏ –ø–∞—Ç—á–µ–π –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –≤ `combat_engine.py` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `patch('src.core.combat_engine.get_rule', ...)` –≤–º–µ—Å—Ç–æ `patch('src.core.rules.get_rule', ...)`).
    - –ú–æ–∫ –¥–ª—è `dice_roller.roll_dice` –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `MagicMock`, —Ç–∞–∫ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è.
    - –ú–æ–∫ –¥–ª—è `resolve_check` –≤ —Ç–µ—Å—Ç–µ –Ω–∞ `CheckError` —Ç–µ–ø–µ—Ä—å –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ `side_effect`.
    - –ü–æ–∫—Ä—ã—Ç—ã —Å—Ü–µ–Ω–∞—Ä–∏–∏: —É—Å–ø–µ—à–Ω–∞—è –∞—Ç–∞–∫–∞ (–ø–æ–ø–∞–¥–∞–Ω–∏–µ, —É—Ä–æ–Ω, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP), –ø—Ä–æ–º–∞—Ö, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–∑ snapshot, –æ—à–∏–±–∫–∏ (–±–æ–π/–∞–∫—Ç–æ—Ä/—Ü–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –æ—à–∏–±–∫–∞ –≤ `resolve_check`).
    - –í—Å–µ 7 —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∑–∞–¥–∞—á–∏ (Task 26)**:
    - –ó–∞–¥–∞—á–∞ 26 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ `Tasks.txt`.
    - –ó–∞–¥–∞—á–∞ 26 –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `Done.txt`.

## –ó–∞–¥–∞—á–∞ 19 (—Å—Ç–∞—Ä–∞—è): üìö 7.3 Turn and Report Formatting (Guild-Scoped) - Revisit
- **–¶–µ–ª—å –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞**: –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —á–∏—Å–ª–∞ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π –≤ `src/core/report_formatter.py`.
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π**:
    - –ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ `_collect_entity_refs_from_log_entry` –∏ `_format_log_entry_with_names_cache` –±—ã–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `COMBAT_START`, `QUEST_ACCEPTED`, `QUEST_STEP_COMPLETED`, `QUEST_COMPLETED`, `LEVEL_UP`, `XP_GAINED`, `RELATIONSHIP_CHANGE`, `STATUS_APPLIED`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:
    - –í —Ñ—É–Ω–∫—Ü–∏—é `_format_log_entry_with_names_cache` –¥–æ–±–∞–≤–ª–µ–Ω—ã –±–ª–æ–∫–∏ `elif` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 8 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.
    - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ `log_entry_details_json`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `get_name_from_cache` –¥–ª—è –∏–º–µ–Ω —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ `get_term` –¥–ª—è –ª–æ–∫–∞–ª–∏–∑—É–µ–º—ã—Ö —Å—Ç—Ä–æ–∫ –∏ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π.
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –í `tests/core/test_report_formatter.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 8 –Ω–æ–≤—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å–æ–±—ã—Ç–∏–π.
    - –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —è–∑—ã–∫–æ–≤ `en` –∏ `ru`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞ –∏–º–µ–Ω –∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ `RuleConfig` (—á–µ—Ä–µ–∑ –º–æ–∫–∏).
- **–†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:
    - –ë—ã–ª–∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Å–æ–±—ã—Ç–∏–π –∏–∑ `EventType`. –ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `DIALOGUE_LINE`, `STATUS_REMOVED` –∏ `QUEST_FAILED` –∫–∞–∫ –Ω–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –æ—Ç—á–µ—Ç–æ–≤.
    - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_collect_entity_refs_from_log_entry` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–±–æ—Ä–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è `DIALOGUE_LINE` –∏ `QUEST_FAILED` (–¥–ª—è `STATUS_REMOVED` —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è `STATUS_APPLIED` –ø–æ–¥—Ö–æ–¥–∏—Ç).
    - –í `_format_log_entry_with_names_cache` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `DIALOGUE_LINE`, `STATUS_REMOVED`, `QUEST_FAILED`.
    - –í `tests/core/test_report_formatter.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ unit-—Ç–µ—Å—Ç—ã –¥–ª—è —ç—Ç–∏—Ö —Ç—Ä–µ—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.
- **–û–±–∑–æ—Ä –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**:
    - –ü—Ä–æ–≤–µ–¥–µ–Ω –æ–±–∑–æ—Ä –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º. –í–æ–ø—Ä–æ—Å –ø–µ—Ä–µ–¥–∞—á–∏ —Å–µ—Å—Å–∏–∏ –≤ `get_rule` —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º–∞—Ç–µ—Ä –æ—Å—Ç–∞–µ—Ç—Å—è –∏–∑–≤–µ—Å—Ç–Ω–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å—é, –Ω–µ —Ç—Ä–µ–±—É—é—â–µ–π –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–æ–¥—É–ª—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π, —É–ª—É—á—à–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—é –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤.
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (–°–µ—Å—Å–∏—è 2024-07-04):**
    - **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å `AsyncSession` –≤ `_format_log_entry_with_names_cache`**:
        - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ `_format_log_entry_with_names_cache` –¥–ª—è –ø—Ä–∏–µ–º–∞ `AsyncSession` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.
        - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è `get_term` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `core.rules.get_rule`.
        - –§—É–Ω–∫—Ü–∏—è `format_turn_report` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `AsyncSession` –≤ `_format_log_entry_with_names_cache`.
        - Unit-—Ç–µ—Å—Ç—ã –≤ `tests/core/test_report_formatter.py` —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `mock_session` –≤ –≤—ã–∑–æ–≤—ã `_format_log_entry_with_names_cache`.
    - **–£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —è–∑—ã–∫–æ–≤–æ–≥–æ fallback –≤ `get_term`**:
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π fallback:
            1. –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∏–∑ `RuleConfig`.
            2. –û—Å–Ω–æ–≤–Ω–æ–π fallback-—è–∑—ã–∫ ("en") –∏–∑ `RuleConfig`.
            3. –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–π —è–∑—ã–∫ –∏–∑ `default_text_map`.
            4. –û—Å–Ω–æ–≤–Ω–æ–π fallback-—è–∑—ã–∫ ("en") –∏–∑ `default_text_map`.
            5. –ü–µ—Ä–≤–æ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `default_text_map`.
            6. –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –µ—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω.
    - –í—Å–µ —Ç–µ—Å—Ç—ã (356) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è: –ê–Ω–∞–ª–∏–∑ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –ó–∞–¥–∞—á 1.1 –∏ 1.2 (—Å—Ç–∞—Ä—ã–π –ª–æ–≥)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–æ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏) ...

## –ó–∞–¥–∞—á–∞ 19 (—Å—Ç–∞—Ä—ã–π –ª–æ–≥): üìö 7.3 Turn and Report Formatting (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 23: üó∫Ô∏è 4.1 Location Model (i18n, Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 21: üß† 3.2 Entity Status Model (i18n, Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 18: üìö 7.2 AI Narrative Generation (Multilang)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 20: üß† 3.1 Ability Model (i18n, Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 26: ‚öîÔ∏è 5.1 Combat and Participant Model (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 1: üó∫Ô∏è 4.3 Location Transitions (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 2: üß† 3.3 API for Activating Abilities and Applying Statuses (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 4: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç–∞
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 5: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 7: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-—Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 8: üé≤ 6.3.2 Check Resolver Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 9: üé≤ 6.3.1 Dice Roller Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 10: –°–µ—Å—Å–∏—è [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è]: –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 11: üöÄ 0.1 Discord Bot Project Initialization
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 12: üóÑÔ∏è 0.2 DBMS Setup and Database Model Definition
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 13: üõ†Ô∏è 0.3 Core Utils
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 14: üåç 1.1 Location Model, Utils, and Default Population
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 15: üë• 1.2 Player and Party System
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 16: üö∂ 1.3 Movement Logic and Command
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 17: üì¶ 2.1 Finalize Definition of ALL DB Schemas
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 18 (—Å—Ç–∞—Ä—ã–π): ü§ñ 2.2 AI Prompt Preparation Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 19 (–æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã–π): ‚úÖ 2.3 AI Prompt Construction Logic
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 20 (—Å—Ç–∞—Ä—ã–π): üß† 2.6 AI Generation, Moderation, and Saving Logic
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 21 (—Å—Ç–∞—Ä—ã–π): ‚öôÔ∏è 6.10 Action Parsing and Recognition Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 22: ‚öôÔ∏è 6.12 Turn Queue System
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 23 (—Å—Ç–∞—Ä—ã–π): ‚öôÔ∏è 6.11 Central Collected Actions Processing Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 24: üó∫Ô∏è 4.2 Guild Map Generation and Editing (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 25 (—Å—Ç–∞—Ä—ã–π): –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç –¥–ª—è main.py
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 26 (—Å—Ç–∞—Ä—ã–π): –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –∏ TypeError
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 27 (—Å—Ç–∞—Ä—ã–π): –í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ –º–∏–≥—Ä–∞—Ü–∏—è—Ö Alembic
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 28: üìö 7.1 Event Log Model (Story Log, i18n, Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 29: ‚öôÔ∏è 6.1.1 Intra-Location Interaction Handler Module
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 30: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 31: üìö 7.2 AI Narrative Generation (Multilang)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 32: üìö 7.3 Turn and Report Formatting (Guild-Scoped)
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 33: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 34: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 35: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...

## –ó–∞–¥–∞—á–∞ 36: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
- ... (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –æ–ø—É—â–µ–Ω–æ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏) ...
