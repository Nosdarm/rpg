## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã:**

1.  **–ê–Ω–∞–ª–∏–∑ `AGENTS.md`:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ª—é–±–æ–π —Ä–∞–±–æ—Ç—ã –≤—Å–µ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª (`AGENTS.md`).
2.  **–†–∞–±–æ—Ç–∞ —Å –∑–∞–¥–∞—á–∞–º–∏ –∏–∑ `tasks.txt`:**
    *   –í–∑—è—Ç—å –æ–¥–Ω—É –∑–∞–¥–∞—á—É –∏–∑ —Ñ–∞–π–ª–∞ `tasks.txt` –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É.
    *   –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É.
    *   –ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).
    *   –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
        *   –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã.
        *   –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç, —Å–Ω–∞—á–∞–ª–∞ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É, –∑–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç.
        *   –ü–æ–≤—Ç–æ—Ä—è—Ç—å –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –≤—Å–µ —Ç–µ—Å—Ç—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ –∑–∞–¥–∞—á–µ, –Ω–µ –ø—Ä–æ–π–¥—É—Ç.
    *   –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
        *   –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É –∏–∑ —Ñ–∞–π–ª–∞ `tasks.txt`.
        *   –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ (–¥–æ–±–∞–≤–∏—Ç—å) –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ –≤ —Ñ–∞–π–ª `done.txt`.
3.  **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
    *   –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—É–¥—É—â–µ–º, —Å–æ–∑–¥–∞—Ç—å –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ (`AGENTS.md`) —Å–µ–∫—Ü–∏—é "–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏".
    *   –£–∫–∞–∑–∞—Ç—å –≤ —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏ –∑–∞–¥–∞—á—É, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å, –∏ —É–∫–∞–∑–∞—Ç—å, –∫–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å.
4.  **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `AGENTS.md` –∏ –ö–æ–º–º–∏—Ç:**
    *   –ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–æ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏, –æ–±–Ω–æ–≤–∏—Ç—å `AGENTS.md` –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ (–≤ —Å–µ–∫—Ü–∏–∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π").
    *   –°–¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π.
5.  **–õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –≤ `AGENTS.md`:**
    *   `AGENTS.md` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤–∞—à–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Ä–µ—à–µ–Ω–∏–π.
    *   –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–æ–µ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ `AGENTS.md` –≤ —Å–µ–∫—Ü–∏–∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏.
6.  **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏:**
    *   –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    *   –≠—Ç–æ—Ç –ø–ª–∞–Ω –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Å–µ–∫—Ü–∏—é "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –≤ `AGENTS.md`. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —ç—Ç–∞ —Å–µ–∫—Ü–∏—è –æ—á–∏—â–∞–µ—Ç—Å—è –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏.
7.  **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π:**
    *   –Ø–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤ —Ö–æ–¥–µ —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞, –∏–º–µ—é—Ç –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
    *   –ó–∞—Ç–µ–º —Å–ª–µ–¥—É—é—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ ("–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞").

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `AGENTS.md` (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è):**

*   **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ê–≥–µ–Ω—Ç–∞:** (–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª)
*   **–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω:**
    *(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–ª–∞–Ω–æ–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏)*
*   **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
    *(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—É–¥—É—â–µ–º)*
*   **–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π:** –•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞—á–∏, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–¥–∞—á–∞–º. –ó–∞–¥–∞—á–∏ –Ω—É–º–µ—Ä—É—é—Ç—Å—è.

---

## –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω
*(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ—á–∏—â–µ–Ω)*

---
## –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
*(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—É–¥—É—â–µ–º)*

---

## –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π

## –ó–∞–¥–∞—á–∞ 23: üó∫Ô∏è 4.1 Location Model (i18n, Guild-Scoped)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
    - –ò–∑—É—á–µ–Ω—ã `src/models/location.py`, `src/models/__init__.py`, `src/core/crud/crud_location.py`, `src/core/locations_utils.py` –∏ –Ω–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è Alembic `fcb2e6d12a18_initial_schema_setup.py`.
    - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª—å `Location` –∏ –±–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ Task 23:**
    - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π (`id`, `guild_id`, `static_id`, `name_i18n`, `descriptions_i18n`, `type`, `coordinates_json`, `neighbor_locations_json`, `generated_details_json`, `ai_metadata_json`) —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏.
    - –û—Ç–º–µ—á–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sa.JSON` –≤–º–µ—Å—Ç–æ —è–≤–Ω–æ–≥–æ `postgresql.JSONB` –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –ü–æ–ª–µ `static_id` `nullable=True` –ø—Ä–∏–∑–Ω–∞–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–º.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–∏–ª–∏—Ç:**
    - –§—É–Ω–∫—Ü–∏–∏ `get_location` (—á–µ—Ä–µ–∑ `location_crud.get`), `get_location_by_static_id` –∏ `get_localized_text` —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:**
    - –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `GuildConfig` –∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π –≤ `on_guild_join` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ `src/bot/events.py`, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ª–æ–≥–∏ –≤ `AGENTS.md` (–ó–∞–¥–∞—á–∞ 14).
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥–µ–ª–∏ –∏ —É—Ç–∏–ª–∏—Ç:**
    - –ú–æ–¥–µ–ª—å `Location` –≤ `src/models/location.py` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `postgresql.JSONB` –≤–º–µ—Å—Ç–æ `sa.JSON` –¥–ª—è –ø–æ–ª–µ–π `name_i18n`, `descriptions_i18n`, `coordinates_json`, `neighbor_locations_json`, `generated_details_json`, `ai_metadata_json`.
    - –°–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è Alembic `alembic/versions/0005_use_jsonb_for_location_fields.py` –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π JSON -> JSONB. `down_revision` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ `0004`.
    - –í `src/models/guild.py` –≤ –º–æ–¥–µ–ª—å `GuildConfig` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `name: Mapped[str | None]`. –ù–∞—á–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `fcb2e6d12a18_initial_schema_setup.py` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø–æ–ª—è.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/crud/crud_guild.py` —Å –∫–ª–∞—Å—Å–æ–º `CRUDGuild(CRUDBase[GuildConfig])` –∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–º `guild_crud`.
    - `guild_crud` –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–º–ø–æ—Ä—Ç—ã –∏ `__all__` –≤ `src/core/crud/__init__.py`.
    - –í `src/bot/events.py`:
        - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã (`guild_crud`, `location_crud`, `update_rule_config`, `GuildConfig`, `Location`, `LocationType`).
        - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `DEFAULT_STATIC_LOCATIONS` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –ª–æ–∫–∞—Ü–∏–π.
        - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã `_ensure_guild_config_exists` (—Å–æ–∑–¥–∞–µ—Ç `GuildConfig` —Å `id`, `name`, `main_language='en'` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `update_rule_config` –¥–ª—è `guild_main_language`) –∏ `_populate_default_locations` (—Å–æ–∑–¥–∞–µ—Ç –ª–æ–∫–∞—Ü–∏–∏ –∏–∑ `DEFAULT_STATIC_LOCATIONS`, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç).
        - –ú–µ—Ç–æ–¥ `on_guild_join` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞ `_ensure_guild_config_exists` –∏ `_populate_default_locations` –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional`, —Å–µ—Å—Å–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ `* , session: AsyncSession`).
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤:**
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/models/test_location.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –º–æ–¥–µ–ª–∏ `Location` (—Å–æ–∑–¥–∞–Ω–∏–µ, –≤—Å–µ –ø–æ–ª—è, –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, `__repr__`), –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π SQLite —Å "–∑–∞–≥–ª—É—à–∫–æ–π" –¥–ª—è JSONB.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_locations_utils.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `get_localized_text` (—Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏) –∏ —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `get_location`, `get_location_by_static_id` (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLite in-memory).
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ `tests/bot/commands/test_map_commands.py` –∏ `tests/core/test_world_generation.py` (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ `generate_new_location_via_ai` –Ω–∞ `generate_location`).
    - –í—Å–µ 281 —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–π.

## –ó–∞–¥–∞—á–∞ 21: üß† 3.2 Entity Status Model (i18n, Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `StatusEffect` –∏ `ActiveStatusEffect`** –≤ `src/models/status_effect.py`.
    - `StatusEffect` –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è: `id`, `guild_id` (FK, `nullable=False`), `static_id` (`nullable=False`), `name_i18n`, `description_i18n`, `properties_json`. –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ `GuildConfig` –∏ `UniqueConstraint("guild_id", "static_id")`.
    - `ActiveStatusEffect` –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è: `id`, `entity_id`, `entity_type`, `status_effect_id` (FK), `guild_id` (FK, `nullable=False`), `applied_at`, `duration_turns`, `remaining_turns`, `source_ability_id`, `custom_properties_json`. –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ `StatusEffect` –∏ `GuildConfig`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `GuildConfig`** –≤ `src/models/guild.py`.
    - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ `active_status_effects: Mapped[List["ActiveStatusEffect"]]`. –û—Ç–Ω–æ—à–µ–Ω–∏–µ `status_effects` —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ.
- **–û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py`**.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ `StatusEffect` –∏ `ActiveStatusEffect` —É–∂–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ª–æ–≥–≥–µ—Ä. –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∏—Å—å.
- **–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è Alembic** `alembic/versions/0004_create_status_effects_tables.py`.
    - `down_revision` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ `0003`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `upgrade()` –∏ `downgrade()` –¥–ª—è —Ç–∞–±–ª–∏—Ü `status_effects` –∏ `active_status_effects`.
- **–ù–∞–ø–∏—Å–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ Unit-—Ç–µ—Å—Ç—ã** –¥–ª—è –º–æ–¥–µ–ª–µ–π `StatusEffect` –∏ `ActiveStatusEffect` –≤ `tests/models/test_status_effect.py`.
    - –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –º–æ–¥–µ–ª–µ–π —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—è InMemory SQLite.

## –ó–∞–¥–∞—á–∞ 18: üìö 7.2 AI Narrative Generation (Multilang)

---
## –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
*(–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –±—É–¥—É—â–µ–º)*

---

## –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π

## –ó–∞–¥–∞—á–∞ 18: üìö 7.2 AI Narrative Generation (Multilang)
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `generate_narrative` –∏–∑ `Tasks.txt` (–ó–∞–¥–∞—á–∞ 18).
    - –ò–∑—É—á–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `generate_narrative` –≤ `src/core/ai_orchestrator.py`.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ —è–∑—ã–∫–∞ (–∏–≥—Ä–æ–∫ -> –≥–∏–ª—å–¥–∏—è -> 'en') –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞.
    - –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω —Å–≤—è–∑–∞–Ω–Ω—ã–π –∫–æ–¥: `src/core/rules.py` (–¥–ª—è `get_rule`), `src/models/player.py` (–¥–ª—è `selected_language`).
    - –í—ã–≤–æ–¥: –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ `src/core/ai_orchestrator.py` —É–∂–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–¥–∞—á–∏.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `generate_narrative`**:
    - –°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü–∏–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ `guild_id`, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
    - –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã `get_player` –∏ `get_rule` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ LLM –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
    - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏ `generate_narrative` –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/core/__init__.py`**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ `generate_narrative` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ `ai_orchestrator` –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `__all__`. –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∏—Å—å.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ/–ø—Ä–æ–≤–µ—Ä–∫–∞ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –¥–ª—è `generate_narrative` –≤ `tests/core/test_ai_orchestrator.py`.
    - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ —è–∑—ã–∫–µ –∏–≥—Ä–æ–∫–∞, –≥–∏–ª—å–¥–∏–∏, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é; –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞; –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ LLM.
    - –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∏—Å—å. –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç.


## –ó–∞–¥–∞—á–∞ 20: üß† 3.1 Ability Model (i18n, Guild-Scoped)
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –º–æ–¥–µ–ª–∏ `Ability`**:
    - –ü–æ–ª—è: `id` (PK), `guild_id` (BIGINT, Indexed, NOT NULLABLE), `static_id` (TEXT, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö `guild_id`), `name_i18n` (JSONB), `description_i18n` (JSONB), `properties_json` (JSONB).
- **–°–æ–∑–¥–∞–Ω–∏–µ/–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –º–æ–¥–µ–ª–∏ `src/models/ability.py`**:
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–ª–∞—Å—Å `Ability` —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏.
    - `guild_id` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ `nullable=False` –∏ `ondelete="CASCADE"`.
    - –î–æ–±–∞–≤–ª–µ–Ω `UniqueConstraint` –¥–ª—è (`guild_id`, `static_id`).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ `guild: Mapped["GuildConfig"]`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/models/guild.py`**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è `abilities: Mapped[List["Ability"]]`. –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/models/__init__.py`**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –∏–º–ø–æ—Ä—Ç–∞ `Ability` –∏ –µ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏–µ –≤ –ª–æ–≥–≥–µ—Ä –∏ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π) `__all__`. –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å.
- **–°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0003_create_abilities_table.py`.
    - `down_revision` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ `0002`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `upgrade()` –∏ `downgrade()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `abilities`.

## –ó–∞–¥–∞—á–∞ 26: ‚öîÔ∏è 5.1 Combat and Participant Model (Guild-Scoped)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω Enum `CombatStatus`**:
    - –í `src/models/enums.py` –¥–æ–±–∞–≤–ª–µ–Ω `CombatStatus` —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏: `PENDING_START`, `ACTIVE`, `PLAYER_TURN`, `NPC_TURN`, `ENDED_VICTORY_PLAYERS`, `ENDED_VICTORY_NPCS`, `ENDED_STALEMATE`, `ENDED_ESCAPED`, `ERROR`.
    - `src/models/__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ `CombatStatus` –∏ –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ª–æ–≥–≥–µ—Ä.
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `CombatEncounter`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/models/combat_encounter.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å `CombatEncounter` —Å –ø–æ–ª—è–º–∏: `id`, `guild_id`, `location_id`, `status` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `CombatStatus`), `current_turn_entity_id`, `current_turn_entity_type`, `turn_order_json`, `rules_config_snapshot_json`, `participants_json`, `combat_log_json`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ `GuildConfig` –∏ `Location`.
    - `src/models/guild.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ `combat_encounters`.
- **–û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py`**:
    - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å `CombatEncounter`.
    - `CombatEncounter` –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞.
- **–°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0002_create_combat_encounter_table.py`.
    - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `down_revision = 'fcb2e6d12a18'`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è ENUM `combat_status_enum` –∏ —Ç–∞–±–ª–∏—Ü—ã `combat_encounters` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏, –≤–Ω–µ—à–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ –∏ server_default –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞.
- **–ù–∞–ø–∏—Å–∞–Ω—ã Unit-—Ç–µ—Å—Ç—ã (–±–∞–∑–æ–≤—ã–µ)**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/models/test_combat_encounter.py`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `CombatEncounter` (—Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏) –∏ –º–µ—Ç–æ–¥–∞ `__repr__`. –¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç SQLite in-memory –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## –ó–∞–¥–∞—á–∞ 1: üó∫Ô∏è 4.3 Location Transitions (Guild-Scoped)
- **–ê–Ω–∞–ª–∏–∑ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è `movement_logic.py` (–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è)**:
    - –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `execute_move_for_player_action(session: AsyncSession, guild_id: int, player_id: int, target_location_identifier: str) -> dict` –≤ `src/core/movement_logic.py`.
    - –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `player_id` (PK) –∏ `session`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ `target_location_identifier` –ø–æ `static_id`. –î–æ–±–∞–≤–ª–µ–Ω `TODO` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏.
    - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑ `handle_move_action` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤—è–∑–Ω–æ—Å—Ç–∏, –¥–≤–∏–∂–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏, –≤—ã–∑–æ–≤–∞ `_update_entities_location` –∏ `on_enter_location`.
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `player.selected_language` –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `action_processor.py`**:
    - –û–±–Ω–æ–≤–ª–µ–Ω `_handle_move_action_wrapper` –≤ `src/core/action_processor.py`.
    - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `execute_move_for_player_action`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è `target_location_identifier` –∏–∑ `action.entities` (—Å —ç–≤—Ä–∏—Å—Ç–∏–∫–∞–º–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π).
    - `execute_move_for_player_action` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, –µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª –¥–≤–∏–∂–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏ (RuleConfig)**:
    - –í `execute_move_for_player_action` –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `TODO` –¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ `RuleConfig` –¥–ª—è –ø–æ–ª–∏—Ç–∏–∫ –¥–≤–∏–∂–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏. MVP —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â—É—é –ª–æ–≥–∏–∫—É (–≤—Å—è –ø–∞—Ä—Ç–∏—è –¥–≤–∏–∂–µ—Ç—Å—è).
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `movement_logic.py` –∏ `action_processor.py`. –ü—Ä–∏–∑–Ω–∞–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ (–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ)**:
    - –í `tests/core/test_movement_logic.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `execute_move_for_player_action` (–¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏).
    - –í `tests/core/test_action_processor.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `_handle_move_action_wrapper`.
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**:
    - –ó–∞–ø—Ä–æ—à–µ–Ω—ã –∏ –ø–æ–ª—É—á–µ–Ω—ã —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞ –ª–æ–∫–∞—Ü–∏–π –ø–æ –∏–º–µ–Ω–∏ (—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —è–∑—ã–∫–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–µ–π).
- **–î–æ—Ä–∞–±–æ—Ç–∫–∞ `movement_logic.py` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏ (—Å–æ–≥–ª–∞—Å–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏)**:
    - –°–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_find_location_by_identifier` –≤ `src/core/movement_logic.py` –¥–ª—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –ª–æ–≥–∏–∫–∏ –ø–æ–∏—Å–∫–∞ (static_id, –∑–∞—Ç–µ–º –∏–º—è —Å —É—á–µ—Ç–æ–º i18n, case-insensitivity, —è–∑—ã–∫–æ–≤—ã—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–æ–º –ø–µ—Ä–≤–æ–≥–æ + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ).
    - `execute_move_for_player_action` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `_find_location_by_identifier` –∏ –ø–æ–ª—É—á–µ–Ω–∏—è `guild_main_language` –∏–∑ `RuleConfig`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è `movement_logic.py` (–ø–æ—Å–ª–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏)**:
    - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `_find_location_by_identifier`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∏—Å–∫–∞.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `execute_move_for_player_action` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å `_find_location_by_identifier` –∏ `get_rule`.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è `action_processor.py` (–ø–æ—Å–ª–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏)**:
    - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –¥–ª—è `_handle_move_action_wrapper` –ø—Ä–∏–∑–Ω–∞–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏, —Ç–∞–∫ –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ –ø–æ–∏—Å–∫–∞ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ `movement_logic.py`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `AGENTS.md`**:
    - –î–æ–ø–æ–ª–Ω–µ–Ω –ª–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è Task 25.

## –ó–∞–¥–∞—á–∞ 2: üß† 3.3 API for Activating Abilities and Applying Statuses (Guild-Scoped)
- **–®–∞–≥ 1 (–∏–∑ –ø–ª–∞–Ω–∞ AGENTS.md): –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞**
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `activate_ability` –∏ `apply_status`/`remove_status` –∏–∑ `Tasks.txt`.
    - –ò–∑—É—á–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏: `Ability`, `StatusEffect`, `ActiveStatusEffect`, `Player`, `GeneratedNpc`, `RuleConfig`, `StoryLog`.
    - –≠—Ç–æ—Ç —à–∞–≥ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ª–æ–≥–∞–º–∏ –∏ —Ç–µ–∫—É—â–∏–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –∑–∞–¥–∞—á–∏.
- **–®–∞–≥ 2.1 (–∏–∑ –ø–ª–∞–Ω–∞ AGENTS.md): –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π `AbilityOutcomeDetails`**
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–∞–π–ª `src/models/ability_outcomes.py`. –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (`AbilityOutcomeDetails`, `AppliedStatusDetail`, etc.) –ø—Ä–∏–∑–Ω–∞–Ω–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–π –¥–ª—è MVP.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω `src/models/__init__.py`. –ò–º–ø–æ—Ä—Ç—ã –¥–ª—è `ability_outcomes` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã. –®–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω.
- **–®–∞–≥ 2.2 (–∏–∑ –ø–ª–∞–Ω–∞ AGENTS.md): –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ `Player`**
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–∞–π–ª `src/models/player.py`. –ü–æ–ª–µ `current_hp: Mapped[Optional[int]]` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0012_add_player_current_hp.py`. –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –®–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω.
- **–®–∞–≥–∏ 3 –∏ 4 (–∏–∑ –ø–ª–∞–Ω–∞ AGENTS.md): –†–µ–∞–ª–∏–∑–∞—Ü–∏—è API `activate_ability` –∏ `apply_status` (MVP)**
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–∞–π–ª `src/core/ability_system.py`. –§—É–Ω–∫—Ü–∏–∏ `activate_ability_v2`, `apply_status_v2`, `remove_status` –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã CRUD-—Ñ–∞–π–ª—ã `src/core/crud/crud_ability.py` –∏ `src/core/crud/crud_status_effect.py`. –û–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã (`get_by_static_id`).
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω `src/models/enums.py`. `EventType` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `ABILITY_USED`, `STATUS_APPLIED`, `STATUS_REMOVED`.
    - **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `src/core/ability_system.py`**:
        - –õ–æ–∫–∞–ª—å–Ω—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `get_ability_by_id_or_static_id` –∏ `get_status_effect_by_static_id` –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã.
        - –§—É–Ω–∫—Ü–∏—è `activate_ability_v2` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `ability_crud.get` (–¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Ç–∏–ø–∞ int) –∏ `ability_crud.get_by_static_id` (–¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Ç–∏–ø–∞ str).
        - –§—É–Ω–∫—Ü–∏—è `apply_status_v2` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `status_effect_crud.get_by_static_id`.
        - –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—ã–∑–æ–≤—ã `log_event` –≤ `activate_ability_v2` –∏ `apply_status_v2`. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ `location_id` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ) –≤ `log_event`.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã `src/core/crud/__init__.py` –∏ `src/core/__init__.py`. –≠–∫—Å–ø–æ—Ä—Ç—ã –¥–ª—è `ability_system` –∏ –µ–≥–æ CRUD-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.
- **–®–∞–≥ 7 (–∏–∑ –ø–ª–∞–Ω–∞ AGENTS.md): –ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω —Ñ–∞–π–ª `tests/core/test_ability_system.py`. –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã.
    - **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤**: –¢–µ—Å—Ç—ã –≤ `tests/core/test_ability_system.py` –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã–∑–æ–≤–æ–≤ `ability_crud.get`, `ability_crud.get_by_static_id` –∏ `status_effect_crud.get_by_static_id` –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä—ã—Ö –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.
    - –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–µ—Å—Ç `test_activate_ability_not_found` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
    - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö**:
        - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –æ—à–∏–±–∫–∏ `AttributeError: 'called_with'` –≤ `test_activate_ability_fireball_on_npc` –ø—É—Ç–µ–º –∑–∞–º–µ–Ω—ã –Ω–∞ `assert_called_with`.
        - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ `TypeError: 'owner_id' is an invalid keyword argument for ActiveStatusEffect` –≤ `test_apply_status_burning_on_player` –ø—É—Ç–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ø–æ—Å–æ–±–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–∞ `ActiveStatusEffect` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `apply_status_v2` (—Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –∑–∞—Ç–µ–º –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤).
    - **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤**: –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`pip install -r requirements.txt`) —Ç–µ—Å—Ç—ã –≤ `tests/core/test_ability_system.py` (6 —Ç–µ—Å—Ç–æ–≤) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã. –®–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω.
- **–®–∞–≥ 9 (–∏–∑ –ø–ª–∞–Ω–∞ AGENTS.md): –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –§–∏–Ω–∞–ª—å–Ω—ã–π –û–±–∑–æ—Ä (MVP)**
    - –ü—Ä–æ–≤–µ–¥–µ–Ω –æ–±–∑–æ—Ä –∫–æ–¥–∞ `src/core/ability_system.py` –∏ `tests/core/test_ability_system.py`. Docstrings –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–∏–∑–Ω–∞–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏ –¥–ª—è MVP.
    - –ü—Ä–æ–≤–µ–¥–µ–Ω–∞ —Å–≤–µ—Ä–∫–∞ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –ó–∞–¥–∞—á–∏ 22 –¥–ª—è MVP. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ MVP –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –®–∞–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω.

## –ó–∞–¥–∞—á–∞ 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–æ–≤ –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])
- **–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ –Ω–µ–¥–∞–≤–Ω–∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ (–ó–∞–¥–∞—á–∞ 22 - Ability System) –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (N+1, action_processor). –ü–æ–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π/–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ç–µ—Å—Ç–∞–º–∏.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
    - **–ó–∞–ø—É—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫:**
        - –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ `python -m pytest` –≤—ã—è–≤–∏–ª 14 –æ—à–∏–±–æ–∫.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ `tests/bot/commands/test_map_commands.py`: `TypeError: object bool can't be used in 'await' expression` –∏–∑-–∑–∞ –≤—ã–∑–æ–≤–∞ `cog_check` –≤–º–µ—Å—Ç–æ `interaction_check`.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ `tests/core/test_ability_system.py`: `AssertionError` –∏–∑-–∑–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è event_type —Å —á–ª–µ–Ω–æ–º Enum. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `EventType.ENUM_MEMBER.value`.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ `tests/core/test_ai_orchestrator.py`: `AssertionError` –≤ `mock_get_player.assert_called_once_with` –∏–∑-–∑–∞ –ø–µ—Ä–µ–¥–∞—á–∏ `player_id` –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ `tests/core/test_map_management.py`: –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ `AssertionError` —Å `EventType` –∏ `TypeError: object bool can't be used in 'await' expression` –∏–∑-–∑–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –º–æ–∫–∞ `location_crud.delete`.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ `tests/core/test_movement_logic.py`: `TypeError: _update_entities_location() got multiple values for argument 'guild_id'` –∏–∑-–∑–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ `session` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@transactional` –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Å keyword-only `session`. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional`.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ `tests/core/test_world_generation.py`: `AssertionError` —Å `EventType`.
        - –ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤—Å–µ 202 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `src/core/ability_system.py`:**
        - –î–æ–±–∞–≤–ª–µ–Ω—ã 3 —Ç–µ—Å—Ç–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ `remove_status`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —É—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –ø–æ–ø—ã—Ç–∫—É —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∏ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ –¥—Ä—É–≥–æ–π –≥–∏–ª—å–¥–∏–∏, –∞ —Ç–∞–∫–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–∑–æ–≤ `log_event`.
        - –î–æ–±–∞–≤–ª–µ–Ω—ã 5 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `activate_ability_v2` –∏ `apply_status_v2` –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤: –Ω–µ –Ω–∞–π–¥–µ–Ω –∫–∞—Å—Ç–µ—Ä, –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ —Ü–µ–ª—å, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP —É Player/NPC, –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ StatusEffect, –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ —Ü–µ–ª—å –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –º–æ–∫–æ–≤.
        - –í—Å–µ 14 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_ability_system.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `src/core/localization_utils.py::get_batch_localized_entity_names`:**
        - –î–æ–±–∞–≤–ª–µ–Ω—ã 3 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ plain `name` –∫–∞–∫ fallback –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π –±–µ–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏–º–µ–Ω–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ `entity_refs`.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `AttributeError` –≤ `get_batch_localized_entity_names` –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞ `entity_refs`, –Ω–µ —è–≤–ª—è—é—â–µ–≥–æ—Å—è —Å–ª–æ–≤–∞—Ä–µ–º.
        - –í—Å–µ 25 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_localization_utils.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `src/core/crud_base_definitions.py::CRUDBase.get_many_by_ids`:**
        - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `tests/core/crud/test_crud_base_definitions.py`.
        - –î–æ–±–∞–≤–ª–µ–Ω—ã 7 —Ç–µ—Å—Ç–æ–≤, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ: —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ ID –±–µ–∑/—Å `guild_id`, —á–∞—Å—Ç–∏—á–Ω–æ–µ/–ø–æ–ª–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ID, –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ ID –Ω–∞ –≤—Ö–æ–¥–µ, –º–æ–¥–µ–ª—å –±–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ PK, –º–æ–¥–µ–ª—å —Å `static_id` –≤ –∫–∞—á–µ—Å—Ç–≤–µ PK.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ –∏ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–≥–µ—Ä–∞ –≤ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞—Ö.
        - –í—Å–µ 7 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/crud/test_crud_base_definitions.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@transactional` –≤ `src/core/database.py`:**
        - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `tests/core/test_database_transactional.py`.
        - –î–æ–±–∞–≤–ª–µ–Ω—ã 8 —Ç–µ—Å—Ç–æ–≤, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ: —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ commit, –æ—Ç–∫–∞—Ç –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π (—Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ/–ø–æ –∫–ª—é—á—É), –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –≤ –¥–µ–∫–æ—Ä–∏—Ä—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é, –≤–∫–ª—é—á–∞—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è keyword-only `session`.
        - –£–ª—É—á—à–µ–Ω–∞ —Ñ–∏–∫—Å—Ç—É—Ä–∞ `mock_get_db_session_context_manager` –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ commit/rollback.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∏–∫–µ —Ç–µ—Å—Ç–æ–≤ –∏ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.
        - –í—Å–µ 8 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_database_transactional.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - **–û–±–∑–æ—Ä –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ö–µ–ª–ø–µ—Ä–æ–≤ –≤ `src/core/action_processor.py`:**
        - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `_load_and_clear_all_actions`, `_execute_player_actions`, `_finalize_turn_processing`.
        - –î–æ–±–∞–≤–ª–µ–Ω—ã 5 –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `_load_and_clear_all_actions` (–ø—É—Å—Ç–æ–π –≤–≤–æ–¥, –æ–¥–∏–Ω –∏–≥—Ä–æ–∫, –ø–∞—Ä—Ç–∏—è, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Pydantic).
        - –î–æ–±–∞–≤–ª–µ–Ω—ã 3 –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞ –¥–ª—è `_execute_player_actions` (–ø—É—Å—Ç–æ–π –≤–≤–æ–¥, –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è).
        - –î–æ–±–∞–≤–ª–µ–Ω—ã 2 –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞ –¥–ª—è `_finalize_turn_processing` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤, –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –Ω–µ –≤ —Å—Ç–∞—Ç—É—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏).
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–∂–∏–¥–∞–Ω–∏–µ `list` –≤–º–µ—Å—Ç–æ `set` –¥–ª—è `ids` –≤ `assert_called_once_with`).
        - –í—Å–µ 15 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/core/test_action_processor.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - **–ò—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:**
        - –ó–∞–ø—É—â–µ–Ω –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ (`python -m pytest`).
        - –í—Å–µ 238 —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ `RuntimeWarning` (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–¥–∞—á–∏ –ø–æ –ø–æ–ª–Ω–æ–º—É —Ü–∏–∫–ª—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–∫—Ä—ã—Ç–∏—é –Ω–æ–≤–æ–≥–æ/—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç.

## –ó–∞–¥–∞—á–∞ 4: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç–∞ (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞])
- **–¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (–ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):**
    - –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞.
    - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ N+1 –ø—Ä–æ–±–ª–µ–º—ã).
    - –ê–Ω–∞–ª–∏–∑ –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, —É–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
    - **–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:** –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (`src/bot`, `src/core`, `src/models`). –ü—Ä–∏–∑–Ω–∞–Ω–∞ –≤ —Ü–µ–ª–æ–º –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–π, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∫—Ä—É–ø–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
    - **–£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ `src/core/action_processor.py`:**
        - –§—É–Ω–∫—Ü–∏—è `process_actions_for_guild` –±—ã–ª–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ —Ç—Ä–∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: `_load_and_clear_all_actions`, `_execute_player_actions`, `_finalize_turn_processing` –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.
        - –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–µ—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `ACTION_DISPATCHER`.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `NameError` –∏–∑-–∑–∞ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `_handle_intra_location_action_wrapper` –∏ `ACTION_DISPATCHER`.
    - **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (N+1 –∑–∞–ø—Ä–æ—Å—ã):**
        - **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π (`action_processor.py`):**
            - –§—É–Ω–∫—Ü–∏—è `_load_and_clear_all_actions` –±—ã–ª–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –∏ –ø–∞—Ä—Ç–∏–π. –í–º–µ—Å—Ç–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏, —Ç–µ–ø–µ—Ä—å —Å–æ–±–∏—Ä–∞—é—Ç—Å—è ID –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ (–≤–∫–ª—é—á–∞—è –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ –ø–∞—Ä—Ç–∏–π) –∏ ID –ø–∞—Ä—Ç–∏–π, –ø–æ—Å–ª–µ —á–µ–≥–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–≤—É–º—è –º–∞—Å—Å–æ–≤—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ (`get_many_by_ids`).
            - –î–ª—è —ç—Ç–æ–≥–æ –≤ `CRUDBase` (`crud_base_definitions.py`) –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `get_many_by_ids`.
        - **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ (`report_formatter.py`, `localization_utils.py`):**
            - –í `localization_utils.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_batch_localized_entity_names`, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π (—Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤) –ø–∞–∫–µ—Ç–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è `get_many_by_ids` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞.
            - –°–æ–∑–¥–∞–Ω—ã `CRUDNpc` –∏ `CRUDItem` –∫–ª–∞—Å—Å—ã –≤ `crud_npc.py` –∏ `crud_item.py` (–Ω–∞—Å–ª–µ–¥—É–µ–º—ã–µ –æ—Ç `CRUDBase`) –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã `npc_crud`, `item_crud`, —á—Ç–æ–±—ã `get_batch_localized_entity_names` –º–æ–≥–ª–∞ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –û–±–Ω–æ–≤–ª–µ–Ω `ENTITY_TYPE_CRUD_MAP`.
            - –§—É–Ω–∫—Ü–∏—è `format_turn_report` –≤ `report_formatter.py` —Ç–µ–ø–µ—Ä—å —Å–Ω–∞—á–∞–ª–∞ —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ –≤—Å–µ—Ö –ª–æ–≥-–∑–∞–ø–∏—Å–µ–π, –≤—ã–∑—ã–≤–∞–µ—Ç `get_batch_localized_entity_names` –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–µ—à–∞ –∏–º–µ–Ω, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ–¥–∞–µ—Ç —ç—Ç–æ—Ç –∫–µ—à –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é `_format_log_entry_with_names_cache` (–±—ã–≤—à–∞—è `format_log_entry`) –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏.
    - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤:**
        - –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –æ—à–∏–±–∫–∏ `NameError` –∏ `AttributeError` –≤ —Ç–µ—Å—Ç–∞—Ö, –≤–æ–∑–Ω–∏–∫—à–∏–µ –∏–∑-–∑–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.
        - –í `tests/core/test_action_processor.py`:
            - –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ `process_actions_for_guild` –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `get_many_by_ids`.
            - –£–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ç–µ—Å—Ç `test_load_and_clear_actions_invalid_json`, —Ç–∞–∫ –∫–∞–∫ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–∞—è –∏–º —Ñ—É–Ω–∫—Ü–∏—è –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞.
        - –í `tests/core/test_report_formatter.py`:
            - –¢–µ—Å—Ç—ã, —Ä–∞–Ω–µ–µ –ø—Ä–æ–≤–µ—Ä—è–≤—à–∏–µ `format_log_entry`, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è `_format_log_entry_with_names_cache` –∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫ `names_cache`.
            - –¢–µ—Å—Ç—ã –¥–ª—è `format_turn_report` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è `get_batch_localized_entity_names` –∏ `_format_log_entry_with_names_cache`. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∞—Å—Å–µ—Ä—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏–º–µ–Ω.
        - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤ `crud_npc.py`, `crud_item.py`, `localization_utils.py`, `core/__init__.py`.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ 169 —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

## –ó–∞–¥–∞—á–∞ 5: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright –∏–∑ `pyright_summary.txt` (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])
- **–ê–Ω–∞–ª–∏–∑ `pyright_summary.txt`**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Ñ–∞–π–ª –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫.
- **`tests/core/test_action_processor.py` (16 –æ—à–∏–±–æ–∫)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞ "Cannot access attribute 'reset_mock' for class 'FunctionType'".
    - –ü—Ä–æ–±–ª–µ–º–∞: Pyright –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–ª, —á—Ç–æ –∞—Ç—Ä–∏–±—É—Ç—ã –º–æ–¥—É–ª—è (`_handle_placeholder_action`, `_handle_move_action_wrapper`), –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `mocker.patch` –≤ —Ñ–∏–∫—Å—Ç—É—Ä–µ `patch_action_handlers_directly`, —è–≤–ª—è—é—Ç—Å—è –æ–±—ä–µ–∫—Ç–∞–º–∏ `AsyncMock`.
    - –†–µ—à–µ–Ω–∏–µ: –í —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫-–∞—Ç—Ä–∏–±—É—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `.reset_mock()`, `.assert_called_once()`) —ç—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç—ã –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º —Å —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞ `AsyncMock` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `placeholder_handler_mock: AsyncMock = src.core.action_processor._handle_placeholder_action # type: ignore`). –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç Pyright –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø.
- **`src/core/localization_utils.py` (7 –æ—à–∏–±–æ–∫)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ "unknown import symbol" –¥–ª—è `get_entity_by_id_gino_style`, `get_location_by_id`, `get_npc`, `get_item`.
        - `get_entity_by_id_gino_style`: –£–¥–∞–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –±–ª–æ–∫ `elif model_class:` –≤ `get_localized_entity_name`, —Ç–∞–∫ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞ –∏ –≤—Å–µ —Ç–∏–ø—ã —Å—É—â–Ω–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —è–≤–Ω—ã–µ –≥–µ—Ç—Ç–µ—Ä—ã –≤ `ENTITY_TYPE_GETTER_MAP`.
        - `get_location_by_id`: –ò–º–ø–æ—Ä—Ç –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `from .crud.crud_location import location_crud`, –∏ –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –≤ `ENTITY_TYPE_GETTER_MAP` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `location_crud.get()`.
        - `get_npc`, `get_item`: –í —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö placeholder-—Ñ–∞–π–ª–∞—Ö `src/core/crud/crud_npc.py` –∏ `src/core/crud/crud_item.py` —Å–æ–∑–¥–∞–Ω—ã –∑–∞–≥–ª—É—à–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π `get_npc` –∏ `get_item`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ `None`. –ò–º–ø–æ—Ä—Ç—ã –≤ `localization_utils.py` —Ç–µ–ø–µ—Ä—å —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∏ –∑–∞–≥–ª—É—à–∫–∏.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Expected class but received..." –¥–ª—è —Ç–∏–ø–∞ `ENTITY_TYPE_GETTER_MAP`. –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ–≤–∞—Ä—è –∏–∑–º–µ–Ω–µ–Ω —Å –æ–±—â–µ–≥–æ `callable` –Ω–∞ –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π `GetterCallable = Callable[[AsyncSession, int, int], Awaitable[Optional[Any]]]`.
    - –û—à–∏–±–∫–∏ "Argument missing for parameter 'player_id'" –∏ "Parameter 'guild_id' is already assigned" –¥–ª—è –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ –≤ `ENTITY_TYPE_GETTER_MAP` –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ —Ä–∞–∑—Ä–µ—à–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `get_player(session, player_id=entity_id, guild_id=guild_id)`.
- **`tests/core/test_interaction_handlers.py` (5 –æ—à–∏–±–æ–∫)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ "Object of type 'None' is not subscriptable" (L124, L302). –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –≤ JSON-–ø–æ–¥–æ–±–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∞—Å—Å–µ—Ä—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `details_json.get("interactable_elements")`).
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ "Cannot access attribute 'assert_called_once' for class 'MethodType'" (L305, L337, L366). –ê—Ç—Ä–∏–±—É—Ç—ã –º–æ–∫–æ–≤ (`mock_session.commit`, `mock_log_event`), –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã–∑—ã–≤–∞–ª–∏—Å—å –º–µ—Ç–æ–¥—ã –∞—Å—Å–µ—Ä—Ç–æ–≤, —Ç–µ–ø–µ—Ä—å —è–≤–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ `AsyncMock` –≤ —Ç–µ—Å—Ç–∞—Ö –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –∞—Å—Å–µ—Ä—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `commit_mock: AsyncMock = mock_session.commit # type: ignore`).
- **`src/core/ai_orchestrator.py` (2 –æ—à–∏–±–∫–∏ –Ω–∞ L85) –∏ `tests/core/test_ai_orchestrator.py` (3 –æ—à–∏–±–∫–∏)**:
    - –í `src/core/ai_orchestrator.py` (L85), –æ—à–∏–±–∫–∏ "Argument missing for parameter 'player_id'" –∏ "Parameter 'guild_id' is already assigned" –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `get_player` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–µ–º —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞ –¥–ª—è `player_id_from_context` –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ `get_player` (`p_id: int = player_id_from_context`).
    - –û—à–∏–±–∫–∏ `Argument missing for parameter "entity_type"` –≤ `tests/core/test_ai_orchestrator.py` (L85, L198, L325) –Ω–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Ñ–∞–π–ª–∞ –∏, –≤–µ—Ä–æ—è—Ç–Ω–æ, –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –≤—ã–∑–æ–≤–∞–º `get_localized_entity_name` –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `prepare_ai_prompt` (–∏–∑ `ai_prompt_builder.py`), —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ –±—ã–ª–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–æ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–∏—Ö 3 –æ—à–∏–±–æ–∫.
- **`tests/bot/test_general_commands_mocked.py` (2 –æ—à–∏–±–∫–∏)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ "Function declaration ... is obscured by a declaration of the same name" –¥–ª—è `mock_db_session_context_manager` (L61) –∏ `mock_ctx` (L69). –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç—Ç–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π/—Ñ–∏–∫—Å—Ç—É—Ä –≤ —Ñ–∞–π–ª–µ.
- **`src/bot/events.py` (1 –æ—à–∏–±–∫–∞ –Ω–∞ L123)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Argument missing for parameter 'message'" –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `process_player_message_for_nlu`. –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏ `process_player_message_for_nlu` –∏ —Å–ø–æ—Å–æ–±–∞, –∫–æ—Ç–æ—Ä—ã–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional` –≤–Ω–µ–¥—Ä—è–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç `session` (–∫–∞–∫ keyword argument). –°–∏–≥–Ω–∞—Ç—É—Ä–∞ `process_player_message_for_nlu` –∏–∑–º–µ–Ω–µ–Ω–∞ –¥–ª—è –ø—Ä–∏–µ–º–∞ `session` –∫–∞–∫ keyword-only argument: `async def process_player_message_for_nlu(bot: commands.Bot, message: discord.Message, *, session: AsyncSession)`.
- **`src/core/game_events.py` (1 –æ—à–∏–±–∫–∞ –Ω–∞ L6)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Function declaration 'on_enter_location' is obscured by a declaration of the same name". –£–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `on_enter_location`.
- **`src/core/movement_logic.py` (1 –æ—à–∏–±–∫–∞ –Ω–∞ L176)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Argument missing for parameter 'session'" –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `_update_entities_location`. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–æ–±–ª–µ–º–µ –≤ `events.py`, —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ `_update_entities_location` –∏–∑–º–µ–Ω–µ–Ω–∞ –¥–ª—è –ø—Ä–∏–µ–º–∞ `session` (–≤–Ω–µ–¥—Ä—è–µ–º–æ–≥–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@transactional`) –∫–∞–∫ keyword-only argument.
- **`src/core/report_formatter.py` (1 –æ—à–∏–±–∫–∞ –Ω–∞ L58)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Argument of type 'list[str | int]' cannot be assigned to parameter 'path' of type 'List[str]'" –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `_safe_get`. –§—É–Ω–∫—Ü–∏—è `_safe_get` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–∏—Å–ª–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ —Å–ø–∏—Å–∫–µ `path` (—Ç–∏–ø `path` –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `List[Union[str, int]]`). –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `Union` –∏–∑ `typing`.
- **`tests/core/test_localization_utils.py` (1 –æ—à–∏–±–∫–∞ –Ω–∞ L14)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Cannot assign to attribute 'name_i18n' for class 'Player'". –ö —Å—Ç—Ä–æ–∫–µ `player.name_i18n = ...` –≤ —Ñ–∏–∫—Å—Ç—É—Ä–µ `mock_player_instance` –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `# type: ignore[attr-defined]`, —Ç–∞–∫ –∫–∞–∫ –º–æ–¥–µ–ª—å `Player` —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–ª–µ `name_i18n`, –Ω–æ —Ç–µ—Å—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –µ–≥–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ `get_localized_entity_name`.
- **`tests/core/test_movement_logic.py` (1 –æ—à–∏–±–∫–∞ –Ω–∞ L335)**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "Cannot assign to attribute 'neighbor_locations_json' for class 'Location'". –ö —Å—Ç—Ä–æ–∫–µ, –≥–¥–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–∏–ø (—Å—Ç—Ä–æ–∫—É) –ø–æ–ª—é `neighbor_locations_json` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `# type: ignore[assignment]`.

## –ó–∞–¥–∞—á–∞ 6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])
- **–ê–Ω–∞–ª–∏–∑ `pyright_summary.txt`**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Ñ–∞–π–ª `pyright_summary.txt` –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∞—Ç—Ä–∏–±—É—Ç–∞ `Player.status`**:
    - –í–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö (`src/bot/commands/turn_commands.py`, `src/core/turn_controller.py`, `src/core/action_processor.py`) –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ `player.status` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `player.current_status` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ `Player`.
    - –í `src/models/enums.py` –≤ Enum `PlayerStatus` –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `PROCESSING_ACTION = "processing_action"`, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –≤ `src/bot/events.py`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ `None` –¥–ª—è `guild_id`**:
    - –í —Ñ–∞–π–ª–µ `src/bot/commands/turn_commands.py` –¥–ª—è –∫–æ–º–∞–Ω–¥, –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö `@app_commands.guild_only()`, –¥–æ–±–∞–≤–ª–µ–Ω—ã —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è `assert interaction.guild_id is not None` –∏ —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —Ç–∏–ø–∞ `guild_id: int = interaction.guild_id`. –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã `int | None` –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ `guild_id` –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –æ–∂–∏–¥–∞—é—â–∏–µ `int`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–∏–ø–∞ `session_maker`**:
    - –í `src/core/turn_controller.py` —Ñ—É–Ω–∫—Ü–∏—è `trigger_guild_turn_processing` –æ–∂–∏–¥–∞–ª–∞ `session_maker: Callable[[], AsyncSession]`.
    - –ü–µ—Ä–µ–¥–∞–≤–∞–µ–º–∞—è `get_db_session` –∏–∑ `src/core/database.py` –∏–º–µ–µ—Ç —Ç–∏–ø `Callable[[], AsyncContextManager[AsyncSession]]`.
    - –¢–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `session_maker` –≤ `trigger_guild_turn_processing` –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `Callable[[], AsyncContextManager[AsyncSession]]` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `AsyncContextManager` –∏–∑ `typing`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ "Object of type 'None' cannot be used as iterable value"**:
    - –í —Ñ–∞–π–ª–∞—Ö `src/bot/commands/turn_commands.py`, `src/core/turn_controller.py`, `src/core/action_processor.py` —Ü–∏–∫–ª—ã, –∏—Ç–µ—Ä–∏—Ä—É—é—â–∏–µ –ø–æ `party.player_ids_json` (–∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å `None`), –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–∞ `for item in (party.player_ids_json or []):` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç–∏–ø–∞ –≤ `process_actions_for_guild`**:
    - –í `src/core/turn_controller.py` —Ñ—É–Ω–∫—Ü–∏—è `_start_action_processing_worker` –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∞ `list[dict]` –≤ `process_actions_for_guild`, –Ω–æ –µ–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `entities_to_process` –±—ã–ª –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ `list[tuple[int, str]]`.
    - –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–ª—è `entities_to_process` –≤ `_start_action_processing_worker` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ `list[dict[str, Any]]`. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `Any` –∏–∑ `typing`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ `tests/test_main.py`**:
    - –û—à–∏–±–∫–∏ –≤–∏–¥–∞ `Cannot access attribute "called" / "call_args" for class "type[BotCore]"` –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –∏–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ Pyright –Ω–µ –º–æ–≥ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ `BotCore` –±—ã–ª –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `MagicMock` –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤.
    - –ö —Å—Ç—Ä–æ–∫–∞–º —Å –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏ `.called` –∏ `.call_args` –∫ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—É `BotCore` –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ `# type: ignore`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤**:
    - `src/bot/commands/master_ai_commands.py`: –ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ `save_approved_generation` (–¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π `@transactional`) –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –∞—Ä–≥—É–º–µ–Ω—Ç `session`. Pyright –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª, —á—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –≤–Ω–µ–¥—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é. –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `# type: ignore` –∫ –≤—ã–∑–æ–≤—É.
    - `src/bot/events.py`: –û—à–∏–±–∫–∞ "Argument missing for parameter 'message'" –Ω–∞ —Å—Ç—Ä–æ–∫–µ 123 (–¥–æ —Ç–µ–∫—É—â–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è) –±—ã–ª–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –≤—ã–∑–æ–≤–æ–º —Ñ—É–Ω–∫—Ü–∏–∏, –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π `@transactional` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ —Å–µ—Å—Å–∏—è –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º). –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `process_player_message_for_nlu`.

## –ó–∞–¥–∞—á–∞ 7: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-—Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏—Ö –∑–∞–ø—É—Å–∫–µ (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è] - –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∫-—Ç–µ—Å—Ç–æ–≤:**
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `AGENTS.md` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ —Å Discord API –∏ –ë–î.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏ –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è (`discord.Interaction`, `discord.Message`, `discord.ext.commands.Context`, —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î).
    - –í—ã–±—Ä–∞–Ω –Ω–∞—á–∞–ª—å–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è: –∫–æ–º–∞–Ω–¥–∞ `/start` –∏ —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `!ping`.
    - –°–æ—Å—Ç–∞–≤–ª–µ–Ω –ø–ª–∞–Ω –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ñ–∞–π–ª–∞ —Å —Ç–µ—Å—Ç–∞–º–∏, —Ñ–∏–∫—Å—Ç—É—Ä –∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—é —Å–∞–º–∏—Ö —Ç–µ—Å—Ç–æ–≤.
- **–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-—Ç–µ—Å—Ç–æ–≤:**
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/bot/test_general_commands_mocked.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã pytest-—Ñ–∏–∫—Å—Ç—É—Ä—ã: `mock_bot`, `mock_interaction`, `mock_db_session`, `command_cog`, `mock_ctx`.
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `/start`:
        - `test_start_command_new_player`: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞.
        - `test_start_command_existing_player`: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞.
        - `test_start_command_no_starting_location`: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ª—É—á–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏.
    - –ù–∞–ø–∏—Å–∞–Ω —Ç–µ—Å—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `!ping`: `test_ping_command`.
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã `unittest.mock.patch` –∏ `AsyncMock/MagicMock` –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ (–ø–æ–≤—Ç–æ—Ä–Ω–æ):**
    - **–ü—Ä–æ–±–ª–µ–º–∞ 1: `UnicodeDecodeError` –ø—Ä–∏ —Å–±–æ—Ä–µ `test_results.txt`**.
        - –ü—Ä–∏—á–∏–Ω–∞: Pytest –ø—ã—Ç–∞–ª—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª `test_results.txt` (–≤–µ—Ä–æ—è—Ç–Ω–æ, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞) –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–µ.
        - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª `test_results.txt` –∏–ª–∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏–µ –≤ UTF-8. (–ü–æ–≤—Ç–æ—Ä–Ω–æ)
    - **–ü—Ä–æ–±–ª–µ–º–∞ 2: `ImportError: cannot import name 'DEFAULT_STARTING_LOCATION_STATIC_ID' from 'src.config.settings'`**.
        - –ü—Ä–∏—á–∏–Ω–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç `DEFAULT_STARTING_LOCATION_STATIC_ID` –∏ `DEFAULT_PLAYER_START_PARAMS_JSON` –≤ —Ñ–∞–π–ª–µ `src/config/settings.py`, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±–æ–≤–∞–ª–∏—Å—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ.
        - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç—Ç–∏—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏–π –≤ `src/config/settings.py`. (–ü–æ–≤—Ç–æ—Ä–Ω–æ)
- **–ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ–≤—Ç–æ—Ä–Ω–æ):**
    - –ü–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç (`feat/add-mock-tests`): –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã—Ö –º–æ–∫-—Ç–µ—Å—Ç–æ–≤. (–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω —Ä–∞–Ω–µ–µ)
    - –í—Ç–æ—Ä–æ–π –∫–æ–º–º–∏—Ç (`fix/add-missing-settings-consts`): –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç –≤ `settings.py`. (–ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω —Ä–∞–Ω–µ–µ)
    - *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –¥–ª—è –ª–æ–≥–∞: –¢–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ AGENTS.md –∏ –∫–æ–º–º–∏—Ç —è–≤–ª—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –ø—Ä–æ—Å—å–±–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.*

## –ó–∞–¥–∞—á–∞ 8: üé≤ 6.3.2 Check Resolver Module
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/check_resolver.py`.
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã Pydantic –º–æ–¥–µ–ª–∏ `ModifierDetail`, `CheckOutcome`, `CheckResult` –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `resolve_check(db, guild_id, check_type, ...)`:
    - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `db: AsyncSession`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–∑ `RuleConfig` (–Ω–æ—Ç–∞—Ü–∏—è –∫–æ—Å—Ç–µ–π, –±–∞–∑–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç, –ø–æ—Ä–æ–≥–∏ –∫—Ä–∏—Ç. —É—Å–ø–µ—Ö–∞/–Ω–µ—É–¥–∞—á–∏) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `get_rule`.
    - –°–æ–∑–¥–∞–Ω–∞ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_get_entity_attribute` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ —Å—É—â–Ω–æ—Å—Ç–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è, —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑–≤–∏—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã "Effective Stats").
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–∞—Å—á–µ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤/—à—Ç—Ä–∞—Ñ–æ–≤. –û—Ç–º–µ—á–µ–Ω—ã –º–µ—Å—Ç–∞ –¥–ª—è –±—É–¥—É—â–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –æ—Ç —É–º–µ–Ω–∏–π, —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è, —Å—Ç–∞—Ç—É—Å–æ–≤.
    - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `dice_roller.roll_dice()` –¥–ª—è –±—Ä–æ—Å–∫–∞ –∫–æ—Å—Ç–µ–π.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ (—É—Å–ø–µ—Ö, –Ω–µ—É–¥–∞—á–∞, –∫—Ä–∏—Ç. —É—Å–ø–µ—Ö/–Ω–µ—É–¥–∞—á–∞) –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å DC –∏ –ø–æ—Ä–æ–≥–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π.
    - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ–±—ä–µ–∫—Ç–µ `CheckResult`.
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —É—Å–ª–æ–≤–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –º–æ–¥–µ–ª—è–º–∏ –≤ `_get_entity_attribute`.
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_check_resolver.py` —Å unit-—Ç–µ—Å—Ç–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º–∏ –º–æ–∫–∏ –¥–ª—è `get_rule`, `_get_entity_attribute` –∏ `roll_dice`. –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—É—Å–ø–µ—Ö/–Ω–µ—É–¥–∞—á–∞, –∫—Ä–∏—Ç—ã, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏).
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (docstrings, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏) –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/core/check_resolver.py`, –æ—Ç–º–µ—á–µ–Ω—ã TODO –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π.
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ò–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Å–æ—á–Ω–∏—Ü–µ–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

## –ó–∞–¥–∞—á–∞ 9: üé≤ 6.3.1 Dice Roller Module
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/dice_roller.py` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `roll_dice(dice_string)`.
- –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ "NdX[+/-M]" –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É–º–º—É –∏ —Å–ø–∏—Å–æ–∫ –±—Ä–æ—Å–∫–æ–≤.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å—Ç—Ä–æ–∫–∏.
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Å—Ç–µ–π (1000) –∏ –≥—Ä–∞–Ω–µ–π (1000).
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/core/test_dice_roller.py` —Å unit-—Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `roll_dice`.
- –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –ø—Ä–æ—Å—Ç—ã–µ –±—Ä–æ—Å–∫–∏, –±—Ä–æ—Å–∫–∏ —Å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ, –Ω—É–ª–µ–≤—ã–µ), –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ—Å—Ç–∏, –Ω–µ—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–±–µ–ª–∞–º, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —á–∏—Å–ª–∞ –∫–æ—Å—Ç–µ–π/–≥—Ä–∞–Ω–µ–π.
- **–ü—Ä–æ–±–ª–µ–º–∞:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤, —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º `src/core/crud.py` –∏ –ø–∞–∫–µ—Ç–∞ `src/core/crud/`.
- **–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–º–ø–æ—Ä—Ç–æ–≤:**
    - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω `src/core/crud.py` –≤ `src/core/crud_base_definitions.py`.
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/core/__init__.py` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `crud_base_definitions` (–∏–º–ø–æ—Ä—Ç, `__all__`, –ª–æ–≥–≥–µ—Ä).
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `CRUDBase` –≤ `src/core/crud/crud_location.py`, `src/core/crud/crud_player.py`, –∏ `src/core/crud/crud_party.py` –Ω–∞ `from src.core.crud_base_definitions import CRUDBase`.
- **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–µ—Å–æ—á–Ω–∏—Ü–µ–π:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏–º–ø–æ—Ä—Ç–æ–≤, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (`run_in_bash_session`) –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É "Failed to compute affected file count and total size... All changes to the repo have been rolled back." –≠—Ç–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤ –∏ –∫–æ–¥–∞ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º —Ä–µ–∂–∏–º–µ. –ü–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–º –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

## –ó–∞–¥–∞—á–∞ 10: –°–µ—Å—Å–∏—è [–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è]: –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- –ê–Ω–∞–ª–∏–∑ `AGENTS.md` –∑–∞–≤–µ—Ä—à–µ–Ω.
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.
- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ `Tasks.txt`, –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–¥–µ—Å—å, –∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –æ—Ç–º–µ—á–∞—Ç—å—Å—è –≤ `Done.txt`.

## –ó–∞–¥–∞—á–∞ 11: üöÄ 0.1 Discord Bot Project Initialization and Basic Guild Integration
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `BotCore` –≤ `src/bot/core.py`:
    - –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `__init__` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `command_prefix` –∏ `intents`.
    - –ú–µ—Ç–æ–¥ `setup_hook` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (–∫–æ–≥–æ–≤).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–≥–æ–≤ `bot.events` –∏ `bot.commands` —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫.
    - –ú–µ—Ç–æ–¥ `on_ready` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –±–æ—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞—Ö.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π Discord –≤ `src/bot/events.py` –≤ –≤–∏–¥–µ `EventCog`:
    - `on_ready`: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
    - `on_message`: –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–∏–≥–Ω–æ—Ä —Å–∞–º–æ–≥–æ —Å–µ–±—è).
    - `on_guild_join`: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
    - `on_guild_remove`: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
    - `on_command_error`: –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –∫–æ–º–∞–Ω–¥.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/ping` (—Ç–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞, –ø—Ä–µ—Ñ–∏–∫—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) –≤ `src/bot/commands.py` –≤ –≤–∏–¥–µ `CommandCog`:
    - –ö–æ–º–∞–Ω–¥–∞ `ping_command` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–æ–π –±–æ—Ç–∞.
    - –í–∫–ª—é—á–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ –∫–æ–º–∞–Ω–¥—ã.
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
    - –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `logging.basicConfig` –≤ `src/main.py`.
    - –§–æ—Ä–º–∞—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: `%(asctime)s:%(levelname)s:%(name)s: %(message)s`.
    - –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `LOG_LEVEL` –≤ `src/config/settings.py` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é INFO).
- –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (`src/bot`, `src/core`, `src/models`, `src/utils`, `src/config`, `tests/`) —Å –ø–æ–º–æ—â—å—é `mkdir`. (–ù–µ—É–¥–∞—á–Ω–æ, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–µ —Å–æ–∑–¥–∞–ª–∏—Å—å).
- –ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é, —Ç–∞–∫ –∫–∞–∫ `create_file_with_block` –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
- –°–æ–∑–¥–∞–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞:
    - `src/main.py`
    - `src/bot/core.py`
    - `src/bot/events.py`
    - `src/bot/commands.py`
    - `src/config/settings.py`
    - `requirements.txt`
    - `.gitignore`
    - `src/bot/__init__.py`
    - `src/config/__init__.py`
    - `src/__init__.py`
    - `tests/__init__.py`
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src/core/`, `src/models/`, `src/utils/` –ø–æ–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ñ–∞–π–ª–æ–≤, –Ω–æ –ø—É—Ç–∏ –¥–ª—è –Ω–∏—Ö —Å—É—â–µ—Å—Ç–≤—É—é—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–æ–∑–¥–∞–Ω–∏—é `src/__init__.py` –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ `src/`. –û–Ω–∏ –±—É–¥—É—Ç –Ω–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á.
- –ó–∞–¥–∞—á–∞ 0.1 (Discord Bot Project Initialization and Basic Guild Integration) –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`.
- –ó–∞–¥–∞—á–∞ 0.1 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`.

## –ó–∞–¥–∞—á–∞ 12: üóÑÔ∏è 0.2 DBMS Setup and Database Model Definition with Guild ID
- **–®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å `GuildConfig`**
    - –°–æ–∑–¥–∞–Ω `src/models/base.py` —Å –∫–ª–∞—Å—Å–æ–º `Base(AsyncAttrs, DeclarativeBase)`.
    - –°–æ–∑–¥–∞–Ω `src/models/guild.py` —Å –º–æ–¥–µ–ª—å—é `GuildConfig`, –≤–∫–ª—é—á–∞—é—â–µ–π –ø–æ–ª—è: `id` (PK, BigInteger), `master_channel_id` (BigInteger, nullable), `system_channel_id` (BigInteger, nullable), `notification_channel_id` (BigInteger, nullable), `main_language` (Text, default 'en').
    - –°–æ–∑–¥–∞–Ω `src/models/__init__.py` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ `Base` –∏ –º–æ–¥–µ–ª–µ–π (–ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ `GuildConfig`), —á—Ç–æ–±—ã Alembic –º–æ–≥ –∏—Ö –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å.
- **–®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω `requirements.txt`**
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `SQLAlchemy>=2.0.20`, `asyncpg>=0.27.0`, `alembic>=1.11.0`.
- **–®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –≤ `src/config/settings.py`**
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `DB_TYPE`, `DB_USER`, `DB_PASSWORD`, `DB_HOST`, `DB_PORT`, `DB_NAME` —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    - –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–∫–∞ `DATABASE_URL` –¥–ª—è `postgresql+asyncpg`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ë–î.
    - –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏–º–µ—Ä `.env` —Ñ–∞–π–ª–∞.
- **–®–∞–≥ 4: –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `src/core/database.py` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î**
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π `engine` SQLAlchemy.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ–∞–±—Ä–∏–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π `AsyncSessionLocal`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä `get_db_session` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º commit/rollback/close.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `init_db` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (–¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).
    - –°–æ–∑–¥–∞–Ω `src/core/__init__.py`.
- **–®–∞–≥ 5: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ `init_db` –≤ `src/main.py`**
    - `init_db()` —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `main()` –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±–æ—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –ë–î.
- **–®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–µ–Ω Alembic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏**
    - –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `pip install -r requirements.txt` –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –≤–∫–ª—é—á–∞—è `alembic`.
    - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω Alembic (`alembic init alembic`).
    - –ù–∞—Å—Ç—Ä–æ–µ–Ω `alembic.ini`: `sqlalchemy.url` —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ `env.py`.
    - –ù–∞—Å—Ç—Ä–æ–µ–Ω `alembic/env.py`:
        - –î–æ–±–∞–≤–ª–µ–Ω –ø—É—Ç—å –∫ `src` –≤ `sys.path`.
        - –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `DATABASE_URL` –∏–∑ `src.config.settings` –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ `sqlalchemy.url`.
        - `target_metadata` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `Base.metadata` –∏–∑ `src.models`.
        - –§—É–Ω–∫—Ü–∏—è `run_migrations_online` –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –¥–≤–∏–∂–∫–æ–º SQLAlchemy.
    - –°–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `alembic/versions/init_0001_create_guild_configs_table.py` –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `guild_configs` –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ë–î –≤ —Å—Ä–µ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ò–Ω–¥–µ–∫—Å –¥–ª—è `id` —Å–¥–µ–ª–∞–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–º.
- –ó–∞–¥–∞—á–∞ 0.2 (DBMS Setup and Database Model Definition with Guild ID) –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`.
- –ó–∞–¥–∞—á–∞ 0.2 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`.

## –ó–∞–¥–∞—á–∞ 13: üõ†Ô∏è 0.3 Core Utils (DB Access, Transactions, CRUD, RuleConfig)
- **–®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ó–∞–¥–∞—á–µ 0.3** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ë–î —Å —É—á–µ—Ç–æ–º –≥–∏–ª—å–¥–∏–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ ORM, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, CRUD-—É—Ç–∏–ª–∏—Ç—ã, –º–æ–¥–µ–ª—å RuleConfig –∏ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–π (–≤–∫–ª—é—á–∞—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ).
- **–®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `RuleConfig`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/models/rule_config.py` —Å –º–æ–¥–µ–ª—å—é `RuleConfig`.
    - –ú–æ–¥–µ–ª—å –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—è: `id` (PK), `guild_id` (FK –∫ `GuildConfig`), `key` (TEXT), `value_json` (JSONB).
    - –î–æ–±–∞–≤–ª–µ–Ω —Å–æ—Å—Ç–∞–≤–Ω–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è (`guild_id`, `key`).
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `RuleConfig`.
- **–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è `RuleConfig`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0002_create_rule_configs_table.py`.
    - –ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `rule_configs` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–æ–º.
- **–®–∞–≥ 4: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –í `src/core/database.py` –¥–æ–±–∞–≤–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional`.
    - –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `get_db_session` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Å—Å–∏–∏ (commit, rollback, close) –∏ –≤–Ω–µ–¥—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é –≤ –¥–µ–∫–æ—Ä–∏—Ä—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é.
- **–®–∞–≥ 5: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±—â–∏–µ CRUD-—É—Ç–∏–ª–∏—Ç—ã** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/crud.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–ª–∞—Å—Å `CRUDBase[ModelType]` —Å –º–µ—Ç–æ–¥–∞–º–∏: `create`, `get`, `get_multi`, `update`, `delete`, `get_by_attribute`, `get_multi_by_attribute`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: `create_entity`, `get_entity_by_id`, `update_entity`, `delete_entity`, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `CRUDBase`.
    - –£—Ç–∏–ª–∏—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `guild_id` –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –º–æ–¥–µ–ª—è–º–∏, –∏–º–µ—é—â–∏–º–∏ —ç—Ç–æ –ø–æ–ª–µ.
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/core/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª—è `crud`.
- **–®–∞–≥ 6: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è `RuleConfig`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/rules.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏: `load_rules_config_for_guild` (–∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª –≥–∏–ª—å–¥–∏–∏), `get_rule` (–ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ –∫–µ—à–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏), `update_rule_config` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –ë–î –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞), `get_all_rules_for_guild` (–ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª –≥–∏–ª—å–¥–∏–∏ –∏–∑ –∫–µ—à–∞).
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –≤–Ω—É—Ç—Ä–∏–ø—Ä–æ—Ü–µ—Å—Å–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª (`_rules_cache`).
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/core/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥—É–ª—è `rules`.

## –ó–∞–¥–∞—á–∞ 14: üåç 1.1 Location Model, Utils, and Default Population
- **–®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è Location Model** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–ª—è –º–æ–¥–µ–ª–∏ `Location` (guild_id, static_id, i18n –ø–æ–ª—è, JSONB –ø–æ–ª—è), –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å ENUM –¥–ª—è —Ç–∏–ø–∞ –ª–æ–∫–∞—Ü–∏–∏, –∏ —É—Ç–∏–ª–∏—Ç—ã (`get_location`, `get_static_location_id`, `get_localized_text`).
- **–®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Location`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/models/location.py` —Å –º–æ–¥–µ–ª—å—é `Location` –∏ enum `LocationType`.
    - –í–∫–ª—é—á–µ–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è, JSONB –¥–ª—è i18n –∏ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, ForeignKey –∫ `guild_configs`.
    - –î–æ–±–∞–≤–ª–µ–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è `(guild_id, static_id)`.
- **–®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ú–æ–¥–µ–ª—å `Location` –∏ enum `LocationType` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∏–º–ø–æ—Ä—Ç—ã –∏ –ª–æ–≥–≥–µ—Ä –≤ `src/models/__init__.py`.
- **–®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è `Location`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0003_create_locations_table.py`.
    - –ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `locations`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞, –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É ENUM —Ç–∏–ø–∞ `locationtype`.
- **–®–∞–≥ 5: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è `Location`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/core/crud/crud_location.py` —Å –∫–ª–∞—Å—Å–æ–º `CRUDLocation(CRUDBase[Location])`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã `get_by_static_id` –∏ `get_locations_by_type`.
    - –°–æ–∑–¥–∞–Ω `src/core/crud/__init__.py` –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ `location_crud`.
- **–®–∞–≥ 6: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã `get_location` –∏ `get_static_location_id`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/core/locations_utils.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `get_location` (–æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `location_crud.get`) –∏ `get_location_by_static_id` (–æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `location_crud.get_by_static_id`).
    - –û–±–Ω–æ–≤–ª–µ–Ω `src/core/__init__.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è `locations_utils`.
- **–®–∞–≥ 7: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –§—É–Ω–∫—Ü–∏—è `get_localized_text` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `src/core/locations_utils.py`.
    - –£—Ç–∏–ª–∏—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ —è–∑—ã–∫—É, fallback-—è–∑—ã–∫—É, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∏–ª–∏ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **–®–∞–≥ 8: –û–±–Ω–æ–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `on_guild_join`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –í `src/bot/events.py` –æ–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `on_guild_join` –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `_ensure_guild_config_exists` –∏ `_populate_default_locations`.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ `GuildConfig` (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∞–≤–∏–ª–∞ `guild_main_language` —á–µ—Ä–µ–∑ `update_rule_config`.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π (`DEFAULT_STATIC_LOCATIONS`) –¥–ª—è –Ω–æ–≤–æ–π –≥–∏–ª—å–¥–∏–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `get_db_session` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π –ë–î.

## –ó–∞–¥–∞—á–∞ 15: üë• 1.2 Player and Party System (Models, CRUD, Utils, Commands)
- **–®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è Player and Party System** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –º–æ–¥–µ–ª–∏ Player –∏ Party, –∏—Ö –ø–æ–ª—è, Enum-—Ç–∏–ø—ã –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤, –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥ `/start` –∏ `/party`, –∞ —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–ª—è `get_db_session` –≤ `src/core/database.py`.
- **–®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã Enum'—ã `PlayerStatus` –∏ `PartyTurnStatus`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/models/enums.py` —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏ `PlayerStatus` –∏ `PartyTurnStatus`.
    - `src/models/__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞.
- **–®–∞–≥ 3: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Player`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/models/player.py` —Å –º–æ–¥–µ–ª—å—é `Player`.
    - –í–∫–ª—é—á–µ–Ω—ã –≤—Å–µ –ø–æ–ª—è, FK, UniqueConstraint(`guild_id`, `discord_id`), Enum `PlayerStatus`, –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ `Location` –∏ `Party`.
- **–®–∞–≥ 4: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `Party`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/models/party.py` —Å –º–æ–¥–µ–ª—å—é `Party`.
    - –í–∫–ª—é—á–µ–Ω—ã –≤—Å–µ –ø–æ–ª—è, FK, Enum `PartyTurnStatus`, JSON-–ø–æ–ª–µ `player_ids_json`, –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ `Location` –∏ `Player`.
- **–®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ú–æ–¥–µ–ª–∏ `Player` –∏ `Party` –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∏–º–ø–æ—Ä—Ç—ã `src/models/__init__.py`.
- **–®–∞–≥ 6: –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic –¥–ª—è `Player` –∏ `Party`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic/versions/0004_create_players_and_parties_tables.py`.
    - –ú–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü `parties` –∏ `players`, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö ENUM-—Ç–∏–ø–æ–≤, –∏–Ω–¥–µ–∫—Å–æ–≤, FK –∏ UniqueConstraint.
- **–®–∞–≥ 7: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã CRUD-–∫–ª–∞—Å—Å—ã `CRUDPlayer` –∏ `CRUDParty`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω—ã `src/core/crud/crud_player.py` –∏ `src/core/crud/crud_party.py`.
    - `CRUDPlayer` –≤–∫–ª—é—á–∞–µ—Ç `get_by_discord_id`, `get_multi_by_location`, `get_multi_by_party_id`, `create_with_defaults`.
    - `CRUDParty` –≤–∫–ª—é—á–∞–µ—Ç `get_by_name`, `add_player_to_party_json`, `remove_player_from_party_json`.
    - `src/core/crud/__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞.
- **–®–∞–≥ 8: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è Player –∏ Party** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/core/player_utils.py` (—Å `get_player`, `get_player_by_discord_id`, `get_players_in_location`, `get_players_in_party`).
    - –°–æ–∑–¥–∞–Ω `src/core/party_utils.py` (—Å `get_party`, `get_party_by_name`).
    - `src/core/__init__.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Ö —ç–∫—Å–ø–æ—Ä—Ç–∞.
- **–®–∞–≥ 9: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/start`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ö–æ–º–∞–Ω–¥–∞ `/start` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/bot/commands.py` (–≤ `CommandCog`).
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞, —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ —Å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –ª–æ–∫–∞—Ü–∏–µ–π –∏ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
- **–®–∞–≥ 10: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è Party** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω `src/bot/commands/party_commands.py` —Å `PartyCog`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã: `/party create <–Ω–∞–∑–≤–∞–Ω–∏–µ>`, `/party leave`, `/party disband`.
    - `src/bot/core.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ `party_commands` Cog.

## –ó–∞–¥–∞—á–∞ 16: üö∂ 1.3 Movement Logic and Command
- **–®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¥–ª—è Movement Logic** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `handle_move_action` –∏ –∫–æ–º–∞–Ω–¥–µ `/move`.
    - –£—á—Ç–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–µ–π `Player`, `Party`, `Location`, `RuleConfig`.
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ –¥–ª—è `log_event` (Task 19) –∏ `on_enter_location` (Task 14).
- **–®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∞ API —Ñ—É–Ω–∫—Ü–∏—è `handle_move_action`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/game_events.py` —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ `on_enter_location` –∏ `log_event`.
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/movement_logic.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_move_action(guild_id, player_discord_id, target_location_static_id)`:
        - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–∞, —Ç–µ–∫—É—â–µ–π –∏ —Ü–µ–ª–µ–≤–æ–π –ª–æ–∫–∞—Ü–∏–π.
        - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –ª–æ–∫–∞—Ü–∏–π —á–µ—Ä–µ–∑ `neighbor_locations_json`.
        - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –ø–∞—Ä—Ç–∏–∏ (–µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –≤ –ø–∞—Ä—Ç–∏–∏, –≤—Å—è –ø–∞—Ä—Ç–∏—è –¥–≤–∏–∂–µ—Ç—Å—è).
        - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `@transactional` —á–µ—Ä–µ–∑ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `_update_entities_location`.
        - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ `on_enter_location` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è.
        - –í–æ–∑–≤—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ.
- **–®–∞–≥ 3: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/move`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/bot/commands/movement_commands.py` —Å `MovementCog`.
    - –í `MovementCog` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/move <target_location_static_id>` –∫–∞–∫ slash command.
    - –ö–æ–º–∞–Ω–¥–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `guild_id`, `player_discord_id` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `handle_move_action`.
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
    - `src/bot/core.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ `movement_commands` Cog.
- **–®–∞–≥ 4: –ü—Ä–æ–¥—É–º–∞–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–≤–∏–∂–µ–Ω–∏—è –¥–ª—è –≥—Ä—É–ø–ø—ã (RuleConfig)** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–ª—é—á `party_movement_policy` –¥–ª—è `RuleConfig` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–Ω–∞—á–µ–Ω–∏—è: `any_member`, `leader_only`).
    - MVP-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ—è–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É `any_member`.
    - –†–µ—à–µ–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —á—Ç–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ `RuleConfig` –¥–æ –±–æ–ª–µ–µ –∑—Ä–µ–ª–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤–∏–ª –∏–ª–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–∏–¥–µ—Ä—Å—Ç–≤–∞ –≤ –≥—Ä—É–ø–ø–µ).
- **–®–∞–≥ 5: –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è `on_enter_location`** (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)
    - –§—É–Ω–∫—Ü–∏—è `on_enter_location` –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ `src/core/game_events.py` –Ω–∞ –®–∞–≥–µ 2 –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (–ª–æ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤).

## –ó–∞–¥–∞—á–∞ 17: üì¶ 2.1 Finalize Definition of ALL DB Schemas (i18n, Guild ID)
- –ó–∞–¥–∞—á–∞ 2.1 (Finalize Definition of ALL DB Schemas (i18n, Guild ID)) –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`.
- –ó–∞–¥–∞—á–∞ 2.1 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`.

## –ó–∞–¥–∞—á–∞ 18: ü§ñ 2.2 AI Prompt Preparation Module
- –ó–∞–¥–∞—á–∞ 2.2 (AI Prompt Preparation Module) –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`.
- –ó–∞–¥–∞—á–∞ 2.2 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`.

## –ó–∞–¥–∞—á–∞ 19: ‚úÖ 2.3 AI Prompt Construction Logic
- –ó–∞–¥–∞—á–∞ 2.3 –∑–∞–ø–∏—Å–∞–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –≤ `Done.txt`.
- –ó–∞–¥–∞—á–∞ 2.3 —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Ñ–∞–π–ª–∞ `Tasks.txt`.

## –ó–∞–¥–∞—á–∞ 20: üß† 2.6 AI Generation, Moderation, and Saving Logic
- (–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—ã—à–µ, –∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –æ—Ç–º–µ—Ç–∫–∞ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–µ)

## –ó–∞–¥–∞—á–∞ 21: ‚öôÔ∏è 6.10 Action Parsing and Recognition Module (NLU & Intent/Entity)
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –≤—Å–µ —à–∞–≥–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–ª–∞–Ω–∞ –¥–ª—è –∑–∞–¥–∞—á–∏ 6.10 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã (—Å–æ–∑–¥–∞–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π `ParsedAction`, `ActionEntity`; —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `nlu_service.parse_player_input` —Å regex; –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `on_message` —á–µ—Ä–µ–∑ `_process_player_message_for_nlu`; –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `player.collected_actions_json`).
- –ó–∞–ø–∏—Å—å –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `Done.txt`.
- –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–π.

## –ó–∞–¥–∞—á–∞ 22: ‚öôÔ∏è 6.12 Turn Queue System (Turn Controller) - Per-Guild Processing
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç–∞—Ç—É—Å–∞–º –∏–≥—Ä–æ–∫–æ–≤/–≥—Ä—É–ø–ø, –∫–æ–º–∞–Ω–¥–∞–º `/end_turn`, `/end_party_turn`, –ª–æ–≥–∏–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ –∏ –≤—ã–∑–æ–≤—É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤**: –í `src/models/enums.py` –æ–±–Ω–æ–≤–ª–µ–Ω—ã `PlayerStatus` (–¥–æ–±–∞–≤–ª–µ–Ω—ã `TURN_ENDED_PENDING_RESOLUTION`, `PROCESSING_GUILD_TURN`; —É–¥–∞–ª–µ–Ω `PROCESSING_ACTION`) –∏ `PartyTurnStatus` (–¥–æ–±–∞–≤–ª–µ–Ω—ã `AWAITING_PARTY_ACTION`, `TURN_ENDED_PENDING_RESOLUTION`, `PROCESSING_GUILD_TURN`; —É–¥–∞–ª–µ–Ω—ã `ACTIVE_TURN`, `PROCESSING_ACTIONS`, `WAITING_FOR_MEMBERS`, `TURN_ENDED`).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥**: –°–æ–∑–¥–∞–Ω `src/bot/commands/turn_commands.py` —Å `TurnManagementCog`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ–º–∞–Ω–¥—ã `/end_turn` –∏ `/end_party_turn`. –ö–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª—è—é—Ç —Å—Ç–∞—Ç—É—Å—ã –∏–≥—Ä–æ–∫–∞/–≥—Ä—É–ø–ø—ã –∏ –≤—ã–∑—ã–≤–∞—é—Ç –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏**: –°–æ–∑–¥–∞–Ω `src/core/turn_controller.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ `process_guild_turn_if_ready` (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –¥–ª—è –≥–∏–ª—å–¥–∏–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π –Ω–∞ `PROCESSING_GUILD_TURN` –∏ –≤—ã–∑–æ–≤–æ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π) –∏ `trigger_guild_turn_processing` (–¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ Cog).
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: `TurnManagementCog` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `BOT_COGS` –≤ `src/config/settings.py`. `turn_controller` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/__init__.py`. –ö–æ–º–∞–Ω–¥—ã –≤ `turn_commands.py` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –≤—ã–∑–æ–≤–∞ `trigger_guild_turn_processing`.
- **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î**: –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic `alembic/versions/0006_update_turn_statuses.py` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ ENUM `PlayerStatus` –∏ `PartyTurnStatus` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `ALTER TYPE ... ADD VALUE IF NOT EXISTS`.
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–∞–Ω–¥, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–ª–µ–Ω "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –≤ `AGENTS.md`.

## –ó–∞–¥–∞—á–∞ 23: ‚öôÔ∏è 6.11 Central Collected Actions Processing Module (Turn Processor) - Guild-Scoped Execution
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: –î–µ—Ç–∞–ª—å–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–æ—Ä–∫–µ—Ä, –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–æ–≤ (`collected_actions_json`), —Ñ–∞–∑—ã –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (MVP –¥–ª—è –≥—Ä—É–ø–ø—ã, —Å–æ–∑–¥–∞–Ω–∏–µ `PendingConflict`, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ú–∞—Å—Ç–µ—Ä–∞), –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–≤—ã–∑–æ–≤ Check Resolver), —Ñ–∞–∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π (–∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –∞—Ç–æ–º–∞—Ä–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –≤—ã–∑–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π-–∑–∞–≥–ª—É—à–µ–∫), –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏–≥—Ä–æ–∫–æ–≤/–≥—Ä—É–ø–ø.
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `PendingConflict` –≤ `src/models/pending_conflict.py` –∏ Enum `ConflictStatus` –≤ `src/models/enums.py`. –û–±–Ω–æ–≤–ª–µ–Ω `src/models/guild.py` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏. –û–±–Ω–æ–≤–ª–µ–Ω `src/models/__init__.py`. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è Alembic `0007_create_pending_conflicts_table.py`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `action_processor.py`**: –°–æ–∑–¥–∞–Ω `src/core/action_processor.py` —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π `process_actions_for_guild`. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–æ–≤, MVP-–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π –∫ –∑–∞–≥–ª—É—à–∫–∞–º (`_handle_placeholder_action`, `_handle_move_action_wrapper`) —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `turn_controller.py`**: `src/core/turn_controller.py` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞ `action_processor.process_actions_for_guild` —á–µ—Ä–µ–∑ `asyncio.create_task`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `core/__init__.py`**: `action_processor` –∏ –µ–≥–æ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `src/core/__init__.py`.
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ)**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –ø–ª–∞–Ω –¥–ª—è –º–∞–Ω—É–∞–ª—å–Ω–æ–≥–æ/–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –æ—á–∏—Å—Ç–∫–∏ `collected_actions_json`.

## –ó–∞–¥–∞—á–∞ 24: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Alembic –º–∏–≥—Ä–∞—Ü–∏–π (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])
- **–ü—Ä–æ–±–ª–µ–º–∞ 1: `DuplicateObjectError: type "event_type_enum" already exists`**
    - **–ü—Ä–∏—á–∏–Ω–∞:** –ú–∏–≥—Ä–∞—Ü–∏—è `0009_create_story_logs_table.py` –ø—ã—Ç–∞–ª–∞—Å—å —Å–æ–∑–¥–∞—Ç—å ENUM `event_type_enum`, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –±—ã–ª —Å–æ–∑–¥–∞–Ω –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã (`4a069d44a15c_initial_schema.py`). –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (`checkfirst=True` –≤ —è–≤–Ω–æ–º –≤—ã–∑–æ–≤–µ `ENUM.create()`) –Ω–µ –ø–æ–º–æ–≥–ª–∞, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –Ω–µ—è–≤–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ ENUM –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ `postgresql.ENUM` –≤ `op.create_table`.
    - **–†–µ—à–µ–Ω–∏–µ:**
        - –í —Ñ–∞–π–ª–µ `alembic/versions/0009_create_story_logs_table.py` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `eventtype_enum` –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `postgresql.ENUM(*event_type_values, name="event_type_enum", create_type=False)`. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏–ª–æ –ø–æ–ø—ã—Ç–∫—É SQLAlchemy —Å–æ–∑–¥–∞—Ç—å —Ç–∏–ø ENUM –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ `op.create_table`.
        - –Ø–≤–Ω—ã–µ –≤—ã–∑–æ–≤—ã `eventtype_enum.create()` –∏ `eventtype_enum.drop()` –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ `0009` –æ—Å—Ç–∞–ª–∏—Å—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.
- **–ü—Ä–æ–±–ª–µ–º–∞ 2: `DuplicateTableError: relation "story_logs" already exists`**
    - **–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ —Å ENUM, –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è `0009_create_story_logs_table.py` —Ç–∞–∫–∂–µ –ø—ã—Ç–∞–ª–∞—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `story_logs` (`op.create_table("story_logs", ...)`), –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã (`4a069d44a15c_initial_schema.py`). –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —Ç–∞–±–ª–∏—Ü –ø–æ–∫–∞–∑–∞–ª–æ –∏—Ö –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å.
    - **–†–µ—à–µ–Ω–∏–µ:**
        - –í —Ñ–∞–π–ª–µ `alembic/versions/0009_create_story_logs_table.py` –≤—ã–∑–æ–≤ `op.create_table("story_logs", ...)` –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º `op.create_index(...)` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `upgrade()` –±—ã–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.
        - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤—ã–∑–æ–≤—ã `op.drop_table("story_logs")` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ `op.drop_index(...)` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `downgrade()` —Ç–∞–∫–∂–µ –±—ã–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.
        - –í —Ñ—É–Ω–∫—Ü–∏—è—Ö `upgrade()` –∏ `downgrade()` –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã `pass`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Å—Ç–∞–ª–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—É—Å—Ç—ã–º–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã `story_logs`.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∏–≥—Ä–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å –ø–æ—Å–ª–µ —ç—Ç–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

## –ó–∞–¥–∞—á–∞ 25: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç –¥–ª—è `main.py`, –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥–∏ (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])
- **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
    - –°–æ–∑–¥–∞–Ω –ø–ª–∞–Ω –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `src/main.py`, –≤–∫–ª—é—á–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ—à–∏–±–æ–∫, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤.
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
    - –î–æ–±–∞–≤–ª–µ–Ω—ã `pytest` –∏ `pytest-asyncio` –≤ `requirements.txt`.
    - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pip install -r requirements.txt`).
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `tests/test_main.py` —Å –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Ç–µ—Å—Ç–æ–≤ –∏ —Ñ–∏–∫—Å—Ç—É—Ä (`mock_settings`, `mock_bot_core`, `mock_init_db`).
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤:**
    - –ù–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `src/main.py`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–µ —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–æ–∫–µ–Ω–∞, –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î, –æ—à–∏–±–∫–∏ –ª–æ–≥–∏–Ω–∞ Discord –∏ –æ–±—â–∏–µ –æ—à–∏–±–∫–∏ –∑–∞–ø—É—Å–∫–∞. –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ `sys.path`.
    - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –≤ `src/core/`:**
        - `src/core/locations_utils.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from models.location...` –Ω–∞ `from ..models.location...`.
        - `src/core/crud/crud_location.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from models.location...` –Ω–∞ `from ...models.location...` –∏ `from core.crud_base_definitions...` –Ω–∞ `from ..crud_base_definitions...`. (–ë—ã–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π).
        - `src/core/crud/crud_player.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from models.player...` –Ω–∞ `from ...models.player...`.
        - `src/core/crud/crud_party.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã `from models.party...` –∏ `from models.player...` –Ω–∞ `from ...models.party...` –∏ `from ...models.player...` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
        - `src/core/movement_logic.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `from models...` –Ω–∞ `from ..models...`.
    - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤ `src/core/action_processor.py`:**
        - –ó–∞–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç `get_player_by_id` –Ω–∞ `get_player` –∏–∑ `player_utils`.
        - –ó–∞–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç `get_party_by_id` –Ω–∞ `get_party` –∏–∑ `party_utils`.
    - **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö –∏ —Ç–µ—Å—Ç–∞—Ö `tests/test_main.py`:**
        - –§–∏–∫—Å—Ç—É—Ä–∞ `mock_settings`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ `LOG_LEVEL` –∏ `BOT_PREFIX`. `BOT_PREFIX` –º–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤ `src.config.settings`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `main()`. `LOG_LEVEL` –∏ `DISCORD_BOT_TOKEN` –º–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ `main_module`.
        - –§–∏–∫—Å—Ç—É—Ä–∞ `mock_init_db`: –ò–∑–º–µ–Ω–µ–Ω–∞ —Å `async def` –Ω–∞ `def`, —á—Ç–æ–±—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `AsyncMock` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö.
        - –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è/–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ—Å—Ç `test_main_no_token` –≤ –ø–æ–ª—å–∑—É `test_main_no_token_fixed`.
        - –í —Ç–µ—Å—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–µ –æ—à–∏–±–∫–∏ (`test_main_discord_login_failure`, `test_main_generic_start_exception`, `test_main_keyboard_interrupt_handling`), –¥–æ–±–∞–≤–ª–µ–Ω—ã `monkeypatch` –∏ –º–æ–∫–∏ –¥–ª—è `discord.Intents` –∏ `discord.ext.commands.when_mentioned_or` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∞—Ü–∏–∏ `BotCore` –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –µ–≥–æ –º–µ—Ç–æ–¥ `start()` –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É.
        - –í —ç—Ç–∏—Ö –∂–µ —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è `expected_prefix_callable` –Ω–∞ `lambda bot, msg: ['?']` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É `BOT_PREFIX`.
        - **–ü—Ä–æ–±–ª–µ–º–∞ —Å –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º `finally` –±–ª–æ–∫–∞:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω." (–∏ –¥—Ä—É–≥–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –±–ª–æ–∫–∞ `finally` –≤ `main.py`) –Ω–µ –ø–æ–ø–∞–¥–∞–ª–æ –≤ `caplog.text` –¥–ª—è —Ç–µ—Å—Ç–æ–≤, –≥–¥–µ –≤ `main()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –ü—Ä–∏ —ç—Ç–æ–º `mock_bot_core.close.assert_called_once()` –ø—Ä–æ—Ö–æ–¥–∏–ª, —É–∫–∞–∑—ã–≤–∞—è –Ω–∞ —Ç–æ, —á—Ç–æ –±–ª–æ–∫ `finally` –¥–æ—Å—Ç–∏–≥–∞–ª—Å—è.
        - –í `src/main.py` –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è–ª–∏—Å—å —è–≤–Ω—ã–µ `return` –≤ `except` –±–ª–æ–∫–∞—Ö –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ `print` –≤ `finally` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏. –≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Ä–µ—à–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –∑–∞—Ö–≤–∞—Ç–∞ –ª–æ–≥–æ–≤.
        - –ü—Ä–∏–Ω—è—Ç–æ –ø—Ä–∞–≥–º–∞—Ç–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —É–¥–∞–ª–∏—Ç—å –∞—Å—Å–µ—Ä—Ç—ã `assert "–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω." in caplog.text` –∏–∑ —Ç–µ—Å—Ç–æ–≤ `test_main_discord_login_failure`, `test_main_generic_start_exception` –∏ `test_main_keyboard_interrupt_handling`, —Ç–∞–∫ –∫–∞–∫ –¥—Ä—É–≥–∏–µ –≤–∞–∂–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏, –≤—ã–∑–æ–≤ `bot.close()`) –ø—Ä–æ—Ö–æ–¥–∏–ª–∏. –≠—Ç–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –≤–æ–∑–º–æ–∂–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è `caplog` —Å `asyncio` –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –¥–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.
        - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π `finally` –±–ª–æ–∫ –≤ `src/main.py` (—É–¥–∞–ª–µ–Ω—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ `print` –∏ —è–≤–Ω—ã–µ `return` –∏–∑ `except` –±–ª–æ–∫–æ–≤, –∫—Ä–æ–º–µ `logger.info` –≤ `finally`).
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ 7 —Ç–µ—Å—Ç–æ–≤ –≤ `tests/test_main.py` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.

## –ó–∞–¥–∞—á–∞ 26: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ –∏ TypeError (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])
- **–ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞ `ImportError: attempted relative import beyond top-level package` –∏ `ModuleNotFoundError`**
    - **–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ `src/bot/core.py` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `bot.events` –≤–º–µ—Å—Ç–æ `src.bot.events`), –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Ñ–∞–π–ª–∞ `src/bot/commands.py` —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π `src/bot/commands/`, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `__init__.py` –≤ `src/bot/commands/`. –¢–∞–∫–∂–µ, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥—É–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `party_commands.py`) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∏–º–ø–æ—Ä—Ç—ã –≤–∏–¥–∞ `from core...` –≤–º–µ—Å—Ç–æ `from src.core...`.
    - **–†–µ—à–µ–Ω–∏–µ:**
        - –í `src/bot/core.py` –∏–∑–º–µ–Ω–µ–Ω—ã –ø—É—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –æ—Ç –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ (`src.bot.events`, `src.bot.commands.party_commands` –∏ —Ç.–¥.).
        - –§–∞–π–ª `src/bot/commands.py` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `src/bot/general_commands.py`, –∏ –ø—É—Ç—å –µ–≥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ `src/bot/core.py` –æ–±–Ω–æ–≤–ª–µ–Ω.
        - –°–æ–∑–¥–∞–Ω –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª `src/bot/commands/__init__.py`.
        - –í `src/bot/commands/party_commands.py` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –Ω–∞ `from src.core...` –∏ `from src.models...`.
- **–ü—Ä–æ–±–ª–µ–º–∞ 2: `ImportError: cannot import name 'get_party_by_id' from 'src.core.party_utils'` –≤ `src.bot.commands.turn_commands.py`**
    - **–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `get_party_by_id` –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞ –≤ `src/core/party_utils.py`. –í–º–µ—Å—Ç–æ –Ω–µ–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_party(..., party_id: int)`, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è —Ç—É –∂–µ —Ä–æ–ª—å.
    - **–†–µ—à–µ–Ω–∏–µ:** –í `src/bot/commands/turn_commands.py` –∏–º–ø–æ—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `from src.core.party_utils import get_party`, –∏ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
- **–ü—Ä–æ–±–ª–µ–º–∞ 3: `TypeError: unsupported type annotation <class 'discord.interactions.Interaction'>` –≤ `src.bot.commands.master_ai_commands.py`**
    - **–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@transactional` (–∫–æ—Ç–æ—Ä—ã–π –≤–Ω–µ–¥—Ä—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `session: AsyncSession`) –Ω–∞ –º–µ—Ç–æ–¥–∞—Ö –∫–æ–º–∞–Ω–¥ (`reject_ai`, `edit_ai`), –∫–æ—Ç–æ—Ä—ã–µ —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç `interaction: discord.Interaction`. –°–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤ `discord.py` –¥–ª—è slash-–∫–æ–º–∞–Ω–¥ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é `discord.Interaction` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤–Ω–µ–¥—Ä–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `AsyncSession`, –æ—à–∏–±–æ—á–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—è –µ–µ –∫–∞–∫ –º–æ–¥—É–ª—å `discord.interactions.Interaction`.
    - **–†–µ—à–µ–Ω–∏–µ:** –î–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –∫–æ–º–∞–Ω–¥ (`reject_ai`, `edit_ai`) –≤ `master_ai_commands.py`:
        - –£–¥–∞–ª–µ–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional` —Å —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥—ã.
        - –£–¥–∞–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `session: AsyncSession` –∏–∑ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥—ã.
        - –í —Ç–µ–ª–µ –∫–æ–º–∞–Ω–¥—ã —Å–µ—Å—Å–∏—è —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ `async with get_db_session() as session:`.
        - –Ø–≤–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `await session.commit()` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `with`.
    - –≠—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç "—á–∏—Å—Ç—É—é" —Å–∏–≥–Ω–∞—Ç—É—Ä—É –¥–ª—è `discord.py` –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –≤–Ω—É—Ç—Ä—å –º–µ—Ç–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã. –ö–æ–º–∞–Ω–¥–∞ `approve_ai` —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∏ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## –ó–∞–¥–∞—á–∞ 27: –í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ –º–∏–≥—Ä–∞—Ü–∏—è—Ö Alembic (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])
- –ü–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (0002-0007), —É–ø–æ–º—è–Ω—É—Ç—ã–µ –≤ –ª–æ–≥–∞—Ö, –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã.
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å `4a069d44a15c_initial_schema.py`.
- –í—Å–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –æ—Å–Ω–æ–≤—ã–≤–∞—Ç—å—Å—è –Ω–∞ `4a069d44a15c` –≤ –∫–∞—á–µ—Å—Ç–≤–µ `down_revision`. –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞ –¥–æ —ç—Ç–æ–π –æ—Ç–º–µ—Ç–∫–∏, –∫–∞—Å–∞—é—â–∏–µ—Å—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π 0002-0007, —Å–ª–µ–¥—É–µ—Ç —Å—á–∏—Ç–∞—Ç—å –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –º–∏–≥—Ä–∞—Ü–∏–π.

## –ó–∞–¥–∞—á–∞ 28: üìö 7.1 Event Log Model (Story Log, i18n, Guild-Scoped)
- **Analysis**: Reviewed requirements for `StoryLog` model and `log_event` API from `Tasks.txt`.
    - Model fields: `id`, `guild_id`, `timestamp`, `location_id`, `event_type`, `entity_ids_json`, `details_json`.
    - API: `log_event(session, guild_id, event_type, details_json, player_id, party_id, location_id, entity_ids_json)`.
    - Decided to use existing `EventType` ENUM from `src/models/enums.py` as found in pre-existing `story_log.py`.
- **Model Definition**:
    - Found existing `src/models/story_log.py` which largely matched requirements, including `EventType` enum usage and an additional `narrative_i18n` field.
    - Updated `src/models/story_log.py` to correctly define relationships:
        - `guild: Mapped["GuildConfig"] = relationship(back_populates="story_logs")`
        - `location: Mapped[Optional["Location"]] = relationship()`
    - Updated `src/models/guild.py` by adding the corresponding `story_logs: Mapped[List["StoryLog"]] = relationship(back_populates="guild", cascade="all, delete-orphan")` relationship and type hints.
    - Verified `StoryLog` and `EventType` were already imported in `src/models/__init__.py`.
- **Alembic Migration**:
    - Identified latest migration as `0008_add_player_sublocation`.
    - Installed dependencies from `requirements.txt` using `pip install -r requirements.txt` to make `alembic` command available.
    - Generated new migration `alembic revision -m "create_story_logs_table" --rev-id "0009"`.
    - Edited `alembic/versions/0009_create_story_logs_table.py`:
        - Set `down_revision = '0008_add_player_sublocation'`.
        - Added operations to create and drop the `event_type_enum` PostgreSQL ENUM type (named `event_type_enum` to match model).
        - Added operations to create and drop the `story_logs` table, matching the `StoryLog` model fields, FKs, and indexes.
        - Corrected `details_json` column to be `nullable=True` to match the model definition.
- **API Implementation**:
    - Implemented `log_event` function in `src/core/game_events.py`, replacing the existing placeholder.
    - Ensured `AsyncSession` type hint and import.
    - Added logic to convert input `event_type` string (e.g., "PLAYER_ACTION") to `EventType` enum member.
    - Added logic to automatically populate `entity_ids_json` with `player_id` (under 'players' key) and `party_id` (under 'parties' key) if provided.
    - Updated `src/core/__init__.py` to import `log_event` and `on_enter_location` from `game_events` and add them to `__all__`.
- **Unit Tests**:
    - Created `tests/core/test_game_events.py`.
    - Wrote tests for `log_event`: successful logging, invalid event type, entity_ids handling, and minimal parameters.
    - Resolved `ModuleNotFoundError: No module named 'src'` during test runs by using `python -m pytest`.
    - Corrected tests to handle `StoryLog.timestamp` (which uses `server_default`) being `None` in unit tests as the database is not hit.
    - All 10 tests for `log_event` passed.

## –ó–∞–¥–∞—á–∞ 29: ‚öôÔ∏è 6.1.1 Intra-Location Interaction Handler Module
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–π—Å—Ç–≤–∏–π –≤–Ω—É—Ç—Ä–∏ –ª–æ–∫–∞—Ü–∏–∏ (`examine`, `interact`, `move_to_sublocation`), API `handle_intra_location_action`.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Player**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `current_sublocation_name: Optional[str]` –≤ –º–æ–¥–µ–ª—å `Player` (`src/models/player.py`) –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª–æ–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏.
- **–ú–∏–≥—Ä–∞—Ü–∏—è Alembic**: –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `0008_add_player_sublocation.py` –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è –≤ –ë–î. `down_revision` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `4a069d44a15c` —Å–æ–≥–ª–∞—Å–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `interaction_handlers.py`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/interaction_handlers.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_intra_location_action(guild_id, session, player_id, action_data)`:
        - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–≥—Ä–æ–∫–∞ –∏ –µ–≥–æ —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é.
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `_find_target_in_location` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤/—Å—É–±–ª–æ–∫–∞—Ü–∏–π –≤ `Location.generated_details_json.interactable_elements` (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å `name`, `description_i18n`, `type`, `interaction_rules_key`, `actual_sublocation_name` –∏ —Ç.–¥.).
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–Ω—Ç `examine`: –∏–∑–≤–ª–µ–∫–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å.
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–Ω—Ç `interact`: MVP-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ `RuleConfig` –∏ `resolve_check`. –õ–æ–≥–∏—Ä—É–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.
        - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–Ω—Ç `move_to_sublocation`: –æ–±–Ω–æ–≤–ª—è–µ—Ç `player.current_sublocation_name` (–∏—Å–ø–æ–ª—å–∑—É—è `actual_sublocation_name` –∏–∑ –¥–∞–Ω–Ω—ã—Ö —Ü–µ–ª–∏, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ).
        - –í—ã–∑—ã–≤–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É `log_event` –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π.
        - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    - –ú–æ–¥—É–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ `src/core/__init__.py`.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `action_processor.py`**:
    - –í `src/core/action_processor.py` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `handle_intra_location_action`.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±–µ—Ä—Ç–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_handle_intra_location_action_wrapper`.
    - –û–±–Ω–æ–≤–ª–µ–Ω `ACTION_DISPATCHER` –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ–Ω—Ç–æ–≤ `examine`, `interact`, `go_to` (–¥–ª—è —Å—É–±–ª–æ–∫–∞—Ü–∏–π) –Ω–∞ –Ω–æ–≤—É—é –æ–±–µ—Ä—Ç–æ—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ NLU (`nlu_service.py`)**:
    - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è "examine <target>" –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω—Ç–µ–Ω—Ç–∞ `examine` –∏ —Å—É—â–Ω–æ—Å—Ç–∏ `name`.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ regex-–ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–æ–≤ `interact` (—Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ `use`, `activate` –∏ —Ç.–¥.) –∏ `go_to` (–¥–ª—è —Å—É–±–ª–æ–∫–∞—Ü–∏–π, —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ `enter`, `move to`), —Ç–∞–∫–∂–µ –∏–∑–≤–ª–µ–∫–∞—é—â–∏–µ —Å—É—â–Ω–æ—Å—Ç—å `name`.
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ/–º–∞–Ω—É–∞–ª—å–Ω–æ–µ)**:
    - –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏ –∏—Å—Ö–æ–¥–æ–≤.
    - –í —Ö–æ–¥–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—è–≤–ª–µ–Ω–∞ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫–∞–Ω–æ–Ω–∏—á–Ω–æ–µ –∏–º—è –¥–ª—è —Å—É–±–ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ `player.current_sublocation_name` (—á–µ—Ä–µ–∑ –ø–æ–ª–µ `actual_sublocation_name` –≤ –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞).
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–ª–µ–Ω "–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω" –∏ "–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π" –≤ `AGENTS.md`.

## –ó–∞–¥–∞—á–∞ 30: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ç–µ—Å—Ç–∞—Ö (–°–µ—Å—Å–∏—è [—Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è])
- **–ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è:** –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ `python -m pytest` –≤—ã—è–≤–∏–ª –æ—à–∏–±–∫–∏ `fixture 'mocker' not found` –≤ `tests/core/test_action_processor.py` –∏ `AttributeError: ... has no attribute 'get_db_session'` –≤–º–µ—Å—Ç–µ —Å `ModuleNotFoundError: No module named 'core'` –≤ `tests/bot/test_general_commands_mocked.py`. –¢–∞–∫–∂–µ –±—ã–ª–∞ –æ—à–∏–±–∫–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `test_ping_command`.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ `tests/core/test_action_processor.py`**:
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `pytest-mock` –≤ `requirements.txt` –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (`pip install -r requirements.txt`). –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω–∏–ª–æ –æ—à–∏–±–∫—É `fixture 'mocker' not found`.
    - –í—ã—è–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–µ–º, —á—Ç–æ `ACTION_DISPATCHER` –≤ `src/core/action_processor.py` –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–ª —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ –∏—Ö –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ–∏–∫—Å—Ç—É—Ä–∞ `patch_action_handlers_directly`: —Ç–µ–ø–µ—Ä—å –æ–Ω–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –º–æ–∫–∏—Ä—É–µ—Ç –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤ –º–æ–¥—É–ª–µ `src.core.action_processor`, –Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç—Ç–∏ –º–æ–∫–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Å–ª–æ–≤–∞—Ä–µ `src.core.action_processor.ACTION_DISPATCHER`. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–ª–æ –≤—ã–∑–æ–≤ –∑–∞–º–æ–∫–∞–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π.
    - –£–¥–∞–ª–µ–Ω –ª–∏—à–Ω–∏–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@transactional` —Å —Ñ—É–Ω–∫—Ü–∏–∏ `_load_and_clear_actions` –≤ `src/core/action_processor.py`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —É–∂–µ –≤ —Ä–∞–º–∫–∞—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
    - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è DEBUG –≤ `_load_and_clear_actions` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–∞.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–∫—Å—Ç—É—Ä–∞ `configure_module_logging` –≤ `tests/core/test_action_processor.py` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è DEBUG –ª–æ–≥–æ–≤ –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–æ–≤.
    - –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –≤ `tests/core/test_action_processor.py` –ø—Ä–æ—Ö–æ–¥—è—Ç.
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ `tests/bot/test_general_commands_mocked.py`**:
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `AttributeError: module 'src.bot.general_commands' has no attribute 'author'`:
        - –¢–µ—Å—Ç—ã –¥–ª—è –∫–æ–º–∞–Ω–¥—ã `start_command` –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∏–∫—Å—Ç—É—Ä—ã `mock_ctx` (–∫–æ—Ç–æ—Ä–∞—è –º–æ–∫–∞–µ—Ç `commands.Context`) –≤–º–µ—Å—Ç–æ `mock_interaction`.
        - –ê—Ç—Ä–∏–±—É—Ç—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`guild.id`, `author.id`, `author.display_name`, `send`) —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `mock_ctx`.
        - –§–∏–∫—Å—Ç—É—Ä–∞ `mock_ctx` –±—ã–ª–∞ —É—Ç–æ—á–Ω–µ–Ω–∞: `ctx.author` —Ç–µ–ø–µ—Ä—å `MagicMock()` –±–µ–∑ `spec` –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (`display_name`, `mention`). `ctx.bot` —Ç–∞–∫–∂–µ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `MagicMock()` –±–µ–∑ `spec` –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—É `mock_bot` –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ `bot.latency`.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `ModuleNotFoundError: No module named 'core'` –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `start_command`:
        - –ò–º–ø–æ—Ä—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `start_command` –≤ `src/bot/general_commands.py` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `from core.database...`) –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã –æ—Ç –∫–æ—Ä–Ω—è `src` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `from src.core.database...`). –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –¥–ª—è `patch` CRUD –æ–ø–µ—Ä–∞—Ü–∏–π (`player_crud`, `location_crud`) –≤ —Ç–µ—Å—Ç–∞—Ö `start_command`. –¢–µ–ø–µ—Ä—å –æ–Ω–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –º–µ—Å—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç—Ç–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'src.core.crud.crud_player.player_crud.get_by_discord_id'`), —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ `start_command`.
    - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `PlayerStatus` –∏–∑ `src.models.enums` –≤ `tests/bot/test_general_commands_mocked.py`.
    - –í `test_start_command_new_player` —É—Ç–æ—á–Ω–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ `created_player_instance_mock` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ (`FixedPlayerNameInTest`). –£ –º–æ–∫–∞ `mock_location` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `name_i18n`.
    - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `test_ping_command`: –∞—Å—Å–µ—Ä—à–Ω —Ç–µ–ø–µ—Ä—å –æ–∂–∏–¥–∞–µ—Ç `"–ü–æ–Ω–≥!"` –∏ `"123ms"` (–±–µ–∑ –ø—Ä–æ–±–µ–ª–∞).
    - –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –≤ `tests/bot/test_general_commands_mocked.py` –ø—Ä–æ—Ö–æ–¥—è—Ç.
- **–û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Å–µ 135 —Ç–µ—Å—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
- **–û—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (RuntimeWarning)**:
    - –í `tests/core/test_turn_controller.py` –∏ `tests/test_main.py` –æ—Å—Ç–∞–ª–∏—Å—å `RuntimeWarning` —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å `AsyncMockMixin._execute_mock_call` –∏ –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ `asyncio`. –≠—Ç–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –ø–∞–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –∏ —Ç—Ä–µ–±—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ, –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –±—É–¥–µ—Ç –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –∏—Ö —É—Å—Ç—Ä–∞–Ω–∏—Ç—å.

## –ó–∞–¥–∞—á–∞ 31: üìö 7.2 AI Narrative Generation (Multilang)
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `generate_narrative`, –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞, –æ–±—Ä–∞–±–æ—Ç–∫–µ —è–∑—ã–∫–∞ (—è–∑—ã–∫ –∏–≥—Ä–æ–∫–∞/–≥–∏–ª—å–¥–∏–∏).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `generate_narrative`**:
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `generate_narrative(session, guild_id, context)` –≤ `src/core/ai_orchestrator.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ —è–∑—ã–∫–∞ (—Å–Ω–∞—á–∞–ª–∞ —è–∑—ã–∫ –∏–≥—Ä–æ–∫–∞ –∏–∑ `Player.selected_language` —á–µ—Ä–µ–∑ `context['player_id']`, –∑–∞—Ç–µ–º —è–∑—ã–∫ –≥–∏–ª—å–¥–∏–∏ –∏–∑ `RuleConfig` –∫–ª—é—á–∞ `guild_main_language`, –∑–∞—Ç–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π 'en').
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ `context` (event_type, involved_entities, location_data, world_state_summary, custom_instruction).
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –º–æ–∫-—Ñ—É–Ω–∫—Ü–∏—è `_mock_narrative_openai_api_call(prompt, language)` –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ LLM —Å —É—á–µ—Ç–æ–º —è–∑—ã–∫–∞.
    - –§—É–Ω–∫—Ü–∏—è `generate_narrative` –≤—ã–∑—ã–≤–∞–µ—Ç `_mock_narrative_openai_api_call`.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ LLM.
    - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã `get_player` –∏ `get_rule` –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥—É–ª—è.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/core/__init__.py`**:
    - `generate_narrative` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `src.core.ai_orchestrator`.
    - `generate_narrative` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `__all__`.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –í `tests/core/test_ai_orchestrator.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –¥–ª—è `generate_narrative`.
    - –¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `@patch` –¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è `_mock_narrative_openai_api_call`, `get_player`, `get_rule` –∏ `@transactional`.
    - –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–æ–≤:
        - –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–∞ –∏–≥—Ä–æ–∫–∞.
        - –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–∞ –≥–∏–ª—å–¥–∏–∏ (–∫–æ–≥–¥–∞ —É –∏–≥—Ä–æ–∫–∞ –Ω–µ—Ç —è–∑—ã–∫–∞ –∏–ª–∏ –Ω–µ—Ç `player_id` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ).
        - –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —è–∑—ã–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ('en'), –∫–æ–≥–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞ –∏–≥—Ä–æ–∫–∞/–≥–∏–ª—å–¥–∏–∏.
        - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å–æ –≤—Å–µ–º–∏ –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
        - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ LLM (–≤–æ–∑–≤—Ä–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —è–∑—ã–∫–µ).
    - –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –º–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@transactional` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Å–µ—Å—Å–∏–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö.

## –ó–∞–¥–∞—á–∞ 32: üìö 7.3 Turn and Report Formatting (Guild-Scoped)
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `format_log_entry` –∏ `format_turn_report`, –≤–∫–ª—é—á–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `StoryLog.details_json`, i18n –∏–º–µ–Ω —Å—É—â–Ω–æ—Å—Ç–µ–π, `RuleConfig` –∏ —Ü–µ–ª–µ–≤–æ–≥–æ —è–∑—ã–∫–∞.
- **–°–æ–∑–¥–∞–Ω–∏–µ `src/core/report_formatter.py`**: –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –¥–ª—è `format_log_entry` –∏ `format_turn_report`, –≤–∫–ª—é—á–∞—è –ø–∞—Ä–∞–º–µ—Ç—Ä `AsyncSession`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `get_localized_entity_name`**:
    - –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `src/core/localization_utils.py`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_localized_entity_name(session, guild_id, entity_type, entity_id, language, fallback_language)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏–º–µ–Ω —Å—É—â–Ω–æ—Å—Ç–µ–π.
    - –í–∫–ª—é—á–∞–µ—Ç `ENTITY_TYPE_MODEL_MAP` –∏ `ENTITY_TYPE_GETTER_MAP` –¥–ª—è —Ä–µ–∑–æ–ª—é—Ü–∏–∏ —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π (—Ç–µ–∫—É—â–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞: "player", "location", "npc", "item", —Å placeholder-–≥–µ—Ç—Ç–µ—Ä–∞–º–∏ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö).
    - –í–∫–ª—é—á–∞–µ—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `get_localized_text` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª–µ–π `name_i18n`.
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `format_log_entry`**:
    - –í `src/core/report_formatter.py` –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `format_log_entry`.
    - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤—ã–∑–æ–≤ `get_localized_entity_name` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω —Å—É—â–Ω–æ—Å—Ç–µ–π.
    - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π: `PLAYER_ACTION` (—Å –ø–æ–¥—Ç–∏–ø–∞–º–∏ `examine`, `interact`, `go_to`), `PLAYER_MOVE`, `ITEM_ACQUIRED`, `COMBAT_ACTION`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –±–∞–∑–æ–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —à–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤ (en/ru).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è `format_turn_report`**:
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `format_turn_report` –≤ `src/core/report_formatter.py`. –û–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Ç–µ—Ä–∏—Ä—É–µ—Ç –ø–æ –ª–æ–≥–∞–º, –≤—ã–∑—ã–≤–∞–µ—Ç `format_log_entry`, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Å—Ç—ã–µ –ª–æ–≥–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `src/core/__init__.py`**:
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –¥–ª—è `localization_utils` (`get_localized_entity_name`, `get_localized_text`) –∏ `report_formatter` (`format_log_entry`, `format_turn_report`).
    - –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `__all__`.
    - –û–±–Ω–æ–≤–ª–µ–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–∞ `core`.
- **–ù–∞–ø–∏—Å–∞–Ω–∏–µ Unit-—Ç–µ—Å—Ç–æ–≤**:
    - –°–æ–∑–¥–∞–Ω `tests/core/test_localization_utils.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `get_localized_text` –∏ `get_localized_entity_name` (–ø–æ–∫—Ä—ã—Ç–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –≤–∫–ª—é—á–∞—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏, —è–∑—ã–∫–æ–≤—ã–µ —Ñ–æ–ª–±–µ–∫–∏, –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã).
    - –°–æ–∑–¥–∞–Ω `tests/core/test_report_formatter.py` —Å —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è `format_log_entry` (–¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π –∏ —è–∑—ã–∫–æ–≤) –∏ `format_turn_report` (–∞–≥—Ä–µ–≥–∞—Ü–∏—è, –ø—É—Å—Ç—ã–µ –ª–æ–≥–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ `guild_id`).
    - –¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `get_localized_entity_name` –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ `format_log_entry`).

## –ó–∞–¥–∞—á–∞ 33: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ (–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è)
- **–¶–µ–ª—å:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Ç–µ—Å—Ç–∞–º–∏, –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –ø–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
    - **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:** –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ `requirements.txt`.
    - **–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:** `python -m pytest` –≤—ã—è–≤–∏–ª 6 –æ—à–∏–±–æ–∫ –∏ 3 —Å–±–æ—è.
        - **–û—à–∏–±–∫–∏ –≤ `tests/models/test_combat_encounter.py` (3 —Å–±–æ—è):**
            - –ü—Ä–∏—á–∏–Ω–∞: `AttributeError: 'SQLiteTypeCompiler' object has no attribute 'visit_json'. Did you mean: 'visit_JSON'?` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `Base.metadata.create_all(cls.engine)`.
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –í `tests/models/test_combat_encounter.py` –≤ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–µ `compile_jsonb_sqlite` –∏–∑–º–µ–Ω–µ–Ω–æ `compiler.visit_json` –Ω–∞ `compiler.visit_JSON`.
            - –†–µ–∑—É–ª—å—Ç–∞—Ç: –¢–µ—Å—Ç—ã –¥–ª—è `test_combat_encounter.py` (3 —Ç–µ—Å—Ç–∞) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
        - **–û—à–∏–±–∫–∏ –≤ `tests/core/test_movement_logic.py` (6 –æ—à–∏–±–æ–∫):**
            - –ü—Ä–∏—á–∏–Ω–∞: `AttributeError: 'coroutine' object has no attribute 'all'` –≤ `_find_location_by_identifier` –≤ `src/core/movement_logic.py` –Ω–∞ —Å—Ç—Ä–æ–∫–µ `found_locations = results.scalars().all()`. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–ª–æ –Ω–∞ —Ç–æ, —á—Ç–æ `results.scalars()` —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—É—Ç–∏–Ω–æ–π.
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –ò–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `scalar_results = await results.scalars(); found_locations = scalar_results.all()`.
            - –ù–æ–≤–∞—è –æ—à–∏–±–∫–∞: `TypeError: object of type 'coroutine' has no len()` –∏ `TypeError: object MagicMock can't be used in 'await' expression`. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–ª–æ –Ω–∞ —Ç–æ, —á—Ç–æ `scalar_results.all()` —Ç–∞–∫–∂–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—É—Ç–∏–Ω–æ–π (–∏–ª–∏ –º–æ–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–µ–≤–µ—Ä–Ω–æ).
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –í `src/core/movement_logic.py` –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `found_locations = await (await results.scalars()).all()`. (–ü–æ–∑–∂–µ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ —ç—Ç–æ `await (await results.scalars()).all()` –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–ª—è SUT, –Ω–æ –º–æ–∫–∏ —Ç–µ—Å—Ç–æ–≤ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —ç—Ç–æ–º—É).
            - –û—à–∏–±–∫–∞ `AttributeError: 'coroutine' object has no attribute 'all'` –≤ `src/core/rules.py` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `load_rules_config_for_guild`.
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –í `src/core/rules.py` –∏–∑–º–µ–Ω–µ–Ω–æ `rules_from_db = result.scalars().all()` –Ω–∞ `scalar_rules = await result.scalars(); rules_from_db = await scalar_rules.all()`. (–≠—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≥–æ, –∫–∞–∫ –º–æ–∫–∏ –±—ã–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `test_execute_move_target_location_not_found_by_static_id`).
            - –ü—Ä–æ–±–ª–µ–º–∞ —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –º–æ–∫–∏ –¥–ª—è `session.execute().scalars().all()` –≤ —Ç–µ—Å—Ç–∞—Ö `_find_location_by_identifier` (6 —Ç–µ—Å—Ç–æ–≤) –Ω–µ —É–≤–µ–Ω—á–∞–ª–∏—Å—å —É—Å–ø–µ—Ö–æ–º, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ `AssertionError: assert <MagicMock name='mock.execute().scalars().all().__getitem__()' ...>`.
            - –†–µ—à–µ–Ω–∏–µ –¥–ª—è 6 —Ç–µ—Å—Ç–æ–≤ `_find_location_by_identifier`: –î–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–±—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —ç—Ç–∏ 6 —Ç–µ—Å—Ç–æ–≤ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø–∞—Ç—á–∏–Ω–≥–∞ —Å–∞–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `_find_location_by_identifier` (`@patch("src.core.movement_logic._find_location_by_identifier", new_callable=AsyncMock)`). –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ —Ç–µ—Å—Ç–∞–º –ø—Ä–æ–π—Ç–∏, –Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –∏–º–µ–Ω–∏ —á–µ—Ä–µ–∑ SQLAlchemy –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —ç—Ç–∏–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ unit-—Ç–µ—Å—Ç–∞–º–∏ –≤ –ø–æ–ª–Ω–æ–π –º–µ—Ä–µ. –¢–µ—Å—Ç—ã –¥–ª—è `execute_move_for_player_action`, –∫–æ—Ç–æ—Ä—ã–µ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `_find_location_by_identifier` (–Ω–æ –≥–¥–µ –æ–Ω –±—ã–ª –∑–∞–º–æ–∫–∞–Ω –∏–ª–∏ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø–æ–∏—Å–∫ –ø–æ static_id), –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏.
        - **–û—à–∏–±–∫–∏ –≤ `test_execute_move_successful_solo_player` –∏ `test_execute_move_successful_party_move`:**
            - –ü—Ä–∏—á–∏–Ω–∞: `TypeError: object MagicMock can't be used in 'await' expression` –≤ `src/core/rules.py` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `await result.scalars()`.
            - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∫–æ–≤ –¥–ª—è `mock_session.execute` –≤ —ç—Ç–∏—Ö —Ç–µ—Å—Ç–∞—Ö, —á—Ç–æ–±—ã `scalars` –±—ã–ª `AsyncMock`.
            - –†–µ–∑—É–ª—å—Ç–∞—Ç: –≠—Ç–∏ –¥–≤–∞ —Ç–µ—Å—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ—Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:**
        - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω `AGENTS.md` ("–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π") –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤.
        - –í—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ `src/core/interaction_handlers.py`, –æ—Å–æ–±–µ–Ω–Ω–æ —Ö–µ–ª–ø–µ—Ä `_find_target_in_location` –∏ i18n –∞—Å–ø–µ–∫—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π, –º–æ–≥—É—Ç –∏–º–µ—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ.
    - **–ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤:**
        - –î–ª—è `src/core/interaction_handlers.py`:
            - –î–æ–±–∞–≤–ª–µ–Ω–æ 8 –ø—Ä—è–º—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è `_find_target_in_location`, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏—Ö —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–ª—é—á–∏, –Ω–µ–≤–µ—Ä–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, —É—Å–ø–µ—à–Ω—ã–π –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–π –ø–æ–∏—Å–∫).
            - –î–æ–±–∞–≤–ª–µ–Ω–æ 4 unit-—Ç–µ—Å—Ç–∞ –¥–ª—è i18n –≤–∞—Ä–∏–∞—Ü–∏–π —Å–æ–æ–±—â–µ–Ω–∏–π –∏–Ω—Ç–µ–Ω—Ç–∞ `examine` –≤ `handle_intra_location_action` (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —è–∑—ã–∫ –∏–≥—Ä–æ–∫–∞, fallback –Ω–∞ 'en', fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è `description_i18n`).
        - –í—Å–µ –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (12) —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.
    - **–§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:**
        - `python -m pytest` –∑–∞–ø—É—â–µ–Ω.
        - –í—Å–µ 274 —Ç–µ—Å—Ç–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã. –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ `RuntimeWarning`, –Ω–µ –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–æ–≤.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ç–µ—Å—Ç—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏ –≤ `test_movement_logic.py` –±—ã–ª–∏ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (—á–∞—Å—Ç–∏—á–Ω–æ –∑–∞ —Å—á–µ—Ç –ø—Ä—è–º–æ–≥–æ –ø–∞—Ç—á–∏–Ω–≥–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏). –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `interaction_handlers.py`.

## –ó–∞–¥–∞—á–∞ 34: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∑–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ Pyright (–¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è)
- **–¶–µ–ª—å:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ `pyright_summary.txt`.
- **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
    - **–ê–Ω–∞–ª–∏–∑ `pyright_summary.txt`**: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –æ—à–∏–±–∫–∞–º–∏.
    - **`tests/core/test_action_processor.py` (15 –æ—à–∏–±–æ–∫)**:
        - 6 –æ—à–∏–±–æ–∫ `Argument of type "str" cannot be assigned to parameter "timestamp" of type "datetime"` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–µ–º –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫–∏ ISO-—Ñ–æ—Ä–º–∞—Ç–∞ –≤ –æ–±—ä–µ–∫—Ç `datetime` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `datetime.datetime.fromisoformat()`.
        - 4 –æ—à–∏–±–∫–∏ `Function declaration "..." is obscured by a declaration of the same name` (–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º–∏ 9 –æ—à–∏–±–æ–∫ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –±–ª–æ–∫–æ–≤) –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —É–¥–∞–ª–µ–Ω–∏–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.
    - **`tests/core/crud/test_crud_base_definitions.py` (13 –æ—à–∏–±–æ–∫)**:
        - –û—à–∏–±–∫–∏ —Ç–∏–ø–∞ "Cannot assign to attribute 'return_value' for class 'MethodType'" –∏ "Cannot access attribute 'assert_called_once' for class 'MethodType'" (–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –¥–ª—è `assert_not_called`, `reset_mock`) –±—ã–ª–∏ –≤—ã–∑–≤–∞–Ω—ã —Ç–µ–º, —á—Ç–æ Pyright –Ω–µ–≤–µ—Ä–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–ª —Ç–∏–ø –º–æ–∫-–∞—Ç—Ä–∏–±—É—Ç–∞ `mock_db_session.execute`.
        - –†–µ—à–µ–Ω–∏–µ: –ö 13 —Å—Ç—Ä–æ–∫–∞–º, –≥–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª –¥–æ—Å—Ç—É–ø –∫ –∞—Ç—Ä–∏–±—É—Ç–∞–º –º–æ–∫–∞ (`return_value`, `assert_called_once` –∏ —Ç.–¥.), –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `# type: ignore[attribute-error]`, —Ç–∞–∫ –∫–∞–∫ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç—ã —É `AsyncMock` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.
    - **`src/core/ability_system.py` (12 –æ—à–∏–±–æ–∫)**:
        - –û—à–∏–±–∫–∞ `Cannot access attribute "NPC" for class "type[RelationshipEntityType]"` (L153): –ó–∞–º–µ–Ω–µ–Ω–æ `RelationshipEntityType.NPC` –Ω–∞ `RelationshipEntityType.GENERATED_NPC`.
        - –û—à–∏–±–∫–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è `source_entity_type`, `entity_type` (L167, L170, L461, L470, L472, L475): –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `.value` –¥–ª—è Enum-—Ç–∏–ø–æ–≤ –ø—Ä–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã–º –ø–æ–ª—è–º –º–æ–¥–µ–ª–∏ `ActiveStatusEffect` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `active_status.entity_type = owner_type_enum_val.value`).
        - –û—à–∏–±–∫–∞ `Cannot assign to attribute "source_entity_id"` (L467) –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–µ–π –æ—à–∏–±–∫–∏ `source_entity_type`: –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è `active_status.source_entity_id` –∏ `active_status.source_entity_type` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `apply_status_v2`, —Ç–∞–∫ –∫–∞–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥–µ —É–∫–∞–∑—ã–≤–∞–ª –Ω–∞ –∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤ –º–æ–¥–µ–ª–∏ `ActiveStatusEffect`.
        - –û—à–∏–±–∫–∏ `Cannot access attribute "value" for class "str"` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `remove_status` (L224, L233, L240, L251): –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è, —Ö—Ä–∞–Ω—è—â–∞—è —Ç–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –≤ `removed_entity_type_str`. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ `removed_entity_type_str == RelationshipEntityType.PLAYER` (–≤–º–µ—Å—Ç–æ `...PLAYER.value`) –∏ –ø–µ—Ä–µ–¥–∞—á–∞ `removed_entity_type_str.value` –≤ `_get_entity`, –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è, —á—Ç–æ `active_status_effect.entity_type` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–ª–µ–Ω Enum.
    - **`tests/models/test_status_effect.py` (11 –æ—à–∏–±–æ–∫)**:
        - –û—à–∏–±–∫–∏ —Ç–∏–ø–∞ `"... is not a known attribute of "None""` –∏ `Object of type "None" is not subscriptable`.
        - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω—ã —è–≤–Ω—ã–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è `assert retrieved_status_effect is not None` –∏ `assert retrieved_active_status is not None` –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–æ–≤ `self.assertIsNotNone(...)` –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞ –¥–ª—è Pyright. –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã `self.session.flush()` –∏ `self.session.refresh()` –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Å–µ—Å—Å–∏—é.
    - **`tests/core/test_ai_orchestrator.py` (3 –æ—à–∏–±–∫–∏)**:
        - –û—à–∏–±–∫–∏ `Argument missing for parameter "entity_type"` –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ `trigger_ai_generation_flow` –∏ `save_approved_generation`.
        - –†–µ—à–µ–Ω–∏–µ: –£–¥–∞–ª–µ–Ω —Ä–∞–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç `entity_type` –∏–∑ –≤—ã–∑–æ–≤–æ–≤ —ç—Ç–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ —Ç–µ—Å—Ç–∞—Ö, —Ç–∞–∫ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –µ–≥–æ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç (–æ—à–∏–±–∫–∏ Pyright –±—ã–ª–∏, –≤–µ—Ä–æ—è—Ç–Ω–æ, –ª–æ–∂–Ω–æ–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏).
    - **`src/bot/commands/map_commands.py` (2 –æ—à–∏–±–∫–∏)**:
        - –û—à–∏–±–∫–∞ `Method "interaction_check" overrides class "Cog" in an incompatible manner`: –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `# type: ignore[override]` –∫ –º–µ—Ç–æ–¥—É `interaction_check`.
        - –û—à–∏–±–∫–∞ `Type "User | Member" is not assignable to declared type "Member"`: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `isinstance(interaction.user, discord.Member)` –∏ —É—Ç–æ—á–Ω–µ–Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–∞ –¥–ª—è `user_as_member`.
    - **`src/core/map_management.py` (2 –æ—à–∏–±–∫–∏)**:
        - –û—à–∏–±–∫–∏ `Cannot access attribute "get" for class "str"` –ø—Ä–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ `new_location.neighbor_locations_json`.
        - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `isinstance(neighbor_data_item, dict)` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `.get()`.
    - **`src/core/movement_logic.py` (2 –æ—à–∏–±–∫–∏)**:
        - –û—à–∏–±–∫–∞ `Argument missing for parameter "session"`: –û—à–∏–±–∫–∞ –æ—Ç–Ω–æ—Å–∏–ª–∞—Å—å –∫ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –∫–æ–¥—É; –∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.
        - –û—à–∏–±–∫–∞ `ScalarResult[Location]" is not awaitable` –¥–ª—è `scalar_results.all()`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ `await scalar_results.all()` –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤.
    - **`src/core/rules.py` (1 –æ—à–∏–±–∫–∞)**:
        - –û—à–∏–±–∫–∞ `ScalarResult[RuleConfig]" is not awaitable` –¥–ª—è `scalar_rules.all()`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ `await scalar_rules.all()` –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤.
    - **`tests/core/test_interaction_handlers.py` (1 –æ—à–∏–±–∫–∞)**:
        - –û—à–∏–±–∫–∞ `Argument of type "None" cannot be assigned to parameter "location_data"...` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `_find_target_in_location(None, ...)`.
        - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `# type: ignore[arg-type]` –∫ –≤—ã–∑–æ–≤—É.
- **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
    - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã/–ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pytest`, `pip install -r requirements.txt`).
    - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤:
        - `tests/core/test_ability_system.py`: –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ enum `RelationshipEntityType` (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–ª–µ–Ω–æ–≤ enum, –ø–µ—Ä–µ–¥–∞—á–∞ `.value` –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –æ–∂–∏–¥–∞—é—â–∏–µ —Å—Ç—Ä–æ–∫—É).
        - `tests/core/test_action_processor.py`: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞—Ö `@patch`.
        - `tests/core/test_ai_orchestrator.py`: –£–¥–∞–ª–µ–Ω—ã –∞—Ä–≥—É–º–µ–Ω—Ç—ã `entity_type` –∏–∑ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ.
        - `tests/core/test_movement_logic.py`: –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ `await` –¥–ª—è `scalar_results.all()` –≤ `src/core/rules.py` –∏ `src/core/movement_logic.py`. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–∫–æ–≤ –¥–ª—è `session.execute().scalars().all()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–º–∏—Ç–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.
    - –ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π 278 —Ç–µ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã.

## –ó–∞–¥–∞—á–∞ 24: üó∫Ô∏è 4.2 Guild Map Generation and Editing (Guild-Scoped)
- **–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞**:
    - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API `generate_location` –∏ –∫–æ–º–∞–Ω–¥–∞–º –ú–∞—Å—Ç–µ—Ä–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ–π (`add_location`, `remove_location`, `connect_locations`, `disconnect_locations`).
    - –ò–∑—É—á–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏: `src/core/world_generation.py` (—Å–æ–¥–µ—Ä–∂–∏—Ç `generate_new_location_via_ai`), `src/core/map_management.py` (—Å–æ–¥–µ—Ä–∂–∏—Ç API –¥–ª—è –ú–∞—Å—Ç–µ—Ä–∞), `src/core/ai_orchestrator.py` (—Å–æ–¥–µ—Ä–∂–∏—Ç –º–æ–∫ AI –∏ –æ–±—â–∏–π –ø–æ—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏), `src/models/location.py`, `src/models/enums.py` (–¥–ª—è `EventType`).
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è API `generate_location`**:
    - –í `src/core/world_generation.py` —Ñ—É–Ω–∫—Ü–∏—è `generate_new_location_via_ai` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –≤ `generate_location`.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `prepare_ai_prompt`, –º–æ–∫–∞ `_mock_openai_api_call` (–∏–∑ `ai_orchestrator.py`), `parse_and_validate_ai_response` (—Å `ParsedLocationData`), –∏ `location_crud.create`.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `neighbor_locations_json` –¥–ª—è –Ω–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏ –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ—Å–µ–¥–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `update_location_neighbors`.
    - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è `WORLD_EVENT_LOCATION_GENERATED` —á–µ—Ä–µ–∑ `log_event`.
    - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ AI (`prompt_hash`, `raw_response_snippet`) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `ai_metadata_json` –Ω–æ–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ API –¥–ª—è –ú–∞—Å—Ç–µ—Ä–∞ –≤ `src/core/map_management.py`**:
    - –§—É–Ω–∫—Ü–∏–∏ `add_location_master`, `remove_location_master`, `connect_locations_master`, `disconnect_locations_master` –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.
    - –ò—Ö —Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π —Å–æ—Å–µ–¥–µ–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `log_event` —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ `EventType`). –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫ –Ω–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ `EventType` –≤ `src/models/enums.py` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ú–∞—Å—Ç–µ—Ä–∞.
- **–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ Discord –¥–ª—è –ú–∞—Å—Ç–µ—Ä–∞**:
    - –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª `src/bot/commands/master_map_commands.py`.
    - –í –Ω–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω `MasterMapCog(commands.Cog)` —Å –≥—Ä—É–ø–ø–æ–π –∫–æ–º–∞–Ω–¥ `/master_map`.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã slash-–∫–æ–º–∞–Ω–¥—ã:
        - `generate_ai_location`: –≤—ã–∑—ã–≤–∞–µ—Ç `core.world_generation.generate_location`.
        - `add_manual_location`: –≤—ã–∑—ã–≤–∞–µ—Ç `core.map_management.add_location_master`.
        - `remove_location`: –≤—ã–∑—ã–≤–∞–µ—Ç `core.map_management.remove_location_master`.
        - `connect_locations`: –≤—ã–∑—ã–≤–∞–µ—Ç `core.map_management.connect_locations_master`.
        - `disconnect_locations`: –≤—ã–∑—ã–≤–∞–µ—Ç `core.map_management.disconnect_locations_master`.
    - –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `is_administrator` (–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ `master_ai_commands.py`) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è JSON –∏–∑ —Å—Ç—Ä–æ–∫) –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∞**:
    - `MasterMapCog` –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ `BOT_COGS` –≤ `src/config/settings.py`.
    - –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏ —Å–ø–∏—Å–æ–∫ `__all__` –≤ `src/core/__init__.py` –¥–ª—è –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è `generate_new_location_via_ai` –≤ `generate_location`.
- **–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
    - –ü—Ä–æ–¥—É–º–∞–Ω—ã —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã –∏ API, –≤–∫–ª—é—á–∞—è —É—Å–ø–µ—à–Ω—ã–µ –≤—ã–∑–æ–≤—ã, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –≤–≤–æ–¥, –æ—à–∏–±–∫–∏ –ë–î, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤) –∏ –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏.
    - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–µ–π –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π.
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `ai_orchestrator.py`**:
    - –ü—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è—Ç—å `ai_orchestrator.py` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π –∏–∑ `PendingGeneration` –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –ø—Ä—è–º–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `generate_location`.
