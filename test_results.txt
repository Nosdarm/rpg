============================= test session starts ==============================
platform linux -- Python 3.12.11, pytest-8.4.1, pluggy-1.6.0 -- /home/jules/.pyenv/versions/3.12.11/bin/python
cachedir: .pytest_cache
rootdir: /app
configfile: pytest.ini
plugins: anyio-4.9.0, asyncio-1.0.0, mock-3.14.1
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 897 items

tests/api/routers/test_auth.py::test_discord_callback_success FAILED     [  0%]
tests/api/routers/test_auth.py::test_discord_callback_missing_redirect_url_config FAILED [  0%]
tests/api/routers/test_auth.py::test_set_active_guild_success FAILED     [  0%]
tests/api/routers/test_auth.py::test_set_active_guild_forbidden FAILED   [  0%]
tests/api/routers/test_auth.py::test_set_active_guild_no_accessible_guilds_in_token FAILED [  0%]
tests/api/routers/test_auth.py::test_set_active_guild_forbidden_empty_list FAILED [  0%]
tests/api/routers/test_auth.py::test_logout_success FAILED               [  0%]
tests/api/routers/test_auth.py::test_logout_no_token FAILED              [  0%]
tests/api/routers/test_auth.py::test_get_current_active_guild_id_success PASSED [  1%]
tests/api/routers/test_auth.py::test_get_current_active_guild_id_not_set PASSED [  1%]
tests/api/routers/test_auth.py::test_get_current_active_guild_id_missing_token PASSED [  1%]
tests/api/routers/test_auth.py::test_discord_login_redirect FAILED       [  1%]
tests/api/routers/test_auth.py::test_discord_login_missing_config FAILED [  1%]
tests/api/routers/test_auth.py::test_get_me_guilds_success FAILED        [  1%]
tests/api/routers/test_auth.py::test_get_me_guilds_no_guilds_in_token FAILED [  1%]
tests/api/routers/test_auth.py::test_get_session_active_guild_success FAILED [  1%]
tests/api/routers/test_auth.py::test_get_session_active_guild_not_set FAILED [  1%]
tests/api/routers/test_auth.py::test_discord_callback_token_exchange_error FAILED [  2%]
tests/api/routers/test_auth.py::test_discord_callback_user_info_error FAILED [  2%]
tests/api/routers/test_auth.py::test_discord_callback_master_user_creation_details FAILED [  2%]
tests/bot/api/test_commands_api.py::test_list_bot_commands_success_empty FAILED [  2%]
tests/bot/api/test_commands_api.py::test_list_bot_commands_success_with_data_and_lang PASSED [  2%]
tests/bot/api/test_commands_api.py::test_list_bot_commands_uses_default_language_if_none_provided FAILED [  2%]
tests/bot/api/test_commands_api.py::test_list_bot_commands_internal_error FAILED [  2%]
tests/bot/api/test_commands_api.py::test_list_bot_commands_bot_not_available PASSED [  2%]
tests/bot/commands/master_commands/test_master_conflict_commands.py::test_resolve_conflict_triggers_reprocessing_when_no_other_conflicts PASSED [  2%]
tests/bot/commands/master_commands/test_master_conflict_commands.py::test_resolve_conflict_does_not_trigger_reprocessing_if_others_remain PASSED [  3%]
tests/bot/commands/master_commands/test_master_conflict_commands.py::test_resolve_conflict_id_not_found PASSED [  3%]
tests/bot/commands/master_commands/test_master_conflict_commands.py::test_conflict_list_no_conflicts PASSED [  3%]
tests/bot/commands/master_commands/test_master_conflict_commands.py::test_conflict_list_with_conflicts PASSED [  3%]
tests/bot/commands/master_commands/test_master_conflict_commands.py::test_conflict_view_found PASSED [  3%]
tests/bot/commands/master_commands/test_master_conflict_commands.py::test_conflict_view_not_found PASSED [  3%]
tests/bot/commands/master_commands/test_master_player_commands.py::test_master_player_create_success PASSED [  3%]
tests/bot/commands/master_commands/test_master_player_commands.py::test_master_player_create_handles_guild_none PASSED [  3%]
tests/bot/commands/master_commands/test_master_player_commands.py::test_master_player_create_with_attributes_json PASSED [  3%]
tests/bot/commands/master_commands/test_master_player_commands.py::test_master_player_create_bad_attributes_json PASSED [  4%]
tests/bot/commands/master_commands/test_master_simulation_tools_cog.py::TestMasterSimulationToolsCog::test_simulate_check_actor_not_found PASSED [  4%]
tests/bot/commands/master_commands/test_master_simulation_tools_cog.py::TestMasterSimulationToolsCog::test_simulate_check_command_success PASSED [  4%]
tests/bot/commands/master_commands/test_master_simulation_tools_cog.py::TestMasterSimulationToolsCog::test_simulate_check_invalid_json_context PASSED [  4%]
tests/bot/commands/master_commands/test_master_simulation_tools_cog.py::TestMasterSimulationToolsCog::test_simulate_combat_action_command_success PASSED [  4%]
tests/bot/commands/master_commands/test_monitoring_master_commands.py::TestMasterMonitoringCog::test_entities_view_player_found PASSED [  4%]
tests/bot/commands/master_commands/test_monitoring_master_commands.py::TestMasterMonitoringCog::test_log_list_empty PASSED [  4%]
tests/bot/commands/master_commands/test_monitoring_master_commands.py::TestMasterMonitoringCog::test_log_list_success PASSED [  4%]
tests/bot/commands/master_commands/test_monitoring_master_commands.py::TestMasterMonitoringCog::test_log_view_found PASSED [  4%]
tests/bot/commands/master_commands/test_monitoring_master_commands.py::TestMasterMonitoringCog::test_log_view_not_found PASSED [  5%]
tests/bot/commands/master_commands/test_monitoring_master_commands.py::TestMasterMonitoringCog::test_map_list_locations_success PASSED [  5%]
tests/bot/commands/master_commands/test_monitoring_master_commands.py::TestMasterMonitoringCog::test_worldstate_get_found PASSED [  5%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_success_player PASSED [  5%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_error_no_owner PASSED [  5%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_error_quest_not_found PASSED [  5%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_error_step_not_found PASSED [  5%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_error_already_exists PASSED [  5%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_guild_only_command PASSED [  5%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_error_both_player_and_party_ids PASSED [  6%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_invalid_status_string PASSED [  6%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_invalid_progress_data_json PASSED [  6%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_invalid_accepted_at_iso_format PASSED [  6%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_db_error_on_create PASSED [  6%]
tests/bot/commands/master_commands/test_quest_master_commands.py::test_progress_create_success_party PASSED [  6%]
tests/bot/commands/test_character_commands.py::test_levelup_command_success PASSED [  6%]
tests/bot/commands/test_character_commands.py::test_levelup_command_no_unspent_xp PASSED [  6%]
tests/bot/commands/test_character_commands.py::test_levelup_command_api_error_not_enough_points PASSED [  6%]
tests/bot/commands/test_character_commands.py::test_levelup_command_player_not_found PASSED [  7%]
tests/bot/commands/test_character_commands.py::test_levelup_command_message_formatting_fallback PASSED [  7%]
tests/bot/commands/test_character_commands.py::test_levelup_command_message_formatting_key_error PASSED [  7%]
tests/bot/commands/test_character_commands.py::test_levelup_command_calls_internal PASSED [  7%]
tests/bot/commands/test_general_commands.py::TestGeneralCommands::test_start_command_existing_player FAILED [  7%]
tests/bot/commands/test_general_commands.py::TestGeneralCommands::test_start_command_new_player FAILED [  7%]
tests/bot/commands/test_general_commands.py::TestGeneralCommands::test_start_command_no_default_start_location_found FAILED [  7%]
tests/bot/commands/test_general_commands.py::TestGeneralCommands::test_start_command_no_guild FAILED [  7%]
tests/bot/commands/test_map_commands.py::test_generate_location_command_success PASSED [  7%]
tests/bot/commands/test_map_commands.py::test_generate_location_command_api_error PASSED [  8%]
tests/bot/commands/test_map_commands.py::test_add_location_command_success PASSED [  8%]
tests/bot/commands/test_map_commands.py::test_add_location_command_invalid_json PASSED [  8%]
tests/bot/commands/test_map_commands.py::test_remove_location_command_success PASSED [  8%]
tests/bot/commands/test_map_commands.py::test_connect_locations_command_success PASSED [  8%]
tests/bot/commands/test_map_commands.py::test_disconnect_locations_command_success PASSED [  8%]
tests/bot/commands/test_map_commands.py::test_map_master_cog_check_no_permission PASSED [  8%]
tests/bot/commands/test_map_commands.py::test_map_master_cog_check_is_master_id PASSED [  8%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_create_name_fails_regex PASSED [  8%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_create_name_not_unique PASSED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_create_name_too_long FAILED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_create_player_already_in_party PASSED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_create_success PASSED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_disband_fails_if_not_leader PASSED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_disband_success PASSED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_join_fails_invite_only PASSED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_join_fails_level_too_low PASSED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_join_fails_party_full PASSED [  9%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_join_moves_player_location FAILED [ 10%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_join_success_by_name FAILED [ 10%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_leave_empties_party_and_disbands PASSED [ 10%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_leave_leader_leaves_policy_disband_on_leave PASSED [ 10%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_leave_leader_leaves_promote_new_leader PASSED [ 10%]
tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_leave_member_leaves_below_threshold_disband PASSED [ 10%]
tests/bot/test_events.py::test_ensure_guild_config_exists_new_guild PASSED [ 10%]
tests/bot/test_events.py::test_ensure_guild_config_exists_existing_guild PASSED [ 10%]
tests/core/crud/test_crud_base_definitions.py::test_get_many_by_ids_success_no_guild PASSED [ 10%]
tests/core/crud/test_crud_base_definitions.py::test_get_many_by_ids_success_with_guild PASSED [ 11%]
tests/core/crud/test_crud_base_definitions.py::test_get_many_by_ids_some_not_found PASSED [ 11%]
tests/core/crud/test_crud_base_definitions.py::test_get_many_by_ids_all_not_found PASSED [ 11%]
tests/core/crud/test_crud_base_definitions.py::test_get_many_by_ids_empty_list_input PASSED [ 11%]
tests/core/crud/test_crud_base_definitions.py::test_get_many_by_ids_model_no_pk_logs_error PASSED [ 11%]
tests/core/crud/test_crud_base_definitions.py::test_get_many_by_ids_with_static_id_pk PASSED [ 11%]
tests/core/crud/test_crud_faction.py::TestCRUDFaction::test_create_faction PASSED [ 11%]
tests/core/crud/test_crud_faction.py::TestCRUDFaction::test_delete_faction PASSED [ 11%]
tests/core/crud/test_crud_faction.py::TestCRUDFaction::test_get_faction_by_id PASSED [ 11%]
tests/core/crud/test_crud_faction.py::TestCRUDFaction::test_get_faction_by_static_id PASSED [ 12%]
tests/core/crud/test_crud_faction.py::TestCRUDFaction::test_get_multi_by_guild_id PASSED [ 12%]
tests/core/crud/test_crud_faction.py::TestCRUDFaction::test_update_faction PASSED [ 12%]
tests/core/crud/test_crud_inventory_item.py::TestCRUDInventoryItem::test_add_item_to_owner_new_item PASSED [ 12%]
tests/core/crud/test_crud_inventory_item.py::TestCRUDInventoryItem::test_add_item_to_owner_stack_existing PASSED [ 12%]
tests/core/crud/test_crud_inventory_item.py::TestCRUDInventoryItem::test_create_inventory_item PASSED [ 12%]
tests/core/crud/test_crud_inventory_item.py::TestCRUDInventoryItem::test_get_inventory_for_owner PASSED [ 12%]
tests/core/crud/test_crud_inventory_item.py::TestCRUDInventoryItem::test_remove_item_from_owner_decrease_quantity PASSED [ 12%]
tests/core/crud/test_crud_inventory_item.py::TestCRUDInventoryItem::test_remove_item_from_owner_delete_stack PASSED [ 12%]
tests/core/crud/test_crud_inventory_item.py::TestCRUDInventoryItem::test_remove_item_from_owner_item_not_found PASSED [ 13%]
tests/core/crud/test_crud_item.py::TestCRUDItem::test_create_item PASSED [ 13%]
tests/core/crud/test_crud_item.py::TestCRUDItem::test_get_by_static_id PASSED [ 13%]
tests/core/crud/test_crud_item.py::TestCRUDItem::test_get_item PASSED    [ 13%]
tests/core/crud/test_crud_item.py::TestCRUDItem::test_get_item_not_found PASSED [ 13%]
tests/core/crud/test_crud_item.py::TestCRUDItem::test_get_item_wrong_guild PASSED [ 13%]
tests/core/crud/test_crud_item.py::TestCRUDItem::test_get_multi_item PASSED [ 13%]
tests/core/crud/test_crud_item.py::TestCRUDItem::test_remove_item PASSED [ 13%]
tests/core/crud/test_crud_item.py::TestCRUDItem::test_update_item PASSED [ 13%]
tests/core/crud/test_crud_party.py::TestCRUDParty::test_add_player_to_party_json PASSED [ 14%]
tests/core/crud/test_crud_party.py::TestCRUDParty::test_create_party PASSED [ 14%]
tests/core/crud/test_crud_party.py::TestCRUDParty::test_delete_party PASSED [ 14%]
tests/core/crud/test_crud_party.py::TestCRUDParty::test_get_party_by_name PASSED [ 14%]
tests/core/crud/test_crud_party.py::TestCRUDParty::test_remove_player_from_party_json PASSED [ 14%]
tests/core/crud/test_crud_party.py::TestCRUDParty::test_update_party PASSED [ 14%]
tests/core/crud/test_crud_party_npc_memory.py::TestCRUDPartyNpcMemory::test_create_party_npc_memory XFAIL [ 14%]
tests/core/crud/test_crud_party_npc_memory.py::TestCRUDPartyNpcMemory::test_get_party_npc_memory XFAIL [ 14%]
tests/core/crud/test_crud_party_npc_memory.py::TestCRUDPartyNpcMemory::test_get_multi_by_party_and_npc XFAIL [ 14%]
tests/core/crud/test_crud_party_npc_memory.py::TestCRUDPartyNpcMemory::test_get_multi_by_party XFAIL [ 15%]
tests/core/crud/test_crud_party_npc_memory.py::TestCRUDPartyNpcMemory::test_get_multi_by_npc XFAIL [ 15%]
tests/core/crud/test_crud_party_npc_memory.py::TestCRUDPartyNpcMemory::test_update_party_npc_memory XFAIL [ 15%]
tests/core/crud/test_crud_party_npc_memory.py::TestCRUDPartyNpcMemory::test_delete_party_npc_memory XFAIL [ 15%]
tests/core/crud/test_crud_party_npc_memory.py::TestCRUDPartyNpcMemory::test_get_count_for_filters XFAIL [ 15%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_create_player_with_defaults PASSED [ 15%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_create_player_with_defaults_no_base_attributes_rule PASSED [ 15%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_create_player_with_defaults_with_base_attributes_rule PASSED [ 15%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_delete_player PASSED [ 15%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_get_by_id_and_guild PASSED [ 16%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_get_multi_by_location PASSED [ 16%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_get_multi_by_party_id PASSED [ 16%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_get_player_by_discord_id PASSED [ 16%]
tests/core/crud/test_crud_player.py::TestCRUDPlayer::test_update_player PASSED [ 16%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_create_questline PASSED [ 16%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_get_all_player_quest_progress_for_party PASSED [ 16%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_get_all_player_quest_progress_for_player PASSED [ 16%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_get_all_quest_steps_for_quest PASSED [ 16%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_get_generated_quest_by_static_id PASSED [ 17%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_get_player_quest_progress_by_party_and_quest PASSED [ 17%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_get_player_quest_progress_by_player_and_quest PASSED [ 17%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_get_quest_step_by_quest_id_and_order PASSED [ 17%]
tests/core/crud/test_crud_quest.py::TestQuestCrud::test_get_questline_by_static_id PASSED [ 17%]
tests/core/test_ability_system.py::test_activate_ability_simple_damage PASSED [ 17%]
tests/core/test_ability_system.py::test_activate_ability_not_enough_resources PASSED [ 17%]
tests/core/test_ability_system.py::test_activate_ability_healing_self PASSED [ 17%]
tests/core/test_ability_system.py::test_apply_status_new_status PASSED   [ 17%]
tests/core/test_ability_system.py::test_apply_status_refresh_duration PASSED [ 18%]
tests/core/test_ability_system.py::test_remove_status_success PASSED     [ 18%]
tests/core/test_ability_system.py::test_activate_ability_prerequisite_not_in_combat PASSED [ 18%]
tests/core/test_ability_system.py::test_activate_ability_target_out_of_range PASSED [ 18%]
tests/core/test_ability_system.py::test_activate_ability_effect_amount_from_rule_config PASSED [ 18%]
tests/core/test_ability_system.py::test_apply_status_stackable_new PASSED [ 18%]
tests/core/test_ability_system.py::test_apply_status_stackable_add_stack PASSED [ 18%]
tests/core/test_ability_system.py::test_apply_status_stackable_reach_max_stacks_and_refresh PASSED [ 18%]
tests/core/test_ability_system.py::test_apply_status_stackable_at_max_stacks_no_refresh PASSED [ 18%]
tests/core/test_action_processor.py::test_process_actions_single_player_only_look PASSED [ 19%]
tests/core/test_action_processor.py::test_process_actions_single_player_with_both_actions PASSED [ 19%]
tests/core/test_action_processor.py::test_process_actions_party_with_one_player_actions PASSED [ 19%]
tests/core/test_action_processor.py::test_process_actions_player_no_actions PASSED [ 19%]
tests/core/test_action_processor.py::test_process_actions_unknown_intent_uses_placeholder PASSED [ 19%]
tests/core/test_action_processor.py::test_load_and_clear_all_actions_empty_entities PASSED [ 19%]
tests/core/test_action_processor.py::test_load_and_clear_all_actions_single_player_with_actions PASSED [ 19%]
tests/core/test_action_processor.py::test_load_and_clear_all_actions_party_with_player_actions PASSED [ 19%]
tests/core/test_action_processor.py::test_load_and_clear_all_actions_player_malformed_json PASSED [ 19%]
tests/core/test_action_processor.py::test_load_and_clear_all_actions_player_action_parsing_error PASSED [ 20%]
tests/core/test_action_processor.py::test_execute_player_actions_empty_list PASSED [ 20%]
tests/core/test_action_processor.py::test_execute_player_actions_handler_exception PASSED [ 20%]
tests/core/test_action_processor.py::test_execute_player_actions_dispatch_and_results PASSED [ 20%]
tests/core/test_action_processor.py::test_finalize_turn_processing_updates_statuses_and_logs PASSED [ 20%]
tests/core/test_action_processor.py::test_finalize_turn_processing_player_not_processing PASSED [ 20%]
tests/core/test_action_processor.py::test_handle_move_action_wrapper_success PASSED [ 20%]
tests/core/test_action_processor.py::test_handle_move_action_wrapper_extracts_target_from_location_name_entity PASSED [ 20%]
tests/core/test_action_processor.py::test_handle_move_action_wrapper_extracts_target_from_single_untyped_entity PASSED [ 20%]
tests/core/test_action_processor.py::test_handle_move_action_wrapper_no_target_identifier PASSED [ 21%]
tests/core/test_action_processor.py::test_handle_move_action_wrapper_execute_move_raises_exception PASSED [ 21%]
tests/core/test_action_processor.py::test_process_actions_halts_if_conflict_pending PASSED [ 21%]
tests/core/test_action_processor.py::test_process_actions_proceeds_if_no_conflict_pending PASSED [ 21%]
tests/core/test_action_processor.py::test_process_actions_handles_exception_during_conflict_check PASSED [ 21%]
tests/core/test_action_processor.py::test_process_player_message_for_nlu_player_in_dialogue PASSED [ 21%]
tests/core/test_action_processor.py::test_process_player_message_for_nlu_player_not_in_dialogue_queues_action PASSED [ 21%]
tests/core/test_action_processor.py::test_process_player_message_for_nlu_player_in_dialogue_nlu_unknown_intent PASSED [ 21%]
tests/core/test_action_processor.py::test_process_player_message_for_nlu_player_not_in_dialogue_unknown_intent_not_queued PASSED [ 21%]
tests/core/test_action_processor.py::test_handle_talk_to_npc_name_lookup_success PASSED [ 22%]
tests/core/test_action_processor.py::test_handle_talk_to_npc_name_lookup_not_found PASSED [ 22%]
tests/core/test_action_processor.py::test_handle_talk_to_npc_name_lookup_ambiguous PASSED [ 22%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_calls_general_loc_prompt_for_npc_with_location_context PASSED [ 22%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_calls_prepare_economic_prompt_for_item PASSED [ 22%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_calls_prepare_faction_prompt_for_faction PASSED [ 22%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_calls_prepare_quest_generation_prompt_for_quest PASSED [ 22%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_calls_simplified_prompt_for_npc_without_location_context PASSED [ 22%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_description_length_too_short PASSED [ 22%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_filtering_of_parsed_entities_item_from_economic_prompt PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_filtering_of_parsed_entities_npc_from_location_prompt PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_i18n_completeness_fail PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_key_field_missing_for_item PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_npc_level_out_of_range PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_pydantic_validation_error_captured PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_quest_malformed_step PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystem::test_quest_missing_steps PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystemMainFunction::test_analyze_generated_content_calls_item_specific_analyzers PASSED [ 23%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystemMainFunction::test_analyze_generated_content_calls_npc_specific_analyzers PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystemMainFunction::test_analyze_generated_content_calls_quest_specific_analyzers PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystemMainFunction::test_i18n_completeness_uses_guild_config_languages PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystemMainFunction::test_score_aggregation PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystemMainFunction::test_uniqueness_check_duplicate_name_i18n PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestAIAnalysisSystemMainFunction::test_uniqueness_check_duplicate_static_id PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestQuestItemBalanceAnalysis::test_quest_items_correct_amount_is_good_score PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestQuestItemBalanceAnalysis::test_quest_items_no_rewards_is_neutral PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestQuestItemBalanceAnalysis::test_quest_items_per_level_range_above_all_thresholds PASSED [ 24%]
tests/core/test_ai_analysis_system.py::TestQuestItemBalanceAnalysis::test_quest_items_per_level_range_empty_rule_uses_default_max PASSED [ 25%]
tests/core/test_ai_analysis_system.py::TestQuestItemBalanceAnalysis::test_quest_items_per_level_range_malformed_rule_uses_default_max_from_code PASSED [ 25%]
tests/core/test_ai_analysis_system.py::TestQuestItemBalanceAnalysis::test_quest_items_per_level_range_match_first_threshold PASSED [ 25%]
tests/core/test_ai_analysis_system.py::TestQuestItemBalanceAnalysis::test_quest_items_per_level_range_match_second_threshold PASSED [ 25%]
tests/core/test_ai_orchestrator.py::test_trigger_ai_generation_flow_success PASSED [ 25%]
tests/core/test_ai_orchestrator.py::test_trigger_ai_generation_validation_failed PASSED [ 25%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_success PASSED [ 25%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_npc_rel_to_existing_faction PASSED [ 25%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_updates_existing_relationship PASSED [ 25%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_pending_gen_not_found PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_not_approved_status PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_no_parsed_data PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_entity_creation_fails PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_generate_narrative_success_player_language PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_generate_narrative_success_guild_language_player_context PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_generate_narrative_success_guild_language_no_player_context PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_generate_narrative_success_default_language PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_generate_narrative_prompt_construction_all_fields PASSED [ 26%]
tests/core/test_ai_orchestrator.py::test_generate_narrative_llm_call_error PASSED [ 27%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_with_npc_relationships PASSED [ 27%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_player_status_no_other_pending PASSED [ 27%]
tests/core/test_ai_orchestrator.py::test_save_approved_generation_player_status_other_pending_exists PASSED [ 27%]
tests/core/test_ai_prompt_builder.py::TestAIPromptBuilder::test_prepare_ai_prompt_basic_scenario PASSED [ 27%]
tests/core/test_ai_prompt_builder.py::TestAIPromptBuilder::test_prepare_ai_prompt_location_not_found PASSED [ 27%]
tests/core/test_ai_prompt_builder.py::TestAIFactionPromptBuilder::test_prepare_faction_relationship_generation_prompt_basic PASSED [ 27%]
tests/core/test_ai_prompt_builder.py::TestAIQuestPromptBuilder::test_prepare_quest_generation_prompt_with_context PASSED [ 27%]
tests/core/test_ai_prompt_builder.py::TestAIEconomicPromptBuilder::test_prepare_economic_entity_generation_prompt_basic PASSED [ 27%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_dialogue_history_inclusion PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_dialogue_prompt_no_relationship_influence_rule PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_dialogue_prompt_with_negative_relationship_tone_hint PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_dialogue_prompt_with_neutral_relationship_default_tone_hint PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_dialogue_prompt_with_positive_relationship_tone_hint PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_prepare_dialogue_prompt_basic_success PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_prepare_dialogue_prompt_no_relationship PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_prepare_dialogue_prompt_npc_not_found PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_prepare_dialogue_prompt_player_not_found PASSED [ 28%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_prepare_dialogue_prompt_with_nlu_data PASSED [ 29%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_prepare_dialogue_prompt_with_nlu_unknown_intent PASSED [ 29%]
tests/core/test_ai_prompt_builder.py::TestDialoguePromptBuilder::test_prepare_dialogue_prompt_with_relationship_quest_hidden_context PASSED [ 29%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_generated_inventory_item_entry_invalid PASSED [ 29%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_generated_inventory_item_entry_valid PASSED [ 29%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_faction_data_invalid PASSED [ 29%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_faction_data_valid PASSED [ 29%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_item_data_invalid PASSED [ 29%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_item_data_valid PASSED [ 29%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_npc_data_invalid_static_id PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_npc_data_missing_required_fields PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_npc_data_valid PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_npc_trader_data_invalid PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_npc_trader_data_minimal PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_npc_trader_data_valid PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_relationship_data_invalid PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserPydanticModels::test_parsed_relationship_data_valid PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_invalid_json_string PASSED [ 30%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_pydantic_validation_error_in_faction PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_quest_data_empty_steps PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_quest_data_missing_static_id PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_quest_step_data_invalid_i18n PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_semantic_validation_error_faction_missing_lang PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_semantic_validation_error_relationship_value_out_of_range PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_structural_validation_error_not_a_list PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_valid_faction_and_relationship PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_valid_item_and_trader_data PASSED [ 31%]
tests/core/test_ai_response_parser.py::TestAIResponseParserFunction::test_parse_valid_quest_data PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_critical_failure PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_critical_success PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_hidden_relationship_dc_modifier_npc_likes_player PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_hidden_relationship_no_relevant_rule_or_disabled PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_hidden_relationship_roll_modifier_npc_hates_player PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_relationship_influence_formula_error PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_relationship_influence_roll_modifier_formula_positive PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_relationship_influence_threshold_modifier_friendly PASSED [ 32%]
tests/core/test_check_resolver.py::TestCheckResolver::test_simple_failure PASSED [ 33%]
tests/core/test_check_resolver.py::TestCheckResolver::test_simple_success PASSED [ 33%]
tests/core/test_combat_cycle_manager.py::test_start_combat_successful_creation PASSED [ 33%]
tests/core/test_combat_cycle_manager.py::test_start_combat_initiative_tie_break_order PASSED [ 33%]
tests/core/test_combat_cycle_manager.py::test_start_combat_no_participants PASSED [ 33%]
tests/core/test_combat_cycle_manager.py::test_process_combat_turn_npc_action PASSED [ 33%]
tests/core/test_combat_cycle_manager.py::test_advance_turn_logic_simple PASSED [ 33%]
tests/core/test_combat_cycle_manager.py::test_check_combat_end_scenarios PASSED [ 33%]
tests/core/test_combat_cycle_manager.py::test_start_combat_player_in_party_status_update PASSED [ 34%]
tests/core/test_combat_cycle_manager.py::test_process_round_effects_status_duration_and_removal PASSED [ 34%]
tests/core/test_combat_cycle_manager.py::test_process_combat_turn_active_entity_defeated_skips_action PASSED [ 34%]
tests/core/test_combat_cycle_manager.py::test_process_combat_turn_combat_ends PASSED [ 34%]
tests/core/test_combat_cycle_manager.py::test_process_combat_turn_player_action_advances_turn PASSED [ 34%]
tests/core/test_combat_cycle_manager.py::test_process_combat_turn_recursive_npc_turns PASSED [ 34%]
tests/core/test_combat_cycle_manager.py::test_process_round_effects_tick_damage_and_participant_json_update PASSED [ 34%]
tests/core/test_combat_engine.py::test_get_combat_rule_from_snapshot PASSED [ 34%]
tests/core/test_combat_engine.py::test_get_combat_rule_from_db PASSED    [ 34%]
tests/core/test_combat_engine.py::test_calculate_attribute_modifier PASSED [ 35%]
tests/core/test_combat_engine.py::test_get_participant_stat_from_override PASSED [ 35%]
tests/core/test_combat_engine.py::test_get_participant_stat_from_player_model PASSED [ 35%]
tests/core/test_combat_engine.py::test_get_participant_stat_from_npc_model PASSED [ 35%]
tests/core/test_combat_engine.py::test_process_combat_action_attack_hit PASSED [ 35%]
tests/core/test_combat_engine.py::test_process_combat_action_actor_not_found PASSED [ 35%]
tests/core/test_combat_engine.py::test_process_combat_action_combat_not_found PASSED [ 35%]
tests/core/test_combat_engine.py::test_process_combat_action_target_not_in_combat PASSED [ 35%]
tests/core/test_combat_engine.py::test_process_combat_action_target_already_defeated PASSED [ 35%]
tests/core/test_combat_engine.py::test_process_combat_action_attack_miss PASSED [ 36%]
tests/core/test_combat_engine.py::test_process_combat_action_attack_crit_hit PASSED [ 36%]
tests/core/test_combat_engine.py::test_process_combat_action_attack_crit_fail PASSED [ 36%]
tests/core/test_combat_engine.py::test_process_combat_action_unknown_action PASSED [ 36%]
tests/core/test_command_utils.py::test_get_localized_string_with_plain_string PASSED [ 36%]
tests/core/test_command_utils.py::test_get_localized_string_with_mock_locale_str PASSED [ 36%]
tests/core/test_command_utils.py::test_get_localized_string_with_none_value PASSED [ 36%]
tests/core/test_command_utils.py::test_extract_parameter_details_simple PASSED [ 36%]
tests/core/test_command_utils.py::test_extract_parameter_details_with_locale_str_description PASSED [ 36%]
tests/core/test_command_utils.py::test_extract_parameter_details_with_choices PASSED [ 37%]
tests/core/test_command_utils.py::test_extract_command_details_single_command PASSED [ 37%]
tests/core/test_command_utils.py::test_extract_command_details_command_with_params_and_locale_desc PASSED [ 37%]
tests/core/test_command_utils.py::test_extract_command_details_with_metadata PASSED [ 37%]
tests/core/test_command_utils.py::test_get_bot_commands_empty PASSED     [ 37%]
tests/core/test_command_utils.py::test_get_bot_commands_with_simple_command PASSED [ 37%]
tests/core/test_command_utils.py::test_get_bot_commands_with_group PASSED [ 37%]
tests/core/test_command_utils.py::test_get_bot_commands_mixed_commands_and_groups_and_sorting PASSED [ 37%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_attack_npc_id PASSED [ 37%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_attack_player_id PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_drop_item_name PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_examine_item_id_priority PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_examine_npc_static_id PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_examine_object_name PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_go_to_point_name PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_go_to_sublocation_name PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_go_to_sublocation_static_id PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_interact_item_static_id PASSED [ 38%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_interact_location_object_name PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_interact_location_object_static_id PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_irrelevant_single_entity PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_move_direction PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_move_location_static_id PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_no_entities PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_single_generic_entity_for_examine_item PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_single_generic_entity_for_examine_object PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_take_item_instance_id PASSED [ 39%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_take_item_static_id PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_trade_target_npc_name PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_item_on_npc_by_static_id PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_item_on_player_by_item_id PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_item_on_self_by_item_id PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_item_on_self_by_static_id PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_object_name PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_object_static_id PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_priority_item_over_object PASSED [ 40%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_priority_item_over_skill_over_object PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_priority_skill_over_object PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_skill_on_self PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestExtractPrimaryTargetSignature::test_use_skill_on_target_npc PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_conflict_interact_vs_use_on_same_object_name PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_conflict_take_vs_use_on_same_item_instance PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_conflict_three_exclusive_actions_same_target PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_conflict_two_attacks_on_same_npc PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_conflict_two_takes_for_same_item_static_id PASSED [ 41%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_conflict_two_uses_on_same_object_static_id PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_conflict_use_on_self_vs_take_same_item_static_id PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_involved_entities_json_structure_and_conflict_type PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_mixed_targeted_and_non_targeted_actions PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_no_actions_no_conflicts PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_no_conflict_use_on_self_vs_attack_unrelated PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_no_target_signature_actions_no_conflict PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_single_action_no_conflicts PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_two_actions_different_targets_no_conflict PASSED [ 42%]
tests/core/test_conflict_simulation_system.py::TestSimulateConflictDetection::test_two_actions_same_target_non_conflicting_intents PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_conflicting_intent_pairs_attack_vs_talk PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_conflicting_intent_pairs_no_conflict_unrelated_pair PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_conflicting_intent_pairs_take_vs_use PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_same_intent_interact_and_use_on_object_diff_sigs_no_conflict_here PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_same_intent_no_conflict_different_targets PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_same_intent_no_conflict_non_exclusive_intent PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_same_intent_three_attacks_on_npc PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_same_intent_two_takes_on_item PASSED [ 43%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_apply_same_intent_two_uses_on_object PASSED [ 44%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_check_use_self_vs_take_conflict PASSED [ 44%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_check_use_self_vs_take_no_conflict_different_items PASSED [ 44%]
tests/core/test_conflict_simulation_system.py::TestConflictRuleApplication::test_check_use_self_vs_take_no_conflict_only_one_action PASSED [ 44%]
tests/core/test_database_transactional.py::test_transactional_success_new_session PASSED [ 44%]
tests/core/test_database_transactional.py::test_transactional_failure_new_session_rollbacks PASSED [ 44%]
tests/core/test_database_transactional.py::test_transactional_uses_passed_session_positional PASSED [ 44%]
tests/core/test_database_transactional.py::test_transactional_uses_passed_session_keyword PASSED [ 44%]
tests/core/test_database_transactional.py::test_transactional_failure_with_passed_session_no_rollback_by_decorator PASSED [ 44%]
tests/core/test_database_transactional.py::test_transactional_correctly_passes_args_and_kwargs_new_session PASSED [ 45%]
tests/core/test_database_transactional.py::test_transactional_correctly_passes_args_and_kwargs_existing_session PASSED [ 45%]
tests/core/test_database_transactional.py::test_transactional_handles_session_as_kwarg_in_wrapped_func_sig PASSED [ 45%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_end_dialogue_not_in_dialogue_status_is_dialogue PASSED [ 45%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_end_dialogue_not_in_dialogue_status_not_dialogue PASSED [ 45%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_end_dialogue_success PASSED [ 45%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_handle_dialogue_input_not_in_dialogue PASSED [ 45%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_handle_dialogue_input_success_with_nlu_data PASSED [ 45%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_start_dialogue_already_with_other_npc PASSED [ 45%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_start_dialogue_already_with_same_npc PASSED [ 46%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_start_dialogue_npc_busy_with_other_player PASSED [ 46%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_start_dialogue_npc_not_found PASSED [ 46%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_start_dialogue_player_in_combat PASSED [ 46%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_start_dialogue_player_not_found PASSED [ 46%]
tests/core/test_dialogue_system.py::TestDialogueSystem::test_start_dialogue_success PASSED [ 46%]
tests/core/test_dice_roller.py::TestDiceRoller::test_invalid_dice_numbers PASSED [ 46%]
tests/core/test_dice_roller.py::TestDiceRoller::test_invalid_formats PASSED [ 46%]
tests/core/test_dice_roller.py::TestDiceRoller::test_multiple_dice_sum_and_count PASSED [ 46%]
tests/core/test_dice_roller.py::TestDiceRoller::test_rolls_with_negative_modifier PASSED [ 47%]
tests/core/test_dice_roller.py::TestDiceRoller::test_rolls_with_positive_modifier PASSED [ 47%]
tests/core/test_dice_roller.py::TestDiceRoller::test_rolls_with_zero_modifier PASSED [ 47%]
tests/core/test_dice_roller.py::TestDiceRoller::test_simple_rolls PASSED [ 47%]
tests/core/test_dice_roller.py::TestDiceRoller::test_whitespace_insensitivity PASSED [ 47%]
tests/core/test_experience_system.py::test_award_xp_single_player_no_levelup PASSED [ 47%]
tests/core/test_experience_system.py::test_award_xp_single_player_level_up PASSED [ 47%]
tests/core/test_experience_system.py::test_award_xp_party_equal_split_no_levelup PASSED [ 47%]
tests/core/test_experience_system.py::test_check_for_level_up_multiple_levels PASSED [ 47%]
tests/core/test_experience_system.py::test_check_for_level_up_no_rules_found PASSED [ 48%]
tests/core/test_experience_system.py::test_award_xp_player_not_found PASSED [ 48%]
tests/core/test_experience_system.py::test_award_xp_party_not_found_or_empty PASSED [ 48%]
tests/core/test_experience_system.py::test_check_for_level_up_max_level_reached PASSED [ 48%]
tests/core/test_experience_system.py::test_award_xp_party_xp_per_player_becomes_zero PASSED [ 48%]
tests/core/test_experience_system.py::test_spend_attribute_points_success PASSED [ 48%]
tests/core/test_experience_system.py::test_spend_attribute_points_not_enough_xp PASSED [ 48%]
tests/core/test_experience_system.py::test_spend_attribute_points_invalid_attribute PASSED [ 48%]
tests/core/test_experience_system.py::test_spend_attribute_points_invalid_points_value PASSED [ 48%]
tests/core/test_experience_system.py::test_spend_attribute_points_new_attribute PASSED [ 49%]
tests/core/test_experience_system.py::test_spend_attribute_points_attribute_definitions_not_dict PASSED [ 49%]
tests/core/test_experience_system.py::test_spend_attribute_points_no_attribute_definitions_rule PASSED [ 49%]
tests/core/test_game_events.py::test_log_event_successful PASSED         [ 49%]
tests/core/test_game_events.py::test_log_event_invalid_event_type_string PASSED [ 49%]
tests/core/test_game_events.py::test_log_event_entity_ids_handling[1-2-None-expected_entities_out0] PASSED [ 49%]
tests/core/test_game_events.py::test_log_event_entity_ids_handling[1-None-initial_entities_in1-expected_entities_out1] PASSED [ 49%]
tests/core/test_game_events.py::test_log_event_entity_ids_handling[None-2-initial_entities_in2-expected_entities_out2] PASSED [ 49%]
tests/core/test_game_events.py::test_log_event_entity_ids_handling[1-2-initial_entities_in3-expected_entities_out3] PASSED [ 49%]
tests/core/test_game_events.py::test_log_event_entity_ids_handling[1-None-initial_entities_in4-expected_entities_out4] PASSED [ 50%]
tests/core/test_game_events.py::test_log_event_entity_ids_handling[None-None-None-None] PASSED [ 50%]
tests/core/test_game_events.py::test_log_event_entity_ids_handling[None-None-initial_entities_in6-None] PASSED [ 50%]
tests/core/test_game_events.py::test_log_event_minimal_parameters PASSED [ 50%]
tests/core/test_global_entity_manager.py::TestGlobalEntityManager::test_simulate_mobile_group_triggers_combat PASSED [ 50%]
tests/core/test_global_entity_manager.py::TestGlobalEntityManager::test_simulate_no_active_global_entities PASSED [ 50%]
tests/core/test_global_entity_manager.py::TestGlobalEntityManager::test_simulate_npc_triggers_dialogue_placeholder PASSED [ 50%]
tests/core/test_global_entity_manager.py::TestGlobalEntityManager::test_simulate_single_global_npc_no_interaction PASSED [ 50%]
tests/core/test_global_entity_manager.py::TestDetermineNextLocationAndGoalReached::test_goal_reached_behavior_idle PASSED [ 50%]
tests/core/test_global_entity_manager.py::TestDetermineNextLocationAndGoalReached::test_goal_reached_behavior_set_new_goal PASSED [ 51%]
tests/core/test_global_entity_manager.py::TestDetermineNextLocationAndGoalReached::test_goal_reached_behavior_start_new_route PASSED [ 51%]
tests/core/test_global_entity_manager.py::TestMobileGroupCombatExpansion::test_mobile_group_actor_expands_members_into_combat PASSED [ 51%]
tests/core/test_global_entity_manager.py::TestMobileGroupCombatExpansion::test_mobile_group_target_expands_members_into_combat PASSED [ 51%]
tests/core/test_interaction_handlers.py::test_examine_existing_object PASSED [ 51%]
tests/core/test_interaction_handlers.py::test_examine_non_existent_object PASSED [ 51%]
tests/core/test_interaction_handlers.py::test_examine_unexaminable_object PASSED [ 51%]
tests/core/test_interaction_handlers.py::test_interact_object_with_check_success PASSED [ 51%]
tests/core/test_interaction_handlers.py::test_interact_object_with_check_failure PASSED [ 51%]
tests/core/test_interaction_handlers.py::test_interact_object_no_check_required PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_interact_object_rule_not_found PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_interact_object_no_interaction_key PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_interact_non_existent_object PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_move_to_valid_sublocation PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_move_to_invalid_sublocation_not_a_sublocation_type PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_move_to_non_existent_sublocation PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_handle_action_player_not_found PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_handle_action_location_not_found PASSED [ 52%]
tests/core/test_interaction_handlers.py::test_handle_action_no_target_name PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_handle_action_unknown_intent PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_find_target_malformed_interactable_elements[mock_location_with_details0] PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_find_target_empty_location_data PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_find_target_no_interactables_key PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_find_target_interactables_not_a_list PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_find_target_empty_interactables_list PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_find_target_success PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_find_target_not_found PASSED [ 53%]
tests/core/test_interaction_handlers.py::test_find_target_item_not_a_dict PASSED [ 54%]
tests/core/test_interaction_handlers.py::test_find_target_item_no_name_key PASSED [ 54%]
tests/core/test_interaction_handlers.py::test_examine_object_player_lang_present PASSED [ 54%]
tests/core/test_interaction_handlers.py::test_examine_object_player_lang_missing_fallback_en PASSED [ 54%]
tests/core/test_interaction_handlers.py::test_examine_object_player_lang_and_en_missing_fallback_default PASSED [ 54%]
tests/core/test_interaction_handlers.py::test_examine_object_no_description_i18n PASSED [ 54%]
tests/core/test_interaction_handlers.py::test_apply_consequences_update_location_state ERROR [ 54%]
tests/core/test_interaction_handlers.py::test_apply_consequences_change_player_stat ERROR [ 54%]
tests/core/test_interaction_handlers.py::test_apply_consequences_teleport_player FAILED [ 54%]
tests/core/test_localization_utils.py::test_get_localized_text[i18n_field0-en-ru-Hello] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_text[i18n_field1-ru-en-\u041f\u0440\u0438\u0432\u0435\u0442] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_text[i18n_field2-ru-en-Hello] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_text[i18n_field3-en-ru-\u041f\u0440\u0438\u0432\u0435\u0442] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_text[i18n_field4-en-es-Hola] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_text[None-en-ru-] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_text[i18n_field6-en-ru-] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_text[i18n_field7-en-ru-] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_text[i18n_field8-en-ru-] PASSED [ 55%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_player_success PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_location_success PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_npc_success PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_item_success PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_entity_not_found PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_unsupported_type PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_nameless_entity PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_plain_name_fallback PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_localized_entity_name_getter_exception PASSED [ 56%]
tests/core/test_localization_utils.py::test_get_batch_localized_entity_names_success PASSED [ 57%]
tests/core/test_localization_utils.py::test_get_batch_localized_entity_names_empty_input PASSED [ 57%]
tests/core/test_localization_utils.py::test_get_batch_localized_entity_names_unsupported_type_in_batch PASSED [ 57%]
tests/core/test_localization_utils.py::test_get_batch_localized_entity_names_crud_exception PASSED [ 57%]
tests/core/test_localization_utils.py::test_get_batch_localized_entity_names_all_entities_not_found PASSED [ 57%]
tests/core/test_localization_utils.py::test_get_batch_localized_entity_names_fallback_and_nameless PASSED [ 57%]
tests/core/test_localization_utils.py::test_get_batch_localized_entity_names_invalid_refs_skipped PASSED [ 57%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_different_field_name_base_is_now_direct_dict_pass PASSED [ 57%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_empty_string_value_is_returned PASSED [ 57%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_get_fallback_language PASSED [ 58%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_get_first_available_if_primary_and_fallback_missing PASSED [ 58%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_get_primary_language PASSED [ 58%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_language_and_default_lang_not_present PASSED [ 58%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_language_not_present_uses_default_lang PASSED [ 58%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_none_if_field_missing_or_none PASSED [ 58%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_none_if_i18n_field_not_dict PASSED [ 58%]
tests/core/test_locations_utils.py::TestGetLocalizedText::test_none_if_no_text_found PASSED [ 58%]
tests/core/test_locations_utils.py::TestLocationDBUtils::test_get_location_by_static_id_existing PASSED [ 58%]
tests/core/test_locations_utils.py::TestLocationDBUtils::test_get_location_by_static_id_not_existing PASSED [ 59%]
tests/core/test_locations_utils.py::TestLocationDBUtils::test_get_location_by_static_id_wrong_guild PASSED [ 59%]
tests/core/test_locations_utils.py::TestLocationDBUtils::test_get_location_existing PASSED [ 59%]
tests/core/test_locations_utils.py::TestLocationDBUtils::test_get_location_mocked PASSED [ 59%]
tests/core/test_locations_utils.py::TestLocationDBUtils::test_get_location_not_existing PASSED [ 59%]
tests/core/test_locations_utils.py::TestLocationDBUtils::test_get_location_wrong_guild PASSED [ 59%]
tests/core/test_map_management.py::test_add_location_master_success PASSED [ 59%]
tests/core/test_map_management.py::test_add_location_master_static_id_exists PASSED [ 59%]
tests/core/test_map_management.py::test_add_location_master_missing_field PASSED [ 59%]
tests/core/test_map_management.py::test_remove_location_master_success PASSED [ 60%]
tests/core/test_map_management.py::test_remove_location_master_not_found PASSED [ 60%]
tests/core/test_map_management.py::test_connect_locations_master_success PASSED [ 60%]
tests/core/test_map_management.py::test_disconnect_locations_master_success PASSED [ 60%]
tests/core/test_movement_logic.py::test_handle_move_action_successful_solo_player PASSED [ 60%]
tests/core/test_movement_logic.py::test_handle_move_action_successful_party_move PASSED [ 60%]
tests/core/test_movement_logic.py::test_handle_move_action_player_not_found PASSED [ 60%]
tests/core/test_movement_logic.py::test_handle_move_action_target_location_not_found PASSED [ 60%]
tests/core/test_movement_logic.py::test_handle_move_action_already_at_target_location PASSED [ 60%]
tests/core/test_movement_logic.py::test_handle_move_action_not_connected PASSED [ 61%]
tests/core/test_movement_logic.py::test_handle_move_action_malformed_neighbors_json PASSED [ 61%]
tests/core/test_movement_logic.py::test_handle_move_action_player_no_current_location_id PASSED [ 61%]
tests/core/test_movement_logic.py::test_handle_move_action_current_location_not_found_in_db PASSED [ 61%]
tests/core/test_movement_logic.py::test_handle_move_action_current_location_wrong_guild PASSED [ 61%]
tests/core/test_movement_logic.py::test_handle_move_action_party_not_found_proceeds_solo PASSED [ 61%]
tests/core/test_movement_logic.py::test_execute_move_successful_solo_player FAILED [ 61%]
tests/core/test_movement_logic.py::test_execute_move_successful_party_move FAILED [ 61%]
tests/core/test_movement_logic.py::test_execute_move_player_not_found PASSED [ 61%]
tests/core/test_movement_logic.py::test_execute_move_player_wrong_guild PASSED [ 62%]
tests/core/test_movement_logic.py::test_execute_move_target_location_not_found_by_static_id FAILED [ 62%]
tests/core/test_movement_logic.py::test_execute_move_not_connected FAILED [ 62%]
tests/core/test_movement_logic.py::test_execute_move_failure_does_not_call_on_enter_location PASSED [ 62%]
tests/core/test_movement_logic.py::test_find_location_by_static_id_success PASSED [ 62%]
tests/core/test_movement_logic.py::test_find_location_by_name_player_language_actual_logic PASSED [ 62%]
tests/core/test_movement_logic.py::test_find_location_by_name_guild_language_fallback_actual_logic PASSED [ 62%]
tests/core/test_movement_logic.py::test_find_location_by_name_english_fallback_actual_logic PASSED [ 62%]
tests/core/test_movement_logic.py::test_find_location_by_name_case_insensitive_actual_logic PASSED [ 62%]
tests/core/test_movement_logic.py::test_find_location_not_found_actual_logic PASSED [ 63%]
tests/core/test_movement_logic.py::test_find_location_by_name_ambiguous_returns_first_and_logs_actual_logic PASSED [ 63%]
tests/core/test_movement_logic.py::test_execute_move_uses_find_location_helper_success FAILED [ 63%]
tests/core/test_movement_logic.py::test_execute_move_when_find_location_helper_returns_none FAILED [ 63%]
tests/core/test_movement_logic.py::test_handle_move_action_party_in_wrong_guild_proceeds_solo PASSED [ 63%]
tests/core/test_nlu_service.py::test_parse_player_input[look-look_around-expected_entities0] PASSED [ 63%]
tests/core/test_nlu_service.py::test_parse_player_input[l-look_around-expected_entities1] PASSED [ 63%]
tests/core/test_nlu_service.py::test_parse_player_input[examine-look_around-expected_entities2] PASSED [ 63%]
tests/core/test_nlu_service.py::test_parse_player_input[inventory-view_inventory-expected_entities3] PASSED [ 63%]
tests/core/test_nlu_service.py::test_parse_player_input[inv-view_inventory-expected_entities4] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[i-view_inventory-expected_entities5] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[help-get_help-expected_entities6] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[?-get_help-expected_entities7] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[go north-move-expected_entities8] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[move west-move-expected_entities9] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[n-move-expected_entities10] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[s-move-expected_entities11] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[e-move-expected_entities12] PASSED [ 64%]
tests/core/test_nlu_service.py::test_parse_player_input[w-move-expected_entities13] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[u-move-expected_entities14] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[d-move-expected_entities15] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[look at goblin-examine-expected_entities16] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[examine the sword-examine-expected_entities17] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[l the chest-examine-expected_entities18] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[exa note-examine-expected_entities19] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[interact with lever-interact-expected_entities20] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[use the terminal-interact-expected_entities21] PASSED [ 65%]
tests/core/test_nlu_service.py::test_parse_player_input[activate button-interact-expected_entities22] PASSED [ 66%]
tests/core/test_nlu_service.py::test_parse_player_input[touch stone-interact-expected_entities23] PASSED [ 66%]
tests/core/test_nlu_service.py::test_parse_player_input[press switch-interact-expected_entities24] PASSED [ 66%]
tests/core/test_nlu_service.py::test_parse_player_input[pull rope-interact-expected_entities25] PASSED [ 66%]
tests/core/test_nlu_service.py::test_parse_player_input[go to the kitchen-go_to-expected_entities26] PASSED [ 66%]
tests/core/test_nlu_service.py::test_parse_player_input[enter the library-go_to-expected_entities27] PASSED [ 66%]
tests/core/test_nlu_service.py::test_parse_player_input[move to arena-go_to-expected_entities28] PASSED [ 66%]
tests/core/test_nlu_service.py::test_parse_player_input[get sword-get_item-expected_entities29] PASSED [ 66%]
tests/core/test_nlu_service.py::test_parse_player_input[take the potion-get_item-expected_entities30] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input[drop shield-drop_item-expected_entities31] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input[discard key-drop_item-expected_entities32] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input[attack goblin-attack_target-expected_entities33] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input[hit the orc with my axe-attack_target-expected_entities34] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input[talk to elara-talk_to_npc-expected_entities35] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input[speak with the guard-talk_to_npc-expected_entities36] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input[say Hello there!-say_text-expected_entities37] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input['General Kenobi-say_text-expected_entities38] PASSED [ 67%]
tests/core/test_nlu_service.py::test_parse_player_input[shout FOR THE ALLIANCE-say_text-expected_entities39] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input[whisper meet me by the docks-say_text-expected_entities40] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input[do something completely random-unknown_intent-expected_entities41] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input[sing a song-unknown_intent-expected_entities42] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input[-unknown_intent-expected_entities43] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input[   -unknown_intent-expected_entities44] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input[  LoOk  -look_around-expected_entities45] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input[gO NoRTh  -move-expected_entities46] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input[  examine  THE  Shiny Orb  -examine-expected_entities47] PASSED [ 68%]
tests/core/test_nlu_service.py::test_parse_player_input_empty_string_returns_unknown PASSED [ 69%]
tests/core/test_nlu_service.py::test_parse_player_input_no_match_returns_unknown PASSED [ 69%]
tests/core/test_nlu_service.py::test_parse_player_input_confidence_values PASSED [ 69%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_npc_ai_rules_merges_defaults_and_specific_relationship_rules PASSED [ 69%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_npc_ai_rules_loads_hidden_relationship_effects PASSED [ 69%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_available_abilities_all_available PASSED [ 69%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_available_abilities_not_enough_mana PASSED [ 69%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_available_abilities_one_on_cooldown PASSED [ 69%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_available_abilities_mana_and_cooldown_mix PASSED [ 69%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_is_hostile_player_default_hostile PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_is_hostile_explicitly_friendly_relationship_player PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_is_hostile_explicitly_hostile_relationship_npc PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_is_hostile_same_faction_npc_friendly_by_default PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_is_hostile_different_faction_npc_hostile_by_default PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_is_hostile_relationship_formula_makes_friendly PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_is_hostile_relationship_formula_makes_hostile PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_calculate_target_score_relationship_formula_modifies_threat PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_is_hostile_hidden_relationship_override_friendly PASSED [ 70%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_calculate_target_score_hidden_relationship_modifier PASSED [ 71%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_choose_action_hidden_relationship_prefers_non_damaging PASSED [ 71%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_potential_targets_basic PASSED [ 71%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_npc_combat_action_chooses_attack_on_player PASSED [ 71%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_npc_combat_action_actor_defeated PASSED [ 71%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_get_npc_combat_action_no_targets_available PASSED [ 71%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_choose_action_relationship_friendly_prefers_non_attack_or_heal PASSED [ 71%]
tests/core/test_npc_combat_strategy.py::TestNPCCombatStrategy::test_choose_action_relationship_hostile_prefers_strong_attack PASSED [ 71%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_add_to_npc_memory_player PASSED [ 71%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_add_to_npc_memory_party PASSED [ 72%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_add_to_npc_memory_both_ids_error PASSED [ 72%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_add_to_npc_memory_no_ids_error PASSED [ 72%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_add_to_npc_memory_crud_exception PASSED [ 72%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_get_npc_memory_player PASSED [ 72%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_get_npc_memory_party PASSED [ 72%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_get_npc_memory_both_ids_error PASSED [ 72%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_get_npc_memory_no_ids_error PASSED [ 72%]
tests/core/test_npc_memory_system.py::TestNpcMemorySystem::test_get_npc_memory_crud_exception PASSED [ 72%]
tests/core/test_quest_system.py::TestQuestSystem::test_advance_quest_progress_to_completion PASSED [ 73%]
tests/core/test_quest_system.py::TestQuestSystem::test_advance_quest_progress_to_next_step PASSED [ 73%]
tests/core/test_quest_system.py::TestQuestSystem::test_apply_quest_consequences_all_types PASSED [ 73%]
tests/core/test_quest_system.py::TestQuestSystem::test_check_mechanic_match_details_subset_match PASSED [ 73%]
tests/core/test_quest_system.py::TestQuestSystem::test_check_mechanic_match_details_subset_mismatch PASSED [ 73%]
tests/core/test_quest_system.py::TestQuestSystem::test_check_mechanic_match_event_type_mismatch PASSED [ 73%]
tests/core/test_quest_system.py::TestQuestSystem::test_handle_player_event_successful_step_completion PASSED [ 73%]
tests/core/test_relationship_system.py::test_get_canonical_entity_pair[1-RelationshipEntityType.PLAYER-2-RelationshipEntityType.GENERATED_NPC-2-RelationshipEntityType.GENERATED_NPC-1-RelationshipEntityType.PLAYER] PASSED [ 73%]
tests/core/test_relationship_system.py::test_get_canonical_entity_pair[2-RelationshipEntityType.GENERATED_NPC-1-RelationshipEntityType.PLAYER-2-RelationshipEntityType.GENERATED_NPC-1-RelationshipEntityType.PLAYER] PASSED [ 73%]
tests/core/test_relationship_system.py::test_get_canonical_entity_pair[1-RelationshipEntityType.PARTY-5-RelationshipEntityType.GENERATED_FACTION-5-RelationshipEntityType.GENERATED_FACTION-1-RelationshipEntityType.PARTY] PASSED [ 74%]
tests/core/test_relationship_system.py::test_get_canonical_entity_pair[5-RelationshipEntityType.GENERATED_FACTION-1-RelationshipEntityType.PARTY-5-RelationshipEntityType.GENERATED_FACTION-1-RelationshipEntityType.PARTY] PASSED [ 74%]
tests/core/test_relationship_system.py::test_get_canonical_entity_pair[1-RelationshipEntityType.PLAYER-10-RelationshipEntityType.PLAYER-1-RelationshipEntityType.PLAYER-10-RelationshipEntityType.PLAYER] PASSED [ 74%]
tests/core/test_relationship_system.py::test_get_canonical_entity_pair[10-RelationshipEntityType.PLAYER-1-RelationshipEntityType.PLAYER-1-RelationshipEntityType.PLAYER-10-RelationshipEntityType.PLAYER] PASSED [ 74%]
tests/core/test_relationship_system.py::test_get_canonical_entity_pair[1-RelationshipEntityType.GENERATED_NPC-1-RelationshipEntityType.GENERATED_NPC-1-RelationshipEntityType.GENERATED_NPC-1-RelationshipEntityType.GENERATED_NPC] PASSED [ 74%]
tests/core/test_relationship_system.py::test_update_relationship_existing_relationship_updated PASSED [ 74%]
tests/core/test_relationship_system.py::test_placeholder PASSED          [ 74%]
tests/core/test_report_formatter.py::test_collect_refs_player_action_examine PASSED [ 74%]
tests/core/test_report_formatter.py::test_collect_refs_player_move PASSED [ 74%]
tests/core/test_report_formatter.py::test_collect_refs_item_acquired PASSED [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_combat_action PASSED [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_ability_used PASSED [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_status_applied PASSED [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_level_up PASSED   [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_xp_gained PASSED  [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_relationship_change PASSED [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_combat_start PASSED [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_combat_end PASSED [ 75%]
tests/core/test_report_formatter.py::test_collect_refs_quest_accepted PASSED [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_quest_step_completed PASSED [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_quest_completed PASSED [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_dialogue_line PASSED [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_quest_failed PASSED [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_npc_action PASSED [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_item_used PASSED  [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_item_used_no_target PASSED [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_item_dropped PASSED [ 76%]
tests/core/test_report_formatter.py::test_collect_refs_dialogue_start PASSED [ 77%]
tests/core/test_report_formatter.py::test_collect_refs_dialogue_end PASSED [ 77%]
tests/core/test_report_formatter.py::test_collect_refs_faction_change PASSED [ 77%]
tests/core/test_report_formatter.py::test_collect_refs_generic_event_with_ids PASSED [ 77%]
tests/core/test_report_formatter.py::test_collect_refs_generic_event_no_ids PASSED [ 77%]
tests/core/test_report_formatter.py::test_format_player_action_examine_en_with_terms PASSED [ 77%]
tests/core/test_report_formatter.py::test_format_player_action_examine_ru_default_terms PASSED [ 77%]
tests/core/test_report_formatter.py::test_format_combat_end_ru_with_terms_and_survivors PASSED [ 77%]
tests/core/test_report_formatter.py::test_format_turn_report_empty_logs_integration PASSED [ 77%]
tests/core/test_report_formatter.py::test_format_turn_report_with_logs_integration PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_ability_used_with_terms[en-uses ability-on] PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_ability_used_with_terms[ru-\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c-\u043d\u0430] PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_combat_start[en-terms.combat.starts_involving_en-Combat starts at '{location_name}' involving: {participants_str}.-location_name_key0-participants_key0-TestPlayer, Goblin] PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_combat_start[ru-terms.combat.starts_involving_ru-\u041d\u0430\u0447\u0438\u043d\u0430\u0435\u0442\u0441\u044f \u0431\u043e\u0439 \u0432 '{location_name}' \u0441 \u0443\u0447\u0430\u0441\u0442\u0438\u0435\u043c: {participants_str}.-location_name_key1-participants_key1-TestPlayer, Goblin] PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_combat_start[en-terms.combat.starts_involving_en-Combat starts at '{location_name}' involving: {participants_str}.-location_name_key2-participants_key2-unknown participants] PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_npc_action[en-actor_key0-attack-PlayerOne-deals 10 damage-.verb_npc-performs '{action_intent}'-on] PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_npc_action[ru-actor_key1-guard-the treasure-successfully-.verb_npc-\u0441\u043e\u0432\u0435\u0440\u0448\u0430\u0435\u0442 '{action_intent}'-\u043d\u0430\u0434] PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_npc_action[en-actor_key2-special_move-themselves--.verb_npc-performs '{action_intent}'-on] PASSED [ 78%]
tests/core/test_report_formatter.py::test_format_combat_action_with_check_result_and_relationship_details[en-10-15-2-17-16-Friendly (Formula)-2] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_combat_action_with_check_result_and_relationship_details[ru-5-8--1-7-10-\u0412\u0440\u0430\u0436\u0434\u0435\u0431\u043d\u043e\u0441\u0442\u044c (\u041f\u043e\u0440\u043e\u0433)--1] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_combat_action_with_check_result_and_relationship_details[en-0-5-0-5-10-None-None] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_item_used[en-player_key0-item_key0-target_info0-It glows faintly.-uses-on] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_item_used[ru-player_key1-item_key1-None-\u041f\u0440\u0435\u0434\u043c\u0435\u0442 \u0438\u0441\u0447\u0435\u0437\u0430\u0435\u0442.-\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442-\u043d\u0430] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_item_used[en-player_key2-item_key2-target_info2--uses-on] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_item_dropped[en-player_key0-item_key0-1-drops] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_item_dropped[ru-player_key1-item_key1-5-\u0432\u044b\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_dialogue_start[en-player_key0-npc_key0-{player_name} starts a conversation with {npc_name}.] PASSED [ 79%]
tests/core/test_report_formatter.py::test_format_dialogue_start[ru-player_key1-npc_key1-{player_name} \u043d\u0430\u0447\u0438\u043d\u0430\u0435\u0442 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440 \u0441 {npc_name}.] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_dialogue_end[en-player_key0-npc_key0-{player_name} ends the conversation with {npc_name}.] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_dialogue_end[ru-player_key1-npc_key1-{player_name} \u0437\u0430\u043a\u0430\u043d\u0447\u0438\u0432\u0430\u0435\u0442 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440 \u0441 {npc_name}.] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_faction_change[en-entity_key0-faction_key0-Neutral-Friendly-Helped them] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_faction_change[ru-entity_key1-faction_key1-\u0412\u0440\u0430\u0436\u0434\u0435\u0431\u043d\u043e\u0441\u0442\u044c-\u041d\u0435\u0439\u0442\u0440\u0430\u043b\u0438\u0442\u0435\u0442-None] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_generic_events[en-EventType.SYSTEM_EVENT-details0-[System Event]:-Weather changed to sunny.] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_generic_events[ru-EventType.WORLD_STATE_CHANGE-details1-[World State Change]:-change: season is now winter] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_generic_events[en-EventType.MASTER_COMMAND-details2-[Master Command]:-command_name: teleport] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_generic_events[ru-EventType.ERROR_EVENT-details3-[Error Event]:-error_message: Failed to load module X.] PASSED [ 80%]
tests/core/test_report_formatter.py::test_format_generic_events[en-EventType.AI_GENERATION_TRIGGERED-details4-[Ai Generation Triggered]:-context: new_npc_for_tavern] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_generic_events[ru-EventType.TRADE_INITIATED-details5-[Trade Initiated]:-player_id: 1; npc_id: 601] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_dialogue_line[en-speaker_key0-Hello world!] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_dialogue_line[ru-speaker_key1-\u041f\u0440\u0438\u0432\u0435\u0442, \u043c\u0438\u0440!] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_dialogue_line[en-speaker_key2-No speaker in cache.] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_status_removed[en-terms.statuses.effect_ended_on_en-'{status_name}' effect has ended on {target_name}.-target_key0-status_key0] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_status_removed[ru-terms.statuses.effect_ended_on_ru-\u042d\u0444\u0444\u0435\u043a\u0442 '{status_name}' \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u0441\u044f \u0434\u043b\u044f {target_name}.-target_key1-status_key1] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_quest_failed[en-ran out of time-with_reason-{player_name} has failed the quest '{quest_name}' due to: {reason}.-player_key0-quest_key0] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_quest_failed[ru-\u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c \u0432\u0440\u0435\u043c\u044f-with_reason-{player_name} \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u043b(\u0430) \u0437\u0430\u0434\u0430\u043d\u0438\u0435 '{quest_name}' \u043f\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0435: {reason}.-player_key1-quest_key1] PASSED [ 81%]
tests/core/test_report_formatter.py::test_format_quest_failed[en-None-simple-{player_name} has failed the quest '{quest_name}'.-player_key2-quest_key2] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_failed[ru-None-simple-{player_name} \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u043b(\u0430) \u0437\u0430\u0434\u0430\u043d\u0438\u0435 '{quest_name}'.-player_key3-quest_key3] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_accepted[en-terms.quests.accepted_en-{player_name} has accepted the quest: '{quest_name}'.-player_key0-quest_key0] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_accepted[ru-terms.quests.accepted_ru-{player_name} \u043f\u0440\u0438\u043d\u044f\u043b(\u0430) \u0437\u0430\u0434\u0430\u043d\u0438\u0435: '{quest_name}'.-player_key1-quest_key1] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_step_completed[en-Retrieve the amulet-detailed-{player_name} completed a step in '{quest_name}': {step_details}.] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_step_completed[ru-\u0414\u043e\u0431\u0443\u0434\u044c\u0442\u0435 \u0430\u043c\u0443\u043b\u0435\u0442-detailed-{player_name} \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u043b(\u0430) \u044d\u0442\u0430\u043f \u0432 \u0437\u0430\u0434\u0430\u043d\u0438\u0438 '{quest_name}': {step_details}.] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_step_completed[en-None-simple-{player_name} completed a step in the quest '{quest_name}'.] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_step_completed[ru-None-simple-{player_name} \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u043b(\u0430) \u044d\u0442\u0430\u043f \u0432 \u0437\u0430\u0434\u0430\u043d\u0438\u0438 '{quest_name}'.] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_completed[en-terms.quests.completed_en-{player_name} has completed the quest: '{quest_name}'!-player_key0-quest_key0] PASSED [ 82%]
tests/core/test_report_formatter.py::test_format_quest_completed[ru-terms.quests.completed_ru-{player_name} \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u043b(\u0430) \u0437\u0430\u0434\u0430\u043d\u0438\u0435: '{quest_name}'!-player_key1-quest_key1] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_level_up[en-5-terms.character.level_up_en-{player_name} has reached level {level_str}!] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_level_up[ru-5-terms.character.level_up_ru-{player_name} \u0434\u043e\u0441\u0442\u0438\u0433(\u043b\u0430) \u0443\u0440\u043e\u0432\u043d\u044f {level_str}!] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_level_up[en-None-terms.character.level_up_en-{player_name} has reached level {level_str}!] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_xp_gained[en-100-defeating a goblin-with_source-{player_name} gained {amount_str} {xp_term} {source_str}.] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_xp_gained[ru-100-\u043f\u043e\u0431\u0435\u0434\u0430 \u043d\u0430\u0434 \u0433\u043e\u0431\u043b\u0438\u043d\u043e\u043c-with_source-{player_name} \u043f\u043e\u043b\u0443\u0447\u0438\u043b(\u0430) {amount_str} {xp_term} {source_str}.] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_xp_gained[en-50-None-simple-{player_name} gained {amount_str} {xp_term}.] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_xp_gained[ru-50-None-simple-{player_name} \u043f\u043e\u043b\u0443\u0447\u0438\u043b(\u0430) {amount_str} {xp_term}.] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_xp_gained[en-None-a mysterious event-with_source-{player_name} gained {amount_str} {xp_term} {source_str}.] PASSED [ 83%]
tests/core/test_report_formatter.py::test_format_relationship_change[en-50-completed a task-e1_key0-e2_key0] PASSED [ 84%]
tests/core/test_report_formatter.py::test_format_relationship_change[ru--20-\u043e\u0441\u043a\u043e\u0440\u0431\u043b\u0435\u043d\u0438\u0435-e1_key1-e2_key1] PASSED [ 84%]
tests/core/test_report_formatter.py::test_format_relationship_change[en-0-None-e1_key2-e2_key2] PASSED [ 84%]
tests/core/test_report_formatter.py::test_format_relationship_change[ru-None-\u0442\u0430\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435-e1_key3-e2_key3] PASSED [ 84%]
tests/core/test_report_formatter.py::test_format_status_applied[en-3-source_info0-target_key0-status_key0] PASSED [ 84%]
tests/core/test_report_formatter.py::test_format_status_applied[ru-None-source_info1-target_key1-status_key1] PASSED [ 84%]
tests/core/test_report_formatter.py::test_format_status_applied[en-5-None-target_key2-status_key2] PASSED [ 84%]
tests/core/test_report_formatter.py::test_format_status_applied[ru-2-source_info3-target_key3-status_key3] PASSED [ 84%]
tests/core/test_rules.py::test_load_rules_config_empty_db PASSED         [ 84%]
tests/core/test_rules.py::test_load_rules_config_populates_cache PASSED  [ 85%]
tests/core/test_rules.py::test_get_rule_cache_hit PASSED                 [ 85%]
tests/core/test_rules.py::test_get_rule_cache_miss_loads_and_returns PASSED [ 85%]
tests/core/test_rules.py::test_get_rule_key_not_found_returns_default PASSED [ 85%]
tests/core/test_rules.py::test_get_rule_none_default PASSED              [ 85%]
tests/core/test_rules.py::test_update_rule_config_creates_new_rule PASSED [ 85%]
tests/core/test_rules.py::test_update_rule_config_updates_existing_rule PASSED [ 85%]
tests/core/test_rules.py::test_get_all_rules_for_guild_empty PASSED      [ 85%]
tests/core/test_rules.py::test_get_all_rules_for_guild_loads_and_returns PASSED [ 85%]
tests/core/test_rules.py::test_get_all_rules_for_guild_uses_cache PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_buy_item_not_enough_gold PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_buy_item_npc_not_enough_items PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_buy_item_success PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_base_value_only PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_item_no_base_value_uses_rule_or_default PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_min_price_applied PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_no_relationship_rule_defined PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_relationship_modifier_formula_buy_positive_relation PASSED [ 86%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_relationship_modifier_formula_sell PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_relationship_modifier_tiers_buy PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_relationship_modifier_tiers_neutral_no_default PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_relationship_modifier_tiers_sell_high_relation PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_relationship_modifier_tiers_use_default_tier PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_relationship_rule_invalid_structure PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_trade_skill_modifier_buy PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_calculate_price_trade_skill_modifier_sell PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_sell_item_player_does_not_own_stack PASSED [ 87%]
tests/core/test_trade_system.py::TestTradeSystem::test_sell_item_player_not_enough_items PASSED [ 88%]
tests/core/test_trade_system.py::TestTradeSystem::test_sell_item_success PASSED [ 88%]
tests/core/test_trade_system.py::TestTradeSystem::test_view_inventory_npc_not_trader PASSED [ 88%]
tests/core/test_trade_system.py::TestTradeSystem::test_view_inventory_success PASSED [ 88%]
tests/core/test_turn_controller.py::test_process_guild_turn_no_pending_entities PASSED [ 88%]
tests/core/test_turn_controller.py::test_process_guild_turn_one_player_pending PASSED [ 88%]
tests/core/test_turn_controller.py::test_process_guild_turn_one_party_pending_with_member PASSED [ 88%]
tests/core/test_turn_controller.py::test_process_guild_turn_lock_prevents_concurrent PASSED [ 88%]
tests/core/test_turn_controller.py::test_trigger_guild_turn_processing_calls_process_ready PASSED [ 88%]
tests/core/test_turn_controller.py::test_process_guild_turn_releases_lock_on_exception PASSED [ 89%]
tests/core/test_turn_controller.py::test_process_guild_turn_multiple_entities PASSED [ 89%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_factions_and_relationships_existing_static_id PASSED [ 89%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_factions_and_relationships_parsing_error PASSED [ 89%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_factions_and_relationships_success PASSED [ 89%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_new_location_ai_validation_error PASSED [ 89%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_new_location_default_connection_description PASSED [ 89%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_new_location_invalid_potential_neighbor_data PASSED [ 89%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_new_location_malformed_initial_neighbors PASSED [ 89%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_new_location_no_location_data_in_response PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_new_location_parent_not_found PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_new_location_potential_neighbor_not_found PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_new_location_via_ai_success PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_quests_for_guild_parse_error PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_quests_for_guild_skips_duplicate_quest_static_id PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_generate_quests_for_guild_success PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_update_location_neighbors_add_connection PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_update_location_neighbors_add_existing_does_not_duplicate PASSED [ 90%]
tests/core/test_world_generation.py::TestWorldGeneration::test_update_location_neighbors_remove_connection PASSED [ 91%]
tests/core/test_world_generation.py::TestWorldGenerationEconomicEntities::test_generate_economic_entities_ai_parse_error PASSED [ 91%]
tests/core/test_world_generation.py::TestWorldGenerationEconomicEntities::test_generate_economic_entities_handles_existing_item_and_npc PASSED [ 91%]
tests/core/test_world_generation.py::TestWorldGenerationEconomicEntities::test_generate_economic_entities_success PASSED [ 91%]
tests/models/test_combat_encounter.py::TestCombatEncounterModel::test_create_combat_encounter_all_fields PASSED [ 91%]
tests/models/test_combat_encounter.py::TestCombatEncounterModel::test_create_combat_encounter_defaults PASSED [ 91%]
tests/models/test_combat_encounter.py::TestCombatEncounterModel::test_repr_method PASSED [ 91%]
tests/models/test_command_info.py::test_command_parameter_info_creation PASSED [ 91%]
tests/models/test_command_info.py::test_command_parameter_info_optional_description PASSED [ 91%]
tests/models/test_command_info.py::test_command_info_creation PASSED     [ 92%]
tests/models/test_command_info.py::test_command_info_no_parameters_no_description PASSED [ 92%]
tests/models/test_command_info.py::test_command_list_response_creation PASSED [ 92%]
tests/models/test_command_info.py::test_command_list_response_empty_commands PASSED [ 92%]
tests/models/test_command_info.py::test_command_list_response_no_language_code PASSED [ 92%]
tests/models/test_command_info.py::test_command_parameter_info_validation_error PASSED [ 92%]
tests/models/test_command_info.py::test_command_info_validation_error PASSED [ 92%]
tests/models/test_command_info.py::test_command_list_response_validation_error PASSED [ 92%]
tests/models/test_command_info.py::test_command_parameter_info_actually_missing_fields PASSED [ 92%]
tests/models/test_command_info.py::test_command_info_actually_missing_fields PASSED [ 93%]
tests/models/test_command_info.py::test_command_list_response_actually_missing_fields PASSED [ 93%]
tests/models/test_custom_types.py::test_jsonb_for_sqlite_stores_and_retrieves_dict PASSED [ 93%]
tests/models/test_custom_types.py::test_jsonb_for_sqlite_stores_and_retrieves_list PASSED [ 93%]
tests/models/test_custom_types.py::test_jsonb_for_sqlite_stores_and_retrieves_null PASSED [ 93%]
tests/models/test_custom_types.py::test_jsonb_for_sqlite_stores_empty_dict_and_list PASSED [ 93%]
tests/models/test_custom_types.py::test_jsonb_for_sqlite_update_json_field PASSED [ 93%]
tests/models/test_custom_types.py::test_jsonb_for_sqlite_with_real_json_strings_if_needed PASSED [ 93%]
tests/models/test_global_event.py::TestGlobalEventModel::test_create_global_event_all_fields PASSED [ 93%]
tests/models/test_global_event.py::TestGlobalEventModel::test_create_global_event_defaults PASSED [ 94%]
tests/models/test_global_event.py::TestGlobalEventModel::test_global_event_repr PASSED [ 94%]
tests/models/test_global_npc.py::TestGlobalNpcModel::test_create_global_npc_all_fields PASSED [ 94%]
tests/models/test_global_npc.py::TestGlobalNpcModel::test_create_global_npc_defaults PASSED [ 94%]
tests/models/test_global_npc.py::TestGlobalNpcModel::test_global_npc_repr PASSED [ 94%]
tests/models/test_inventory_item.py::TestInventoryItemModel::test_create_inventory_item_all_fields PASSED [ 94%]
tests/models/test_inventory_item.py::TestInventoryItemModel::test_create_inventory_item_minimal PASSED [ 94%]
tests/models/test_inventory_item.py::TestInventoryItemModel::test_inventory_item_relationship_to_item PASSED [ 94%]
tests/models/test_inventory_item.py::TestInventoryItemModel::test_inventory_item_repr PASSED [ 94%]
tests/models/test_item.py::TestItemModel::test_create_item_all_fields PASSED [ 95%]
tests/models/test_item.py::TestItemModel::test_create_item_minimal PASSED [ 95%]
tests/models/test_item.py::TestItemModel::test_item_repr PASSED          [ 95%]
tests/models/test_location.py::TestLocationModel::test_create_location_all_fields PASSED [ 95%]
tests/models/test_location.py::TestLocationModel::test_create_location_minimal PASSED [ 95%]
tests/models/test_location.py::TestLocationModel::test_default_jsonb_fields_are_empty_dicts PASSED [ 95%]
tests/models/test_location.py::TestLocationModel::test_location_repr PASSED [ 95%]
tests/models/test_location.py::TestLocationModel::test_location_repr_no_en_name PASSED [ 95%]
tests/models/test_mobile_group.py::TestMobileGroupModel::test_create_mobile_group_all_fields PASSED [ 95%]
tests/models/test_mobile_group.py::TestMobileGroupModel::test_create_mobile_group_defaults PASSED [ 96%]
tests/models/test_mobile_group.py::TestMobileGroupModel::test_mobile_group_repr PASSED [ 96%]
tests/models/test_party.py::TestPartyModel::test_create_party_all_fields PASSED [ 96%]
tests/models/test_party.py::TestPartyModel::test_create_party_minimal PASSED [ 96%]
tests/models/test_party.py::TestPartyModel::test_party_repr PASSED       [ 96%]
tests/models/test_party.py::TestPartyModel::test_party_repr_no_members PASSED [ 96%]
tests/models/test_party_npc_memory.py::TestPartyNpcMemoryModel::test_create_party_npc_memory_minimal XFAIL [ 96%]
tests/models/test_party_npc_memory.py::TestPartyNpcMemoryModel::test_create_party_npc_memory_full XFAIL [ 96%]
tests/models/test_party_npc_memory.py::TestPartyNpcMemoryModel::test_foreign_key_guild_constraint XFAIL [ 96%]
tests/models/test_party_npc_memory.py::TestPartyNpcMemoryModel::test_foreign_key_party_constraint XFAIL [ 97%]
tests/models/test_party_npc_memory.py::TestPartyNpcMemoryModel::test_foreign_key_npc_constraint XFAIL [ 97%]
tests/models/test_party_npc_memory.py::TestPartyNpcMemoryModel::test_nullable_fields XFAIL [ 97%]
tests/models/test_player.py::TestPlayerModel::test_create_player_all_fields PASSED [ 97%]
tests/models/test_player.py::TestPlayerModel::test_create_player_minimal PASSED [ 97%]
tests/models/test_player.py::TestPlayerModel::test_player_attributes_json_default_is_new_dict PASSED [ 97%]
tests/models/test_player.py::TestPlayerModel::test_player_repr PASSED    [ 97%]
tests/models/test_player.py::TestPlayerModel::test_player_unique_constraint_guild_discord_id PASSED [ 97%]
tests/models/test_quest.py::TestQuestModels::test_create_generated_quest PASSED [ 97%]
tests/models/test_quest.py::TestQuestModels::test_create_player_quest_progress_for_party PASSED [ 98%]
tests/models/test_quest.py::TestQuestModels::test_create_player_quest_progress_for_player PASSED [ 98%]
tests/models/test_quest.py::TestQuestModels::test_create_quest_step PASSED [ 98%]
tests/models/test_quest.py::TestQuestModels::test_create_questline PASSED [ 98%]
tests/models/test_quest.py::TestQuestModels::test_player_quest_progress_relationships PASSED [ 98%]
tests/models/test_quest.py::TestQuestModels::test_quest_step_relationship PASSED [ 98%]
tests/models/test_quest.py::TestQuestModels::test_questline_quest_relationship PASSED [ 98%]
tests/models/test_status_effect.py::TestStatusEffectModels::test_active_status_effect_repr PASSED [ 98%]
tests/models/test_status_effect.py::TestStatusEffectModels::test_create_active_status_effect PASSED [ 98%]
tests/models/test_status_effect.py::TestStatusEffectModels::test_create_status_effect PASSED [ 99%]
tests/models/test_status_effect.py::TestStatusEffectModels::test_status_effect_repr PASSED [ 99%]
tests/test_main.py::test_main_success ERROR                              [ 99%]
tests/test_main.py::test_main_db_init_error ERROR                        [ 99%]
tests/test_main.py::test_main_discord_login_failure ERROR                [ 99%]
tests/test_main.py::test_main_generic_start_exception ERROR              [ 99%]
tests/test_main.py::test_main_keyboard_interrupt_handling ERROR          [ 99%]
tests/test_main.py::test_main_no_token_fixed ERROR                       [ 99%]
tests/test_main.py::test_main_success_with_bot_args_check ERROR          [100%]

==================================== ERRORS ====================================
_______ ERROR at setup of test_apply_consequences_update_location_state ________
file /app/tests/core/test_interaction_handlers.py, line 765
  @pytest.mark.asyncio
  @patch("backend.core.interaction_handlers.get_rule", new_callable=AsyncMock)
  @patch("backend.core.interaction_handlers.player_crud", new_callable=AsyncMock)
  @patch("backend.core.interaction_handlers.location_crud", new_callable=AsyncMock)
  @patch("backend.core.interaction_handlers.log_event", new_callable=AsyncMock)
  # Patches for consequence effect handlers if they were external, but they are internal for now or mocked directly
  @patch("backend.core.entity_stats_utils.change_entity_stat", new_callable=MagicMock) # Corrected patch path
  @patch("backend.core.interaction_handlers.EventType", new=PristineEventType) # Added EventType patch
  async def test_apply_consequences_update_location_state(
      mock_sut_event_type_patch: MagicMock, # For EventType patch
      mock_change_stat: MagicMock,
      mock_log_event: AsyncMock,
      mock_location_crud: AsyncMock,
      mock_player_crud: AsyncMock,
      mock_get_rule: AsyncMock, # For interaction rule AND consequence rule
      mock_session: AsyncSession,
      mock_player: Player,
      mock_location_with_details: Location # Location with interactables
  ):
      mock_player_crud.get.return_value = mock_player
      mock_location_crud.get.return_value = mock_location_with_details

      # Target object for interaction
      target_object_name = "Old Chest"
      target_object_original_state = "locked"

      # Ensure the target object exists and set its initial state
      found_chest = False
      if mock_location_with_details.generated_details_json and "interactable_elements" in mock_location_with_details.generated_details_json:
          for item in mock_location_with_details.generated_details_json["interactable_elements"]:
              if item.get("name") == target_object_name:
                  item["state"] = target_object_original_state # Set initial state
                  item["interaction_rules_key"] = "unlockable_chest" # Key for interaction rule
                  found_chest = True
                  break
      assert found_chest, "Test setup error: Old Chest not found in mock_location_with_details"

      # 1. Mock the interaction rule (e.g., for a successful check)
      interaction_rule_content = {
          "requires_check": False, # Or True with a mocked successful check leading to these consequences
          "direct_consequences_key": "chest_unlocked_consequences"
          # If requires_check=True: "success_consequences_key": "chest_unlocked_consequences"
      }

      # 2. Mock the consequence rule
      consequence_key = "chest_unlocked_consequences"
      consequence_rule_content = [
          {
              "type": "update_location_state",
              "target_object_name": target_object_name,
              "property_name": "state",
              "new_value": "unlocked",
              "feedback_message_key": "chest_now_unlocked_feedback" # Optional feedback
          }
      ]

      # get_rule will be called twice: once for interaction, once for consequence
      def get_rule_side_effect(session, guild_id, key):
E       fixture 'mock_get_rule' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_db_session, mock_location, mock_location_crud, mock_location_no_details, mock_location_with_details, mock_player, mock_session, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/core/test_interaction_handlers.py:765
_________ ERROR at setup of test_apply_consequences_change_player_stat _________
file /app/tests/core/test_interaction_handlers.py, line 889
  @pytest.mark.asyncio
  @patch("backend.core.interaction_handlers.get_rule", new_callable=AsyncMock)
  @patch("backend.core.interaction_handlers.player_crud", new_callable=AsyncMock)
  @patch("backend.core.interaction_handlers.location_crud", new_callable=AsyncMock)
  @patch("backend.core.interaction_handlers.log_event", new_callable=AsyncMock)
  @patch("backend.core.entity_stats_utils.change_entity_stat") # Corrected patch path
  @patch("backend.core.interaction_handlers.EventType", new=PristineEventType) # Added EventType patch
  async def test_apply_consequences_change_player_stat(
      mock_sut_event_type_patch: MagicMock, # For EventType patch
      mock_change_entity_stat: MagicMock,
      mock_log_event: AsyncMock,
      mock_location_crud: AsyncMock,
      mock_player_crud: AsyncMock,
      mock_get_rule: AsyncMock,
      mock_session: AsyncSession,
      mock_player: Player,
      mock_location_with_details: Location
  ):
      mock_player_crud.get.return_value = mock_player
      mock_location_crud.get.return_value = mock_location_with_details
      target_object_name = "Old Chest" # Interaction target

      interaction_rule_content = {"direct_consequences_key": "buff_strength_consequence"}
      consequence_key = "buff_strength_consequence"
      consequence_rule_content = [{
          "type": "change_player_stat", "stat_name": "strength", "change_amount": 2,
          "feedback_message_key": "player_feels_stronger"
      }]

      def get_rule_side_effect(session, guild_id, key):
E       fixture 'mock_get_rule' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_db_session, mock_location, mock_location_crud, mock_location_no_details, mock_location_with_details, mock_player, mock_session, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/app/tests/core/test_interaction_handlers.py:889
_____________________ ERROR at setup of test_main_success ______________________
tests/test_main.py:24: in mock_settings
    monkeypatch.setattr(main_module, 'DISCORD_BOT_TOKEN', 'fake_token')
E   AttributeError: <module 'backend.main' from '/app/backend/main.py'> has no attribute 'DISCORD_BOT_TOKEN'
__________________ ERROR at setup of test_main_db_init_error ___________________
tests/test_main.py:24: in mock_settings
    monkeypatch.setattr(main_module, 'DISCORD_BOT_TOKEN', 'fake_token')
E   AttributeError: <module 'backend.main' from '/app/backend/main.py'> has no attribute 'DISCORD_BOT_TOKEN'
______________ ERROR at setup of test_main_discord_login_failure _______________
tests/test_main.py:24: in mock_settings
    monkeypatch.setattr(main_module, 'DISCORD_BOT_TOKEN', 'fake_token')
E   AttributeError: <module 'backend.main' from '/app/backend/main.py'> has no attribute 'DISCORD_BOT_TOKEN'
_____________ ERROR at setup of test_main_generic_start_exception ______________
tests/test_main.py:24: in mock_settings
    monkeypatch.setattr(main_module, 'DISCORD_BOT_TOKEN', 'fake_token')
E   AttributeError: <module 'backend.main' from '/app/backend/main.py'> has no attribute 'DISCORD_BOT_TOKEN'
___________ ERROR at setup of test_main_keyboard_interrupt_handling ____________
tests/test_main.py:24: in mock_settings
    monkeypatch.setattr(main_module, 'DISCORD_BOT_TOKEN', 'fake_token')
E   AttributeError: <module 'backend.main' from '/app/backend/main.py'> has no attribute 'DISCORD_BOT_TOKEN'
__________________ ERROR at setup of test_main_no_token_fixed __________________
tests/test_main.py:24: in mock_settings
    monkeypatch.setattr(main_module, 'DISCORD_BOT_TOKEN', 'fake_token')
E   AttributeError: <module 'backend.main' from '/app/backend/main.py'> has no attribute 'DISCORD_BOT_TOKEN'
___________ ERROR at setup of test_main_success_with_bot_args_check ____________
tests/test_main.py:24: in mock_settings
    monkeypatch.setattr(main_module, 'DISCORD_BOT_TOKEN', 'fake_token')
E   AttributeError: <module 'backend.main' from '/app/backend/main.py'> has no attribute 'DISCORD_BOT_TOKEN'
=================================== FAILURES ===================================
________________________ test_discord_callback_success _________________________
tests/api/routers/test_auth.py:133: in test_discord_callback_success
    assert response.status_code == status.HTTP_307_TEMPORARY_REDIRECT # RedirectResponse   307
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 404 == 307
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   307 = status.HTTP_307_TEMPORARY_REDIRECT
______________ test_discord_callback_missing_redirect_url_config _______________
tests/api/routers/test_auth.py:173: in test_discord_callback_missing_redirect_url_config
    assert response.status_code == status.HTTP_500_INTERNAL_SERVER_ERROR
E   assert 404 == 500
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   500 = status.HTTP_500_INTERNAL_SERVER_ERROR
________________________ test_set_active_guild_success _________________________
tests/api/routers/test_auth.py:184: in test_set_active_guild_success
    assert response.status_code == status.HTTP_200_OK
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   200 = status.HTTP_200_OK
_______________________ test_set_active_guild_forbidden ________________________
tests/api/routers/test_auth.py:195: in test_set_active_guild_forbidden
    assert response.status_code == status.HTTP_403_FORBIDDEN
E   assert 404 == 403
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   403 = status.HTTP_403_FORBIDDEN
_____________ test_set_active_guild_no_accessible_guilds_in_token ______________
tests/api/routers/test_auth.py:205: in test_set_active_guild_no_accessible_guilds_in_token
    assert response.status_code == status.HTTP_403_FORBIDDEN
E   assert 404 == 403
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   403 = status.HTTP_403_FORBIDDEN
__________________ test_set_active_guild_forbidden_empty_list __________________
tests/api/routers/test_auth.py:215: in test_set_active_guild_forbidden_empty_list
    assert response.status_code == status.HTTP_403_FORBIDDEN
E   assert 404 == 403
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   403 = status.HTTP_403_FORBIDDEN
_____________________________ test_logout_success ______________________________
tests/api/routers/test_auth.py:222: in test_logout_success
    assert response.status_code == status.HTTP_204_NO_CONTENT
E   assert 404 == 204
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   204 = status.HTTP_204_NO_CONTENT
_____________________________ test_logout_no_token _____________________________
tests/api/routers/test_auth.py:226: in test_logout_no_token
    assert response.status_code == status.HTTP_401_UNAUTHORIZED
E   assert 404 == 401
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   401 = status.HTTP_401_UNAUTHORIZED
_________________________ test_discord_login_redirect __________________________
tests/api/routers/test_auth.py:267: in test_discord_login_redirect
    assert response.status_code == status.HTTP_307_TEMPORARY_REDIRECT
E   assert 404 == 307
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   307 = status.HTTP_307_TEMPORARY_REDIRECT
______________________ test_discord_login_missing_config _______________________
tests/api/routers/test_auth.py:282: in test_discord_login_missing_config
    assert response.status_code == status.HTTP_500_INTERNAL_SERVER_ERROR
E   assert 404 == 500
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   500 = status.HTTP_500_INTERNAL_SERVER_ERROR
__________________________ test_get_me_guilds_success __________________________
tests/api/routers/test_auth.py:290: in test_get_me_guilds_success
    assert response.status_code == status.HTTP_200_OK
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   200 = status.HTTP_200_OK
____________________ test_get_me_guilds_no_guilds_in_token _____________________
tests/api/routers/test_auth.py:296: in test_get_me_guilds_no_guilds_in_token
    assert response.status_code == status.HTTP_200_OK
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   200 = status.HTTP_200_OK
____________________ test_get_session_active_guild_success _____________________
tests/api/routers/test_auth.py:303: in test_get_session_active_guild_success
    assert response.status_code == status.HTTP_200_OK
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   200 = status.HTTP_200_OK
____________________ test_get_session_active_guild_not_set _____________________
tests/api/routers/test_auth.py:309: in test_get_session_active_guild_not_set
    assert response.status_code == status.HTTP_200_OK
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   200 = status.HTTP_200_OK
__________________ test_discord_callback_token_exchange_error __________________
tests/api/routers/test_auth.py:338: in test_discord_callback_token_exchange_error
    assert response.status_code == status.HTTP_400_BAD_REQUEST
E   assert 404 == 400
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   400 = status.HTTP_400_BAD_REQUEST
____________________ test_discord_callback_user_info_error _____________________
tests/api/routers/test_auth.py:375: in test_discord_callback_user_info_error
    assert response.status_code == status.HTTP_400_BAD_REQUEST
E   assert 404 == 400
E    +  where 404 = <Response [404 Not Found]>.status_code
E    +  and   400 = status.HTTP_400_BAD_REQUEST
______________ test_discord_callback_master_user_creation_details ______________
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:960: in assert_called_once_with
    raise AssertionError(msg)
E   AssertionError: Expected 'create' to be called once. Called 0 times.

During handling of the above exception, another exception occurred:
tests/api/routers/test_auth.py:434: in test_discord_callback_master_user_creation_details
    mock_crud_master_user.create.assert_called_once_with(
E   AssertionError: Expected 'create' to be called once. Called 0 times.
_____________________ test_list_bot_commands_success_empty _____________________
tests/bot/api/test_commands_api.py:65: in test_list_bot_commands_success_empty
    assert data["language_code"] == settings.BOT_LANGUAGE #    
                                    ^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'backend.config.settings' has no attribute 'BOT_LANGUAGE'
________ test_list_bot_commands_uses_default_language_if_none_provided _________
tests/bot/api/test_commands_api.py:100: in test_list_bot_commands_uses_default_language_if_none_provided
    assert data["language_code"] == settings.BOT_LANGUAGE
                                    ^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'backend.config.settings' has no attribute 'BOT_LANGUAGE'
____________________ test_list_bot_commands_internal_error _____________________
tests/bot/api/test_commands_api.py:112: in test_list_bot_commands_internal_error
    expected_lang = settings.BOT_LANGUAGE
                    ^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'backend.config.settings' has no attribute 'BOT_LANGUAGE'
------------------------------ Captured log call -------------------------------
ERROR    backend.bot.api.commands_api:commands_api.py:97 Error retrieving bot commands: Internal processing error
Traceback (most recent call last):
  File "/app/backend/bot/api/commands_api.py", line 86, in list_bot_commands
    commands_list: List[CommandInfo] = await get_bot_commands(
                                       ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py", line 2291, in _execute_mock_call
    raise effect
Exception: Internal processing error
____________ TestGeneralCommands.test_start_command_existing_player ____________
tests/bot/commands/test_general_commands.py:84: in setUp
    self.mock_get_rule = self.patcher_get_rule.start()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1624: in start
    result = self.__enter__()
             ^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'backend.bot.commands.general_commands' from '/app/backend/bot/commands/general_commands.py'> does not have the attribute 'get_rule'
______________ TestGeneralCommands.test_start_command_new_player _______________
tests/bot/commands/test_general_commands.py:84: in setUp
    self.mock_get_rule = self.patcher_get_rule.start()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1624: in start
    result = self.__enter__()
             ^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'backend.bot.commands.general_commands' from '/app/backend/bot/commands/general_commands.py'> does not have the attribute 'get_rule'
____ TestGeneralCommands.test_start_command_no_default_start_location_found ____
tests/bot/commands/test_general_commands.py:84: in setUp
    self.mock_get_rule = self.patcher_get_rule.start()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1624: in start
    result = self.__enter__()
             ^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'backend.bot.commands.general_commands' from '/app/backend/bot/commands/general_commands.py'> does not have the attribute 'get_rule'
_______________ TestGeneralCommands.test_start_command_no_guild ________________
tests/bot/commands/test_general_commands.py:84: in setUp
    self.mock_get_rule = self.patcher_get_rule.start()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1624: in start
    result = self.__enter__()
             ^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'backend.bot.commands.general_commands' from '/app/backend/bot/commands/general_commands.py'> does not have the attribute 'get_rule'
______________ TestPartyCommands.test_party_create_name_too_long _______________
tests/bot/commands/test_party_commands.py:200: in test_party_create_name_too_long
    self.ctx.send.assert_called_once_with(f"{self.author.mention},     ( 10 ).")
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:961: in assert_called_once_with
    return self.assert_called_with(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:949: in assert_called_with
    raise AssertionError(_error_message()) from cause
E   AssertionError: expected call not found.
E   Expected: send('<@321>,     ( 10 ).')
E     Actual: send('<@321>,            (3-32 , , , , , ).')
___________ TestPartyCommands.test_party_join_moves_player_location ____________
tests/bot/commands/test_party_commands.py:422: in test_party_join_moves_player_location
    self.assertEqual(player_in_db.current_location_id, different_loc.id) # Player moved
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: 10 != 11
------------------------------ Captured log call -------------------------------
ERROR    backend.bot.commands.party_commands:party_commands.py:352       TestPartyUser#0000   789: '<' not supported between instances of 'NoneType' and 'int'
Traceback (most recent call last):
  File "/app/backend/bot/commands/party_commands.py", line 314, in party_join
    if player.level < min_level_req:
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<' not supported between instances of 'NoneType' and 'int'
______________ TestPartyCommands.test_party_join_success_by_name _______________
tests/bot/commands/test_party_commands.py:394: in test_party_join_success_by_name
    self.mock_party_crud.add_player_to_party_json.assert_called_once_with(self.session_mock, party=target_party, player_id=player_in_db.id)
/home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:960: in assert_called_once_with
    raise AssertionError(msg)
E   AssertionError: Expected 'add_player_to_party_json' to be called once. Called 0 times.
------------------------------ Captured log call -------------------------------
ERROR    backend.bot.commands.party_commands:party_commands.py:352       TestPartyUser#0000   789: '<' not supported between instances of 'NoneType' and 'int'
Traceback (most recent call last):
  File "/app/backend/bot/commands/party_commands.py", line 314, in party_join
    if player.level < min_level_req:
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: '<' not supported between instances of 'NoneType' and 'int'
___________________ test_apply_consequences_teleport_player ____________________
tests/core/test_interaction_handlers.py:1104: in test_apply_consequences_teleport_player
    assert movement_log_found, f"PLAYER_MOVED event for teleport not logged. Log calls: {mock_log_event.call_args_list}"
E   AssertionError: PLAYER_MOVED event for teleport not logged. Log calls: [call(<EventType.CONSEQUENCE_EFFECT_ERROR: 'consequence_effect_error'>, <AsyncMock spec='AsyncSession' id='140599451914352'>, guild_id=1, details_json={'player_id': 1, 'location_id': 1, 'rule_key': 'consequences:portal_teleports_player', 'effect_index': 0, 'failed_effect_rule': {'type': 'teleport_player', 'target_location_static_id': 'secret_chamber', 'feedback_message_key': 'player_teleported'}, 'error': "type object 'EventType' has no attribute 'PLAYER_MOVED'"}),
E      call(session=<AsyncMock spec='AsyncSession' id='140599451914352'>, guild_id=1, event_type='player_interact', details_json={'player_id': 1, 'target': 'Mystic Portal', 'location_id': 1, 'sublocation': None, 'interaction_rules_key': 'portal_activation', 'rule_found': True, 'rule_content': {'direct_consequences_key': 'portal_teleports_player'}, 'check_required': False, 'applied_consequences_key': 'portal_teleports_player'}, player_id=1, location_id=1)]
E   assert False
----------------------------- Captured stdout call -----------------------------
DEBUG TELEPORT: Using PristineEventType for assertions. ID: 94443206658416
DEBUG TELEPORT: PristineEventType.PLAYER_MOVED DOES NOT EXIST. Dir: ['ABILITY_USED', 'AI_CONTENT_APPROVED', 'AI_CONTENT_EDITED', 'AI_CONTENT_REJECTED', 'AI_CONTENT_SAVED', 'AI_CONTENT_VALIDATION_FAILED', 'AI_CONTENT_VALIDATION_SUCCESS', 'AI_GENERATION_TRIGGERED', 'AI_RESPONSE_RECEIVED', 'ATTRIBUTE_POINTS_SPENT', 'COMBAT_ACTION', 'COMBAT_END', 'COMBAT_START', 'CONSEQUENCE_EFFECT_APPLIED', 'CONSEQUENCE_EFFECT_ERROR', 'DIALOGUE_END', 'DIALOGUE_LINE', 'DIALOGUE_START', 'ERROR_EVENT', 'FACTION_CHANGE', 'GE_TRIGGERED_DIALOGUE_PLACEHOLDER', 'GLOBAL_ENTITY_ACTION', 'GLOBAL_ENTITY_DETECTED_ENTITY', 'GLOBAL_ENTITY_MOVED', 'ITEM_ACQUIRED', 'ITEM_DROPPED', 'ITEM_LOST', 'ITEM_USED', 'LEVEL_UP', 'MASTER_ACTION_LOCATIONS_CONNECTED', 'MASTER_ACTION_LOCATIONS_DISCONNECTED', 'MASTER_ACTION_LOCATION_ADDED', 'MASTER_ACTION_LOCATION_REMOVED', 'MASTER_COMMAND', 'MOVEMENT', 'NPC_ACTION', 'PLAYER_ACTION', 'QUEST_ACCEPTED', 'QUEST_COMPLETED', 'QUEST_FAILED', 'QUEST_STEP_COMPLETED', 'RELATIONSHIP_CHANGE', 'STATUS_APPLIED', 'STATUS_REMOVED', 'STATUS_TICK_EFFECT', 'SYSTEM_EVENT', 'TRADE_COMPLETED', 'TRADE_INITIATED', 'TRADE_ITEM_BOUGHT', 'TRADE_ITEM_SOLD', 'TURN_END', 'TURN_START', 'WORLD_EVENT_ECONOMIC_ENTITIES_GENERATED', 'WORLD_EVENT_FACTIONS_GENERATED', 'WORLD_EVENT_LOCATION_GENERATED', 'WORLD_EVENT_QUESTS_GENERATED', 'WORLD_STATE_CHANGE', 'XP_GAINED', '__class__', '__contains__', '__doc__', '__getitem__', '__init_subclass__', '__iter__', '__len__', '__members__', '__module__', '__name__', '__qualname__']
DEBUG TELEPORT: PristineEventType.CONSEQUENCE_EFFECT_APPLIED exists. Value: 'consequence_effect_applied'
DEBUG TELEPORT: Log call 0 - Extracted event type: 'EventType.CONSEQUENCE_EFFECT_ERROR', Type: <enum 'EventType'>
DEBUG TELEPORT: Log call 1 - Extracted event type: 'player_interact', Type: <class 'str'>
------------------------------ Captured log call -------------------------------
ERROR    backend.core.interaction_handlers:interaction_handlers.py:473 Error applying consequence effect {'type': 'teleport_player', 'target_location_static_id': 'secret_chamber', 'feedback_message_key': 'player_teleported'} for key consequences:portal_teleports_player: type object 'EventType' has no attribute 'PLAYER_MOVED'
Traceback (most recent call last):
  File "/app/backend/core/interaction_handlers.py", line 407, in _apply_consequences
    await log_event(EventType.PLAYER_MOVED, session, guild_id=guild_id, # Corrected: Use Enum member
                    ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'EventType' has no attribute 'PLAYER_MOVED'
___________________ test_execute_move_successful_solo_player ___________________
tests/core/test_movement_logic.py:558: in test_execute_move_successful_solo_player
    assert result["status"] == "success"
E   AssertionError: assert 'error' == 'success'
E
E     - success
E     + error
------------------------------ Captured log call -------------------------------
WARNING  backend.core.rules:rules.py:54 Rule key 'movement:allowed_player_statuses' not found for guild_id 1 in cache. Returning default: ['IDLE', 'EXPLORING']
WARNING  backend.core.movement_logic:movement_logic.py:788 MovementError for player 1 in guild 1 targeting 'forest': Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING
___________________ test_execute_move_successful_party_move ____________________
tests/core/test_movement_logic.py:623: in test_execute_move_successful_party_move
    assert result["status"] == "success"
E   AssertionError: assert 'error' == 'success'
E
E     - success
E     + error
------------------------------ Captured log call -------------------------------
WARNING  backend.core.rules:rules.py:54 Rule key 'movement:allowed_player_statuses' not found for guild_id 1 in cache. Returning default: ['IDLE', 'EXPLORING']
WARNING  backend.core.movement_logic:movement_logic.py:788 MovementError for player 1 in guild 1 targeting 'forest': Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING
___________ test_execute_move_target_location_not_found_by_static_id ___________
tests/core/test_movement_logic.py:724: in test_execute_move_target_location_not_found_by_static_id
    assert f"Location '{NON_EXISTENT_LOCATION_STATIC_ID}' could not be found" in result["message"]
E   assert "Location 'void' could not be found" in 'Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING'
------------------------------ Captured log call -------------------------------
WARNING  backend.core.rules:rules.py:54 Rule key 'movement:allowed_player_statuses' not found for guild_id 1 in cache. Returning default: ['IDLE', 'EXPLORING']
WARNING  backend.core.movement_logic:movement_logic.py:788 MovementError for player 1 in guild 1 targeting 'void': Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING
_______________________ test_execute_move_not_connected ________________________
tests/core/test_movement_logic.py:761: in test_execute_move_not_connected
    assert f"You cannot move directly from '{mock_start_location.name_i18n['en']}' to '{mock_unconnected_location.name_i18n['en']}'" in result["message"]
E   assert "You cannot move directly from 'Start Zone' to 'Mountain'" in 'Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING'
------------------------------ Captured log call -------------------------------
WARNING  backend.core.rules:rules.py:54 Rule key 'movement:allowed_player_statuses' not found for guild_id 1 in cache. Returning default: ['IDLE', 'EXPLORING']
WARNING  backend.core.movement_logic:movement_logic.py:788 MovementError for player 1 in guild 1 targeting 'mountain': Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING
_____________ test_execute_move_uses_find_location_helper_success ______________
tests/core/test_movement_logic.py:1074: in test_execute_move_uses_find_location_helper_success
    assert result["status"] == "success"
E   AssertionError: assert 'error' == 'success'
E
E     - success
E     + error
------------------------------ Captured log call -------------------------------
WARNING  backend.core.movement_logic:movement_logic.py:357 Rule 'movement:allowed_player_statuses' for guild 1 is not a list: en. Defaulting.
WARNING  backend.core.movement_logic:movement_logic.py:788 MovementError for player 1 in guild 1 targeting 'forest': Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING
___________ test_execute_move_when_find_location_helper_returns_none ___________
tests/core/test_movement_logic.py:1114: in test_execute_move_when_find_location_helper_returns_none
    assert "Location 'some_unknown_place' could not be found" in result["message"]
E   assert "Location 'some_unknown_place' could not be found" in 'Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING'
------------------------------ Captured log call -------------------------------
WARNING  backend.core.movement_logic:movement_logic.py:357 Rule 'movement:allowed_player_statuses' for guild 1 is not a list: <MagicMock name='get_rule()' spec='RuleConfig' id='140599377689392'>. Defaulting.
WARNING  backend.core.movement_logic:movement_logic.py:788 MovementError for player 1 in guild 1 targeting 'some_unknown_place': Cannot move while in status: exploring. Allowed statuses: IDLE, EXPLORING
=============================== warnings summary ===============================
../home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/discord/player.py:29
  /home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/discord/player.py:29: DeprecationWarning: 'audioop' is deprecated and slated for removal in Python 3.13
    import audioop

../home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pydantic/_internal/_config.py:323
  /home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

../home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

tests/bot/commands/master_commands/test_master_conflict_commands.py::test_resolve_conflict_does_not_trigger_reprocessing_if_others_remain
  /home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:2217: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    def __init__(self, name, parent):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/core/test_action_processor.py::test_process_actions_player_no_actions
  /home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/stash.py:108: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    del self._storage[key]
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/core/test_ai_orchestrator.py::test_save_approved_generation_success
  /app/backend/core/database.py:135: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    return await func(*processed_args, **kwargs) # kwargs contains 'session' if it was passed that way
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/core/test_turn_controller.py::test_process_guild_turn_one_party_pending_with_member
  /home/jules/.pyenv/versions/3.12.11/lib/python3.12/unittest/mock.py:404: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    def __init__(self, /, *args, **kwargs):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/core/test_turn_controller.py::test_process_guild_turn_releases_lock_on_exception
  /home/jules/.pyenv/versions/3.12.11/lib/python3.12/site-packages/_pytest/stash.py:108: RuntimeWarning: coroutine 'test_process_guild_turn_releases_lock_on_exception.<locals>.sync_simulated_create_task.<locals>.run_coro_and_catch_exception' was never awaited
    del self._storage[key]
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/core/test_world_generation.py::TestWorldGeneration::test_generate_factions_and_relationships_existing_static_id
  /home/jules/.pyenv/versions/3.12.11/lib/python3.12/traceback.py:265: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    def __init__(self, filename, lineno, name, *, lookup_line=True,
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/api/routers/test_auth.py::test_discord_callback_success - assert...
FAILED tests/api/routers/test_auth.py::test_discord_callback_missing_redirect_url_config
FAILED tests/api/routers/test_auth.py::test_set_active_guild_success - assert...
FAILED tests/api/routers/test_auth.py::test_set_active_guild_forbidden - asse...
FAILED tests/api/routers/test_auth.py::test_set_active_guild_no_accessible_guilds_in_token
FAILED tests/api/routers/test_auth.py::test_set_active_guild_forbidden_empty_list
FAILED tests/api/routers/test_auth.py::test_logout_success - assert 404 == 204
FAILED tests/api/routers/test_auth.py::test_logout_no_token - assert 404 == 401
FAILED tests/api/routers/test_auth.py::test_discord_login_redirect - assert 4...
FAILED tests/api/routers/test_auth.py::test_discord_login_missing_config - as...
FAILED tests/api/routers/test_auth.py::test_get_me_guilds_success - assert 40...
FAILED tests/api/routers/test_auth.py::test_get_me_guilds_no_guilds_in_token
FAILED tests/api/routers/test_auth.py::test_get_session_active_guild_success
FAILED tests/api/routers/test_auth.py::test_get_session_active_guild_not_set
FAILED tests/api/routers/test_auth.py::test_discord_callback_token_exchange_error
FAILED tests/api/routers/test_auth.py::test_discord_callback_user_info_error
FAILED tests/api/routers/test_auth.py::test_discord_callback_master_user_creation_details
FAILED tests/bot/api/test_commands_api.py::test_list_bot_commands_success_empty
FAILED tests/bot/api/test_commands_api.py::test_list_bot_commands_uses_default_language_if_none_provided
FAILED tests/bot/api/test_commands_api.py::test_list_bot_commands_internal_error
FAILED tests/bot/commands/test_general_commands.py::TestGeneralCommands::test_start_command_existing_player
FAILED tests/bot/commands/test_general_commands.py::TestGeneralCommands::test_start_command_new_player
FAILED tests/bot/commands/test_general_commands.py::TestGeneralCommands::test_start_command_no_default_start_location_found
FAILED tests/bot/commands/test_general_commands.py::TestGeneralCommands::test_start_command_no_guild
FAILED tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_create_name_too_long
FAILED tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_join_moves_player_location
FAILED tests/bot/commands/test_party_commands.py::TestPartyCommands::test_party_join_success_by_name
FAILED tests/core/test_interaction_handlers.py::test_apply_consequences_teleport_player
FAILED tests/core/test_movement_logic.py::test_execute_move_successful_solo_player
FAILED tests/core/test_movement_logic.py::test_execute_move_successful_party_move
FAILED tests/core/test_movement_logic.py::test_execute_move_target_location_not_found_by_static_id
FAILED tests/core/test_movement_logic.py::test_execute_move_not_connected - a...
FAILED tests/core/test_movement_logic.py::test_execute_move_uses_find_location_helper_success
FAILED tests/core/test_movement_logic.py::test_execute_move_when_find_location_helper_returns_none
ERROR tests/core/test_interaction_handlers.py::test_apply_consequences_update_location_state
ERROR tests/core/test_interaction_handlers.py::test_apply_consequences_change_player_stat
ERROR tests/test_main.py::test_main_success - AttributeError: <module 'backen...
ERROR tests/test_main.py::test_main_db_init_error - AttributeError: <module '...
ERROR tests/test_main.py::test_main_discord_login_failure - AttributeError: <...
ERROR tests/test_main.py::test_main_generic_start_exception - AttributeError:...
ERROR tests/test_main.py::test_main_keyboard_interrupt_handling - AttributeEr...
ERROR tests/test_main.py::test_main_no_token_fixed - AttributeError: <module ...
ERROR tests/test_main.py::test_main_success_with_bot_args_check - AttributeEr...
= 34 failed, 840 passed, 14 xfailed, 9 warnings, 9 errors in 100.72s (0:01:40) =
